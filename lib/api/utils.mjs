var g="ray_tab_hash",i="ray_req_hash",y=()=>{if(typeof window===void 0)return"";let t=sessionStorage.getItem(g);return t||(t=`ray-${Date.now()}`,sessionStorage.setItem(g,t)),t},f=async({logCount:t=1e3,removeLastLog:o,...e})=>{if(typeof window===void 0)return new Promise(r=>r());let s=JSON.parse(localStorage.getItem(i)||"[]").slice(0,t-1);o&&s.pop(),new Blob([JSON.stringify(e.data)]).size>1024&&(e.data=JSON.stringify(e.data).substring(0,200)+"..."),s.unshift({...e,time:Date.now(),session:y()});try{localStorage.setItem(i,JSON.stringify(s))}catch{if(o){let r=!1,a=JSON.stringify(e.data).substring(0,100);for(s[0].data=a+(a.length>100?"...":"");!r;){s.pop();let n=JSON.stringify(e.data).substring(0,100);s[0].data=n+(n.length>100?"...":"");try{localStorage.setItem(i,JSON.stringify(s)),r=!0}catch{r=!1}}return new Promise(n=>n())}return f({...e,logCount:t,removeLastLog:!0})}};export{g as SESSION_KEY,i as STORAGE_KEY,y as getSessionKey,f as updateReqHistory};
//# sourceMappingURL=utils.mjs.map