import _l from"axios";import{get as ki,set as ls}from"lodash";import ms from"dayjs";import Qu from"dayjs/plugin/utc";ms.extend(Qu);var Hu=(i=>(i[i.Error=0]="Error",i[i.Warning=1]="Warning",i[i.Info=2]="Info",i[i.Debug=3]="Debug",i))(Hu||{}),hi=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return ms().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ti={},ds={};function oe(r){let e=ki(Ti,r);if(!e){let t=ki(ds,r);e=new hi({name:r,logLevel:t}),ls(Ti,r,e)}return e}function Vp(r,e){ls(ds,r,e);let t=ki(Ti,r);t&&(t.level=e)}import{PublicKey as ul}from"@solana/web3.js";import cl from"bn.js";import sl from"big.js";import qt from"bn.js";import we from"bn.js";var fn=9e15,Dt=1e9,Ii="0123456789abcdef",xr="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Br="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",xi={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-fn,maxE:fn,crypto:!1},bs,Rt,j=!0,Kr="[DecimalError] ",Wt=Kr+"Invalid argument: ",gs=Kr+"Precision limit exceeded",ws=Kr+"crypto unavailable",As="[object Decimal]",De=Math.floor,Ce=Math.pow,ju=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Zu=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,$u=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ps=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,pt=1e7,Y=7,Ju=9007199254740991,ec=xr.length-1,Bi=Br.length-1,O={toStringTag:As};O.absoluteValue=O.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),G(r)};O.ceil=function(){return G(new this.constructor(this),this.e+1,2)};O.clampedTo=O.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(Wt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};O.comparedTo=O.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};O.cosine=O.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+Y,n.rounding=1,t=tc(n,xs(n,t)),n.precision=r,n.rounding=e,G(Rt==2||Rt==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};O.cubeRoot=O.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(j=!1,o=l.s*Ce(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=_e(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Ce(t,1/3),r=De((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=be(c.plus(l).times(a),c.plus(u),s+2,1),_e(a.d).slice(0,s)===(t=_e(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(G(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(G(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return j=!0,G(n,r,m.rounding,e)};O.decimalPlaces=O.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-De(this.e/Y))*Y,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};O.dividedBy=O.div=function(r){return be(this,new this.constructor(r))};O.dividedToIntegerBy=O.divToInt=function(r){var e=this,t=e.constructor;return G(be(e,new t(r),0,1,1),t.precision,t.rounding)};O.equals=O.eq=function(r){return this.cmp(r)===0};O.floor=function(){return G(new this.constructor(this),this.e+1,3)};O.greaterThan=O.gt=function(r){return this.cmp(r)>0};O.greaterThanOrEqualTo=O.gte=function(r){var e=this.cmp(r);return e==1||e===0};O.hyperbolicCosine=O.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/Rr(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=yn(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return G(o,s.precision=t,s.rounding=n,!0)};O.hyperbolicSine=O.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=yn(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/Rr(5,r)),i=yn(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,G(i,e,t,!0)};O.hyperbolicTangent=O.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,be(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};O.inverseCosine=O.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?dt(t,i,o):new t(0):new t(NaN):e.isZero()?dt(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=dt(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};O.inverseHyperbolicCosine=O.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,j=!1,t=t.times(t).minus(1).sqrt().plus(t),j=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};O.inverseHyperbolicSine=O.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,j=!1,t=t.times(t).plus(1).sqrt().plus(t),j=!0,n.precision=r,n.rounding=e,t.ln())};O.inverseHyperbolicTangent=O.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?G(new o(i),r,e,!0):(o.precision=t=n-i.e,i=be(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};O.inverseSine=O.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=dt(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};O.inverseTangent=O.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Bi)return s=dt(l,m+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Bi)return s=dt(l,m+4,p).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/Y+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(j=!1,e=Math.ceil(a/Y),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),j=!0,G(s,l.precision=m,l.rounding=p,!0)};O.isFinite=function(){return!!this.d};O.isInteger=O.isInt=function(){return!!this.d&&De(this.e/Y)>this.d.length-2};O.isNaN=function(){return!this.s};O.isNegative=O.isNeg=function(){return this.s<0};O.isPositive=O.isPos=function(){return this.s>0};O.isZero=function(){return!!this.d&&this.d[0]===0};O.lessThan=O.lt=function(r){return this.cmp(r)<0};O.lessThanOrEqualTo=O.lte=function(r){return this.cmp(r)<1};O.logarithm=O.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding,d=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(j=!1,a=m+d,s=vt(c,a),n=e?Sr(l,a+10):vt(r,a),u=be(s,n,a,1),On(u.d,i=m,p))do if(a+=10,s=vt(c,a),n=e?Sr(l,a+10):vt(r,a),u=be(s,n,a,1),!o){+_e(u.d).slice(i+1,i+15)+1==1e14&&(u=G(u,m+1,0));break}while(On(u.d,i+=10,p));return j=!0,G(u,m,p)};O.minus=O.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,p,d=this,y=d.constructor;if(r=new y(r),!d.d||!r.d)return!d.s||!r.s?r=new y(NaN):d.d?r.s=-r.s:r=new y(r.d||d.s!==r.s?d:NaN),r;if(d.s!=r.s)return r.s=-r.s,d.plus(r);if(c=d.d,p=r.d,a=y.precision,u=y.rounding,!c[0]||!p[0]){if(p[0])r.s=-r.s;else if(c[0])r=new y(d);else return new y(u===3?-0:0);return j?G(r,a,u):r}if(t=De(r.e/Y),l=De(d.e/Y),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=p.length):(e=p,t=l,s=c.length),n=Math.max(Math.ceil(a/Y),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=p.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=p[n]){m=c[n]<p[n];break}o=0}for(m&&(e=c,c=p,p=e,r.s=-r.s),s=c.length,n=p.length-s;n>0;--n)c[s++]=0;for(n=p.length;n>o;){if(c[--n]<p[n]){for(i=n;i&&c[--i]===0;)c[i]=pt-1;--c[i],c[n]+=pt}c[n]-=p[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=Cr(c,t),j?G(r,a,u):r):new y(u===3?-0:0)};O.modulo=O.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?G(new n(t),n.precision,n.rounding):(j=!1,n.modulo==9?(e=be(t,r.abs(),0,3,1),e.s*=r.s):e=be(t,r,0,n.modulo,1),e=e.times(r),j=!0,t.minus(e))};O.naturalExponential=O.exp=function(){return Si(this)};O.naturalLogarithm=O.ln=function(){return vt(this)};O.negated=O.neg=function(){var r=new this.constructor(this);return r.s=-r.s,G(r)};O.plus=O.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,p=m.constructor;if(r=new p(r),!m.d||!r.d)return!m.s||!r.s?r=new p(NaN):m.d||(r=new p(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=p.precision,u=p.rounding,!c[0]||!l[0])return l[0]||(r=new p(m)),j?G(r,a,u):r;if(o=De(m.e/Y),n=De(r.e/Y),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/Y),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/pt|0,c[i]%=pt;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=Cr(c,n),j?G(r,a,u):r};O.precision=O.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(Wt+r);return t.d?(e=ks(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};O.round=function(){var r=this,e=r.constructor;return G(new e(r),r.e+1,e.rounding)};O.sine=O.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+Y,n.rounding=1,t=rc(n,xs(n,t)),n.precision=r,n.rounding=e,G(Rt>2?t.neg():t,r,e,!0)):new n(NaN)};O.squareRoot=O.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(j=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=_e(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=De((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(be(s,o,t+2,1)).times(.5),_e(o.d).slice(0,t)===(e=_e(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(G(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(G(n,u+1,1),r=!n.times(n).eq(s));break}return j=!0,G(n,u,l.rounding,r)};O.tangent=O.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=be(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,G(Rt==2||Rt==4?t.neg():t,r,e,!0)):new n(NaN)};O.times=O.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,p=l.d,d=(r=new m(r)).d;if(r.s*=l.s,!p||!p[0]||!d||!d[0])return new m(!r.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?r.s/0:r.s*0);for(t=De(l.e/Y)+De(r.e/Y),u=p.length,c=d.length,u<c&&(o=p,p=d,d=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+d[n]*p[i-n-1]+e,o[i--]=a%pt|0,e=a/pt|0;o[i]=(o[i]+e)%pt|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=Cr(o,t),j?G(r,m.precision,m.rounding):r};O.toBinary=function(r,e){return Ci(this,2,r,e)};O.toDecimalPlaces=O.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Ze(r,0,Dt),e===void 0?e=n.rounding:Ze(e,0,8),G(t,r+t.e+1,e))};O.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=At(n,!0):(Ze(r,0,Dt),e===void 0?e=i.rounding:Ze(e,0,8),n=G(new i(n),r+1,e),t=At(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};O.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=At(i):(Ze(r,0,Dt),e===void 0?e=o.rounding:Ze(e,0,8),n=G(new o(i),r+i.e+1,e),t=At(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};O.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,p,d=this,y=d.d,f=d.constructor;if(!y)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ks(y)-d.e-1,s=o%Y,e.d[0]=Ce(10,s<0?Y+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(Wt+a);r=a.gt(e)?o>0?e:c:a}for(j=!1,a=new f(_e(y)),l=f.precision,f.precision=o=y.length*Y*2;m=be(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=be(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=d.s,p=be(c,n,o,1).minus(d).abs().cmp(be(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,j=!0,p};O.toHexadecimal=O.toHex=function(r,e){return Ci(this,16,r,e)};O.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Ze(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(j=!1,t=be(t,r,0,e,1).times(r),j=!0,G(t)):(r.s=t.s,t=r),t};O.toNumber=function(){return+this};O.toOctal=function(r,e){return Ci(this,8,r,e)};O.toPower=O.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(Ce(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return G(a,n,o);if(e=De(r.e/Y),e>=r.d.length-1&&(t=c<0?-c:c)<=Ju)return i=hs(u,a,t,n),r.s<0?new u(1).div(i):G(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Ce(+a,c),e=t==0||!isFinite(t)?De(c*(Math.log("0."+_e(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(j=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=Si(r.times(vt(a,n+t)),n),i.d&&(i=G(i,n+5,1),On(i.d,n,o)&&(e=n+10,i=G(Si(r.times(vt(a,e+t)),e),e+5,1),+_e(i.d).slice(n+1,n+15)+1==1e14&&(i=G(i,n+1,0)))),i.s=s,j=!0,u.rounding=o,G(i,n,o))};O.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=At(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Ze(r,1,Dt),e===void 0?e=i.rounding:Ze(e,0,8),n=G(new i(n),r,e),t=At(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};O.toSignificantDigits=O.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Ze(r,1,Dt),e===void 0?e=n.rounding:Ze(e,0,8)),G(new n(t),r,e)};O.toString=function(){var r=this,e=r.constructor,t=At(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};O.truncated=O.trunc=function(){return G(new this.constructor(this),this.e+1,1)};O.valueOf=O.toJSON=function(){var r=this,e=r.constructor,t=At(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function _e(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=Y-n.length,t&&(o+=Ft(t)),o+=n;s=r[e],n=s+"",t=Y-n.length,t&&(o+=Ft(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ze(r,e,t){if(r!==~~r||r<e||r>t)throw Error(Wt+r)}function On(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=Y,i=0):(i=Math.ceil((e+1)/Y),e%=Y),o=Ce(10,Y-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==Ce(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==Ce(10,e-3)-1,s}function Ir(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=Ii.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function tc(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/Rr(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=yn(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var be=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,p,d,y,f,b,g,A,k,h,T,I,S,x,R,N,E,z,v=n.constructor,Z=n.s==i.s?1:-1,ee=n.d,ie=i.d;if(!ee||!ee[0]||!ie||!ie[0])return new v(!n.s||!i.s||(ee?ie&&ee[0]==ie[0]:!ie)?NaN:ee&&ee[0]==0||!ie?Z*0:Z/0);for(u?(d=1,l=n.e-i.e):(u=pt,d=Y,l=De(n.e/d)-De(i.e/d)),E=ie.length,R=ee.length,g=new v(Z),A=g.d=[],m=0;ie[m]==(ee[m]||0);m++);if(ie[m]>(ee[m]||0)&&l--,o==null?(I=o=v.precision,s=v.rounding):a?I=o+(n.e-i.e)+1:I=o,I<0)A.push(1),y=!0;else{if(I=I/d+2|0,m=0,E==1){for(p=0,ie=ie[0],I++;(m<R||p)&&I--;m++)S=p*u+(ee[m]||0),A[m]=S/ie|0,p=S%ie|0;y=p||m<R}else{for(p=u/(ie[0]+1)|0,p>1&&(ie=r(ie,p,u),ee=r(ee,p,u),E=ie.length,R=ee.length),x=E,k=ee.slice(0,E),h=k.length;h<E;)k[h++]=0;z=ie.slice(),z.unshift(0),N=ie[0],ie[1]>=u/2&&++N;do p=0,c=e(ie,k,E,h),c<0?(T=k[0],E!=h&&(T=T*u+(k[1]||0)),p=T/N|0,p>1?(p>=u&&(p=u-1),f=r(ie,p,u),b=f.length,h=k.length,c=e(f,k,b,h),c==1&&(p--,t(f,E<b?z:ie,b,u))):(p==0&&(c=p=1),f=ie.slice()),b=f.length,b<h&&f.unshift(0),t(k,f,h,u),c==-1&&(h=k.length,c=e(ie,k,E,h),c<1&&(p++,t(k,E<h?z:ie,h,u))),h=k.length):c===0&&(p++,k=[0]),A[m++]=p,c&&k[0]?k[h++]=ee[x]||0:(k=[ee[x]],h=1);while((x++<R||k[0]!==void 0)&&I--);y=k[0]!==void 0}A[0]||A.shift()}if(d==1)g.e=l,bs=y;else{for(m=1,p=A[0];p>=10;p/=10)m++;g.e=m+l*d-1,G(g,a?o+g.e+1:o,s,y)}return g}}();function G(r,e,t,n){var i,o,s,a,u,c,l,m,p,d=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=Y,s=e,l=m[p=0],u=l/Ce(10,i-s-1)%10|0;else if(p=Math.ceil((o+1)/Y),a=m.length,p>=a)if(n){for(;a++<=p;)m.push(0);l=u=0,i=1,o%=Y,s=o-Y+1}else break e;else{for(l=a=m[p],i=1;a>=10;a/=10)i++;o%=Y,s=o-Y+i,u=s<0?0:l/Ce(10,i-s-1)%10|0}if(n=n||e<0||m[p+1]!==void 0||(s<0?l:l%Ce(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/Ce(10,i-s):0:m[p-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=Ce(10,(Y-e%Y)%Y),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=p,a=1,p--):(m.length=p+1,a=Ce(10,Y-o),m[p]=s>0?(l/Ce(10,i-s)%Ce(10,s)|0)*a:0),c)for(;;)if(p==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==pt&&(m[0]=1));break}else{if(m[p]+=a,m[p]!=pt)break;m[p--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return j&&(r.e>d.maxE?(r.d=null,r.e=NaN):r.e<d.minE&&(r.e=0,r.d=[0])),r}function At(r,e,t){if(!r.isFinite())return Is(r);var n,i=r.e,o=_e(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Ft(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+Ft(-i-1)+o,t&&(n=t-s)>0&&(o+=Ft(n))):i>=s?(o+=Ft(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+Ft(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=Ft(n))),o}function Cr(r,e){var t=r[0];for(e*=Y;t>=10;t/=10)e++;return e}function Sr(r,e,t){if(e>ec)throw j=!0,t&&(r.precision=t),Error(gs);return G(new r(xr),e,1,!0)}function dt(r,e,t){if(e>Bi)throw Error(gs);return G(new r(Br),e,t,!0)}function ks(r){var e=r.length-1,t=e*Y+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function Ft(r){for(var e="";r--;)e+="0";return e}function hs(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/Y+4);for(j=!1;;){if(t%2&&(o=o.times(e),fs(o.d,s)&&(i=!0)),t=De(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),fs(e.d,s)}return j=!0,o}function ps(r){return r.d[r.d.length-1]&1}function Ts(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function Si(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,p=r.constructor,d=p.rounding,y=p.precision;if(!r.d||!r.d[0]||r.e>17)return new p(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(j=!1,u=y):u=e,a=new p(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(Ce(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new p(1),p.precision=u;;){if(o=G(o.times(r),u,1),t=t.times(++l),a=s.plus(be(o,t,u,1)),_e(a.d).slice(0,u)===_e(s.d).slice(0,u)){for(i=m;i--;)s=G(s.times(s),u,1);if(e==null)if(c<3&&On(s.d,u-n,d,c))p.precision=u+=10,t=o=a=new p(1),l=0,c++;else return G(s,p.precision=y,d,j=!0);else return p.precision=y,s}s=a}}function vt(r,e){var t,n,i,o,s,a,u,c,l,m,p,d=1,y=10,f=r,b=f.d,g=f.constructor,A=g.rounding,k=g.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new g(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(j=!1,l=k):l=e,g.precision=l+=y,t=_e(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=_e(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return c=Sr(g,l+2,k).times(o+""),f=vt(new g(n+"."+t.slice(1)),l-y).plus(c),g.precision=k,e==null?G(f,k,A,j=!0):f;for(m=f,u=s=f=be(f.minus(1),f.plus(1),l,1),p=G(f.times(f),l,1),i=3;;){if(s=G(s.times(p),l,1),c=u.plus(be(s,new g(i),l,1)),_e(c.d).slice(0,l)===_e(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Sr(g,l+2,k).times(o+""))),u=be(u,new g(d),l,1),e==null)if(On(u.d,l-y,A,a))g.precision=l+=y,c=s=f=be(m.minus(1),m.plus(1),l,1),p=G(f.times(f),l,1),i=a=1;else return G(u,g.precision=k,A,j=!0);else return g.precision=k,u;u=c,i+=2}}function Is(r){return String(r.s*r.s/0)}function Ki(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%Y,t<0&&(n+=Y),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=Y;n<i;)r.d.push(+e.slice(n,n+=Y));e=e.slice(n),n=Y-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),j&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function nc(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Ps.test(e))return Ki(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(Zu.test(e))t=16,e=e.toLowerCase();else if(ju.test(e))t=2;else if($u.test(e))t=8;else throw Error(Wt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=hs(n,new n(t),o,o*2)),c=Ir(e,t,pt),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=Cr(c,l),r.d=c,j=!1,s&&(r=be(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?Ce(2,u):Nn.pow(2,u))),j=!0,r)}function rc(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:yn(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Rr(5,t)),e=yn(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function yn(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/Y);for(j=!1,u=t.times(t),a=new r(n);;){if(s=be(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=be(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return j=!0,s.d.length=m+1,s}function Rr(r,e){for(var t=r;--e;)t*=r;return t}function xs(r,e){var t,n=e.s<0,i=dt(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return Rt=n?4:1,e;if(t=e.divToInt(i),t.isZero())Rt=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return Rt=ps(t)?n?2:3:n?4:1,e;Rt=ps(t)?n?1:4:n?3:2}return e.minus(i).abs()}function Ci(r,e,t,n){var i,o,s,a,u,c,l,m,p,d=r.constructor,y=t!==void 0;if(y?(Ze(t,1,Dt),n===void 0?n=d.rounding:Ze(n,0,8)):(t=d.precision,n=d.rounding),!r.isFinite())l=Is(r);else{for(l=At(r),s=l.indexOf("."),y?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),p=new d(1),p.e=l.length-s,p.d=Ir(At(p),10,i),p.e=p.d.length),m=Ir(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(r=new d(r),r.d=m,r.e=o,r=be(r,p,t,n,0,i),m=r.d,o=r.e,c=bs),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Ii.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Ir(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Ii.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function fs(r,e){if(r.length>e)return r.length=e,!0}function ic(r){return new this(r).abs()}function oc(r){return new this(r).acos()}function sc(r){return new this(r).acosh()}function ac(r,e){return new this(r).plus(e)}function uc(r){return new this(r).asin()}function cc(r){return new this(r).asinh()}function lc(r){return new this(r).atan()}function mc(r){return new this(r).atanh()}function dc(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=dt(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?dt(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=dt(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(be(r,e,o,1)),e=dt(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(be(r,e,o,1)),t}function pc(r){return new this(r).cbrt()}function fc(r){return G(r=new this(r),r.e+1,2)}function yc(r,e,t){return new this(r).clamp(e,t)}function bc(r){if(!r||typeof r!="object")throw Error(Kr+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,Dt,"rounding",0,8,"toExpNeg",-fn,0,"toExpPos",0,fn,"maxE",0,fn,"minE",-fn,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=xi[t]),(n=r[t])!==void 0)if(De(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Wt+t+": "+n);if(t="crypto",i&&(this[t]=xi[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ws);else this[t]=!1;else throw Error(Wt+t+": "+n);return this}function gc(r){return new this(r).cos()}function wc(r){return new this(r).cosh()}function Bs(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,ys(o)){c.s=o.s,j?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;j?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Ki(c,o.toString())}else if(u!=="string")throw Error(Wt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Ps.test(o)?Ki(c,o):nc(c,o)}if(i.prototype=O,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=bc,i.clone=Bs,i.isDecimal=ys,i.abs=ic,i.acos=oc,i.acosh=sc,i.add=ac,i.asin=uc,i.asinh=cc,i.atan=lc,i.atanh=mc,i.atan2=dc,i.cbrt=pc,i.ceil=fc,i.clamp=yc,i.cos=gc,i.cosh=wc,i.div=Ac,i.exp=Pc,i.floor=kc,i.hypot=hc,i.ln=Tc,i.log=Ic,i.log10=Bc,i.log2=xc,i.max=Sc,i.min=Kc,i.mod=Cc,i.mul=Rc,i.pow=Lc,i.random=Oc,i.round=Nc,i.sign=Mc,i.sin=_c,i.sinh=Vc,i.sqrt=Ec,i.sub=Fc,i.sum=vc,i.tan=Wc,i.tanh=Dc,i.trunc=qc,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Ac(r,e){return new this(r).div(e)}function Pc(r){return new this(r).exp()}function kc(r){return G(r=new this(r),r.e+1,3)}function hc(){var r,e,t=new this(0);for(j=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return j=!0,new this(1/0);t=e}return j=!0,t.sqrt()}function ys(r){return r instanceof Nn||r&&r.toStringTag===As||!1}function Tc(r){return new this(r).ln()}function Ic(r,e){return new this(r).log(e)}function xc(r){return new this(r).log(2)}function Bc(r){return new this(r).log(10)}function Sc(){return Ts(this,arguments,"lt")}function Kc(){return Ts(this,arguments,"gt")}function Cc(r,e){return new this(r).mod(e)}function Rc(r,e){return new this(r).mul(e)}function Lc(r,e){return new this(r).pow(e)}function Oc(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Ze(r,1,Dt),n=Math.ceil(r/Y),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(ws);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=Y,n&&r&&(i=Ce(10,Y-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=Y)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<Y&&(t-=Y-n)}return s.e=t,s.d=a,s}function Nc(r){return G(r=new this(r),r.e+1,this.rounding)}function Mc(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function _c(r){return new this(r).sin()}function Vc(r){return new this(r).sinh()}function Ec(r){return new this(r).sqrt()}function Fc(r,e){return new this(r).sub(e)}function vc(){var r=0,e=arguments,t=new this(e[r]);for(j=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return j=!0,G(t,this.precision,this.rounding)}function Wc(r){return new this(r).tan()}function Dc(r){return new this(r).tanh()}function qc(r){return G(r=new this(r),r.e+1,1)}O[Symbol.for("nodejs.util.inspect.custom")]=O.toString;O[Symbol.toStringTag]="Decimal";var Nn=O.constructor=Bs(xi);xr=new Nn(xr);Br=new Nn(Br);var V=Nn;import{PublicKey as Mi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Uc}from"@solana/spl-token";import{PublicKey as ke,SystemProgram as Ss,SYSVAR_RENT_PUBKEY as Gc}from"@solana/web3.js";function P({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Ri=[P({pubkey:Uc,isWritable:!1}),P({pubkey:Ss.programId,isWritable:!1}),P({pubkey:Gc,isWritable:!1})];function Li({publicKey:r,transformSol:e}){let t=Oi(r.toString());if(t instanceof ke)return e&&t.equals(Re)?$:t;if(e&&t.toString()===Re.toBase58())return $;if(typeof t=="string"){if(t===ke.default.toBase58())return ke.default;try{return new ke(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Oi(r){try{return new ke(r)}catch{return r}}var bn=new ke("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ks=new ke("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),$e=new ke("SysvarRent111111111111111111111111111111111"),Ni=new ke("SysvarC1ock11111111111111111111111111111111"),gn=new ke("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Lr=new ke("Sysvar1nstructions1111111111111111111111111"),Cs=Ss.programId,qp=new ke("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Up=new ke("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Gp=new ke("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Xp=new ke("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),zp=new ke("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Yp=new ke("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Qp=new ke("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Hp=new ke("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),jp=new ke("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Zp=new ke("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),$p=new ke("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),$=new ke("So11111111111111111111111111111111111111112"),Re=ke.default;function wn(r){return Li({publicKey:r,transformSol:!0})}import{PublicKey as Xc}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Rs}from"@solana/spl-token";var Pt={chainId:101,address:Xc.default.toBase58(),programId:Rs.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Rs.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var _i=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Re.toBase58()||e instanceof Mi&&Re.equals(e)){this.decimals=Le.decimals,this.symbol=Le.symbol,this.name=Le.name,this.mint=new Mi(Le.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Mi.default:Li({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},le=_i;le.WSOL=new _i({...Le,mint:Le.address});import Nr from"big.js";import Qc from"bn.js";import Hc from"decimal.js-light";import zc from"toformat";var Yc=zc,Mn=Yc;var Or=oe("module/fraction"),Vi=Mn(Nr),_n=Mn(Hc),jc={[0]:_n.ROUND_DOWN,[1]:_n.ROUND_HALF_UP,[2]:_n.ROUND_UP},Zc={[0]:Nr.roundDown,[1]:Nr.roundHalfUp,[2]:Nr.roundUp},J=class{constructor(e,t=new Qc(1)){this.numerator=q(e),this.denominator=q(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(q(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(q(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(q(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(q(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Or.logWithError(`${e} is not an integer.`),e<=0&&Or.logWithError(`${e} is not positive.`),_n.set({precision:e+1,rounding:jc[n]});let i=new _n(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Or.logWithError(`${e} is not an integer.`),e<0&&Or.logWithError(`${e} is negative.`),Vi.DP=e,Vi.RM=Zc[n]||1,new Vi(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var $c=oe("Raydium_price"),qe=class extends J{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new J(Fi(n.decimals),Fi(i.decimals))}get raw(){return new J(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new qe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&$c.logWithError("mul token not equals");let n=super.mul(t);return new qe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var vi=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Vn=vi;Vn.SOL=new vi(Pt);function Kf(r,e){return r instanceof le&&e instanceof le?r.equals(e):r instanceof le||e instanceof le?!1:r===e}import Jc from"bn.js";var Ls=new J(new Jc(100)),Ve=class extends J{toSignificant(e=5,t,n){return this.mul(Ls).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ls).toFixed(e,t,n)}};function xe(r){if(r instanceof Ve)return new J(r.numerator,r.denominator);if(r instanceof qe)return r.adjusted;if(r instanceof Pe)try{return xe(r.toExact())}catch{return new J(Ie)}if(r instanceof J)return r;let e=String(r),t=Zt(e);return new J(t.numerator,t.denominator)}function Vf(r){var n;if(r instanceof Ve)return{fr:new J(r.numerator,r.denominator)};if(r instanceof qe)return{fr:r.adjusted};if(r instanceof Pe)return{fr:xe(r.toExact()),decimals:r.token.decimals};if(r instanceof J)return{fr:r};let e=String(r),t=Zt(e);return{fr:new J(t.numerator,t.denominator),decimals:(n=t.dec)==null?void 0:n.length}}function Ef(r,e){if(r==null||e==null)return!1;let t=xe(r),n=xe(e);return t.sub(n).numerator,t.sub(n).numerator.lt(Ie)}function el(r,e){if(r==null||e==null)return!1;let t=xe(r),n=xe(e);return t.sub(n).numerator.gt(Ie)}function Ff(r,e){if(r==null||e==null)return!1;let t=xe(r),n=xe(e);return t.sub(n).numerator.lte(Ie)}function vf(r,e){if(r==null||e==null)return!1;let t=xe(r),n=xe(e);return t.sub(n).numerator.gte(Ie)}function tl(r,e){if(r==null||e==null)return!1;let t=xe(r),n=xe(e);return t.sub(n).numerator.eq(Ie)}function Wf(r,e){if(r==null||e==null)return;let t=xe(r),n=xe(e);try{return t.div(n)}catch{return t}}function Df(r,e){if(r==null||e==null)return;let t=xe(r),n=xe(e);return t.sub(n)}function qf(r){return r==null?!1:!tl(r,0)}function Uf(r,e){return el(e,r)?e:r}function Wi(r,e){if(r==null||e==null)return;let t=xe(r),n=xe(e);return t.mul(n)}function Gf(r,e){if(r==null||e==null)return;let t=xe(r),n=xe(e);return t.add(n)}var Ei=(n=>(n[n.ROUND_DOWN=0]="ROUND_DOWN",n[n.ROUND_HALF_UP=1]="ROUND_HALF_UP",n[n.ROUND_UP=2]="ROUND_UP",n))(Ei||{}),Ie=new we(0),_s=new we(1),ry=new we(2),iy=new we(3),oy=new we(5),$t=new we(10),sy=new we(100),ay=new we(1e3),uy=new we(1e4),Os=9007199254740991;function q(r){let e=oe("Raydium_parseBigNumberish");if(r instanceof we)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new we(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Os||r<=-Os)&&e.logWithError(`BigNumberish number overflow: ${r}`),new we(String(r))):typeof r=="bigint"?new we(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new we(0))}function Fi(r){return $t.pow(q(r))}function Zt(r){var a;if(r===void 0)return{denominator:"1",numerator:"0"};if(r instanceof we)return{numerator:r.toString(),denominator:"1"};if(r instanceof J)return{denominator:r.denominator.toString(),numerator:r.numerator.toString()};let e=String(r),[,t="",n="",i=""]=(a=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?a:[],o="1"+"0".repeat(i.length),s=t+(n==="0"?"":n)+i||"0";return{denominator:o,numerator:s,sign:t,int:n,dec:i}}function Mr(r,e){let t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function nl(r){var n;let[,e="",t=""]=(n=r.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${e}${t}`}function rl(r,e=0){return r instanceof we?r:new we(nl(Vs(r).mul($t.pow(new we(String(e))))))}function Vs(r){if(r instanceof Ve)return new J(r.numerator,r.denominator);if(r instanceof qe)return r.adjusted;if(r instanceof Pe)try{return Vs(r.toExact())}catch{return new J(Ie)}if(r instanceof J)return r;let e=String(r),t=Zt(e);return new J(t.numerator,t.denominator)}function cy(r,e){let{numerator:t,denominator:n}=Zt(r);return new Ve(new we(t),new we(n).mul(e!=null&&e.alreadyDecimaled?new we(100):new we(1)))}function ly(r){let{token:e,numberPrice:t,decimalDone:n}=r,i=new le({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:o,denominator:s}=Zt(t),a=n?new we(o).mul($t.pow(new we(e.decimals))):o,u=new we(s).mul($t.pow(new we(i.decimals)));return new qe({baseToken:i,denominator:u.toString(),quoteToken:new le({...e,skipMint:!0,mint:""}),numerator:a.toString()})}function Ns(r){let e=new Vn({decimals:6,symbol:"usd",name:"usd"}),t=rl(Wi(r,10**e.decimals));return new Jt(e,t)}function my(r,e){return Ns(!e||!r?0:Wi(r,e))}function il(r){if(r==null)return;let{numerator:e,denominator:t}=Zt(r.toString());return new J(e,t)}function ol(r){return r instanceof V}function Ms(r){return ol(r)?il(r):Array.isArray(r)?r.map(e=>Ms(e)):Di(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,Ms(t)])):r}var al=oe("Raydium_amount"),_r=Mn(sl);function Es(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):al.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var Pe=class extends J{constructor(t,n,i=!0,o){let s=new qt(0),a=$t.pow(new qt(t.decimals));if(i)s=q(n);else{let u=new qt(0),c=new qt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Es(n.toString(),t.decimals);u=q(l),c=q(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=oe(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return _r.DP=this.token.decimals,new _r(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}},Jt=class extends J{constructor(t,n,i=!0,o){let s=new qt(0),a=$t.pow(new qt(t.decimals));if(i)s=q(n);else{let u=new qt(0),c=new qt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Es(n.toString(),t.decimals);u=q(l),c=q(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=oe(o||"TokenAmount"),this.currency=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.currency.equals(t.currency)||this.logger.logWithError("gt currency not equals"),this.raw.gt(t.raw)}lt(t){return this.currency.equals(t.currency)||this.logger.logWithError("lt currency not equals"),this.raw.lt(t.raw)}add(t){return this.currency.equals(t.currency)||this.logger.logWithError("add currency not equals"),new Jt(this.currency,this.raw.add(t.raw))}sub(t){return this.currency.equals(t.currency)||this.logger.logWithError("sub currency not equals"),new Jt(this.currency,this.raw.sub(t.raw))}toSignificant(t=this.currency.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.currency.decimals,n,i=0){return t>this.currency.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return _r.DP=this.currency.decimals,new _r(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};async function Fs(r){new Promise(e=>setTimeout(e,r))}function _y(){return new Date().getTime()}function Di(r){return typeof r=="object"&&r!==null&&![le,Pe,ul,J,cl,qe,Ve].some(e=>typeof e=="object"&&r instanceof e)}function de(r){return typeof r=="string"?Oi(r):Array.isArray(r)?r.map(e=>de(e)):Di(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,de(t)])):r}import{PublicKey as Wn,sendAndConfirmTransaction as Xi,Transaction as Dn,TransactionMessage as qn,VersionedTransaction as Un}from"@solana/web3.js";import wl from"axios";var En=(t=>(t[t.V0=0]="V0",t[t.LEGACY=1]="LEGACY",t))(En||{}),_={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as Ws,ComputeBudgetProgram as vs,Transaction as Er,TransactionMessage as ll,Keypair as Ds,VersionedTransaction as qs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ml}from"@solana/spl-token";var Lt=oe("Raydium_txUtil"),Us=1644;function Fr(r){let e=[],t=[];return r.microLamports&&(e.push(vs.setComputeUnitPrice({microLamports:r.microLamports})),t.push(_.SetComputeUnitPrice)),r.units&&(e.push(vs.setComputeUnitLimit({units:r.units})),t.push(_.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function An(r){var e,t;try{return((t=await((e=r.getLatestBlockhash)==null?void 0:e.call(r)))==null?void 0:t.blockhash)||(await r.getRecentBlockhash()).blockhash}catch{return(await r.getRecentBlockhash()).blockhash}}function vr(r,e){r.length<1&&Lt.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Lt.logWithError(`no signers provided:, ${e.toString()}`);let t=new Er;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Us}catch{return!1}}async function Gs(r,e,t,n=!0){let i=new Ws("RaydiumSimuLateTransaction11111111111111111"),o=[],s=new Er;s.feePayer=i;for(let c of e)vr([...s.instructions,c],[i])||(o.push(s),s=new Er,s.feePayer=i),s.add(c);s.instructions.length>0&&o.push(s);let a=[];try{if(a=await dl(r,o,n),a.find(c=>c.err!==null))throw Error("rpc simulateTransaction error")}catch(c){c instanceof Error&&Lt.logWithError("failed to simulate for instructions","RPC_ERROR",{message:c.message})}let u=[];for(let c of a)if(Lt.debug("simulate result:",c),c.logs){let l=c.logs.filter(m=>m&&m.includes(t));Lt.debug("filteredLog:",u),l.length||Lt.logWithError("simulate log not match keyword","keyword",t),u.push(...l)}return u}function Xs(r,e){let t=r.match(/{["\w:,]+}/g);return!t||t.length!==1?Lt.logWithError(`simulate log fail to match json, keyword: ${e}`):t[0]}function Ot(r,e){let n=new RegExp(`"${e}":(\\d+)`,"g").exec(r);return!n||n.length!==2?Lt.logWithError(`simulate log fail to match key", key: ${e}`):n[1]}function re(r,e){let[t,n]=Ws.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}async function dl(r,e,t){let n=[];if(t){let i=await r.getLatestBlockhash(),o=[];for(let c of e){c.recentBlockhash=i.blockhash,c.lastValidBlockHeight=i.lastValidBlockHeight;let m=c._compile().serialize(),d=c._serialize(m).toString("base64");o.push(d)}let s=o.map(c=>{let l=r._buildArgs([c],void 0,"base64");return{methodName:"simulateTransaction",args:l}}),a=[],u=20;for(let c=0;c<Math.ceil(s.length/u);c++)a.push(s.slice(c*u,(c+1)*u));n=await(await Promise.all(a.map(async c=>(await r._rpcBatchRequest(c)).map(l=>l.result.value)))).flat()}else try{n=await Promise.all(e.map(async i=>await(await r.simulateTransaction(i)).value))}catch(i){i instanceof Error&&Lt.logWithError("failed to get info for multiple accounts","RPC_ERROR",{message:i.message})}return n}function Fn({instructions:r,payer:e,signers:t}){return vr(r,[e,...t])}function vn({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Ds.generate().publicKey.toString()}){let o=new ll({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new qs(o).serialize()).toString("base64").length<Us}catch{return!1}}var Vr={time:0,data:void 0};async function zy(r){if(!Vr.data||(Date.now()-Vr.time)/1e3>30){let e=await r.getEpochInfo();return Vr={time:Date.now(),data:e},e}else return Vr.data}var pl=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r);function en(r){let e=[];return r.forEach(t=>{t instanceof Er&&(t.recentBlockhash||(t.recentBlockhash=ml.toBase58()),t.feePayer||(t.feePayer=Ds.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof qs&&(n=pl(n));let i=n.toString("base64");e.push(i)}),console.log("simulate tx string:",e),e}import{PublicKey as zs,AddressLookupTableAccount as Wr}from"@solana/web3.js";import{PublicKey as fl}from"@solana/web3.js";import{getTransferFeeConfig as yl,unpackMint as bl}from"@solana/spl-token";var qi=oe("Raydium_accountInfo_util");async function kt(r,e,t){let{batchRequest:n,commitment:i="confirmed"}={batchRequest:!1,...t},o=Ui(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=r._buildArgs([l.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=Ui(a,10);s=(await(await Promise.all(u.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&qi.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:p,executable:d,lamports:y,owner:f,rentEpoch:b}=m;return p.length!==2&&p[1]!=="base64"&&qi.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:d,lamports:y,owner:new fl(f),rentEpoch:b}}return null})))}else try{s=await Promise.all(o.map(a=>r.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&qi.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Pn(r,e,t){let n=await kt(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>({...i,accountInfo:n[o]}))}var gl=(n=>(n[n.Uninitialized=0]="Uninitialized",n[n.Mint=1]="Mint",n[n.Account=2]="Account",n))(gl||{}),tb=1;async function nb({connection:r,mints:e}){var i,o;if(e.length===0)return{};let t=await Pn(r,e.map(s=>({pubkey:s}))),n={};for(let s of t){let a=bl(s.pubkey,s.accountInfo,(i=s.accountInfo)==null?void 0:i.owner);n[s.pubkey.toString()]={...a,feeConfig:(o=yl(a))!=null?o:void 0}}return n}async function Gi({connection:r,address:e}){let t=await kt(r,[...new Set(e.map(i=>i.toString()))].map(i=>new zs(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new Wr({key:s,state:Wr.deserialize(o.data)});n[s.toString()]=a,Dr[s.toString()]=a}return n}var Dr={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Wr({key:new zs("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Wr.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var qr=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await wl.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Fr(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Wn.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0({...t||{}}):this.build(t)}build(e){let t=new Dn;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async n=>{var a;let{recentBlockHash:i,skipPreflight:o=!0}=n||{},s=i!=null?i:await An(this.connection);if(t.recentBlockhash=s,this.signers.length&&t.sign(...this.signers),en([t]),(a=this.owner)!=null&&a.isKeyPair)return{txId:await Xi(this.connection,t,this.signers.find(u=>u.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:o}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:o}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var f;let{sequentially:l,onTxUpdate:m,recentBlockHash:p,skipPreflight:d=!0}=c||{},y=p!=null?p:await An(this.connection);if((f=this.owner)!=null&&f.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,g)=>(b.recentBlockhash=y,await Xi(this.connection,b,a[g].find(A=>A.publicKey.equals(this.owner.publicKey))?a[g]:[...a[g],this.owner.signer],{skipPreflight:d})))),signedTxs:s};if(this.signAllTransactions){let b=s.map((A,k)=>(A.recentBlockhash=y,a[k].length&&A.sign(...a[k]),A));en(b);let g=await this.signAllTransactions(b);if(l){let A=0,k=[],h=async()=>{if(!g[A])return;let T=await this.connection.sendRawTransaction(g[A].serialize(),{skipPreflight:d});k.push({txId:T,status:"sent",signedTx:g[A]}),m==null||m([...k]),A++,this.connection.onSignature(T,I=>{let S=k.findIndex(x=>x.txId===T);S>-1&&(k[S].status=I.err?"error":"success"),m==null||m([...k]),I.err||h()},"processed"),this.connection.getSignatureStatus(T)};return await h(),{txIds:k.map(T=>T.txId),signedTxs:g}}else{let A=[];for(let k=0;k<g.length;k+=1){let h=await this.connection.sendRawTransaction(g[k].serialize(),{skipPreflight:d});A.push(h)}return{txIds:A,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,...o}=e||{},s={...this.cluster==="devnet"?{}:Dr,...t},a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let p of a)s[p]===void 0&&u.push(new Wn(p));let c=await Gi({connection:this.connection,address:u});for(let[p,d]of Object.entries(c))s[p]=d;let l=new qn({payerKey:this.feePayer,recentBlockhash:i?Wn.default.toBase58():await An(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new Un(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async p=>{var f;let{recentBlockHash:d,skipPreflight:y=!0}=p||{};if(d&&(m.message.recentBlockhash=d),en([m]),(f=this.owner)!=null&&f.isKeyPair){this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))||m.sign([this.owner.signer]);let b=await this.connection.sendTransaction(m,{skipPreflight:y}),{lastValidBlockHeight:g,blockhash:A}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:A,lastValidBlockHeight:g,signature:b},"confirmed"),{txId:b,signedTx:m}}if(this.signAllTransactions){let b=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:y}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var y;let{sequentially:l,onTxUpdate:m,recentBlockHash:p,skipPreflight:d=!0}=c||{};if(p&&s.forEach(f=>f.message.recentBlockhash=p),en(s),(y=this.owner)!=null&&y.isKeyPair){let{lastValidBlockHeight:f,blockhash:b}=await this.connection.getLatestBlockhash();return s.forEach((g,A)=>{a[A].find(k=>k.publicKey.equals(this.owner.publicKey))||g.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async g=>{let A=await this.connection.sendTransaction(g,{skipPreflight:d});return await this.connection.confirmTransaction({blockhash:b,lastValidBlockHeight:f,signature:A},"confirmed"),A})),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(l){let b=0,g=[],A=async()=>{if(!f[b])return;let k=await this.connection.sendTransaction(f[b],{skipPreflight:d});g.push({txId:k,status:"sent",signedTx:f[b]}),m==null||m([...g]),b++,this.connection.onSignature(k,h=>{let T=g.findIndex(I=>I.txId===k);T>-1&&(g[T].status=h.err?"error":"success"),m==null||m([...g]),h.err||A()},"processed"),this.connection.getSignatureStatus(k)};return A(),{txIds:[],signedTxs:f}}else{let b=[];for(let g=0;g<f.length;g+=1){let A=await this.connection.sendTransaction(f[g],{skipPreflight:d});b.push(A)}return{txIds:b,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){let{computeBudgetConfig:t,...n}=e||{},i=t?Fr(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((c,l)=>({...c,[l.publicKey.toBase58()]:l}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(c=>{let l=[...u,c],m=t?[...i.instructions,...l]:l,d=[...new Set(l.map(y=>y.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(y=>new Wn(y));if(u.length<12&&Fn({instructions:m,payer:this.feePayer,signers:d})||Fn({instructions:l,payer:this.feePayer,signers:d}))u.push(c);else{if(u.length===0)throw Error("item ins too big");Fn({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:d})?s.push(new Dn().add(...i.instructions,...u)):s.push(new Dn().add(...u)),a.push(Array.from(new Set(u.map(y=>y.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),u=[c]}}),u.length>0){let l=[...new Set(u.map(m=>m.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(m=>o[m]).filter(m=>m!==void 0);Fn({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:l.map(m=>m.publicKey)})?s.push(new Dn().add(...i.instructions,...u)):s.push(new Dn().add(...u)),a.push(l)}return s.forEach(c=>c.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async c=>{var f;let{sequentially:l,onTxUpdate:m,recentBlockHash:p,skipPreflight:d=!0}=c||{},y=p!=null?p:await An(this.connection);if(s.forEach(async(b,g)=>{b.recentBlockhash=y,a[g].length&&b.sign(...a[g])}),en(s),(f=this.owner)!=null&&f.isKeyPair)return{txIds:await Promise.all(s.map(async(b,g)=>await Xi(this.connection,b,a[g].find(A=>A.publicKey.equals(this.owner.publicKey))?a[g]:[...a[g],this.owner.signer],{skipPreflight:d}))),signedTxs:s};if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(l){let g=0,A=[],k=async()=>{if(!b[g])return;let h=await this.connection.sendRawTransaction(b[g].serialize(),{skipPreflight:d});A.push({txId:h,status:"sent",signedTx:b[g]}),m==null||m([...A]),g++,this.connection.onSignature(h,T=>{let I=A.findIndex(S=>S.txId===h);I>-1&&(A[I].status=T.err?"error":"success"),m==null||m([...A]),T.err||k()},"processed"),this.connection.getSignatureStatus(h)};return await k(),{txIds:A.map(h=>h.txId),signedTxs:b}}else{let g=[];for(let A=0;A<b.length;A+=1){let k=await this.connection.sendRawTransaction(b[A].serialize(),{skipPreflight:d});g.push(k)}return{txIds:g,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:i=[],...o}=e||{},s={...this.cluster==="devnet"?{}:Dr,...n},a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let b of a)s[b]===void 0&&u.push(new Wn(b));let c=await Gi({connection:this.connection,address:u});for(let[b,g]of Object.entries(c))s[b]=g;let l=t?Fr(t):{instructions:[],instructionTypes:[]},m=await An(this.connection),p=this.signers.reduce((b,g)=>({...b,[g.publicKey.toBase58()]:g}),{}),d=[],y=[],f=[];if(this.allInstructions.forEach(b=>{let g=[...f,b],A=t?[...l.instructions,...g]:g;if(f.length<12&&vn({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s})||vn({instructions:g,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(b);else{if(f.length===0)throw Error("item ins too big");let k={};for(let h of[...new Set(a)])s[h]!==void 0&&(k[h]=s[h]);if(t&&vn({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new qn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));d.push(new Un(h))}else{let h=new qn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));d.push(new Un(h))}y.push(Array.from(new Set(f.map(h=>h.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(h=>p[h]).filter(h=>h!==void 0)),f=[b]}}),f.length>0){let g=[...new Set(f.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(A=>p[A]).filter(A=>A!==void 0);if(t&&vn({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new qn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));d.push(new Un(A))}else{let A=new qn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));d.push(new Un(A))}y.push(g)}return{builder:this,transactions:d,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async b=>{var T;let{sequentially:g,onTxUpdate:A,recentBlockHash:k,skipPreflight:h=!0}=b||{};if(d.map(async(I,S)=>{y[S].length&&I.sign(y[S]),k&&(I.message.recentBlockhash=k)}),en(d),(T=this.owner)!=null&&T.isKeyPair){let{lastValidBlockHeight:I,blockhash:S}=await this.connection.getLatestBlockhash();return d.forEach((x,R)=>{y[R].find(N=>N.publicKey.equals(this.owner.publicKey))||x.sign([this.owner.signer])}),{txIds:await Promise.all(d.map(async x=>{let R=await this.connection.sendTransaction(x,{skipPreflight:h});return await this.connection.confirmTransaction({blockhash:S,lastValidBlockHeight:I,signature:R},"confirmed"),R})),signedTxs:d}}if(this.signAllTransactions){let I=await this.signAllTransactions(d);if(g){let S=0,x=[],R=async()=>{if(!I[S])return;let N=await this.connection.sendTransaction(I[S],{skipPreflight:h});x.push({txId:N,status:"sent",signedTx:I[S]}),A==null||A([...x]),S++,this.connection.onSignature(N,E=>{let z=x.findIndex(v=>v.txId===N);z>-1&&(x[z].status=E.err?"error":"success"),A==null||A([...x]),E.err||R()},"processed"),this.connection.getSignatureStatus(N)};return R(),{txIds:[],signedTxs:I}}else{let S=[];for(let x=0;x<I.length;x+=1){let R=await this.connection.sendTransaction(I[x],{skipPreflight:h});S.push(R)}return{txIds:S,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};var ft=class{constructor(e){this._owner=e}get publicKey(){return ft.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return ft.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return ft.isKeyPair(this._owner)}get isPublicKey(){return ft.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!ft.isKeyPair(e)}};function Ui(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}function Ab(r,...e){return r.filter(t=>e.every(n=>n.includes(t)))}function Pb(r,...e){return r.filter(t=>e.every(n=>!n.includes(t)))}function kb(r){return[...new Set(r)]}var Ys=r=>typeof r=="number",Qs=r=>r?new Date(r):new Date,Al=r=>Qs(r).getTime();function Hs(r,e,t){let n=Ys(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()<=+n}function js(r,e,t){let n=Ys(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(r).getTime()>+n}function Tb(r,e){let n=Al(r)+(e.days?e.days*24*60*60*1e3:0)+(e.hours?e.hours*60*60*1e3:0)+(e.minutes?e.minutes*60*1e3:0)+(e.seconds?e.seconds*1e3:0)+(e.milliseconds?e.milliseconds:0);return Qs(n)}import{PublicKey as Se}from"@solana/web3.js";var zi=new Se("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Yi=new Se("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),kn=new Se("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Pl=new Se("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),kl=new Se("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ur=new Se("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Qi=new Se("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),hl=new Se("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Tl=new Se("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Il=new Se("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),xl=new Se("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Bl=new Se("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Sl=new Se("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Kl=new Se("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Cl=new Se("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Rl=new Se("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ll=new Se("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Bb=new Se("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Sb=new Se("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Kb=new Se("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Gn={IDO_PROGRAM_ID_V1:xl,IDO_PROGRAM_ID_V2:Bl,IDO_PROGRAM_ID_V3:Sl,IDO_PROGRAM_ID_V4:Kl},Cb={AMM_V4:Qi,AMM_STABLE:hl,CLMM_PROGRAM_ID:Tl,FARM_PROGRAM_ID_V3:zi,FARM_PROGRAM_ID_V5:Yi,FARM_PROGRAM_ID_V6:kn,OPEN_BOOK_PROGRAM:kl,SERUM_PROGRAM_ID_V3:Ur,UTIL1216:Pl,Router:Il,CREATE_CPMM_POOL_PROGRAM:Cl,CREATE_CPMM_POOL_AUTH:Rl,CREATE_CPMM_POOL_FEE_ACC:Ll};import{PublicKey as Ol}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Nl}from"@solana/spl-token";function pe(r,e,t){return re([r.toBuffer(),(t!=null?t:Nl).toBuffer(),e.toBuffer()],new Ol("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Ke from"bn.js";var ht=1e4;function Vb(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new Ke(i.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(i.transferFeeBasisPoints===ht){let a=new Ke(i.maximumFee.toString());return{amount:r.add(a),fee:a,expirationTime:s}}else{let a=Ut(r.mul(new Ke(ht)),new Ke(ht-i.transferFeeBasisPoints)),u=new Ke(i.maximumFee.toString()),c=a.sub(r).gt(u)?r.add(u):a,l=Ut(c.mul(new Ke(i.transferFeeBasisPoints)),new Ke(ht)),m=l.gt(o)?o:l;return{amount:c,fee:m,expirationTime:s}}else{let a=Ut(r.mul(new Ke(i.transferFeeBasisPoints)),new Ke(ht)),u=a.gt(o)?o:a;return{amount:r,fee:u,expirationTime:s}}}function ge(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new Ke(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===ht){let u=new Ke(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=Ut(r.mul(new Ke(ht)),new Ke(ht-o.transferFeeBasisPoints)),c=new Ke(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=Ut(l.mul(new Ke(o.transferFeeBasisPoints)),new Ke(ht)),p=m.gt(s)?s:m;return{amount:l,fee:p,expirationTime:a}}else{let u=Ut(r.mul(new Ke(o.transferFeeBasisPoints)),new Ke(ht)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function tn(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function Ut(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new Ke(0))?t.add(new Ke(1)):t}var Gr=(t=>(t.ALL="all",t.Strict="strict",t))(Gr||{}),Zs=(s=>(s.All="all",s.Standard="standard",s.Concentrated="concentrated",s.AllFarm="allFarm",s.StandardFarm="standardFarm",s.ConcentratedFarm="concentratedFarm",s))(Zs||{});var Ee={BASE_HOST:"https://api-v3.raydium.io",OWNER_BASE_HOST:"https://owner-v1.raydium.io",SERVICE_BASE_HOST:"https://service.raydium.io",SEND_TRANSACTION:"/send-transaction",FARM_ARP:"/main/farm/info",FARM_ARP_LINE:"/main/farm-apr-tv",CLMM_CONFIG:"/main/clmm-config",VERSION:"/main/version",CHECK_AVAILABILITY:"/v3/main/AvailabilityCheckAPI",RPCS:"/main/rpcs",INFO:"/main/info",STAKE_POOLS:"/main/stake-pools",CHAIN_TIME:"/main/chain-time",TOKEN_LIST:"/mint/list",MINT_INFO_ID:"/mint/ids",JUP_TOKEN_LIST:"https://token.jup.ag/{type}",POOL_LIST:"/pools/info/list",POOL_SEARCH_BY_ID:"/pools/info/ids",POOL_SEARCH_MINT:"/pools/info/mint",POOL_SEARCH_LP:"/pools/info/lps",POOL_KEY_BY_ID:"/pools/key/ids",POOL_LIQUIDITY_LINE:"/pools/line/liquidity",POOL_POSITION_LINE:"/pools/line/position",FARM_INFO:"/farms/info/ids",FARM_LP_INFO:"/farms/info/lp",FARM_KEYS:"/farms/key/ids",OWNER_CREATED_FARM:"/create-pool/{owner}",OWNER_IDO:"/main/ido/{owner}",OWNER_STAKE_FARMS:"/position/stake/{owner}",IDO_KEYS:"/ido/key/ids",SWAP_HOST:"https://transaction-v1.raydium.io",SWAP_COMPUTE:"/compute/",SWAP_TX:"/transaction/",MINT_PRICE:"/mint/price",MIGRATE_CONFIG:"/main/migrate-lp",PRIORITY_FEE:"/main/auto-fee"},ng={...Ee};var $s="ray_tab_hash",Hi="ray_req_hash",Ml=()=>{if(typeof window===void 0)return"";let r=sessionStorage.getItem($s);return r||(r=`ray-${Date.now()}`,sessionStorage.setItem($s,r)),r},Xr=async({logCount:r=1e3,removeLastLog:e,...t})=>{if(typeof window===void 0)return new Promise(i=>i());let n=JSON.parse(localStorage.getItem(Hi)||"[]").slice(0,r-1);e&&n.pop(),new Blob([JSON.stringify(t.data)]).size>1024&&(t.data=JSON.stringify(t.data).substring(0,200)+"..."),n.unshift({...t,time:Date.now(),session:Ml()});try{localStorage.setItem(Hi,JSON.stringify(n))}catch{if(e){let i=!1,o=JSON.stringify(t.data).substring(0,100);for(n[0].data=o+(o.length>100?"...":"");!i;){n.pop();let s=JSON.stringify(t.data).substring(0,100);n[0].data=s+(s.length>100?"...":"");try{localStorage.setItem(Hi,JSON.stringify(n)),i=!0}catch{i=!1}}return new Promise(s=>s())}return Xr({...t,logCount:r,removeLastLog:!0})}};var hn=oe("Raydium_Api"),ji=new Map;async function hg(r,e,t=1e3){let n;for(;n==null;)try{hn.debug(`Request ${r} through endlessRetry`),n=await e()}catch(i){hn.error(`Request ${r} failed, retry after ${t} ms`,i),await Fs(t)}return n}var zr=class{constructor({cluster:e,timeout:t,logRequests:n,logCount:i,urlConfigs:o}){this.cluster=e,this.urlConfigs=o||{},this.logCount=i||1e3,this.api=_l.create({baseURL:this.urlConfigs.BASE_HOST||Ee.BASE_HOST,timeout:t}),this.api.interceptors.request.use(s=>{let{method:a,baseURL:u,url:c}=s;return hn.debug(`${a==null?void 0:a.toUpperCase()} ${u}${c}`),s},s=>(hn.error("Request failed"),Promise.reject(s))),this.api.interceptors.response.use(s=>{let{config:a,data:u,status:c}=s,{method:l,baseURL:m,url:p}=a;return n&&Xr({status:c,url:`${m}${p}`,params:a.params,data:u,logCount:this.logCount}),hn.debug(`${l==null?void 0:l.toUpperCase()} ${m}${p}  ${c}`),u},s=>{let{config:a,response:u={}}=s,{status:c}=u,{method:l,baseURL:m,url:p}=a;return n&&Xr({status:c,url:`${m}${p}`,params:a.params,data:s.message,logCount:this.logCount}),hn.error(`${l.toUpperCase()} ${m}${p} ${c||s.message}`),Promise.reject(s)})}async getClmmConfigs(){return(await this.api.get(this.urlConfigs.CLMM_CONFIG||Ee.CLMM_CONFIG)).data}async getClmmPoolLines(e){return(await this.api.get(`${this.urlConfigs.POOL_LIQUIDITY_LINE||Ee.POOL_LIQUIDITY_LINE}?pool_id=${e}`)).data}async getBlockSlotCountForSecond(e){if(!e)return 2;let n=(await this.api.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(i=>i.numSlots);return n.reduce((i,o)=>i+o,0)/n.length/60}async getChainTimeOffset(){return(await this.api.get(this.urlConfigs.CHAIN_TIME||Ee.CHAIN_TIME)).data}async getRpcs(){return this.api.get(this.urlConfigs.RPCS||Ee.RPCS)}async getTokenList(){return(await this.api.get(this.urlConfigs.TOKEN_LIST||Ee.TOKEN_LIST)).data}async getJupTokenList(e){return this.api.get("/",{baseURL:(this.urlConfigs.JUP_TOKEN_LIST||Ee.JUP_TOKEN_LIST).replace("{type}",e||"all")})}async getTokenInfo(e){return(await this.api.get((this.urlConfigs.MINT_INFO_ID||Ee.MINT_INFO_ID)+`?mints=${e.map(n=>n.toString()).join(",")}`)).data}async getPoolList(e={}){let{type:t="all",sort:n="liquidity",order:i="desc",page:o=0,pageSize:s=100}=e;return(await this.api.get((this.urlConfigs.POOL_LIST||Ee.POOL_LIST)+`?poolType=${t}&poolSortField=${n}&sortType=${i}&page=${o}&pageSize=${s}`)).data}async fetchPoolById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.POOL_SEARCH_BY_ID||Ee.POOL_SEARCH_BY_ID)+`?ids=${t}`)).data}async fetchPoolKeysById(e){let{idList:t}=e,n=[],i=t.filter(s=>ji.has(s)?(n.push(ji.get(s)),!1):!0),o=[];return i.length&&(o=(await this.api.get((this.urlConfigs.POOL_KEY_BY_ID||Ee.POOL_KEY_BY_ID)+`?ids=${i.join(",")}`)).data.filter(Boolean),o.forEach(a=>{ji.set(a.id,a)})),n.concat(o)}async fetchPoolByMints(e){let{mint1:t,mint2:n,type:i="all",sort:o="default",order:s="desc",page:a=1}=e,[u,c]=[t&&wn(t).toBase58(),n&&n!=="undefined"?wn(n).toBase58():""],[l,m]=c&&u>c?[c,u]:[u,c];return console.log(123123555,`?mint1=${l}&mint2=${m}&poolType=${i}&poolSortField=${o}&sortType=${s}&pageSize=100&page=${a}`),(await this.api.get((this.urlConfigs.POOL_SEARCH_MINT||Ee.POOL_SEARCH_MINT)+`?mint1=${l}&mint2=${m}&poolType=${i}&poolSortField=${o}&sortType=${s}&pageSize=100&page=${a}`)).data}async fetchFarmInfoById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_INFO||Ee.FARM_INFO)+`?ids=${t}`)).data}async fetchFarmKeysById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_KEYS||Ee.FARM_KEYS)+`?ids=${t}`)).data}async fetchAvailabilityStatus(){return(await this.api.get(this.urlConfigs.CHECK_AVAILABILITY||Ee.CHECK_AVAILABILITY)).data}};import{merge as Kp}from"lodash";var Yr="please provide owner in load() initialization or you can set by calling raydium.setOwner(owner)",Js="please provide connection in load() initialization or set it by raydium.setConnection(connection)";import{createAssociatedTokenAccountInstruction as lo,TOKEN_PROGRAM_ID as rn,AccountLayout as Yt,TOKEN_2022_PROGRAM_ID as Xm}from"@solana/spl-token";import{PublicKey as ei,SystemProgram as zm}from"@solana/web3.js";var Zi=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),he=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=oe(t)}createTxBuilder(e){return this.scope.checkOwner(),new qr({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Zi(e))}logInfo(...e){this.logger.info(Zi(e))}logAndCreateError(...e){let t=Zi(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{createInitializeAccountInstruction as vm,createCloseAccountInstruction as Wm,createTransferInstruction as Dm,TOKEN_PROGRAM_ID as Tn}from"@solana/spl-token";import{PublicKey as qm,SystemProgram as Um}from"@solana/web3.js";import Gm from"bn.js";import{PublicKey as ya,Keypair as _m}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Vm}from"@solana/spl-token";import Em from"bn.js";import{PublicKey as Sm}from"@solana/web3.js";import sa,{isBN as aa}from"bn.js";import{bits as Vl,BitStructure as El,blob as Fl,Blob as vl,cstr as Wl,f32 as Dl,f32be as ql,f64 as Ul,f64be as Gl,greedy as Xl,Layout as zl,ns64 as Yl,ns64be as Ql,nu64 as Hl,nu64be as jl,offset as Zl,s16 as $l,s16be as Jl,s24 as em,s24be as tm,s32 as nm,s32be as rm,s40 as im,s40be as om,s48 as sm,s48be as am,s8 as um,seq as cm,struct as _g,Structure as lm,u16 as mm,u16be as dm,u24 as pm,u24be as fm,u32 as ym,u32be as bm,u40 as gm,u40be as wm,u48 as Am,u48be as Pm,u8 as km,UInt as hm,union as Tm,Union as Im,unionLayoutDiscriminator as xm,utf8 as Bm}from"@solana/buffer-layout";var Xn=zl,ea=lm,ta=Im,Vg=El,$i=hm,na=vl,Eg=Xl,Qr=km,Tt=mm,Fg=pm,zn=ym,vg=gm,Wg=Am,ra=Hl,Dg=dm,qg=fm,Ug=bm,Gg=wm,Xg=Pm,zg=jl,Yg=um,Qg=$l,Hg=em,Fe=nm,jg=im,Zg=sm,$g=Yl,Jg=Jl,ew=tm,tw=rm,nw=om,rw=am,iw=Ql,ow=Dl,sw=ql,aw=Ul,uw=Gl;var ia=cm,oa=Tm,cw=xm,me=Fl,lw=Wl,mw=Bm,Ji=Vl,eo=Zl;var nn=class extends Xn{constructor(t,n,i){super(t,i);this.blob=me(t),this.signed=n}decode(t,n=0){let i=new sa(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new sa(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}},Hr=class extends Xn{constructor(t){super(8,t);this._lower=Ji(zn(),!1),this._upper=Ji(zn(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let i=this._lower.decode(t,n),o=this._upper.decode(t,n+this._lower.span);return{...i,...o}}encode(t,n,i=0){return this._lower.encode(t,n,i)+this._upper.encode(t,n,i+this._lower.span)}};function M(r){return new $i(1,r)}function Ue(r){return new $i(4,r)}function w(r){return new nn(8,!1,r)}function X(r){return new nn(16,!1,r)}function ua(r){return new nn(1,!0,r)}function jr(r){return new nn(8,!0,r)}function ca(r){return new nn(16,!0,r)}var Nt=class extends Xn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function B(r){return new Nt(me(32),e=>new Sm(e),e=>e.toBuffer(),r)}var to=class extends Xn{constructor(t,n){super(-1,n);this.layout=t,this.discriminator=Qr()}encode(t,n,i=0){return t==null?this.discriminator.encode(0,n,i):(this.discriminator.encode(1,n,i),this.layout.encode(t,n,i+1)+1)}decode(t,n=0){let i=this.discriminator.decode(t,n);if(i===0)return null;if(i===1)return this.layout.decode(t,n+1);throw new Error("Invalid option "+this.property)}getSpan(t,n=0){let i=this.discriminator.decode(t,n);if(i===0)return 1;if(i===1)return this.layout.getSpan(t,n+1)+1;throw new Error("Invalid option "+this.property)}};function bw(r,e){return new to(r,e)}function ve(r){return new Nt(Qr(),Km,Cm,r)}function Km(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Cm(r){return r?1:0}function gw(r,e){let t=zn("length"),n=L([t,W(r,eo(t,-t.span),"values")]);return new Nt(n,({values:i})=>i,i=>({values:i}),e)}function ww(r,e,t){let n=L([w("tag"),e.replicate("data")]);function i({tag:o,data:s}){if(!o.eq(r))throw new Error("Invalid tag, expected: "+r.toString("hex")+", got: "+o.toString("hex"));return s}return new Nt(n,i,o=>({tag:r,data:o}),t)}function Rm(r){let e=zn("length"),t=L([e,me(eo(e,-e.span),"data")]);return new Nt(t,({data:n})=>n,n=>({data:n}),r)}function Aw(r){return new Nt(Rm(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),r)}function Pw(r,e){let t=oa(Qr(),e);return r.forEach((n,i)=>t.addVariant(i,n,n.property)),t}function kw(r,e,t){let n=L([W(r,e,"values")]);return new Nt(n,({values:i})=>i,i=>({values:i}),t)}var no=class extends ea{decode(e,t){return super.decode(e,t)}};function L(r,e,t){return new no(r,e,t)}var ro=class extends ta{encodeInstruction(e){let t=Math.max(...Object.values(this.registry).map(i=>i.span)),n=Buffer.alloc(t);return n.slice(0,this.encode(e,n))}decodeInstruction(e){return this.decode(e)}};function hw(r,e,t){return new ro(r,e,t)}var io=class extends na{decode(e,t){let n=super.decode(e,t);if(!n.every(i=>i===0))throw new Error("nonzero padding bytes");return n}};function Tw(r){return new io(r)}function W(r,e,t){let n,i=typeof e=="number"?e:aa(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=aa(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ia(r,i,t)}var Gt=L([B("mint"),B("owner"),w("amount"),Ue("delegateOption"),B("delegate"),M("state"),Ue("isNativeOption"),w("isNative"),w("delegatedAmount"),Ue("closeAuthorityOption"),B("closeAuthority")]);function Lm(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function oo(r,...e){if(!Lm(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function so(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function la(r,e){oo(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var $r=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),yt=(r,e)=>r<<32-e|r>>>e;var Rw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Om(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function ao(r){return typeof r=="string"&&(r=Om(r)),oo(r),r}var Zr=class{clone(){return this._cloneInto()}},Lw={}.toString;function ma(r){let e=n=>r().update(ao(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Nm(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var da=(r,e,t)=>r&e^~r&t,pa=(r,e,t)=>r&e^r&t^e&t,Jr=class extends Zr{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=$r(this.buffer)}update(e){so(this);let{view:t,buffer:n,blockLen:i}=this;e=ao(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=$r(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){so(this),la(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;Nm(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=$r(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var Mm=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),zt=new Uint32Array(64),uo=class extends Jr{constructor(){super(64,32,8,!1),this.A=Xt[0]|0,this.B=Xt[1]|0,this.C=Xt[2]|0,this.D=Xt[3]|0,this.E=Xt[4]|0,this.F=Xt[5]|0,this.G=Xt[6]|0,this.H=Xt[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)zt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let p=zt[m-15],d=zt[m-2],y=yt(p,7)^yt(p,18)^p>>>3,f=yt(d,17)^yt(d,19)^d>>>10;zt[m]=f+zt[m-7]+y+zt[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let p=yt(a,6)^yt(a,11)^yt(a,25),d=l+p+da(a,u,c)+Mm[m]+zt[m]|0,f=(yt(n,2)^yt(n,13)^yt(n,22))+pa(n,i,o)|0;l=c,c=u,u=a,a=s+d|0,s=o,o=i,i=n,n=d+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){zt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var fa=ma(()=>new uo);var Qw=oe("Raydium_Util");function ba({owner:r,solAccountResp:e,tokenAccountResp:t}){let n=[],i=[];for(let{pubkey:o,account:s}of t.value){let a=Gt.decode(s.data),{mint:u,amount:c}=a;n.push({publicKey:o,mint:u,amount:c,isAssociated:pe(r,u,s.owner).publicKey.equals(o),isNative:!1,programId:s.owner}),i.push({pubkey:o,accountInfo:a,programId:s.owner})}return e&&n.push({mint:ya.default,amount:new Em(e.lamports),isNative:!0,programId:e.owner}),{tokenAccounts:n,tokenAccountRawInfos:i}}function Ge({fromPublicKey:r,programId:e=Vm}){let t=_m.generate().publicKey.toBase58().slice(0,32);return{publicKey:Fm(r,t,e),seed:t}}function Fm(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=fa(n);return new ya(i)}function co(r){let{mint:e,tokenAccount:t,owner:n,programId:i=Tn}=r;return vm(t,e,n,i)}function Mt(r){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:i,programId:o=Tn}=r;return Wm(e,t,i,n,o)}async function It(r){let{connection:e,amount:t,commitment:n,payer:i,owner:o,skipCloseAccount:s}=r,a=await e.getMinimumBalanceForRentExemption(Gt.span,n),u=q(t).add(new Gm(a)),c=Ge({fromPublicKey:i,programId:Tn});return{addresses:{newAccount:c.publicKey},signers:[],instructions:[Um.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:c.seed,newAccountPubkey:c.publicKey,lamports:u.toNumber(),space:Gt.span,programId:Tn}),co({mint:new qm(Le.address),tokenAccount:c.publicKey,owner:o,programId:Tn})],instructionTypes:[_.CreateAccount,_.InitAccount],endInstructionTypes:s?[]:[_.CloseAccount],endInstructions:s?[]:[Mt({tokenAccount:c.publicKey,payer:i,owner:o})]}}function Yn({source:r,destination:e,owner:t,amount:n,multiSigners:i=[],tokenProgram:o=Tn}){return Dm(r,e,t,BigInt(String(n)),i,o)}var Qn=class extends he{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;let{tokenAccounts:n,tokenAccountRawInfos:i}=t;this._tokenAccounts=n||[],this._tokenAccountRawInfos=i||[],this._clientOwnedToken=!!(n||i)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:n}){return t&&(this._tokenAccounts=t),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(n=>n!==t),this}getAssociatedTokenAccount(t,n){return pe(this.scope.ownerPubKey,t,n).publicKey}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let i={...{},...t},[o,s,a]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,i.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:rn},i.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:Xm},i.commitment)]),{tokenAccounts:u,tokenAccountRawInfos:c}=ba({owner:this.scope.ownerPubKey,solAccountResp:o,tokenAccountResp:{context:s.context,value:[...s.value,...a.value]}});return this._tokenAccounts=u,this._tokenAccountRawInfos=c,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),"confirmed"),{tokenAccounts:u,tokenAccountRawInfos:c}}async getCreatedTokenAccount({mint:t,programId:n=rn,associatedOnly:i=!0}){await this.fetchWalletTokenAccounts();let o=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(t)).sort((a,u)=>a.amount.lt(u.amount)?1:-1),s=this.getAssociatedTokenAccount(t,n);for(let a of o){let{publicKey:u}=a;if(u&&(!i||i&&s.equals(u)))return u}}async getOrCreateTokenAccount(t){var y,f,b;await this.fetchWalletTokenAccounts();let{mint:n,createInfo:i,associatedOnly:o,owner:s,notUseTokenAccount:a=!1,skipCloseAccount:u=!1,checkCreateATAOwner:c=!1}=t,l=new ei(t.tokenProgram||rn),m=this.getAssociatedTokenAccount(n,new ei(l)),p=(a?[]:this.tokenAccountRawInfos).filter(g=>g.accountInfo.mint.equals(n)&&(!o||g.pubkey.equals(m))).sort((g,A)=>g.accountInfo.amount.lt(A.accountInfo.amount)?1:-1);if(i===void 0||p.length>0)return p.length>0?{account:p[0].pubkey}:{};let d={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(o){let g=lo(s,m,s,n,l);if(c){let A=await this.scope.connection.getAccountInfo(m);if(A===null)(y=d.instructions)==null||y.push(g),d.instructionTypes.push(_.CreateATA);else if(!(A.owner.equals(l)&&Yt.decode(A.data).mint.equals(n)&&Yt.decode(A.data).owner.equals(s)))throw Error(`create ata check error -> mint: ${n.toString()}, ata: ${m.toString()}`)}else d.instructions.push(g),d.instructionTypes.push(_.CreateATA);if(n.equals($)&&i.amount){let A=await It({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:i.payer||this.scope.ownerPubKey,amount:(f=i.amount)!=null?f:0,skipCloseAccount:u});d.instructions.push(...A.instructions||[]),d.endInstructions.push(...A.endInstructions||[]),d.instructionTypes.push(...A.instructionTypes||[]),d.endInstructionTypes.push(...A.endInstructionTypes||[]),i.amount&&(d.instructions.push(Yn({source:A.addresses.newAccount,destination:m,owner:this.scope.ownerPubKey,amount:i.amount,tokenProgram:rn})),d.instructionTypes.push(_.TransferAmount))}return u||(d.endInstructions.push(Mt({owner:s,payer:i.payer||s,tokenAccount:m,programId:l})),d.endInstructionTypes.push(_.CloseAccount)),{account:m,instructionParams:d}}else if(n.equals($)){let g=await It({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:i.payer||this.scope.ownerPubKey,amount:(b=i.amount)!=null?b:0,skipCloseAccount:u});return d.instructions.push(...g.instructions||[]),d.endInstructions.push(...g.endInstructions||[]),d.signers.push(...g.signers||[]),d.instructionTypes.push(...g.instructionTypes||[]),d.endInstructionTypes.push(...g.endInstructionTypes||[]),{account:g.addresses.newAccount,instructionParams:d}}else{let g=Ge({fromPublicKey:s,programId:l}),A=await this.scope.connection.getMinimumBalanceForRentExemption(Yt.span),k=zm.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:g.seed,newAccountPubkey:g.publicKey,lamports:A,space:Yt.span,programId:l});return d.instructions.push(k,co({mint:n,tokenAccount:g.publicKey,owner:this.scope.ownerPubKey,programId:l})),d.instructionTypes.push(_.CreateAccount),d.instructionTypes.push(_.InitAccount),u||(d.endInstructions.push(Mt({owner:s,payer:i.payer||s,tokenAccount:g.publicKey,programId:l})),d.endInstructionTypes.push(_.CloseAccount)),{account:g.publicKey,instructionParams:d}}}async checkOrCreateAta({mint:t,programId:n=rn,autoUnwrapWSOLToSOL:i}){var u;await this.fetchWalletTokenAccounts();let o=(u=this.scope.account.tokenAccounts.find(({mint:c})=>(c==null?void 0:c.toBase58())===t.toBase58()))==null?void 0:u.publicKey,s=this.scope.ownerPubKey,a={};if(!o){let c=this.getAssociatedTokenAccount(t,n),l=await lo(s,c,s,t,n);a.instructions=[l],a.instructionTypes=[_.CreateATA],o=c}return i&&$.toBase58()===t.toBase58()&&(a.endInstructions=[Mt({owner:s,payer:s,tokenAccount:o,programId:n})],a.endInstructionTypes=[_.CloseAccount]),{pubKey:o,newInstructions:a}}async handleTokenAccount(t){let{side:n,amount:i,mint:o,programId:s=rn,tokenAccount:a,payer:u=this.scope.ownerPubKey,bypassAssociatedCheck:c,skipCloseAccount:l,checkCreateATAOwner:m}=t,p=this.getAssociatedTokenAccount(o,s);if(new ei($).equals(o)){let d=await It({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:u,amount:i,skipCloseAccount:l});return{tokenAccount:d.addresses.newAccount,...d}}else if(!a||n==="out"&&!p.equals(a)&&!c){let d=[],y=lo(this.scope.ownerPubKey,p,this.scope.ownerPubKey,o,s);if(m){let f=await this.scope.connection.getAccountInfo(p);if(f===null)d.push(y);else if(!(f.owner.equals(s)&&Yt.decode(f.data).mint.equals(o)&&Yt.decode(f.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${o.toString()}, ata: ${p.toString()}
          ataInfo.owner: ${f.owner.toString()}, programId: ${s.toString()},
          ataInfo.data.mint: ${Yt.decode(f.data).mint.toString()}, mint: ${o.toString()},
          ataInfo.data.owner: ${Yt.decode(f.data).owner.toString()}, owner: ${this.scope.ownerPubKey.toString()}`)}else d.push(y);return{tokenAccount:p,instructions:d,instructionTypes:[_.CreateATA]}}return{tokenAccount:a}}async processTokenAccount(t){let{mint:n,programId:i=rn,amount:o,useSOLBalance:s,handleTokenAccount:a}=t,u,c=this.createTxBuilder();if(n.equals(new ei($))&&s){let{tokenAccount:l,...m}=await this.handleTokenAccount({side:"in",amount:o||0,mint:n,bypassAssociatedCheck:!0,programId:i});u=l,c.addInstruction(m)}else if(u=await this.getCreatedTokenAccount({mint:n,associatedOnly:!1,programId:i}),!u&&a){let{tokenAccount:l,...m}=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:n,bypassAssociatedCheck:!0,programId:i});u=l,c.addInstruction(m)}return{tokenAccount:u,...c.AllTxData}}};import{createAssociatedTokenAccountInstruction as pd}from"@solana/spl-token";import{PublicKey as Ae,SystemProgram as fd}from"@solana/web3.js";import{PublicKey as Ta}from"@solana/web3.js";var mo=L([M("instruction")]),po=L([M("instruction")]),Ym=L([w("rewardState"),w("rewardOpenTime"),w("rewardEndTime"),w("rewardLastUpdateTime"),w("totalReward"),w("totalRewardEmissioned"),w("rewardClaimed"),w("rewardPerSecond"),X("accRewardPerShare"),B("rewardVault"),B("rewardMint"),B("rewardSender"),w("rewardType"),W(w(),15,"padding")]),Qm=L([w("state"),w("nonce"),B("lpVault"),B("rewardVault"),B(),B(),w(),w(),w("totalReward"),X("perShareReward"),w("lastSlot"),w("perSlotReward")]),Hm=L([w("state"),w("nonce"),B("lpVault"),B("rewardVaultA"),w("totalRewardA"),X("perShareRewardA"),w("perSlotRewardA"),M("option"),B("rewardVaultB"),me(7),w("totalRewardB"),X("perShareRewardB"),w("perSlotRewardB"),w("lastSlot"),B()]),jm=L([w(),w("state"),w("nonce"),w("validRewardTokenNum"),X("rewardMultiplier"),w("rewardPeriodMax"),w("rewardPeriodMin"),w("rewardPeriodExtend"),B("lpMint"),B("lpVault"),W(Ym,5,"rewardInfos"),B("creator"),B(),W(w(),32,"padding")]),ga=new Proxy(Qm,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return{...i,version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]}}:Reflect.get(r,e,t)}}),wa=new Proxy(Hm,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return{...i,version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]}}:Reflect.get(r,e,t)}}),Hn=new Proxy(jm,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return{...i,version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return{...o,rewardType:((s=Object.entries(Qt).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]}})}}:Reflect.get(r,e,t)}}),Zm=L([w("isSet"),w("rewardPerSecond"),w("rewardOpenTime"),w("rewardEndTime"),w("rewardType")]),fo=L([M("instruction"),w("nonce"),W(Zm,5,"rewardTimeInfo")]),yo=L([M("instruction"),w("rewardReopenTime"),w("rewardEndTime"),w("rewardPerSecond")]),bo=L([M("instruction"),w("isSet"),w("rewardPerSecond"),w("rewardOpenTime"),w("rewardEndTime"),w("rewardType")]),BA=L([w("state"),B("id"),B("owner"),w("deposited"),W(w(),1,"rewardDebts")]),jn=L([w("state"),B("id"),B("owner"),w("deposited"),W(X(),1,"rewardDebts"),w(""),w("voteLockedBalance"),W(w(),15)]),SA=L([w("state"),B("id"),B("owner"),w("deposited"),W(w(),2,"rewardDebts")]),Aa=L([w("state"),B("id"),B("owner"),w("deposited"),W(X(),2,"rewardDebts"),W(w(),17)]),Pa=L([w(),w("state"),B("id"),B("owner"),w("deposited"),W(X(),5,"rewardDebts"),W(w(),16)]),He=L([M("instruction"),w("amount")]),$m=L([B("mint"),B("grantAuthority"),w("baselineVoteWeightScaledFactor"),w("maxExtraLockupVoteWeightScaledFactor"),w("lockupSaturationSecs"),ua("digitShift"),W(M(),7,"reserved1"),W(w(),7,"reserved2")]),ka=L([me(8),B("governanceProgramId"),B("realm"),B("realmGoverningTokenMint"),B("realmAuthority"),W(M(),32,"reserved1"),W($m,4,"votingMints"),jr("timeOffset"),M("bump"),W(M(),7,"reserved2"),W(w(),11,"reserved3")]),Jm=L([jr("startTime"),jr("endTime"),M("kind"),W(M(),15,"reserved")]),ed=L([W(Jm,1,"lockup"),w("amountDeposited_native"),w("amountInitiallyLockedNative"),ve("isUsed"),ve("allowClawback"),M("votingMintConfigIdx"),W(M(),29,"reserved")]),ha=L([me(8),B("voterAuthority"),B("registrar"),W(ed,32,"deposits"),M("voterBump"),M("voterWweightRecordBump"),W(M(),94,"reserved")]);var _A=oe("Raydium_farm_config"),Ia=new Ta("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),xa=new Ta("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),Ba={3:ga,5:wa,6:Hn},Sa={3:jn,5:Aa,6:Pa},go=r=>[3,5,6].indexOf(r)!==-1,wo=r=>{var s;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=r,i=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,o={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${i}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${i}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${i}`}};return(s=o[e])==null?void 0:s.call(o)},Qt={"Standard SPL":0,"Option tokens":1},bt={[zi.toString()]:3,[Yi.toString()]:5,[kn.toString()]:6};import{PublicKey as ne,SystemProgram as on,SYSVAR_RENT_PUBKEY as rd,SYSVAR_CLOCK_PUBKEY as Jn,TransactionInstruction as Ne}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as id,TOKEN_PROGRAM_ID as nt,ASSOCIATED_TOKEN_PROGRAM_ID as od}from"@solana/spl-token";import ni from"bn.js";function Ao(r,e,t){return re([e.toBuffer(),Buffer.from("registrar","utf8"),t.toBuffer()],r)}function Po(r,e){return re([e.toBuffer(),Buffer.from("voting_mint_seed","utf8")],r)}function ko(r,e){return re([e.toBuffer()],r)}function ho(r,e,t){return re([e.toBuffer(),Buffer.from("voter","utf8"),t.toBuffer()],r)}function To(r,e,t){return re([e.toBuffer(),Buffer.from("voter-weight-record","utf8"),t.toBuffer()],r)}function Io(r,e,t,n){return re([Buffer.from("governance","utf8"),e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}import Je from"bn.js";var Zn=oe("Raydium.farm.util");function $n({programId:r,poolId:e,mint:t,type:n}){let{publicKey:i}=re([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],r);return i}function et({programId:r,poolId:e,owner:t,version:n}){let{publicKey:i}=re([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return i}var Ka=({programId:r,poolId:e})=>re([e.toBuffer()],r);function Ca(r){return{isSet:new Je(1),rewardPerSecond:q(r.perSecond),rewardOpenTime:q(r.openTime),rewardEndTime:q(r.endTime),rewardType:q(Qt[r.rewardType])}}function xo(r){return q(r.endTime).sub(q(r.openTime)).mul(q(r.perSecond))}function ti(r){let e=Sa[r];return e||Zn.logWithError("invalid version",r),e}function td(r){let e=Ba[r];return e||Zn.logWithError("invalid version",r),e}function nd(r,e,t,n){if(r.version===3||r.version===5){if(r.lastSlot.gte(new Je(t)))return r;let i=new Je(t).sub(r.lastSlot);r.lastSlot=new Je(t);for(let o of r.rewardInfos){if(e.amount.eq(new Je(0)))continue;let s=o.perSlotReward.mul(i);o.perShareReward=o.perShareReward.add(s.mul(new Je(10).pow(new Je(r.version===3?9:15))).div(e.amount)),o.totalReward=o.totalReward.add(s)}}else if(r.version===6)for(let i of r.rewardInfos){if(i.rewardState.eq(new Je(0)))continue;let o=Je.min(new Je(n),i.rewardEndTime);if(i.rewardOpenTime.gte(o))continue;let a=o.sub(i.rewardLastUpdateTime).mul(i.rewardPerSecond),u=i.totalReward.sub(i.totalRewardEmissioned);u.lt(a)?(a=u,i.rewardLastUpdateTime=i.rewardLastUpdateTime.add(u.div(i.rewardPerSecond))):i.rewardLastUpdateTime=o,!e.amount.eq(new Je(0))&&(i.accRewardPerShare=i.accRewardPerShare.add(a.mul(r.rewardMultiplier).div(e.amount)),i.totalRewardEmissioned=i.totalRewardEmissioned.add(a))}return r}async function $A({connection:r,farmPools:e,owner:t,config:n,chainTime:i}){let o=!1,s=!1,a=new Je(10),u=[];for(let p of e){let d=de(p);d.version===6?s=!0:o=!0,u.push({pubkey:d.id,version:d.version,key:"state",poolId:d.id},{pubkey:d.lpVault,version:d.version,key:"lpVault",poolId:d.id}),t&&u.push({pubkey:et({programId:d.programId,poolId:d.id,owner:t,version:p.version}),version:d.version,key:"ledger",poolId:d.id})}let c={},l=await Pn(r,u,n);for(let{pubkey:p,version:d,key:y,poolId:f,accountInfo:b}of l){let g=f.toBase58();if(c[g]={...c[g]},y==="state"){let A=td(d);(!b||!b.data||b.data.length!==A.span)&&Zn.logWithError(`invalid farm state account info, pools.id, ${p}`),c[g].state=A.decode(b.data)}else if(y==="lpVault")(!b||!b.data||b.data.length!==Gt.span)&&Zn.logWithError(`invalid farm lp vault account info, pools.lpVault, ${p}`),c[g].lpVault=Gt.decode(b.data);else if(y==="ledger"){let A=ti(d);b&&b.data&&(b.data.length!==A.span&&Zn.logWithError(`invalid farm ledger account info, ledger, ${p}`),c[g].ledger=A.decode(b.data))}}let m=s||o?await r.getSlot():0;for(let p of Object.keys(c))c[p]!==void 0&&(c[p].state=nd(c[p].state,c[p].lpVault,m,i));for(let[p,{state:d,ledger:y}]of Object.entries(c))if(y){let f=d.version===6?d.rewardMultiplier:d.rewardInfos.length===1?a.pow(new Je(9)):a.pow(new Je(15)),b=d.rewardInfos.map((g,A)=>{let k=y.rewardDebts[A];return y.deposited.mul(d.version===6?g.accRewardPerShare:g.perShareReward).div(f).sub(k)});c[p].wrapped={...c[p].wrapped,pendingRewards:b}}return c}function JA(r,e=Date.now()){if(r.version===6){let t=r.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>Hs(e,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>js(e,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=r.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}async function Bo(r,e,t,n){let i=await r.getAccountInfo(e);if(i===null)throw Error("registrar info check error");let s=ka.decode(i.data).votingMints.findIndex(l=>l.mint.equals(n));if(s===-1)throw Error("find voter mint error");let a=await r.getAccountInfo(t);if(a===null)return{index:s,isInit:!1};let c=ha.decode(a.data).deposits.findIndex(l=>l.isUsed&&l.votingMintConfigIdx===s);return c===-1?{index:s,isInit:!1}:{index:c,isInit:!0}}var sd=oe("Raydium_farm_instruction"),er={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Ra(r){let{version:e,id:t,ledger:n,programId:i,owner:o}=r,s={3:9,5:10}[e];s||sd.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(mo.span);mo.encode({instruction:s},a);let u=[P({pubkey:t}),P({pubkey:n}),P({pubkey:o,isWritable:!1}),P({pubkey:on.programId,isWritable:!1}),P({pubkey:rd,isWritable:!1})];return{instruction:new Ne({programId:i,keys:u,data:a}),instructionType:_.FarmV3CreateLedger}}function La(r){var n;let e=Buffer.alloc(fo.span);fo.encode({instruction:0,nonce:new ni(r.nonce),rewardTimeInfo:r.rewardInfoConfig},e);let t=[...Ri,P({pubkey:r.farmId}),P({pubkey:r.farmAuthority,isWritable:!1}),P({pubkey:r.lpVault}),P({pubkey:r.lpMint,isWritable:!1}),P({pubkey:r.lockVault}),P({pubkey:r.lockMint,isWritable:!1}),P({pubkey:(n=r.lockUserAccount)!=null?n:Re}),P({pubkey:r.owner,isWritable:!1,isSigner:!0})];for(let i of r.rewardInfo)t.push(P({pubkey:i.rewardMint,isWritable:!1}),P({pubkey:i.rewardVault}),P({pubkey:i.userRewardToken}));return{instruction:new Ne({programId:r.programId,keys:t,data:e}),instructionType:_.FarmV6Create}}function Oa(r){let e=Buffer.alloc(po.span);po.encode({instruction:5},e);let t=[P({pubkey:nt,isWritable:!1}),P({pubkey:r.id}),P({pubkey:r.authority,isWritable:!1}),P({pubkey:r.lpVault,isWritable:!1}),P({pubkey:r.rewardVault}),P({pubkey:r.userRewardToken}),P({pubkey:r.owner,isWritable:!1,isSigner:!0})];return{instruction:new Ne({programId:r.programId,keys:t,data:e}),instructionType:_.FarmV6CreatorWithdraw}}function ad(r,e,t,n,i,o,s,a,u,c,l,m,p){let d=L([M("depositEntryIndex"),w("amount")]),y=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:Lr,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({depositEntryIndex:m,amount:p},f);let b=Buffer.from([...er.voterStakeRegistryDeposit,...f]);return new Ne({keys:y,programId:r,data:b})}function ud(r,e,t,n){let i=L([]),o=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:on.programId,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([...er.voterStakeRegistryUpdateVoterWeightRecord,...s]);return new Ne({keys:o,programId:r,data:a})}function cd(r,e,t,n,i,o,s,a,u,c,l,m,p,d,y){let f=L([M("depositEntryIndex"),w("amount")]),b=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Lr,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({depositEntryIndex:d,amount:y},g);let A=Buffer.from([...er.voterStakeRegistryWithdraw,...g]);return new Ne({keys:b,programId:r,data:A})}function ld(r,e,t,n,i,o){let s=L([M("ins")]),a=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:on.programId,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);return s.encode({ins:23},u),new Ne({keys:a,programId:r,data:u})}function md(r,e,t,n,i,o,s,a){let u=L([M("voterBump"),M("voterWeightRecordBump")]),c=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:on.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:Lr,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({voterBump:s,voterWeightRecordBump:a},l);let m=Buffer.from([...er.voterStakeRegistryCreateVoter,...l]);return new Ne({keys:c,programId:r,data:m})}function dd(r,e,t,n,i,o,s,a,u,c,l,m){let p=L([M("depositEntryIndex"),M("kind"),M("option"),w("startTs"),Ue("periods"),ve("allowClawback")]),d=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:on.programId,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:od,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1}],y=Buffer.alloc(p.span);p.encode({depositEntryIndex:a,kind:u,option:c===void 0?0:1,startTs:c,periods:l,allowClawback:m},y);let f=Buffer.from([...er.voterStakeRegistryCreateDepositEntry,...y]);return new Ne({keys:d,programId:r,data:f})}async function bP({connection:r,programId:e,governanceProgramId:t,voteWeightAddinProgramId:n,realm:i,communityTokenMint:o,owner:s,poolId:a,tokenProgram:u}){let c=Ao(n,i,o).publicKey,l=et({programId:e,poolId:a,owner:s,version:3}),m=await r.getAccountInfo(l);if(m===null)throw Error("user is not staker");let p=jn.decode(m.data),d=p.deposited.sub(p.voteLockedBalance);if(console.log("amount",d.toString()),d.eq(new ni(0)))throw Error("user do not has new stake amount");let y=Po(e,a).publicKey,f=ko(e,a).publicKey,{publicKey:b,nonce:g}=ho(n,c,s),A=pe(b,y,u).publicKey,{publicKey:k,nonce:h}=To(n,c,s),T=Io(t,i,o,s).publicKey,I=[],S=pe(s,y,u).publicKey;if(await r.getAccountInfo(S)===null&&I.push(id(s,S,s,y)),await r.getAccountInfo(b)===null){let z=ld(t,i,s,o,s,T);I.push(z,md(n,c,b,k,s,s,g,h))}let{index:N,isInit:E}=await Bo(r,c,b,y);return E||I.push(dd(n,c,b,A,s,s,y,N,0,void 0,0,!1)),I.push(ad(n,c,b,A,S,s,l,a,y,f,e,N,d),ud(n,c,b,k)),I}async function gP({connection:r,programId:e,governanceProgramId:t,voteWeightAddinProgramId:n,realm:i,communityTokenMint:o,owner:s,poolId:a,tokenProgram:u}){let c=Ao(n,i,o).publicKey,l=et({programId:e,poolId:a,owner:s,version:3}),m=await r.getAccountInfo(l);if(m===null)throw Error("user is not staker");let p=jn.decode(m.data);if(p.voteLockedBalance.eq(new ni(0)))throw Error("user has vote locked balance = 0");let d=Po(e,a).publicKey,y=ko(e,a).publicKey,{publicKey:f}=ho(n,c,s),b=pe(f,d,u).publicKey,{publicKey:g}=To(n,c,s),A=Io(t,i,o,s).publicKey,k=[],{index:h,isInit:T}=await Bo(r,c,f,d);if(!T)throw Error("deposit entry index check error");return k.push(cd(n,c,f,s,A,g,b,pe(s,d,u).publicKey,l,a,d,y,e,h,p.voteLockedBalance)),k}function So({payer:r,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:i}){let o=Buffer.alloc(yo.span);yo.encode({instruction:3,rewardReopenTime:q(i.openTime),rewardEndTime:q(i.endTime),rewardPerSecond:q(i.perSecond)},o);let s=[P({pubkey:nt,isWritable:!1}),P({pubkey:n.id}),P({pubkey:n.lpVault,isWritable:!1}),P({pubkey:e}),P({pubkey:t}),P({pubkey:r,isWritable:!1,isSigner:!0})];return new Ne({programId:n.programId,keys:s,data:o})}function Ko({payer:r,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:i}){let o=Buffer.alloc(bo.span);bo.encode({instruction:4,isSet:new ni(1),rewardPerSecond:q(i.perSecond),rewardOpenTime:q(i.openTime),rewardEndTime:q(i.endTime),rewardType:q(Qt[i.rewardType])},o);let s=[...Ri,P({pubkey:t.id}),P({pubkey:t.authority,isWritable:!1}),P({pubkey:i.mint,isWritable:!1}),P({pubkey:n}),P({pubkey:e}),P({pubkey:r,isWritable:!1,isSigner:!0})];return new Ne({programId:t.programId,keys:s,data:o})}function wP(r){let{farmInfo:e,farmKeys:t,version:n,lpAccount:i,rewardAccounts:o,owner:s,instruction:a,amount:u,deposit:c}=r,[l,m]=[new ne(e.programId),new ne(e.id)],p=et({programId:l,poolId:m,owner:s,version:n}),d=Buffer.alloc(He.span);He.encode({instruction:a,amount:u},d);let y=n===6?[P({pubkey:nt,isWritable:!1}),...c?[P({pubkey:on.programId,isWritable:!1})]:[],P({pubkey:m}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:new ne(t.lpVault)}),P({pubkey:p}),P({pubkey:s,isWritable:!1,isSigner:!0}),P({pubkey:i})]:[P({pubkey:m}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:p}),P({pubkey:s,isWritable:!1,isSigner:!0}),P({pubkey:i}),P({pubkey:new ne(t.lpVault)}),P({pubkey:o[0]}),P({pubkey:new ne(t.rewardInfos[0].vault)}),P({pubkey:Jn,isWritable:!1}),P({pubkey:nt,isWritable:!1})];if(n===5)for(let f=1;f<t.rewardInfos.length;f++)y.push(P({pubkey:o[f]})),y.push(P({pubkey:new ne(t.rewardInfos[f].vault)}));if(n===6)for(let f=0;f<t.rewardInfos.length;f++)y.push(P({pubkey:new ne(t.rewardInfos[f].vault)})),y.push(P({pubkey:o[f]}));return new Ne({programId:l,keys:y,data:d})}function tr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new ne(e.programId),new ne(e.id)],c=et({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(He.span);He.encode({instruction:2,amount:q(s)},l);let m=[P({pubkey:nt,isWritable:!1}),P({pubkey:u}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:new ne(t.lpVault)}),P({pubkey:c}),P({pubkey:o,isWritable:!1,isSigner:!0}),P({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)m.push(P({pubkey:new ne(t.rewardInfos[p].vault)})),m.push(P({pubkey:i[p]}));return new Ne({programId:a,keys:m,data:l})}function nr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ne(e.programId),new ne(e.id)],l=et({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(He.span);He.encode({instruction:12,amount:q(s)},m);let p=[P({pubkey:c}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:l}),P({pubkey:o,isWritable:!1,isSigner:!0}),P({pubkey:n}),P({pubkey:new ne(t.lpVault)}),P({pubkey:i[0]}),P({pubkey:new ne(t.rewardInfos[0].vault)}),P({pubkey:Jn,isWritable:!1}),P({pubkey:nt,isWritable:!1})];for(let d=1;d<t.rewardInfos.length;d++)p.push(P({pubkey:i[d]})),p.push(P({pubkey:new ne(t.rewardInfos[d].vault)}));if(a)for(let d of a)p.push(P({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function rr(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ne(e.programId),new ne(e.id)],l=et({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(He.span);He.encode({instruction:11,amount:q(s)},m);let p=[P({pubkey:c}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:l}),P({pubkey:o,isWritable:!1,isSigner:!0}),P({pubkey:n}),P({pubkey:new ne(t.lpVault)}),P({pubkey:i[0]}),P({pubkey:new ne(t.rewardInfos[0].vault)}),P({pubkey:Jn,isWritable:!1}),P({pubkey:nt,isWritable:!1})];if(a)for(let d of a)p.push(P({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function Na(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ne(e.programId),new ne(e.id)],l=et({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(He.span);He.encode({instruction:10,amount:q(s)},m);let p=[P({pubkey:c}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:l}),P({pubkey:o,isWritable:!1,isSigner:!0}),P({pubkey:n}),P({pubkey:new ne(t.lpVault)}),P({pubkey:i[0]}),P({pubkey:new ne(t.rewardInfos[0].vault)}),P({pubkey:Jn,isWritable:!1}),P({pubkey:nt,isWritable:!1})];if(a)for(let d of a)p.push(P({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function Ma(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ne(e.programId),new ne(e.id)],l=et({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(He.span);He.encode({instruction:11,amount:q(s)},m);let p=[P({pubkey:c}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:l}),P({pubkey:o,isWritable:!1,isSigner:!0}),P({pubkey:n}),P({pubkey:new ne(t.lpVault)}),P({pubkey:i[0]}),P({pubkey:new ne(t.rewardInfos[0].vault)}),P({pubkey:Jn,isWritable:!1}),P({pubkey:nt,isWritable:!1})];for(let d=1;d<t.rewardInfos.length;d++)p.push(P({pubkey:i[d]})),p.push(P({pubkey:new ne(t.rewardInfos[d].vault)}));if(a)for(let d of a)p.push(P({pubkey:d}));return new Ne({programId:u,keys:p,data:m})}function _a(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new ne(e.programId),new ne(e.id)],c=et({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(He.span);He.encode({instruction:1,amount:q(s)},l);let m=[P({pubkey:nt,isWritable:!1}),P({pubkey:on.programId,isWritable:!1}),P({pubkey:u}),P({pubkey:new ne(t.authority),isWritable:!1}),P({pubkey:new ne(t.lpVault)}),P({pubkey:c}),P({pubkey:o,isWritable:!1,isSigner:!0}),P({pubkey:n})];for(let p=0;p<t.rewardInfos.length;p++)m.push(P({pubkey:new ne(t.rewardInfos[p].vault)})),m.push(P({pubkey:i[p]}));return new Ne({programId:a,keys:m,data:l})}var ir=class extends he{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(Re)){let n=await It({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:xo({...t,openTime:t.openTime.toString(),endTime:t.endTime.toString()})});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:i=kn,txVersion:o}){this.checkDisabled(),this.scope.checkOwner();let a={lpMint:new Ae(e.lpMint.address),lockInfo:{lockMint:Ia,lockVault:xa},version:6,rewardInfos:t,programId:i},u=this.createTxBuilder(),c=n!=null?n:this.scope.ownerPubKey,l=Ge({fromPublicKey:c,programId:a.programId}),m=await this.scope.connection.getMinimumBalanceForRentExemption(Hn.span);u.addInstruction({instructions:[fd.createAccountWithSeed({fromPubkey:c,basePubkey:c,seed:l.seed,newAccountPubkey:l.publicKey,lamports:m,space:Hn.span,programId:a.programId})]});let{publicKey:p,nonce:d}=Ka({programId:new Ae(a.programId),poolId:l.publicKey}),y=$n({programId:a.programId,poolId:l.publicKey,mint:a.lpMint,type:"lpVault"}),f=[],b=[];for(let h of a.rewardInfos){h.openTime>=h.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",h.openTime.toString()),isNaN(Qt[h.rewardType])&&this.logAndCreateError("rewardType error",h.rewardType),Number(h.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",h.perSecond),f.push(Ca(h));let{rewardPubKey:T,newInstruction:I}=await this._getUserRewardInfo({rewardInfo:h,payer:c});I&&u.addInstruction(I),T||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let S=h.mint.equals(Re)?new Ae(Le.address):h.mint;b.push({rewardMint:S,rewardVault:$n({programId:a.programId,poolId:l.publicKey,mint:S,type:"rewardVault"}),userRewardToken:T})}let g=await this.scope.account.getCreatedTokenAccount({mint:a.lockInfo.lockMint});g||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:A,instructionType:k}=La({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:p,lpVault:y,lpMint:a.lpMint,lockVault:a.lockInfo.lockVault,lockMint:a.lockInfo.lockMint,lockUserAccount:g,programId:a.programId,rewardInfo:b,rewardInfoConfig:f,nonce:d});return u.addInstruction({instructions:[A],instructionTypes:[k]}).versionBuild({txVersion:o,extInfo:{farmId:l.publicKey,farmAuthority:p,lpVault:y,lockUserAccount:g,nonce:d}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:i}){var b;let o=bt[e.programId];o!==6&&this.logAndCreateError("invalid farm version ",o);let s=de((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let u=t||this.scope.ownerPubKey,c=n.mint.equals(Re)?new Ae(Le.address):n.mint,l=a.rewardInfos.findIndex(g=>new Ae(g.mint.address).equals(c)),m=s.rewardInfos[l];m||this.logAndCreateError("configuration does not exist","rewardMint",c);let p=(b=m.vault)!=null?b:Re,d=this.createTxBuilder(),{rewardPubKey:y,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:n,payer:u});return f&&d.addInstruction(f),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),d.addInstruction({instructions:[So({payer:this.scope.ownerPubKey,rewardVault:p,userRewardTokenPub:y,farmKeys:a,rewardInfo:n})],instructionTypes:[_.FarmV6Restart]}).versionBuild({txVersion:i})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:i}){var l;let o=bt[e.programId];o!==6&&this.logAndCreateError("invalid farm version ",o);let s=de((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(m=>{m.openTime>=m.endTime&&this.logAndCreateError("start time error","newRewardInfo",m)});let u=t||this.scope.ownerPubKey,c=this.createTxBuilder();for(let m of n){let p=m.mint.equals(Re)?new Ae(Le.address):m.mint,d=a.rewardInfos.findIndex(k=>new Ae(k.mint.address).equals(p)),y=s.rewardInfos[d];y||this.logAndCreateError("configuration does not exist","rewardMint",p);let f=(l=y.vault)!=null?l:Re,{rewardPubKey:b,newInstruction:g}=await this._getUserRewardInfo({rewardInfo:m,payer:u});g&&c.addInstruction(g),b||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let A=So({payer:this.scope.ownerPubKey,rewardVault:f,userRewardTokenPub:b,farmKeys:a,rewardInfo:m});c.addInstruction({instructions:[A],instructionTypes:[_.FarmV6Restart]})}return c.versionBuild({txVersion:i})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:i,payer:o}=e,s=bt[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=de((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=o!=null?o:this.scope.ownerPubKey,c=this.createTxBuilder(),l=i.mint.equals(Re)?new Ae(Le.address):i.mint,m=$n({programId:new Ae(n.programId),poolId:new Ae(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:p,newInstruction:d}=await this._getUserRewardInfo({rewardInfo:i,payer:u});return d&&c.addInstruction(d),p||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),i.mint=l,c.addInstruction({instructions:[Ko({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:a,rewardVault:m,rewardInfo:i})],instructionTypes:[_.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:i,payer:o}=e,s=bt[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=de((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=o!=null?o:this.scope.ownerPubKey,c=this.createTxBuilder();for(let l of i){let m=l.mint.equals(Re)?new Ae(Le.address):l.mint,p=$n({programId:new Ae(n.programId),poolId:new Ae(n.id),mint:m,type:"rewardVault"}),{rewardPubKey:d,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:l,payer:u});y&&c.addInstruction(y),d||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let f=Ko({payer:this.scope.ownerPubKey,userRewardTokenPub:d,farmKeys:a,rewardVault:p,rewardInfo:{...l,mint:m}});c.addInstruction({instructions:[f],instructionTypes:[_.FarmV6CreatorAddReward]})}return c.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:i,feePayer:o,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:c,computeBudgetConfig:l}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:m,programId:p}=n,d=bt[p];go(d)||this.logAndCreateError("invalid farm program:",n.programId);let[y,f]=[new Ae(n.programId),new Ae(n.id)],b=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],g=et({programId:y,poolId:f,owner:this.scope.ownerPubKey,version:d}),A=this.createTxBuilder();A.addCustomComputeBudget(l);let k={};for(let v of this.scope.account.tokenAccounts)if(a){let Z=pe(this.scope.ownerPubKey,v.mint,v.programId).publicKey;v.publicKey&&Z.equals(v.publicKey)&&(k[v.mint.toString()]=v.publicKey)}else k[v.mint.toString()]=v.publicKey;let h=b.lpMint,T=k[h.address];T||this.logAndCreateError("you don't have any lp","lp zero",k);let I=[];for(let v of m){let Z=s&&v.mint.address===$.toString(),ee=k[v.mint.address];if(!ee){let{account:ie,instructionParams:mt}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:v.mint.programId,mint:new Ae(v.mint.address),notUseTokenAccount:Z,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!Z,associatedOnly:Z?!1:a,checkCreateATAOwner:u});ee=ie,mt&&A.addInstruction(mt)}k[v.mint.address]=ee,I.push(ee)}let S,x=await this.scope.connection.getAccountInfo(g);if(x&&(S=ti(d).decode(x.data)),n.programId!==kn.toString()&&!S){let{instruction:v,instructionType:Z}=Ra({id:f,programId:y,version:d,ledger:g,owner:this.scope.ownerPubKey});A.addInstruction({instructions:[v],instructionTypes:[Z]})}let R=wo({version:d,rewardInfos:m,rewardTokenAccountsPublicKeys:I});R&&this.logAndCreateError(R);let N={amount:q(i),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:b,lpAccount:T,rewardAccounts:I,userAuxiliaryLedgers:c==null?void 0:c.map(v=>new Ae(v))},E=d===6?_a(N):d===5?Ma(N):Na(N),z={3:_.FarmV3Deposit,5:_.FarmV5Deposit,6:_.FarmV6Deposit};return A.addInstruction({instructions:[E],instructionTypes:[z[d]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:i,deposited:o,useSOLBalance:s,feePayer:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:l,computeBudgetConfig:m}=e,{rewardInfos:p}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let d=bt[n.programId];go(d)||this.logAndCreateError("invalid farm program:",n.programId);let y=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],f=this.createTxBuilder();f.addCustomComputeBudget(m);let b={};for(let R of this.scope.account.tokenAccounts)if(u){let N=pe(this.scope.ownerPubKey,R.mint).publicKey;R.publicKey&&N.equals(R.publicKey)&&(b[R.mint.toString()]=R.publicKey)}else b[R.mint.toString()]=R.publicKey;if(o)o.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let R=et({programId:new Ae(n.programId),poolId:new Ae(n.id),owner:this.scope.ownerPubKey,version:d}),N=await this.scope.connection.getAccountInfo(R);N||this.logAndCreateError("no lp data",{farmId:n.id,version:d,ledgerData:N}),ti(d).decode(N.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id})}let g=y.lpMint.address,A=s&&g===$.toString(),k=b[g.toString()];if(!k){let{account:R,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.lpMint.programId,mint:new Ae(g),notUseTokenAccount:A,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:A?!1:u,checkCreateATAOwner:c});k=R,N&&f.addInstruction(N)}b[g.toString()]=k;let h=[];for(let R of p){let N=s&&R.mint.address===$.toString(),E=b[R.mint.address];if(!E){let{account:z,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:R.mint.programId,mint:new Ae(R.mint.address),notUseTokenAccount:N,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!N,associatedOnly:N?!1:u,checkCreateATAOwner:c});E=z,v&&f.addInstruction(v)}b[R.mint.address]=E,h.push(E)}let T=wo({version:d,rewardInfos:p,rewardTokenAccountsPublicKeys:h});T&&this.logAndCreateError(T);let I={amount:q(i),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:y,lpAccount:k,rewardAccounts:h,userAuxiliaryLedgers:l==null?void 0:l.map(R=>new Ae(R))},S=d===6?tr(I):d===5?nr(I):rr(I),x={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};return f.addInstruction({instructions:[S],instructionTypes:[x[d]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n}){var d;this.scope.checkOwner();let i=de((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),o=bt[e.programId];o!==6&&this.logAndCreateError("invalid farm version",o);let s=e.rewardInfos.findIndex(y=>y.mint.address===Re.toString()?new Ae(Le.address):t),a=i.rewardInfos[s];a||this.logAndCreateError("withdraw mint error","rewardInfos",e);let u=(d=a==null?void 0:a.vault)!=null?d:Re,c=this.createTxBuilder(),l;if(t.equals(Re)){let y=await It({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:xo({...a,openTime:a.openTime,endTime:a.endTime,perSecond:new V(a.perSecond).mul(10**a.mint.decimals).toString()})});l=y.addresses.newAccount,c.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(l=await this.scope.account.getAssociatedTokenAccount(t),c.addInstruction({instructions:[pd(this.scope.ownerPubKey,l,this.scope.ownerPubKey,t)],instructionTypes:[_.CreateATA]})):l=y}let{instruction:m,instructionType:p}=Oa({programId:i.programId,id:i.id,authority:i.authority,lpVault:i.lpVault,rewardVault:u,userRewardToken:l,owner:this.scope.ownerPubKey});return c.addInstruction({instructions:[m],instructionTypes:[p]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:u,computeBudgetConfig:c}=e,l=this.createTxBuilder(),m={};for(let y of this.scope.account.tokenAccounts)if(o){let f=pe(this.scope.ownerPubKey,y.mint).publicKey;y.publicKey&&f.equals(y.publicKey)&&(m[y.mint.toString()]=y.publicKey)}else m[y.mint.toString()]=y.publicKey;let d=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(y=>y.id).join(",")})).reduce((y,f)=>({...y,[f.id]:f}),{});for(let y of Object.values(t)){let{programId:f,lpMint:b,rewardInfos:g,id:A}=y,k=bt[f],h=b.address,T=n&&h===$.toString(),I=m[h];if(!I){let{account:z,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:b.programId,mint:new Ae(h),notUseTokenAccount:T,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:T?!1:o,checkCreateATAOwner:s});I=z,v&&l.addInstruction(v)}m[h.toString()]=I;let S=[];for(let z of g){let v=n&&z.mint.address===$.toString(),Z=m[z.mint.address];if(!Z){let{account:ee,instructionParams:ie}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:z.mint.programId,mint:new Ae(z.mint.address),notUseTokenAccount:v,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!v,associatedOnly:v?!1:o,checkCreateATAOwner:s});Z=ee,ie&&l.addInstruction(ie)}m[z.mint.address]=Z,S.push(Z)}let x=d[A],R={amount:Ie,owner:this.scope.ownerPubKey,farmInfo:y,farmKeys:x,lpAccount:I,rewardAccounts:S,userAuxiliaryLedgers:a==null?void 0:a.map(z=>new Ae(z))},N=k===6?tr(R):k===5?nr(R):rr(R),E={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};l.addInstruction({instructions:[N],instructionTypes:[E[k]]})}return u===1?l.sizeCheckBuild({computeBudgetConfig:c}):l.sizeCheckBuildV0({computeBudgetConfig:c})}};import{PublicKey as tt}from"@solana/web3.js";import{NATIVE_MINT as gu,TOKEN_PROGRAM_ID as li}from"@solana/spl-token";var DP=L([Ue("mintAuthorityOption"),B("mintAuthority"),w("supply"),M("decimals"),M("isInitialized"),Ue("freezeAuthorityOption"),B("freezeAuthority")]);import{PublicKey as yd}from"@solana/web3.js";import{MintLayout as Va,TOKEN_PROGRAM_ID as bd}from"@solana/spl-token";var HP=async({connection:r,mint:e})=>{let t=await r.getAccountInfo(new yd(e));return!t||t.data.length!==Va.span?void 0:Va.decode(t.data)},jP=({mint:r,decimals:e,programId:t=bd,logoURI:n="",priority:i=3})=>{let o=r.toBase58().substring(0,6);return{address:r.toBase58(),decimals:e,symbol:o,logoURI:n,extensions:{},chainId:101,programId:t.toString(),name:o,tags:[],priority:i}},Ea=r=>new le({mint:r.address,decimals:r.decimals,symbol:r.symbol,name:r.name}),ZP=({amount:r,isRaw:e,name:t,...n})=>new Pe(new le({mint:n.address,decimals:n.decimals,symbol:n.symbol,name:t}),r,e,t);function $P(r){return r.address===Pt.address?Le:r}function JP(r){return r.address===Le.address?Pt:r}import{TOKEN_PROGRAM_ID as or,ASSOCIATED_TOKEN_PROGRAM_ID as Ld}from"@solana/spl-token";import{PublicKey as fe,TransactionInstruction as _t,SystemProgram as _o,SYSVAR_RENT_PUBKEY as Od}from"@solana/web3.js";var Co=L([M("instruction"),w("amountIn"),w("minAmountOut")]),Ro=L([M("instruction"),w("maxAmountIn"),w("amountOut")]),mk=L([M("instruction"),M("nonce")]),Lo=L([M("instruction"),M("nonce"),w("startTime")]),gd=L([w("status"),w("nonce"),w("maxOrder"),w("depth"),w("baseDecimal"),w("quoteDecimal"),w("state"),w("resetFlag"),w("minSize"),w("volMaxCutRatio"),w("amountWaveRatio"),w("baseLotSize"),w("quoteLotSize"),w("minPriceMultiplier"),w("maxPriceMultiplier"),w("systemDecimalValue"),w("minSeparateNumerator"),w("minSeparateDenominator"),w("tradeFeeNumerator"),w("tradeFeeDenominator"),w("pnlNumerator"),w("pnlDenominator"),w("swapFeeNumerator"),w("swapFeeDenominator"),w("baseNeedTakePnl"),w("quoteNeedTakePnl"),w("quoteTotalPnl"),w("baseTotalPnl"),w("poolOpenTime"),w("punishPcAmount"),w("punishCoinAmount"),w("orderbookToInitTime"),X("swapBaseInAmount"),X("swapQuoteOutAmount"),w("swapBase2QuoteFee"),X("swapQuoteInAmount"),X("swapBaseOutAmount"),w("swapQuote2BaseFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("withdrawQueue"),B("lpVault"),B("owner"),w("lpReserve"),W(w(),3,"padding")]),wd=L([w("accountType"),w("status"),w("nonce"),w("maxOrder"),w("depth"),w("baseDecimal"),w("quoteDecimal"),w("state"),w("resetFlag"),w("minSize"),w("volMaxCutRatio"),w("amountWaveRatio"),w("baseLotSize"),w("quoteLotSize"),w("minPriceMultiplier"),w("maxPriceMultiplier"),w("systemDecimalsValue"),w("abortTradeFactor"),w("priceTickMultiplier"),w("priceTick"),w("minSeparateNumerator"),w("minSeparateDenominator"),w("tradeFeeNumerator"),w("tradeFeeDenominator"),w("pnlNumerator"),w("pnlDenominator"),w("swapFeeNumerator"),w("swapFeeDenominator"),w("baseNeedTakePnl"),w("quoteNeedTakePnl"),w("quoteTotalPnl"),w("baseTotalPnl"),w("poolOpenTime"),w("punishPcAmount"),w("punishCoinAmount"),w("orderbookToInitTime"),X("swapBaseInAmount"),X("swapQuoteOutAmount"),X("swapQuoteInAmount"),X("swapBaseOutAmount"),w("swapQuote2BaseFee"),w("swapBase2QuoteFee"),B("baseVault"),B("quoteVault"),B("baseMint"),B("quoteMint"),B("lpMint"),B("modelDataAccount"),B("openOrders"),B("marketId"),B("marketProgramId"),B("targetOrders"),B("owner"),W(w(),64,"padding")]),Oo=L([M("instruction"),w("baseAmountIn"),w("quoteAmountIn"),w("fixedSide")]),No=L([M("instruction"),w("amountIn")]),dk={4:gd,5:wd},Fa=L([w("fee")]);import{PublicKey as Ad}from"@solana/web3.js";var xn=new Ad("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),an=5e4,Pd=L([w("x"),w("y"),w("price")]),kd=L([w("accountType"),w("status"),w("multiplier"),w("validDataCount"),W(Pd,an,"DataElement")]);function hd(r,e){return[0,an-2]}function Td(r){return[0,an-2]}function Id(r){return[0,an-2]}function xd(r,e,t){let[n,i]=hd(e,t),o=n,s=i,a=0,u=e*r.multiplier/t;for(;o<=s;){if(a=Math.floor((s+o)/2),a===0||a>=an-2)return[a,a,!1];let c=r.DataElement[a].x*r.multiplier/r.DataElement[a].y,l=r.DataElement[a-1].x*r.multiplier/r.DataElement[a-1].y,m=r.DataElement[a+1].x*r.multiplier/r.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===l)return[a-1,a-1,!0];if(u===m)return[a+1,a+1,!0];if(u<l)s=a-1;else{if(u>l&&u<c)return[a-1,a,!0];if(u>c&&u<m)return[a,a+1,!0];o=a+1}}return[a,a,!1]}function Mo(r,e,t){let[n,i,o]=xd(r,e,t);if(!o)return 0;if(n===i){let s=r.DataElement[n].x;return e*r.multiplier/s}else{let s=r.DataElement[n].x,a=r.DataElement[n].y,u=r.DataElement[i].x,c=r.DataElement[i].y,l=t*(u*a-s*c),m=s*l,p=(u-s)*(e*a-s*t)*c,d=m+p;return e*r.multiplier*l/d}}function sn(r,e,t){return e*r.multiplier/t}function va(r,e,t){return e*t/r.multiplier}function Bd(r,e){let[t,n]=Td(e),i=t,o=n,s=0,a=e;for(;i<o;){if(s=Math.floor((o+i)/2),s<=0||s>an-2)return[s,s,!1];let u=r.DataElement[s].x,c=r.DataElement[s-1].x,l=r.DataElement[s+1].x;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<c)o=s-1;else{if(a>c&&a<u)return[s-1,s,!0];if(a>u&&a<l)return[s,s+1,!0];i=s+1}}return[s,s,!1]}function Sd(r,e){let[t,n]=Id(e),i=t,o=n,s=0,a=e;for(;i<=o;){if(s=Math.floor((o+i)/2),s<=0||s>=an-2)return[s,s,!1];let u=r.DataElement[s].y,c=r.DataElement[s-1].y,l=r.DataElement[s+1].y;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<l)i=s+1;else{if(a<c&&a>u)return[s-1,s,!0];if(a<u&&a>l)return[s,s+1,!0];o=s-1}}return[s,s,!1]}function Wa(r,e,t,n){let i=n?e+t:e-t,[o,s,a]=Bd(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].y,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,p=r.DataElement[o].y,d=r.DataElement[s].y;if(e>=u&&e<=c)return n?[m,d,!0,a]:[l,p,!0,a];{let y,f;return n?(y=l+(m-l)*(e-u)/(c-u),f=p-(i-u)*r.multiplier/m):(y=l+(m-l)*(e-u)/(c-u),f=d+(c-i)*r.multiplier/l),[y,f,!1,a]}}}function Kd(r,e,t,n){let i=n?e-t:e+t,[o,s,a]=Sd(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].x,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,p=r.DataElement[o].y,d=r.DataElement[s].y;if(e>=d&&e<=p)return n?[m,c,!0,a]:[l,u,!0,a];{let y,f;return n?(y=l+(m-l)*(p-e)/(p-d),f=u+m*(p-i)/r.multiplier):(y=l+(m-l)*(p-e)/(p-d),f=c-l*(i-d)/r.multiplier),[y,f,!1,a]}}}function Cd(r,e){let t=Wa(r,e,0,!1);return t[3]?t[0]:0}function Da(r,e,t,n){let i=Mo(r,e,t),o=sn(r,e,i),s=sn(r,t,i),a=sn(r,n,i),u=!0,[c,l,m,p]=Wa(r,o,a,u);if(!p)return 0;if(m)return n*r.multiplier/c;{let d=s-l;return va(r,d,i)}}function qa(r,e,t,n){let i=Mo(r,e,t),o=sn(r,e,i),s=sn(r,t,i),a=sn(r,n,i),u=!1,[c,l,m,p]=Kd(r,s,a,u);if(!p)return 0;if(m)return n*c/r.multiplier;{let d=o-l;return va(r,d,i)}}function Rd(r){let e=kd.decode(r);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function Ua(r,e,t,n){let i=Cd(r,sn(r,e,Mo(r,e,t)))/r.multiplier;return n?i:1/i}var In=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(xn);e&&(this._layoutData=Rd(e==null?void 0:e.data))}}};var Ga=oe("Raydium_liquidity_instruction");function Xa(r){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:o,fixedSide:s}=r,a=Buffer.alloc(Oo.span);Oo.encode({instruction:3,baseAmountIn:q(i),quoteAmountIn:q(o),fixedSide:s==="base"?Ie:_s},a);let u=[P({pubkey:or,isWritable:!1}),P({pubkey:new fe(e.id)}),P({pubkey:new fe(t.authority),isWritable:!1}),P({pubkey:new fe(t.openOrders),isWritable:!1}),P({pubkey:new fe(t.targetOrders)}),P({pubkey:new fe(e.lpMint.address)}),P({pubkey:new fe(t.vault.A)}),P({pubkey:new fe(t.vault.B)})];return e.pooltype.includes("StablePool")&&u.push(P({pubkey:xn})),u.push(P({pubkey:new fe(e.marketId),isWritable:!1}),P({pubkey:n.baseTokenAccount}),P({pubkey:n.quoteTokenAccount}),P({pubkey:n.lpTokenAccount}),P({pubkey:n.owner,isWritable:!1,isSigner:!0}),P({pubkey:new fe(t.marketEventQueue),isWritable:!1})),new _t({programId:new fe(e.programId),keys:u,data:a})}function Vo(r){let{poolInfo:e,poolKeys:t,userKeys:n,amountIn:i}=r,o=de(t),s=4;if(e.pooltype.includes("StablePool")&&(s=5),s===4||s===5){let a=Buffer.alloc(No.span);No.encode({instruction:4,amountIn:q(i)},a);let u=[P({pubkey:or,isWritable:!1}),P({pubkey:o.id}),P({pubkey:o.authority,isWritable:!1}),P({pubkey:o.openOrders}),P({pubkey:o.targetOrders}),P({pubkey:o.mintLp.address}),P({pubkey:o.vault.A}),P({pubkey:o.vault.B})];return s===5?u.push(P({pubkey:xn})):(u.push(P({pubkey:o.id})),u.push(P({pubkey:o.id}))),u.push(P({pubkey:o.marketProgramId,isWritable:!1}),P({pubkey:o.marketId}),P({pubkey:o.marketBaseVault}),P({pubkey:o.marketQuoteVault}),P({pubkey:o.marketAuthority,isWritable:!1}),P({pubkey:n.lpTokenAccount}),P({pubkey:n.baseTokenAccount}),P({pubkey:n.quoteTokenAccount}),P({pubkey:n.owner,isWritable:!1,isSigner:!0}),P({pubkey:o.marketEventQueue}),P({pubkey:o.marketBids}),P({pubkey:o.marketAsks})),new _t({programId:o.programId,keys:u,data:a})}return new _t({programId:o.programId,keys:[]})}function za({programId:r,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:i,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:p,marketId:d,userWallet:y,userCoinVault:f,userPcVault:b,userLpVault:g,nonce:A,openTime:k,coinAmount:h,pcAmount:T,ammConfigId:I,feeDestinationId:S}){let x=L([M("instruction"),M("nonce"),w("openTime"),w("pcAmount"),w("coinAmount")]),R=[{pubkey:or,isSigner:!1,isWritable:!1},{pubkey:Ld,isSigner:!1,isWritable:!1},{pubkey:_o.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!1},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],N=Buffer.alloc(x.span);return x.encode({instruction:1,nonce:A,openTime:k,coinAmount:h,pcAmount:T},N),{instruction:new _t({keys:R,programId:r,data:N}),instructionType:_.AmmV4CreatePool}}function Kk(r){let e=L([M("instruction"),M("simulateType")]),t=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},t);let n=[P({pubkey:new fe(r.id),isWritable:!1}),P({pubkey:new fe(r.authority),isWritable:!1}),P({pubkey:new fe(r.openOrders),isWritable:!1}),P({pubkey:new fe(r.vault.A),isWritable:!1}),P({pubkey:new fe(r.vault.B),isWritable:!1}),P({pubkey:new fe(r.mintLp.address),isWritable:!1}),P({pubkey:new fe(r.marketId),isWritable:!1}),P({pubkey:new fe(r.marketEventQueue),isWritable:!1})];return new _t({programId:new fe(r.programId),keys:n,data:t})}function Nd({poolKeys:r,userKeys:e,amountIn:t,minAmountOut:n},i){let o=de(r),s=Buffer.alloc(Co.span);Co.encode({instruction:9,amountIn:q(t),minAmountOut:q(n)},s);let a=[P({pubkey:or,isWritable:!1}),P({pubkey:o.id}),P({pubkey:o.authority,isWritable:!1}),P({pubkey:o.openOrders})];return i===4&&a.push(P({pubkey:o.targetOrders})),a.push(P({pubkey:o.vault.A}),P({pubkey:o.vault.B})),i===5&&a.push(P({pubkey:xn})),a.push(P({pubkey:o.marketProgramId,isWritable:!1}),P({pubkey:o.marketId}),P({pubkey:o.marketBids}),P({pubkey:o.marketAsks}),P({pubkey:o.marketEventQueue}),P({pubkey:o.marketBaseVault}),P({pubkey:o.marketQuoteVault}),P({pubkey:o.marketAuthority,isWritable:!1}),P({pubkey:e.tokenAccountIn}),P({pubkey:e.tokenAccountOut}),P({pubkey:e.owner,isWritable:!1})),new _t({programId:o.programId,keys:a,data:s})}function Md({poolKeys:r,userKeys:e,maxAmountIn:t,amountOut:n},i){let o=de(r),s=Buffer.alloc(Ro.span);Ro.encode({instruction:11,maxAmountIn:q(t),amountOut:q(n)},s);let a=[P({pubkey:_o.programId,isWritable:!1}),P({pubkey:o.id}),P({pubkey:o.authority,isWritable:!1}),P({pubkey:o.openOrders}),P({pubkey:o.targetOrders}),P({pubkey:o.vault.A}),P({pubkey:o.vault.B})];return i===5&&a.push(P({pubkey:xn})),a.push(P({pubkey:o.marketProgramId,isWritable:!1}),P({pubkey:o.marketId}),P({pubkey:o.marketBids}),P({pubkey:o.marketAsks}),P({pubkey:o.marketEventQueue}),P({pubkey:o.marketBaseVault}),P({pubkey:o.marketQuoteVault}),P({pubkey:o.marketAuthority,isWritable:!1}),P({pubkey:e.tokenAccountIn}),P({pubkey:e.tokenAccountOut}),P({pubkey:e.owner,isWritable:!1,isSigner:!0})),new _t({programId:o.programId,keys:a,data:s})}function ri(r){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:o,fixedSide:s}=r;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Nd({...a,amountIn:i,minAmountOut:o},t);if(s==="out")return Md({...a,maxAmountIn:i,amountOut:o},t);Ga.logWithError("invalid params","params",r)}throw Ga.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}function Ck({poolKeys:r,userKeys:e,startTime:t}){let n=Buffer.alloc(Lo.span);Lo.encode({instruction:0,nonce:5,startTime:q(t)},n);let i=de(r),o=[P({pubkey:or,isWritable:!1}),P({pubkey:_o.programId,isWritable:!1}),P({pubkey:Od,isWritable:!1}),P({pubkey:i.id}),P({pubkey:i.authority,isWritable:!1}),P({pubkey:i.openOrders}),P({pubkey:i.mintLp.address}),P({pubkey:i.mintA.address,isWritable:!1}),P({pubkey:i.mintB.address,isWritable:!1}),P({pubkey:i.vault.A,isWritable:!1}),P({pubkey:i.vault.B,isWritable:!1}),P({pubkey:i.id}),P({pubkey:i.targetOrders}),P({pubkey:e.lpTokenAccount}),P({pubkey:i.id,isWritable:!1}),P({pubkey:i.marketProgramId,isWritable:!1}),P({pubkey:i.marketId,isWritable:!1}),P({pubkey:e.payer,isSigner:!0})];return new _t({programId:i.programId,keys:o,data:n})}function Ya({poolKeys:r}){let e=L([M("instruction"),M("simulateType")]),t=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},t);let n=[P({pubkey:new fe(r.id),isWritable:!1}),P({pubkey:new fe(r.authority),isWritable:!1}),P({pubkey:new fe(r.openOrders),isWritable:!1}),P({pubkey:new fe(r.vault.A),isWritable:!1}),P({pubkey:new fe(r.vault.B),isWritable:!1}),P({pubkey:new fe(r.mintLp.address),isWritable:!1}),P({pubkey:new fe(r.marketId),isWritable:!1}),P({pubkey:new fe(r.marketEventQueue),isWritable:!1})];return{instruction:new _t({programId:new fe(r.programId),keys:n,data:t})}}import{TOKEN_PROGRAM_ID as We,TOKEN_2022_PROGRAM_ID as jt,ASSOCIATED_TOKEN_PROGRAM_ID as cu}from"@solana/spl-token";import{PublicKey as F,TransactionInstruction as gt,SystemProgram as Bn,Keypair as Go}from"@solana/web3.js";import lu from"bn.js";import Xd from"bn.js";function Qa(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r,!1),new Uint8Array(e)}function Lk(r){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,r,!1),new Uint8Array(e)}function Ok(r){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,r,!1),new Uint8Array(e)}function ii(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function Eo(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function Fo(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function sr(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function Ha(r,e){return sr(r,e)?null:Eo(r,e)}function ja(r,e){return sr(r,e)?null:Fo(r,e)}var _d=Buffer.from("amm_config","utf8"),Vd=Buffer.from("pool","utf8"),Ed=Buffer.from("pool_vault","utf8"),Fd=Buffer.from("pool_reward_vault","utf8"),Za=Buffer.from("position","utf8"),vd=Buffer.from("tick_array","utf8"),Wd=Buffer.from("operation","utf8"),Dd=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Vk(r,e){return re([_d,Qa(e)],r)}function $a(r,e,t,n){return re([Vd,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function vo(r,e,t){return re([Ed,e.toBuffer(),t.toBuffer()],r)}function Ja(r,e,t){return re([Fd,e.toBuffer(),t.toBuffer()],r)}function ye(r,e,t){return re([vd,e.toBuffer(),ii(t)],r)}function un(r,e,t,n){return re([Za,e.toBuffer(),ii(t),ii(n)],r)}function st(r,e){return re([Za,e.toBuffer()],r)}function oi(r){return re([Buffer.from("metadata","utf8"),gn.toBuffer(),r.toBuffer()],gn)}function ar(r){return re([Wd],r)}function at(r,e){return re([Dd,e.toBuffer()],r)}import xt from"bn.js";var ce=new xt(0),rt=new xt(1),Vt=new xt(-1),it=new xt(1).shln(64),si=new xt(1).shln(128),Wo=it.sub(rt),ur=64,eu=si.subn(1),Xe=-443636,je=-Xe,Bt=new xt("4295048016"),St=new xt("79226673521066979257578248091"),tu=16,nu="59543866431248",ru="184467440737095516",iu="15793534762490258745",ai=new xt(10).pow(new xt(6)),qd=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(qd||{}),vk={[500]:10,[3e3]:60,[1e4]:200},Wk={version:6,liquidity:ce,tickCurrent:0,observationIndex:0,observationUpdateDuration:0,feeGrowthGlobalX64A:ce,feeGrowthGlobalX64B:ce,protocolFeesTokenA:ce,protocolFeesTokenB:ce,swapInAmountTokenA:ce,swapOutAmountTokenB:ce,swapInAmountTokenB:ce,swapOutAmountTokenA:ce,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},ou={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Dk=new xt("18446744073700000000");var Ud=15,ue=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=U.getTickArrayStartIndexByTick(i,o),l=U.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Ud/2));for(let d=0;d<l.length;d++){let{publicKey:y}=ye(t,n,l[d]);u.push(y)}let m=(await kt(e,u)).map(d=>d!==null?cr.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let y=m[d];y!==null&&(p[y.startTickIndex]={...y,address:u[d]})}return p}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=U.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,p,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/ue.tickCount(t)),a=n?U.searchLowBitFromStart(i,o,s-1,1,t):U.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=Oe-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<Oe;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=ye(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=U.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u-1}else for(u=u+1;u<Oe;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u+1}let{publicKey:m}=ye(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(U.checkIsOutOfBoundary(e)){if(e>je)return!1;let n=U.getTickArrayStartIndexByTick(Xe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Oe*e}};import te from"bn.js";import{PublicKey as Ht}from"@solana/web3.js";import Be from"bn.js";var Do=14,Et=class{static maxTickInTickarrayBitmap(e){return e*Oe*cn}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!ue.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-ue.tickCount(n):t+ue.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Oe,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=Ha(1024,l);if(m!==null){let p=(c-m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=ja(1024,l);if(m!==null){let p=(c+m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-ue.tickCount(n)}}}},lr=class{static getBitmapOffset(e,t){if(!ue.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Et.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Et.maxTickInTickarrayBitmap(e),n=-t;if(je<=t)throw Error(`extensionTickBoundary check error: ${je}, ${t}`);if(n<=Xe)throw Error(`extensionTickBoundary check error: ${n}, ${Xe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:U.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=ue.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=Et.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=U.mergeTickArrayBitmap(e).shln(cn-1-a),c=sr(512,u)?null:Eo(512,u);if(c!==null){let l=t-c*ue.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=U.mergeTickArrayBitmap(e).shrn(a),c=sr(512,u)?null:Fo(512,u);if(c!==null){let l=t+c*ue.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ue.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Et.maxTickInTickarrayBitmap(t),i=Math.floor(n/ue.tickCount(t));return e<0&&n!=0&&(i=cn-i),i}};import Kt from"bn.js";var mr=class{static getfeeGrowthInside(e,t,n){let i=new Kt(0),o=new Kt(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Kt(0),a=new Kt(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=H.mulDivFloor(H.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,it),u=t.tokenFeesOwedA.add(a),c=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,it),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=H.mulDivFloor(H.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,it),u=t.tokenFeesOwedA.add(a),c=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,it),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=H.wrappingSubU128(u,c.growthInsideLastX64),m=H.mulDivFloor(l,t.liquidity,it),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=H.wrappingSubU128(u,c.growthInsideLastX64),m=H.mulDivFloor(l,t.liquidity,it),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Kt(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Kt(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(H.wrappingSubU128(H.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Kt(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Kt(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(H.wrappingSubU128(H.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var b,g,A,k;let a=Q.priceToSqrtPriceX64(new V(e.price),e.mintA.decimals,e.mintB.decimals),u=Q.getSqrtPriceX64FromTick(t.tickLower),c=Q.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=ae.getAmountsFromLiquidity(a,u,c,n,o),[p,d]=[ge(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ge(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[y,f]=[ge(new Kt(new V(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ge(new Kt(new V(m.amountB.toString()).mul(l).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:tn(p.expirationTime,d.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as su}from"@solana/spl-token";var ze=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintA.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:y}=ln.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o);return a.push(...p),{expectedAmountOut:m.mul(Vt),remainingAccounts:a,executionPrice:d,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=ye(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:y}=ln.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Vt),c,o);return a.push(...p),{expectedAmountIn:m,remainingAccounts:a,executionPrice:d,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=ze.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?lr.checkTickArrayIsInit(ue.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):U.checkTickArrayIsInitialized(U.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=ye(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ue.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=ye(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ue.tickCount(e.tickSpacing)),i=t?U.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):U.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ue.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=Et.nextInitializedTickArrayStartIndex(U.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=lr.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Xe||t>je)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],p=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d={...m,perSecond:H.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ht(p)};if(d.tokenMint.equals(Ht.default))continue;if(n<=d.openTime.toNumber()||i.eq(ce)){s.push(d);continue}let y=new Be(Math.min(d.endTime.toNumber(),n)),f=y.sub(d.lastUpdateTime),b=H.mulDivFloor(f,d.emissionsPerSecondX64,i),g=d.rewardGrowthGlobalX64.add(b),A=H.mulDivFloor(f,d.emissionsPerSecondX64,it),k=d.rewardTotalEmissioned.add(A);s.push({...d,rewardGrowthGlobalX64:g,rewardTotalEmissioned:k,lastUpdateTime:y})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=U.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=Et.maxTickInTickarrayBitmap(e),n=-t;return t>je&&(t=ue.getArrayStartIndex(je,e)+ue.tickCount(e)),n<Xe&&(n=ue.getArrayStartIndex(Xe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ue.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ue.tickCount(t)*cn}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Pn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=au.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=U.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=U.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:p}=ye(u.programId,u.id,m);o.push({pubkey:p}),i[p.toString()]=u.id}}let s=await Pn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=cr.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of u)for(let d of s)c.push(st(d,p).publicKey);let l=await kt(t,c,{batchRequest:i}),m={};for(let p of l){if(p===null)continue;let d=ci.decode(p.data),y=d.poolId.toString(),f=e.find(x=>x.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,g=U._getTickPriceLegacy({poolInfo:b,tick:d.tickLower,baseIn:!0}),A=U._getTickPriceLegacy({poolInfo:b,tick:d.tickUpper,baseIn:!0}),{amountA:k,amountB:h}=ae.getAmountsFromLiquidity(b.sqrtPriceX64,g.tickSqrtPriceX64,A.tickSqrtPriceX64,d.liquidity,!1),T=1/(1-Math.sqrt(Math.sqrt(g.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:g.price,priceUpper:A.price,amountA:k,amountB:h,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(x=>({...x,pendingReward:new Be(0)})),leverage:T,tokenFeeAmountA:new Be(0),tokenFeeAmountB:new Be(0)}];let I=await U.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),S=await U.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=I,m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=S}if(o){let p=Object.values(m),d=await kt(t,p,{batchRequest:i}),y={};for(let f=0;f<p.length;f++){let b=d[f];if(b===null)continue;let g=p[f].toString();y[g]=cr.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let g of b){let A=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,k=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,h=y[m[A].toString()],T=y[m[k].toString()],I=h.ticks[U.getTickOffsetInArray(g.tickLower,f.tickSpacing)],S=T.ticks[U.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:x,tokenFeeAmountB:R}=await mr.GetPositionFees(f,g,I,S),N=await mr.GetPositionRewards(f,g,I,S);g.tokenFeeAmountA=x.gte(new Be(0))?x:new Be(0),g.tokenFeeAmountB=R.gte(new Be(0))?R:new Be(0);for(let E=0;E<N.length;E++)g.rewardInfos[E].pendingReward=N[E].gte(new Be(0))?N[E]:new Be(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new V(0)}){var N;let u,c=n.toBase58()===e.mintA.address,[l,m]=c?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new V(0))?u=c?Bt.add(new Be(1)):St.sub(new Be(1)):u=Q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ge(o,l,i,!1),{expectedAmountOut:d,remainingAccounts:y,executionPrice:f,feeAmount:b}=ze.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((N=p.fee)!=null?N:ce),u),g=ge(d,m,i,!1),A=Q.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),k=c?A:new V(1).div(A),h=d.mul(new Be(Math.floor((1-s)*1e10))).div(new Be(1e10)),T=ge(h,m,i,!1),I=c?e.currentPrice:new V(1).div(e.currentPrice),S=new V(k).sub(I).abs(),x=I,R=new Ve(new V(S).mul(10**15).toFixed(0),new V(x).mul(10**15).toFixed(0));return{realAmountIn:p,amountOut:g,minAmountOut:T,expirationTime:tn(p.expirationTime,g.expirationTime),currentPrice:e.currentPrice,executionPrice:k,priceImpact:R,fee:b,remainingAccounts:y}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s}){let a=i.address===e.mintB.address,[u,c]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,m]=[new le({...u,mint:u.address,isToken2022:u.programId===su.toBase58()}),new le({...c,mint:c.address,isToken2022:c.programId===su.toBase58()})],{realAmountIn:p,amountOut:d,minAmountOut:y,expirationTime:f,currentPrice:b,executionPrice:g,priceImpact:A,fee:k,remainingAccounts:h}=await ze.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ht(u.address),amountIn:n,slippage:o,epochInfo:s}),T={...p,amount:new Pe(l,p.amount),fee:p.fee===void 0?void 0:new Pe(l,p.fee)},I={...d,amount:new Pe(m,d.amount),fee:d.fee===void 0?void 0:new Pe(m,d.fee)},S={...y,amount:new Pe(m,y.amount),fee:y.fee===void 0?void 0:new Pe(m,y.fee)},x=new qe({baseToken:l,denominator:new Be(10).pow(new Be(20+l.decimals)),quoteToken:m,numerator:b.mul(new V(10**(20+m.decimals))).toFixed(0)}),R=new qe({baseToken:l,denominator:new Be(10).pow(new Be(20+l.decimals)),quoteToken:m,numerator:g.mul(new V(10**(20+m.decimals))).toFixed(0)}),N=new Pe(l,k);return{realAmountIn:T,amountOut:I,minAmountOut:S,expirationTime:f,currentPrice:x,executionPrice:R,priceImpact:A,fee:N,remainingAccounts:h}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var y,f,b;let o=e[t],s=U.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=U.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,p=o.priceMax-o.priceMin,d;return l<=0?d=0:m===l?d=p/l:p===l?d=l/m:d=l/p*(l/m),{feeApr:o.feeApr*d,rewardsApr:[(y=o.rewardApr[0])!=null?y:0*d,(f=o.rewardApr[1])!=null?f:0*d,(b=o.rewardApr[2])!=null?b:0*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[wn(e.mintA.address).toString()],p=i[wn(e.mintB.address).toString()],d=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=Q.priceToSqrtPriceX64(new V(e.price),e.mintA.decimals,e.mintB.decimals),b=Q.getSqrtPriceX64FromTick(s),g=Q.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:k}=ae.getAmountsFromLiquidityWithSlippage(f,b,g,t,!1,!1,0),{amountSlippageA:h,amountSlippageB:T}=ae.getAmountsFromLiquidityWithSlippage(f,b,g,o,!1,!1,0),I=new V(A.toString()).div(new V(10).pow(d)).mul(m.value).add(new V(k.toString()).div(new V(10).pow(y)).mul(p.value)),S=new V(h.toString()).div(new V(10).pow(d)).mul(m.value).add(new V(T.toString()).div(new V(10).pow(y)).mul(p.value)),x=S.div(I.add(S)).div(S),N=new V(l.volumeFee).mul(365).div(c).mul(x).mul(100).toNumber(),E=3600*24*365,z=e.rewardDefaultInfos.map(v=>{var ie,mt;let Z=v.mint.decimals,ee=i[v.mint.address];return u<((ie=v.startTime)!=null?ie:0)||u>((mt=v.endTime)!=null?mt:0)||!v.perSecond||!ee||Z===void 0?0:new V(ee.value).mul(new V(v.perSecond).mul(E)).div(new V(10).pow(Z)).mul(x).mul(100).toNumber()});return{feeApr:N,rewardsApr:z,apr:N+z.reduce((v,Z)=>v+Z,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var g,A;let l=Q.priceToSqrtPriceX64(new V(e.price),e.mintA.decimals,e.mintB.decimals),m=Q.getSqrtPriceX64FromTick(n),p=Q.getSqrtPriceX64FromTick(i),d=a?1-s:1+s,y=ge(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!c),f=new Be(new V(y.amount.sub((A=y.fee)!=null?A:ce).toString()).mul(d).toFixed(0)),b;if(l.lte(m))b=t?ae.getLiquidityFromTokenAmountA(m,p,f,!a):new Be(0);else if(l.lte(p)){let k=ae.getLiquidityFromTokenAmountA(l,p,f,!a),h=ae.getLiquidityFromTokenAmountB(m,l,f);b=t?k:h}else b=t?new Be(0):ae.getLiquidityFromTokenAmountB(m,p,f);return ze.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var b,g,A,k;let u=Q.getSqrtPriceX64FromTick(n),c=Q.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=ae.getAmountsFromLiquidity(Q.priceToSqrtPriceX64(new V(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[p,d]=[ge(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ge(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[y,f]=[ge(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ge(m.amountB.muln(l),(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)];return{liquidity:o,amountA:p,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:tn(p.expirationTime,d.expirationTime)}}static async fetchComputeClmmInfo({owner:e,connection:t,poolInfo:n}){let i=await t.getAccountInfo(new Ht(n.id));if(!i)throw new Error(`pool not found ${n.id}`);let o=ui.decode(i.data),s=at(e,new Ht(n.id)).publicKey,a=await ze.fetchExBitmaps({connection:t,exBitmapAddress:[s],batchRequest:!1});return{...o,id:new Ht(n.id),programId:new Ht(n.programId),mintA:n.mintA,mintB:n.mintB,ammConfig:{...n.config,id:new Ht(n.config.id),fundOwner:""},currentPrice:new V(n.price),exBitmapInfo:a[s.toBase58()],startTime:o.startTime.toNumber()}}};function Bh({poolInfo:r,tickLower:e,tickUpper:t,amountA:n,amountB:i,slippage:o,add:s,epochInfo:a,amountHasFee:u}){var k,h,T,I;let[c,l,m,p]=e<t?[e,t,n,i]:[t,e,i,n],d=Q.priceToSqrtPriceX64(new V(r.price),r.mintA.decimals,r.mintB.decimals),y=Q.getSqrtPriceX64FromTick(c),f=Q.getSqrtPriceX64FromTick(l),[b,g]=[ge(m,(k=r.mintA.extensions)==null?void 0:k.feeConfig,a,!u),ge(p,(h=r.mintB.extensions)==null?void 0:h.feeConfig,a,!u)],A=ae.getLiquidityFromTokenAmounts(d,y,f,b.amount.sub((T=b.fee)!=null?T:ce),g.amount.sub((I=g.fee)!=null?I:ce));return ae.getAmountsOutFromLiquidity({poolInfo:r,tickLower:e,tickUpper:t,liquidity:A,slippage:o,add:s,epochInfo:a,amountAddFee:!u})}var H=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(ce)||(o=o.add(rt)),o}static mulDivFloor(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).add(n.sub(rt)).div(n)}static x64ToDecimal(e,t){return new V(e.toString()).div(V.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new te(e.mul(V.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(si).sub(t).mod(si)}};function Me(r,e){return qo(r.mul(e),64,256)}function Gd(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function qo(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var Q=class{static sqrtPriceX64ToPrice(e,t,n){return H.x64ToDecimal(e).pow(2).mul(V.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return H.decimalToX64(e.mul(V.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(ce))return e;let o=t.shln(ur);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?H.mulDivCeil(s,e,a):H.mulDivRoundingUp(s,rt,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return H.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(ur);if(i)return e.add(o.div(t));{let s=H.mulDivRoundingUp(o,rt,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Xe||e>je)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new te("18445821805675395072"):new te("18446744073709551616");return(t&2)!=0&&(n=Me(n,new te("18444899583751176192"))),(t&4)!=0&&(n=Me(n,new te("18443055278223355904"))),(t&8)!=0&&(n=Me(n,new te("18439367220385607680"))),(t&16)!=0&&(n=Me(n,new te("18431993317065453568"))),(t&32)!=0&&(n=Me(n,new te("18417254355718170624"))),(t&64)!=0&&(n=Me(n,new te("18387811781193609216"))),(t&128)!=0&&(n=Me(n,new te("18329067761203558400"))),(t&256)!=0&&(n=Me(n,new te("18212142134806163456"))),(t&512)!=0&&(n=Me(n,new te("17980523815641700352"))),(t&1024)!=0&&(n=Me(n,new te("17526086738831433728"))),(t&2048)!=0&&(n=Me(n,new te("16651378430235570176"))),(t&4096)!=0&&(n=Me(n,new te("15030750278694412288"))),(t&8192)!=0&&(n=Me(n,new te("12247334978884435968"))),(t&16384)!=0&&(n=Me(n,new te("8131365268886854656"))),(t&32768)!=0&&(n=Me(n,new te("3584323654725218816"))),(t&65536)!=0&&(n=Me(n,new te("696457651848324352"))),(t&131072)!=0&&(n=Me(n,new te("26294789957507116"))),(t&262144)!=0&&(n=Me(n,new te("37481735321082"))),e>0&&(n=eu.div(n)),n}static getTickFromPrice(e,t,n){return Q.getTickFromSqrtPriceX64(Q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(St)||e.lt(Bt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new te(t-64),i=Gd(n,32,128),o=new te("8000000000000000","hex"),s=0,a=new te(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new te(0))&&s<tu;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new te(nu)),p=qo(m.sub(new te(ru)),64,128).toNumber(),d=qo(m.add(new te(iu)),64,128).toNumber();return p==d?p:Q.getSqrtPriceX64FromTick(d).lte(e)?d:p}},mn=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=Q.getTickFromSqrtPriceX64(Q.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=mn.getTickWithPriceAndTickspacing(e,t,n,i),s=Q.getSqrtPriceX64FromTick(o);return Q.sqrtPriceX64ToPrice(s,n,i)}},ae=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(ur),s=t.sub(e);return i?H.mulDivRoundingUp(H.mulDivCeil(o,s,t),rt,e):H.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");return i?H.mulDivCeil(n,t.sub(e),it):H.mulDivFloor(n,t.sub(e),it)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?H.mulDivRoundingUp(a,rt,Wo):a.shrn(ur)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),H.mulDivFloor(n,Wo,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ae.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=ae.getLiquidityFromTokenAmountA(e,n,i,!1),a=ae.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return ae.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ae.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new te(0)};if(e.lt(n)){let s=ae.getTokenAmountAFromLiquidity(e,n,i,o),a=ae.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new te(0),amountB:ae.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=ae.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new te(new V(u.toString()).mul(l).toFixed(0)),p=new te(new V(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,k,h,T;let c=Q.priceToSqrtPriceX64(new V(e.price),e.mintA.decimals,e.mintB.decimals),l=Q.getSqrtPriceX64FromTick(t),m=Q.getSqrtPriceX64FromTick(n),p=s?1+o:1-o,d=ae.getAmountsFromLiquidity(c,l,m,i,s),[y,f]=[ge(d.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),ge(d.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,u)],[b,g]=[ge(new te(new V(d.amountA.toString()).mul(p).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),ge(new te(new V(d.amountB.toString()).mul(p).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,a,u)];return{liquidity:i,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:g,expirationTime:tn(y.expirationTime,f.expirationTime)}}},ln=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,p,d,y){if(p.eq(ce))throw new Error("amountSpecified must not be 0");if(y||(y=s?Bt.add(rt):St.sub(rt)),s){if(y.lt(Bt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(St))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=p.gt(ce),b={amountSpecifiedRemaining:p,amountCalculated:ce,sqrtPriceX64:m,tick:c>d?Math.min(d+ue.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new te(0)},g=d,A=n[d],k=0,h=!s&&A.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(ce)&&!b.sqrtPriceX64.eq(y);){if(k>10)throw Error("liquidity limit");let T={};T.sqrtPriceStartX64=b.sqrtPriceX64;let I=U.nextInitTick(A,b.tick,l,s,h),S=I||null,x=null;if(!(S!=null&&S.liquidityGross.gtn(0))){let N=ze.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},g,s);if(!N.isExist)throw Error("swapCompute LiquidityInsufficient");g=N.nextStartIndex;let{publicKey:E}=ye(e,t,g);x=E,A=n[g],S=U.firstInitializedTick(A,s)}T.tickNext=S.tick,T.initialized=S.liquidityGross.gtn(0),d!==g&&x&&(b.accounts.push(x),d=g),T.tickNext<Xe?T.tickNext=Xe:T.tickNext>je&&(T.tickNext=je),T.sqrtPriceNextX64=Q.getSqrtPriceX64FromTick(T.tickNext);let R;if(s&&T.sqrtPriceNextX64.lt(y)||!s&&T.sqrtPriceNextX64.gt(y)?R=y:R=T.sqrtPriceNextX64,[b.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=ln.swapStepCompute(b.sqrtPriceX64,R,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(T.feeAmount),f?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),b.amountCalculated=b.amountCalculated.sub(T.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(T.amountOut),b.amountCalculated=b.amountCalculated.add(T.amountIn.add(T.feeAmount))),b.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let N=S.liquidityNet;s&&(N=N.mul(Vt)),b.liquidity=ae.addDelta(b.liquidity,N)}h=T.tickNext!=b.tick&&!s&&A.startTickIndex===T.tickNext,b.tick=s?T.tickNext-1:T.tickNext}else if(b.sqrtPriceX64!=T.sqrtPriceStartX64){let N=Q.getTickFromSqrtPriceX64(b.sqrtPriceX64);h=N!=b.tick&&!s&&A.startTickIndex===N,b.tick=N}++k}try{let{nextStartIndex:T,isExist:I}=ue.nextInitializedTickArray(b.tick,l,s,i,o);I&&d!==T&&(b.accounts.push(ye(e,t,T).publicKey),d=T)}catch{}return{amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new te(0),amountIn:new te(0),amountOut:new te(0),feeAmount:new te(0)},a=e.gte(t),u=i.gte(ce);if(u){let l=H.mulDivFloor(i,ai.sub(new te(o.toString())),ai);s.amountIn=a?ae.getTokenAmountAFromLiquidity(t,e,n,!0):ae.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=Q.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?ae.getTokenAmountBFromLiquidity(t,e,n,!1):ae.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Vt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=Q.getNextSqrtPriceX64FromOutput(e,n,i.mul(Vt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=ae.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=ae.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:ae.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:ae.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(Vt))&&(s.amountOut=i.mul(Vt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=H.mulDivCeil(s.amountIn,new te(o),ai.sub(new te(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Oe=60,cn=512,U=class{static getTickArrayAddressByTick(e,t,n,i){let o=U.getTickArrayStartIndexByTick(n,i),{publicKey:s}=ye(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=U.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=Oe)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=ue.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ue.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Oe,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*Oe,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Oe:e+t*Oe}static mergeTickArrayBitmap(e){let t=new Xd(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*Oe));return[...U.searchLowBitFromStart(e,t,s-1,o,n),...U.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return U.searchHightBitFromStart(e,t,0,cn,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=U.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=ye(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>U.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=ue.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>U.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=ue.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Xe||e>je}static nextInitTick(e,t,n,i,o){if(ue.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Oe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Oe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Oe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=Q.getSqrtPriceX64FromTick(t),o=Q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new V(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new V(1).div(t),o=mn.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Q.getSqrtPriceX64FromTick(o),a=Q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new V(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=Q.getSqrtPriceX64FromTick(t),o=Q.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new V(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new V(1).div(t),o=mn.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Q.getSqrtPriceX64FromTick(o),a=Q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new V(1).div(a)}}};var jh=L([me(8),M("bump"),Tt("index"),B(""),Ue("protocolFeeRate"),Ue("tradeFeeRate"),Tt("tickSpacing"),W(w(),8,"")]),zd=L([Ue("blockTimestamp"),X("sqrtPriceX64"),X("cumulativeTimePriceX64"),W(X(),1,"")]),Uo=L([me(8),ve("initialized"),B("poolId"),W(zd,1e3,"observations"),W(X(),5,"")]),Yd=L([M("rewardState"),w("openTime"),w("endTime"),w("lastUpdateTime"),X("emissionsPerSecondX64"),w("rewardTotalEmissioned"),w("rewardClaimed"),B("tokenMint"),B("tokenVault"),B("creator"),X("rewardGrowthGlobalX64")]),ui=L([me(8),M("bump"),B("ammConfig"),B("creator"),B("mintA"),B("mintB"),B("vaultA"),B("vaultB"),B("observationId"),M("mintDecimalsA"),M("mintDecimalsB"),Tt("tickSpacing"),X("liquidity"),X("sqrtPriceX64"),Fe("tickCurrent"),Tt("observationIndex"),Tt("observationUpdateDuration"),X("feeGrowthGlobalX64A"),X("feeGrowthGlobalX64B"),w("protocolFeesTokenA"),w("protocolFeesTokenB"),X("swapInAmountTokenA"),X("swapOutAmountTokenB"),X("swapInAmountTokenB"),X("swapOutAmountTokenA"),M("status"),W(M(),7,""),W(Yd,3,"rewardInfos"),W(w(),16,"tickArrayBitmap"),w("totalFeesTokenA"),w("totalFeesClaimedTokenA"),w("totalFeesTokenB"),w("totalFeesClaimedTokenB"),w("fundFeesTokenA"),w("fundFeesTokenB"),w("startTime"),W(w(),15*4-3,"padding")]),Qd=L([X("growthInsideLastX64"),w("rewardAmountOwed")]),ci=L([me(8),M("bump"),B("nftMint"),B("poolId"),Fe("tickLower"),Fe("tickUpper"),X("liquidity"),X("feeGrowthInsideLastX64A"),X("feeGrowthInsideLastX64B"),w("tokenFeesOwedA"),w("tokenFeesOwedB"),W(Qd,3,"rewardInfos"),W(w(),8,"")]),Zh=L([me(8),M("bump"),B("poolId"),Fe("tickLowerIndex"),Fe("tickUpperIndex"),X("liquidity"),X("feeGrowthInsideLastX64A"),X("feeGrowthInsideLastX64B"),w("tokenFeesOwedA"),w("tokenFeesOwedB"),W(X(),3,"rewardGrowthInside"),W(w(),8,"")]),Hd=L([Fe("tick"),ca("liquidityNet"),X("liquidityGross"),X("feeGrowthOutsideX64A"),X("feeGrowthOutsideX64B"),W(X(),3,"rewardGrowthsOutsideX64"),W(Ue(),13,"")]),cr=L([me(8),B("poolId"),Fe("startTickIndex"),W(Hd,Oe,"ticks"),M("initializedTickCount"),W(M(),115,"")]),uu=L([me(329),W(B(),100,"whitelistMints")]),au=L([me(8),B("poolId"),W(W(w(),8),Do,"positiveTickArrayBitmap"),W(W(w(),8),Do,"negativeTickArrayBitmap")]);var mu=oe("Raydium_Clmm"),wt={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Te=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y){let f=L([X("sqrtPriceX64"),w("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Bn.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,startTime:y},g);let A=Buffer.from([...wt.createPool,...g]);return new gt({keys:b,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:i,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Ge({fromPublicKey:i,programId:n}),[p,d]=[new F(o.address),new F(s.address)],y=[Bn.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Uo.span),space:Uo.span,programId:n})],{publicKey:f}=$a(n,a,p,d),{publicKey:b}=vo(n,f,p),{publicKey:g}=vo(n,f,d);return y.push(this.createPoolInstruction(n,f,i,a,m.publicKey,p,b,new F(o.programId||We),d,g,new F(s.programId||We),at(n,f).publicKey,u,c)),{signers:[],instructions:y,instructionTypes:[_.CreateAccount,_.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:b,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,g,A,k,h,T,I,S,x,R,N){let E=L([Fe("tickLowerIndex"),Fe("tickUpperIndex"),Fe("tickArrayLowerStartIndex"),Fe("tickArrayUpperStartIndex"),X("liquidity"),w("amountMaxA"),w("amountMaxB"),ve("withMetadata"),M("optionBaseFlag"),ve("baseFlag")]),z=[...N?[{pubkey:N,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:Bn.programId,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:cu,isSigner:!1,isWritable:!1},{pubkey:gn,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...z],Z=Buffer.alloc(E.span);E.encode({tickLowerIndex:A,tickUpperIndex:k,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:T,liquidity:I,amountMaxA:S,amountMaxB:x,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},Z);let ee=Buffer.from([...wt.openPosition,...Z]);return new gt({keys:v,programId:e,data:ee})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new F(e.programId),new F(e.id)],y;if(l)y=new F((await l(1))[0]);else{let x=Go.generate();m.push(x),y=x.publicKey}let f=U.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=U.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=ye(p,d,f),{publicKey:A}=ye(p,d,b),{publicKey:k}=pe(n.wallet,y,We),{publicKey:h}=oi(y),{publicKey:T}=st(p,y),{publicKey:I}=un(p,d,i,o),S=this.openPositionFromLiquidityInstruction(p,n.feePayer,d,n.wallet,y,k,h,I,g,A,T,n.tokenAccountA,n.tokenAccountB,new F(t.vault.A),new F(t.vault.B),new F(e.mintA.address),new F(e.mintB.address),i,o,f,b,s,a,u,c);return{signers:m,instructions:[S],instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:k,metadataAccount:h,personalPosition:T,protocolPosition:I}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new F(e.programId),new F(e.id)],y;if(l)y=new F((await l(1))[0]);else{let x=Go.generate();m.push(x),y=x.publicKey}let f=U.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=U.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=ye(p,d,f),{publicKey:A}=ye(p,d,b),{publicKey:k}=pe(n.wallet,y,We),{publicKey:h}=oi(y),{publicKey:T}=st(p,y),{publicKey:I}=un(p,d,i,o),S=this.openPositionFromBaseInstruction(p,n.feePayer,d,n.wallet,y,k,h,I,g,A,T,n.tokenAccountA,n.tokenAccountB,new F(t.vault.A),new F(t.vault.B),new F(e.mintA.address),new F(e.mintB.address),i,o,f,b,c,s,a,u,ze.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?at(p,d).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:k,metadataAccount:h,personalPosition:T,protocolPosition:I},instructions:[S],signers:m,instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,g,A,k,h,T,I,S,x,R,N){let E=L([Fe("tickLowerIndex"),Fe("tickUpperIndex"),Fe("tickArrayLowerStartIndex"),Fe("tickArrayUpperStartIndex"),X("liquidity"),w("amountMaxA"),w("amountMaxB"),ve("withMetadata"),M("optionBaseFlag"),ve("baseFlag")]),z=[...N?[{pubkey:N,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:Bn.programId,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:cu,isSigner:!1,isWritable:!1},{pubkey:gn,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...z],Z=Buffer.alloc(E.span);E.encode({tickLowerIndex:A,tickUpperIndex:k,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:T,liquidity:new lu(0),amountMaxA:S==="MintA"?x:R,amountMaxB:S==="MintA"?R:x,withMetadata:I==="create",baseFlag:S==="MintA",optionBaseFlag:1},Z);let ee=Buffer.from([...wt.openPosition,...Z]);return new gt({keys:v,programId:e,data:ee})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,p=[];if(l)m=new F((await l(1))[0]);else{let x=Go.generate();p.push(x),m=x.publicKey}let[d,y]=[new F(e.programId),new F(e.id)],f=U.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=U.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=ye(d,y,f),{publicKey:A}=ye(d,y,b),{publicKey:k}=pe(n.wallet,m,We),{publicKey:h}=oi(m),{publicKey:T}=st(d,m),{publicKey:I}=un(d,y,i,o),S=this.openPositionFromLiquidityInstruction(d,n.wallet,y,n.wallet,m,k,h,I,g,A,T,n.tokenAccountA,n.tokenAccountB,new F(t.vault.A),new F(t.vault.B),new F(t.mintA.address),new F(t.mintB.address),i,o,f,b,s,a,u,c,ze.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?at(d,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:k,metadataAccount:h,personalPosition:T,protocolPosition:I},instructions:[S],signers:p,instructionTypes:[_.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=L([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Bn.programId,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...wt.closePosition,...u]);return new gt({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new F(e.programId),{publicKey:s}=pe(n.wallet,i.nftMint,We),{publicKey:a}=st(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[_.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,g,A){let k=L([X("liquidity"),w("amountMaxA"),w("amountMaxB"),M("optionBaseFlag"),ve("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...h],I=Buffer.alloc(k.span);k.encode({liquidity:f,amountMaxA:b,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},I);let S=Buffer.from([...wt.increaseLiquidity,...I]);return new gt({keys:T,programId:e,data:S})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new F(e.programId),new F(e.id)],l=U.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=U.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=ye(u,c,l),{publicKey:d}=ye(u,c,m),{publicKey:y}=pe(i.wallet,n.nftMint,We),{publicKey:f}=st(u,n.nftMint),{publicKey:b}=un(u,c,n.tickLower,n.tickUpper),g=this.increasePositionFromLiquidityInstruction(u,i.wallet,y,f,c,b,p,d,i.tokenAccountA,i.tokenAccountB,new F(t.vault.A),new F(t.vault.B),new F(e.mintA.address),new F(e.mintB.address),o,s,a,ze.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?at(u,c).publicKey:void 0);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[g],instructionTypes:[_.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new F(e.programId),new F(e.id)],l=U.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=U.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=ye(u,c,l),{publicKey:d}=ye(u,c,m),{publicKey:y}=pe(i.wallet,n.nftMint,We),{publicKey:f}=st(u,n.nftMint),{publicKey:b}=un(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,y,f,c,b,p,d,i.tokenAccountA,i.tokenAccountB,new F(t.vault.A),new F(t.vault.B),new F(e.mintA.address),new F(e.mintB.address),o,s,a,ze.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?at(u,c).publicKey:void 0)],signers:[],instructionTypes:[_.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,g,A){let k=L([X("liquidity"),w("amountMaxA"),w("amountMaxB"),M("optionBaseFlag"),ve("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...h],I=Buffer.alloc(k.span);k.encode({liquidity:new lu(0),amountMaxA:f==="MintA"?b:g,amountMaxB:f==="MintA"?g:b,baseFlag:f==="MintA",optionBaseFlag:1},I);let S=Buffer.from([...wt.increaseLiquidity,...I]);return new gt({keys:T,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,g,A,k){let h=L([X("liquidity"),w("amountMinA"),w("amountMinB")]),T=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...f.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...T],S=Buffer.alloc(h.span);h.encode({liquidity:b,amountMinA:g,amountMinB:A},S);let x=Buffer.from([...wt.decreaseLiquidity,...S]);return new gt({keys:I,programId:e,data:x})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new F(e.programId),new F(e.id)],m=U.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=U.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=ye(c,l,m),{publicKey:y}=ye(c,l,p),{publicKey:f}=pe(i.wallet,n.nftMint,u),{publicKey:b}=st(c,n.nftMint),{publicKey:g}=un(c,l,n.tickLower,n.tickUpper),A=[];for(let h=0;h<e.rewardDefaultInfos.length;h++)A.push({poolRewardVault:new F(t.rewardInfos[h].vault),ownerRewardVault:i.rewardAccounts[h],rewardMint:new F(e.rewardDefaultInfos[h].mint.address)});let k=[];return k.push(this.decreaseLiquidityInstruction(c,i.wallet,f,b,l,g,d,y,i.tokenAccountA,i.tokenAccountB,new F(t.vault.A),new F(t.vault.B),new F(e.mintA.address),new F(e.mintB.address),A,o,s,a,ze.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?at(c,l).publicKey:void 0)),{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:g},signers:[],instructions:k,instructionTypes:[_.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,g){let A=L([w("amount"),w("otherAmountThreshold"),X("sqrtPriceLimitX64"),ve("isBaseInput")]),k=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(S=>({pubkey:S,isSigner:!1,isWritable:!0}))],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...k],T=Buffer.alloc(A.span);A.encode({amount:d,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},T);let I=Buffer.from([...wt.swap,...T]);return new gt({keys:h,programId:e,data:I})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:i,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new F(e.programId),new F(e.id)],[m,p]=[new F(t.vault.A),new F(t.vault.B)],[d,y]=[new F(e.mintA.address),new F(e.mintB.address)],f=e.mintA.address===i.toString(),b=[this.swapInstruction(c,n.wallet,l,new F(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:p,f?p:m,f?d:y,f?y:d,u,m,o,s,a,!0,at(c,l).publicKey)];return{signers:[],instructions:b,instructionTypes:[_.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,p){let d=L([w("openTime"),w("endTime"),X("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Bn.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:q(l),endTime:q(m),emissionsPerSecondX64:p},f);let b=Buffer.from([...wt.initReward,...f]);return new gt({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new F(e.programId),new F(e.id)],a=Ja(o,s,i.mint).publicKey,u=ar(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new F(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[_.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,p){let d=L([M("rewardIndex"),X("emissionsPerSecondX64"),w("openTime"),w("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:p,openTime:q(l),endTime:q(m)},f);let b=Buffer.from([...wt.setRewardEmissions,...f]);return new gt({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new F(e.programId),new F(e.id)],a,u,c;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===i.mint.toString()&&(a=p,u=new F(t.rewardInfos[p].vault),c=new F(t.rewardInfos[p].mint.address));(a===void 0||u===void 0)&&mu.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=ar(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new F(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[_.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=L([M("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...wt.collectReward,...l]);return new gt({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new F(e.programId),new F(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new F(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&mu.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[_.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:i,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new F(e.programId),new F(e.id)],[m,p]=[new F(t.vault.A),new F(t.vault.B)],[d,y]=[new F(e.mintA.address),new F(e.mintB.address)],f=e.mintA.address===i.toString(),b=[this.swapInstruction(c,n.wallet,l,new F(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?p:m,f?m:p,f?d:y,f?y:d,u,m,o,s,a,!1)];return{signers:[],instructions:b,instructionTypes:[_.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import{PublicKey as Jd}from"@solana/web3.js";import{PublicKey as Zd}from"@solana/web3.js";import du from"bn.js";var pu=new du(25),fu=new du(1e4),jd={4:3,5:3};var $d=oe("Raydium_liquidity_serum");function yu({programId:r,marketId:e}){let t=[e.toBuffer()],n=0,i;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));i=Zd.createProgramAddressSync(o,r)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:i,nonce:n}}throw $d.logWithError("unable to find a viable program address nonce","params",{programId:r,marketId:e}),new Error("unable to find a viable program address nonce")}import dr from"bn.js";function zo({programId:r}){let{publicKey:e}=re([Buffer.from("amm_config_account_seed","utf-8")],r);return e}function dn({name:r,programId:e,marketId:t}){let{publicKey:n}=re([e.toBuffer(),t.toBuffer(),Buffer.from(r,"utf-8")],e);return n}function ep({programId:r,marketId:e}){let{publicKey:t}=re([r.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],r);return t}function tp({programId:r}){return re([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],r)}function bu({version:r,marketVersion:e,marketId:t,baseMint:n,quoteMint:i,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=dn({name:"amm_associated_seed",programId:a,marketId:t}),l=dn({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:p}=tp({programId:a}),d=dn({name:"coin_vault_associated_seed",programId:a,marketId:t}),y=dn({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=dn({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),b=ep({programId:a,marketId:t}),g=dn({name:"target_associated_seed",programId:a,marketId:t}),A=dn({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:k}=yu({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:i,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:r,programId:a,authority:m,nonce:p,baseVault:d,quoteVault:y,lpVault:f,openOrders:b,targetOrders:g,withdrawQueue:A,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:k,lookupTableAccount:Jd.default,configId:zo({programId:a})}}var Xo;async function ST({connection:r,poolKeysList:e,config:t}){Xo||(Xo=new In({connection:r}),await Xo.initStableModelLayout());let n=e.map(s=>Ya({poolKeys:s}));return(await Gs(r,n.map(s=>s.instruction),"GetPoolData")).map(s=>{let a=Xs(s,"GetPoolData"),u=new dr(Ot(a,"status")),c=Number(Ot(a,"coin_decimals")),l=Number(Ot(a,"pc_decimals")),m=Number(Ot(a,"lp_decimals")),p=new dr(Ot(a,"pool_coin_amount")),d=new dr(Ot(a,"pool_pc_amount")),y=new dr(Ot(a,"pool_lp_supply")),f="0";try{f=Ot(a,"pool_open_time")}catch{}return{status:u,baseDecimals:c,quoteDecimals:l,lpDecimals:m,baseReserve:p,quoteReserve:d,lpSupply:y,startTime:new dr(f)}})}import ot from"bn.js";var pr=class extends he{constructor(t){super(t);this.stableLayout=new In({connection:this.scope.connection})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:i,baseIn:o}){let s=new ot(new V(n).mul(10**t[o?"mintA":"mintB"].decimals).toFixed(0)),a=Ea(t[o?"mintB":"mintA"]),[u,c]=[new ot(new V(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new ot(new V(t.mintAmountB).mul(10**t.mintB.decimals).toString())],l=new ot(new V(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,V.ROUND_DOWN));this.logDebug("baseReserve:",u.toString(),"quoteReserve:",c.toString()),this.logDebug("tokenIn:",o?t.mintA.symbol:t.mintB.symbol,"amountIn:",s.toString(),"anotherToken:",o?t.mintB.symbol:t.mintA.symbol,"slippage:",`${i.toSignificant()}%`,"baseReserve",u.toString(),"quoteReserve",c.toString());let m=o?"base":"quote";this.logDebug("input side:",m);let p=Ie;s.isZero()||(p=m==="base"?Mr(s.mul(c),u):Mr(s.mul(u),c)),this.logDebug("amountRaw:",p.toString(),"lpAmount:",l.toString());let d=Mr(s.mul(l),m==="base"?u:c);this.logDebug("liquidity:",d.toString());let f=new Ve(new ot(1)).add(i).mul(p).quotient,b=new Pe(a,p),g=new Pe(a,f);return this.logDebug("anotherAmount:",b.toFixed(),"maxAnotherAmount:",g.toFixed()),{anotherAmount:b,maxAnotherAmount:g,liquidity:d}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,amountInA:i,amountInB:o,fixedSide:s,config:a,txVersion:u,computeBudgetConfig:c}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",i,"amountInB:",o),(i.isZero()||o.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:i.toFixed(),amountInB:o.toFixed()});let{account:l}=this.scope,{bypassAssociatedCheck:m,checkCreateATAOwner:p}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...a},[d,y]=[i.token,o.token],f=await l.getCreatedTokenAccount({mint:d.mint,associatedOnly:!1}),b=await l.getCreatedTokenAccount({mint:y.mint,associatedOnly:!1});!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let g=await l.getCreatedTokenAccount({mint:new tt(n.lpMint.address)}),A=[d,y],k=[f,b],h=[i.raw,o.raw],T=i.token.mint.toBase58()===n.mintA.address?"base":"quote",I="base";["quote","base"].includes(T)||this.logAndCreateError("invalid fixedSide","fixedSide",s),T==="quote"?(A.reverse(),k.reverse(),h.reverse(),I=s==="a"?"quote":"base"):T==="base"&&(I=s==="a"?"base":"quote");let[S,x]=A,[R,N]=k,[E,z]=h,v=await this.getAmmPoolKeys(n.id),Z=this.createTxBuilder(),{tokenAccount:ee,...ie}=await l.handleTokenAccount({side:"in",amount:E,mint:S.mint,tokenAccount:R,bypassAssociatedCheck:m,checkCreateATAOwner:p});Z.addInstruction(ie);let{tokenAccount:mt,...Rn}=await l.handleTokenAccount({side:"in",amount:z,mint:x.mint,tokenAccount:N,bypassAssociatedCheck:m,checkCreateATAOwner:p});Z.addInstruction(Rn);let{tokenAccount:Ai,...Pi}=await l.handleTokenAccount({side:"out",amount:0,mint:new tt(n.lpMint.address),tokenAccount:g,bypassAssociatedCheck:m,checkCreateATAOwner:p});return Z.addInstruction(Pi),Z.addInstruction({instructions:[Xa({poolInfo:n,poolKeys:v,userKeys:{baseTokenAccount:ee,quoteTokenAccount:mt,lpTokenAccount:Ai,owner:this.scope.ownerPubKey},baseAmountIn:E,quoteAmountIn:z,fixedSide:I})],instructionTypes:[n.pooltype.includes("StablePool")?_.AmmV5AddLiquidity:_.AmmV4AddLiquidity],lookupTableAddress:v.lookupTableAccount?[v.lookupTableAccount]:[]}),Z.addCustomComputeBudget(c),u===0&&await Z.buildV0(),Z.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,amountIn:i,config:o,txVersion:s,computeBudgetConfig:a}=t,u=await this.getAmmPoolKeys(n.id),[c,l,m]=[new tt(n.mintA.address),new tt(n.mintB.address),new tt(n.lpMint.address)];this.logDebug("amountIn:",i),i.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",i.toString());let{account:p}=this.scope,d=await p.getCreatedTokenAccount({mint:m,associatedOnly:!1});d||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",p.tokenAccounts);let y=await p.getCreatedTokenAccount({mint:c}),f=await p.getCreatedTokenAccount({mint:l}),b=this.createTxBuilder(),{bypassAssociatedCheck:g,checkCreateATAOwner:A}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...o},{tokenAccount:k,...h}=await p.handleTokenAccount({side:"out",amount:0,mint:c,tokenAccount:y,bypassAssociatedCheck:g,checkCreateATAOwner:A});b.addInstruction(h);let{tokenAccount:T,...I}=await p.handleTokenAccount({side:"out",amount:0,mint:l,tokenAccount:f,bypassAssociatedCheck:g,checkCreateATAOwner:A});return b.addInstruction(I),b.addInstruction({instructions:[Vo({poolInfo:n,poolKeys:u,userKeys:{lpTokenAccount:d,baseTokenAccount:k,quoteTokenAccount:T,owner:this.scope.ownerPubKey},amountIn:i})],lookupTableAddress:u.lookupTableAccount?[u.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?_.AmmV5RemoveLiquidity:_.AmmV4RemoveLiquidity]}),b.addCustomComputeBudget(a),s===0?await b.buildV0():b.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:i,createPositionInfo:o,farmInfo:s,userFarmLpAmount:a,base:u,computeBudgetConfig:c,payer:l,tokenProgram:m=li,checkCreateATAOwner:p=!0,getEphemeralSigners:d,txVersion:y}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let f=this.createTxBuilder();f.addCustomComputeBudget(c);let b={};for(let ee of this.scope.account.tokenAccountRawInfos)(b[ee.accountInfo.mint.toString()]===void 0||pe(this.scope.ownerPubKey,ee.accountInfo.mint,li).publicKey.equals(ee.pubkey))&&(b[ee.accountInfo.mint.toString()]=ee.pubkey);let g=b[t.lpMint.address];if(g===void 0)throw Error("find lp account error in trade accounts");let A=i.add(a!=null?a:new ot(0)),k=t.mintA.address===le.WSOL.mint.toString(),h=t.mintB.address===le.WSOL.mint.toString(),{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:li,mint:new tt(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:k?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!0,checkCreateATAOwner:p});if(f.addInstruction(I||{}),T===void 0)throw new Error("base token account not found");let{account:S,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:li,mint:new tt(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:h?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:!0,checkCreateATAOwner:p});if(f.addInstruction(x||{}),S===void 0)throw new Error("quote token account not found");if(b[t.mintA.address]=T,b[t.mintB.address]=S,s!==void 0&&!(a!=null&&a.isZero())){let ee=[];for(let Ln of s.rewardInfos){let Yu=Ln.mint.address===le.WSOL.mint.toString();if(b[Ln.mint.address])ee.push(b[Ln.mint.address]);else{let{account:us,instructionParams:cs}=await this.scope.account.getOrCreateTokenAccount({mint:new tt(Ln.mint.address),tokenProgram:m,owner:this.scope.ownerPubKey,skipCloseAccount:!Yu,createInfo:{payer:l||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:p});us||this.logAndCreateError("farm reward account not found:",Ln.mint.address),cs&&f.addInstruction(cs),ee.push(us)}}let ie=(await this.scope.api.fetchFarmKeysById({ids:s.id}))[0],mt={amount:a,owner:this.scope.ownerPubKey,farmInfo:s,farmKeys:ie,lpAccount:g,rewardAccounts:ee},Rn=bt[s.programId],Ai=Rn===6?tr(mt):Rn===5?nr(mt):rr(mt),Pi={3:_.FarmV3Withdraw,5:_.FarmV5Withdraw,6:_.FarmV6Withdraw};f.addInstruction({instructions:[Ai],instructionTypes:[Pi[Rn]]})}let R=await this.getAmmPoolKeys(t.id),N=Vo({poolInfo:t,poolKeys:R,userKeys:{lpTokenAccount:g,baseTokenAccount:T,quoteTokenAccount:S,owner:this.scope.ownerPubKey},amountIn:A});f.addInstruction({instructions:[N],instructionTypes:[t.pooltype.includes("StablePool")?_.AmmV5RemoveLiquidity:_.AmmV4RemoveLiquidity],lookupTableAddress:R.lookupTableAccount?[R.lookupTableAccount]:[]});let[E,z]=t.mintA.address===n.mintA.address?[T,S]:[S,T],v=await this.scope.clmm.getClmmPoolKeys(t.id),Z=await Te.openPositionFromBaseInstructions({poolInfo:n,poolKeys:v,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:E,tokenAccountB:z},withMetadata:"create",...o,base:u,getEphemeralSigners:d});return f.addInstruction({instructions:[...Z.instructions],signers:Z.signers,instructionTypes:[...Z.instructionTypes],lookupTableAddress:v.lookupTableAccount?[v.lookupTableAccount]:[]}),y===0?f.sizeCheckBuildV0():f.sizeCheckBuild()}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:i,quoteMintInfo:o,baseAmount:s,quoteAmount:a,startTime:u,ownerInfo:c,associatedOnly:l=!1,checkCreateATAOwner:m=!1,tokenProgram:p,txVersion:d,feeDestinationId:y,computeBudgetConfig:f}){var z;let b=c.feePayer||((z=this.scope.owner)==null?void 0:z.publicKey),g=c.useSOLBalance&&i.mint.equals(gu),A=c.useSOLBalance&&o.mint.equals(gu),k=this.createTxBuilder(),{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:g?{payer:b,amount:s}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:l,checkCreateATAOwner:m});k.addInstruction(T||{});let{account:I,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({mint:o.mint,owner:this.scope.ownerPubKey,createInfo:A?{payer:b,amount:a}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:l,checkCreateATAOwner:m});if(k.addInstruction(S||{}),h===void 0||I===void 0)throw Error("you don't has some token account");let x=bu({version:4,marketVersion:3,marketId:n.marketId,baseMint:i.mint,quoteMint:o.mint,baseDecimals:i.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n.programId}),R={programId:t,ammId:x.id,ammAuthority:x.authority,ammOpenOrders:x.openOrders,lpMint:x.lpMint,coinMint:x.baseMint,pcMint:x.quoteMint,coinVault:x.baseVault,pcVault:x.quoteVault,withdrawQueue:x.withdrawQueue,ammTargetOrders:x.targetOrders,poolTempLp:x.lpVault,marketProgramId:x.marketProgramId,marketId:x.marketId,ammConfigId:x.configId,feeDestinationId:y},{instruction:N,instructionType:E}=za({...R,userWallet:this.scope.ownerPubKey,userCoinVault:h,userPcVault:I,userLpVault:pe(this.scope.ownerPubKey,x.lpMint,p).publicKey,nonce:x.nonce,openTime:u,coinAmount:s,pcAmount:a});return k.addInstruction({instructions:[N],instructionTypes:[E]}),k.addCustomComputeBudget(f),k.versionBuild({txVersion:d,extInfo:{address:R}})}async getCreatePoolFee({programId:t}){let n=zo({programId:t}),i=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(i===null)throw Error("get config account error");return Fa.decode(i.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:i,mintOut:o,slippage:s}){if(i!==t.mintA.address&&i!==t.mintA.address)throw new Error("toke not match");if(o!==t.mintB.address&&o!==t.mintB.address)throw new Error("toke not match");let{baseReserve:a,quoteReserve:u}=t,c=[a,u],l=i==t.mintA.address?"base":"quote";l==="quote"&&c.reverse();let[m,p]=c,d=t.programId===Qi.toBase58(),y;if(d)y=new V(p.toString()).div(m.toString());else{let x=Ua(this.stableLayout.stableModelData,a.toNumber(),u.toNumber(),!1);l==="quote"?y=new V(1e6).div(x*1e6):y=new V(x*1e6).div(1e6)}let f=n,b=new ot(0),g=new ot(0);if(!f.isZero())if(d){g=Ut(f.mul(pu),fu);let x=f.sub(g),R=m.add(x);b=p.mul(x).div(R)}else{g=f.mul(new ot(2)).div(new ot(1e4));let x=f.sub(g);l==="quote"?b=new ot(Da(this.stableLayout.stableModelData,u.toNumber(),a.toNumber(),x.toNumber())):b=new ot(qa(this.stableLayout.stableModelData,u.toNumber(),a.toNumber(),x.toNumber()))}let A=new ot(new V(b.toString()).mul(1-s).toFixed(0)),k=b,h=A,T=new V(b.toString()).div(new V(f.sub(g).toString()).toFixed(0));!f.isZero()&&!b.isZero()&&(T=new V(b.toString()).div(f.sub(g).toString()));let I=y.sub(T).div(y).mul(100);return{amountOut:k,minAmountOut:h,currentPrice:y,executionPrice:T,priceImpact:I,fee:g}}async swap({poolInfo:t,amountIn:n,amountOut:i,inputMint:o,fixedSide:s,txVersion:a,computeBudgetConfig:u}){let c=this.createTxBuilder(),[l,m]=o===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],p=await this.scope.account.getCreatedTokenAccount({mint:new tt(l.address),programId:new tt(l.programId),associatedOnly:!1}),d=await this.scope.account.getCreatedTokenAccount({mint:new tt(m.address),programId:new tt(m.programId),associatedOnly:!1}),{tokenAccount:y,...f}=await this.scope.account.handleTokenAccount({side:"in",amount:n,mint:new tt(l.address),tokenAccount:p,bypassAssociatedCheck:!1,checkCreateATAOwner:!1});c.addInstruction(f);let{tokenAccount:b,...g}=await this.scope.account.handleTokenAccount({side:"out",amount:0,mint:new tt(m.address),tokenAccount:d,bypassAssociatedCheck:!1,checkCreateATAOwner:!1});c.addInstruction(g);let A=await this.getAmmPoolKeys(t.id),k=4;return t.pooltype.includes("StablePool")&&(k=5),c.addInstruction({instructions:[ri({version:k,poolKeys:A,userKeys:{tokenAccountIn:y,tokenAccountOut:b,owner:this.scope.ownerPubKey},amountIn:n,amountOut:i,fixedSide:s})],instructionTypes:[k===4?_.AmmV4SwapBaseIn:_.AmmV5SwapBaseIn]}),c.addCustomComputeBudget(u),c.versionBuild({txVersion:a})}};import{PublicKey as se}from"@solana/web3.js";import ut from"bn.js";var fr=class extends he{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var A;let{programId:t,owner:n=((A=this.scope.owner)==null?void 0:A.publicKey)||se.default,mint1:i,mint2:o,ammConfig:s,initialPrice:a,startTime:u,computeBudgetConfig:c,forerunCreate:l,txVersion:m}=e,p=this.createTxBuilder(),[d,y,f]=new ut(new se(i.address).toBuffer()).gt(new ut(new se(o.address).toBuffer()))?[o,i,new V(1).div(a)]:[i,o,a],b=Q.priceToSqrtPriceX64(f,d.decimals,y.decimals),g=await Te.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:d,mintB:y,ammConfigId:s.id,initialPriceX64:b,startTime:u,forerunCreate:l});return p.addInstruction(g),p.addCustomComputeBudget(c),p.versionBuild({txVersion:m,extInfo:{address:{...g.address,programId:t.toString(),id:g.address.poolId.toString(),mintA:d,mintB:y,openTime:u.toString(),vault:{A:g.address.mintAVault.toString(),B:g.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},mockPoolInfo:{type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:g.address.poolId.toString(),mintA:d,mintB:y,feeRate:s.tradeFeeRate,openTime:u.toString(),programId:t.toString(),price:f.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},...ou},forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:p,computeBudgetConfig:d,txVersion:y}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),b=null,g=null,A=n.useSOLBalance&&e.mintA.address===$.toString(),k=n.useSOLBalance&&e.mintB.address===$.toString(),[h,T]=s==="MintA"?[a,u]:[u,a],{account:I,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new se(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||h.isZero()?{payer:this.scope.ownerPubKey,amount:h}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});I&&(b=I),f.addInstruction(S||{});let{account:x,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new se(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:k||T.isZero()?{payer:this.scope.ownerPubKey,amount:T}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:c,checkCreateATAOwner:l});x&&(g=x),f.addInstruction(R||{}),(!b||!g)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let N=t||await this.getClmmPoolKeys(e.id),E=await Te.openPositionFromBaseInstructions({poolInfo:e,poolKeys:N,ownerInfo:{...n,feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:g},tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:m,getEphemeralSigners:p});return f.addInstruction(E),f.addCustomComputeBudget(d),f.versionBuild({txVersion:y,extInfo:E.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:i,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:p,getEphemeralSigners:d}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let y=this.createTxBuilder(),f=null,b=null,g=n.useSOLBalance&&e.mintA.address===$.toBase58(),A=n.useSOLBalance&&e.mintB.address===$.toBase58(),{account:k,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new se(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:g?!1:c,checkCreateATAOwner:l});k&&(f=k),y.addInstruction(h||{});let{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new se(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:c,checkCreateATAOwner:l});T&&(b=T),y.addInstruction(I||{}),(f===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=t||await this.getClmmPoolKeys(e.id),x=await Te.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:S,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:u,amountMaxA:i,amountMaxB:o,withMetadata:m,getEphemeralSigners:d});return y.addInstruction(x),y.versionBuild({txVersion:p,extInfo:{address:x.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:i,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,p=this.createTxBuilder(),d,y,f=a.useSOLBalance&&t.mintA.address===$.toString(),b=a.useSOLBalance&&t.mintB.address===$.toString(),{account:g,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new se(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});g&&(d=g),p.addInstruction(A||{});let{account:k,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new se(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});k&&(y=k),p.addInstruction(h||{}),!d&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.getClmmPoolKeys(t.id),I=Te.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:d,tokenAccountB:y},liquidity:s,amountMaxA:i,amountMaxB:o});return p.addInstruction(I),p.addCustomComputeBudget(l),p.versionBuild({txVersion:m,extInfo:{address:I.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:i,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e,p=this.createTxBuilder(),d,y,f=a.useSOLBalance&&t.mintA.address===$.toString(),b=a.useSOLBalance&&t.mintB.address===$.toString(),{account:g,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new se(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:i==="MintA"?o:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:c});g&&(d=g),p.addInstruction(A||{});let{account:k,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new se(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:i==="MintA"?s:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:c});k&&(y=k),p.addInstruction(h||{}),!d&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.getClmmPoolKeys(t.id),I=Te.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:d,tokenAccountB:y},base:i,baseAmount:o,otherAmountMax:s});return p.addInstruction(I),p.addCustomComputeBudget(l),p.versionBuild({txVersion:m,extInfo:{address:I.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:i,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:m}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let p=this.createTxBuilder(),d=i.useSOLBalance&&t.mintA.address===$.toString(),y=i.useSOLBalance&&t.mintB.address===$.toString(),f,b,{account:g,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new se(t.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!d,associatedOnly:d?!1:u,checkCreateATAOwner:c});f=g,A&&p.addInstruction(A);let{account:k,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new se(t.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:c});b=k,h&&p.addInstruction(h);let T=[];for(let R of t.rewardDefaultInfos){let N=i.useSOLBalance&&R.mint.address===$.toString(),E;if(R.mint.address===t.mintA.address)E=f;else if(R.mint.address===t.mintB.address)E=b;else{let{account:z,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new se(R.mint.programId),mint:new se(R.mint.address),notUseTokenAccount:N,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!N,associatedOnly:N?!1:u,checkCreateATAOwner:c});E=z,v&&p.addInstruction(v)}T.push(E)}!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let I=await this.getClmmPoolKeys(t.id),S=await Te.decreaseLiquidityInstructions({poolInfo:t,poolKeys:I,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:T},liquidity:a,amountMinA:o,amountMinB:s});p.addInstruction({instructions:S.instructions,instructionTypes:[_.ClmmDecreasePosition]});let x={...S.address};if(i.closePosition){let R=await Te.closePositionInstructions({poolInfo:t,poolKeys:I,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});p.addInstruction({endInstructions:R.instructions,endInstructionTypes:R.instructionTypes}),x={...x,...R.address}}return p.addCustomComputeBudget(l),p.versionBuild({txVersion:m,extInfo:{address:x}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let i=this.createTxBuilder(),o=await this.getClmmPoolKeys(e.id),s=Te.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return i.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.address.toString()===$.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new se(n.mint.address),mint:new se(n.mint.address),notUseTokenAccount:!!c,skipCloseAccount:!c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ut(new V(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});p&&u.addInstruction(p),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),y=Te.initRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new se(n.mint.programId),mint:new se(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:H.decimalToX64(n.perSecond)}});return u.addInstruction(y),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:y.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let u=this.createTxBuilder(),c={};for(let l of n){let m=t.useSOLBalance&&l.mint.address===$.toString(),p=l.perSecond.mul(l.endTime-l.openTime),{account:d,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new se(l.mint.programId),mint:new se(l.mint.address),notUseTokenAccount:!!m,skipCloseAccount:!m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ut(new V(p.toFixed(0)).gte(p)?p.toFixed(0):p.add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});y&&u.addInstruction(y),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),b=Te.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{programId:new se(l.mint.programId),mint:new se(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:H.decimalToX64(l.perSecond)}});c={...c,...b.address},u.addInstruction(b)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let u=this.createTxBuilder(),c=t.useSOLBalance&&n.mint.equals($),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:c,owner:this.scope.ownerPubKey,createInfo:c?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ut(new V(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:c?!1:i,checkCreateATAOwner:o});m&&u.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.getClmmPoolKeys(e.id),d=Te.setRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:H.decimalToX64(n.perSecond)}});return u.addInstruction(d),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:d.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let u=this.createTxBuilder(),c={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let m=t.useSOLBalance&&l.mint.address===$.toString(),{account:p,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new se(l.mint.programId),mint:new se(l.mint.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new ut(new V(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:m?!1:i,checkCreateATAOwner:o});d&&u.addInstruction(d),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=await this.getClmmPoolKeys(e.id),f=Te.setRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{mint:new se(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:H.decimalToX64(l.perSecond)}});u.addInstruction(f),c={...c,...f.address}}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(d=>d.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),u=t.useSOLBalance&&n.equals($),{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new se(s.mint.programId),mint:n,notUseTokenAccount:u,owner:this.scope.ownerPubKey,skipCloseAccount:!u,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:u?!1:i,checkCreateATAOwner:o});l&&a.addInstruction(l),c||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),p=Te.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:c},rewardMint:n});return a.addInstruction(p),a.build({address:p.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let u of n){let c=e.rewardDefaultInfos.find(f=>f.mint.address===u.toString());if(!c){this.logAndCreateError("reward mint error","not found reward mint",u);continue}let l=t.useSOLBalance&&u.equals($),{account:m,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new se(c.mint.programId),mint:u,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:i,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),p&&s.addInstruction(p);let d=await this.getClmmPoolKeys(e.id),y=Te.collectRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:u});s.addInstruction(y),a={...a,...y.address}}return s.build({address:a})}async swap({poolInfo:e,inputMint:t,amountIn:n,amountOutMin:i,priceLimit:o,ownerInfo:s,remainingAccounts:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,txVersion:l}){let m=this.createTxBuilder(),p=s.useSOLBalance&&e.mintA.address===$.toBase58(),d=s.useSOLBalance&&e.mintB.address===$.toBase58(),y;!o||o.equals(new V(0))?y=t.toString()===e.mintA.address?Bt.add(new ut(1)):St.sub(new ut(1)):y=Q.priceToSqrtPriceX64(o,e.mintA.decimals,e.mintB.decimals);let f;if(!f){let{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new se(e.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!p,createInfo:{payer:s.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:u,checkCreateATAOwner:c});f=A,k&&m.addInstruction(k)}let b;if(!b){let{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new se(e.mintB.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,skipCloseAccount:!d,createInfo:{payer:s.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:d?!1:u,checkCreateATAOwner:c});b=A,k&&m.addInstruction(k)}(!f||!b)&&this.logAndCreateError("user do not have token account",this.scope.account.tokenAccountRawInfos);let g=await this.getClmmPoolKeys(e.id);return m.addInstruction(Te.makeSwapBaseInInstructions({poolInfo:e,poolKeys:g,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},inputMint:new se(t),amountIn:n,amountOutMin:i,sqrtPriceLimitX64:y,remainingAccounts:a})),m.versionBuild({txVersion:l})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:u}){let c={};for(let m of this.scope.account.tokenAccountRawInfos)i?pe(this.scope.ownerPubKey,m.accountInfo.mint,s).publicKey.equals(m.pubkey)&&(c[m.accountInfo.mint.toString()]=m.pubkey):c[m.accountInfo.mint.toString()]=m.pubkey;let l=this.createTxBuilder();for(let m of Object.values(e)){if(t[m.id]===void 0||!t[m.id].find(k=>!k.liquidity.isZero()||k.rewardInfos.find(h=>!h.rewardAmountOwed.isZero())))continue;let p=m,d=n.useSOLBalance&&p.mintA.address===$.toString(),y=n.useSOLBalance&&p.mintB.address===$.toString(),f=c[p.mintA.address];if(!f){let{account:k,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintA.programId,mint:new se(p.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,skipCloseAccount:!d,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:d?!1:i,checkCreateATAOwner:o});f=k,h&&l.addInstruction(h)}let b=c[p.mintB.address];if(!b){let{account:k,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintB.programId,mint:new se(p.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:y?!1:i,checkCreateATAOwner:o});b=k,h&&l.addInstruction(h)}c[p.mintA.address]=f,c[p.mintB.address]=b;let g=[];for(let k of p.rewardDefaultInfos){let h=n.useSOLBalance&&k.mint.address===$.toString(),T=c[k.mint.address];if(!T){let{account:I,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new se(k.mint.programId),mint:new se(k.mint.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,skipCloseAccount:!h,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:h?!1:i});T=I,S&&l.addInstruction(S)}c[k.mint.address]=T,g.push(T)}let A=await this.getClmmPoolKeys(p.id);for(let k of t[m.id]){let h=Te.decreaseLiquidityInstructions({poolInfo:p,poolKeys:A,ownerPosition:k,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:g},liquidity:new ut(0),amountMinA:new ut(0),amountMinB:new ut(0)});l.addInstruction(h)}}return a===0?l.sizeCheckBuildV0({computeBudgetConfig:u}):l.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(ar(e).publicKey);return t?uu.decode(t.data).whitelistMints.filter(i=>!i.equals(se.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new ut(1))).map(s=>st(new se(e),s.accountInfo.mint).publicKey),i=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return i.forEach(s=>{if(!s)return;let a=ci.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){let t=await this.scope.connection.getAccountInfo(new se(e)),n=ui.decode(t.data),i=Q.sqrtPriceX64ToPrice(n.sqrtPriceX64,n.mintDecimalsA,n.mintDecimalsB).toNumber();return{...n,currentPrice:i}}};import{PublicKey as D}from"@solana/web3.js";import{NATIVE_MINT as di,TOKEN_PROGRAM_ID as Ct,AccountLayout as Ku}from"@solana/spl-token";var np=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),rp=Buffer.from("amm_config","utf8"),ip=Buffer.from("pool","utf8"),op=Buffer.from("pool_lp_mint","utf8"),sp=Buffer.from("pool_vault","utf8"),ap=Buffer.from("observation","utf8");function up(r){return re([np],r)}function cp(r,e){return re([rp,dp(e)],r)}function lp(r,e,t,n){return re([ip,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function mp(r,e){return re([op,e.toBuffer()],r)}function wu(r,e,t){return re([sp,e.toBuffer(),t.toBuffer()],r)}function mi(r,e){return re([ap,e.toBuffer()],r)}function dp(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r,!1),new Uint8Array(e)}function Au({programId:r,mintA:e,mintB:t}){let n=cp(r,0).publicKey,i=up(r).publicKey,o=lp(r,n,e,t).publicKey,s=mp(r,o).publicKey,a=wu(r,o,e).publicKey,u=wu(r,o,t).publicKey,c=mi(r,o).publicKey;return{poolId:o,configId:n,authority:i,lpMint:s,vaultA:a,vaultB:u,observationId:c}}import{TransactionInstruction as yr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yo,TOKEN_2022_PROGRAM_ID as Pu,ASSOCIATED_TOKEN_PROGRAM_ID as pp}from"@solana/spl-token";var fp=oe("Raydium_cpmm"),br={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function ku(r,e,t,n,i,o,s,a,u,c,l,m,p,d,y,f,b,g,A,k){let h=L([w("amountMaxA"),w("amountMaxB"),w("openTime")]),T=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Yo,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:pp,isSigner:!1,isWritable:!1},{pubkey:Cs,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1}],I=Buffer.alloc(h.span);return h.encode({amountMaxA:g,amountMaxB:A,openTime:k},I),new yr({keys:T,programId:r,data:Buffer.from([...br.initialize,...I])})}function hu(r,e,t,n,i,o,s,a,u,c,l,m,p,d,y){let f=L([w("lpAmount"),w("amountMaxA"),w("amountMaxB")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:Yo,isSigner:!1,isWritable:!1},{pubkey:Pu,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0}],g=Buffer.alloc(f.span);return fp.debug("cpmm deposit data",{lpAmount:p.toString(),amountMaxA:d.toString(),amountMaxB:y.toString()}),f.encode({lpAmount:p,amountMaxA:d,amountMaxB:y},g),new yr({keys:b,programId:r,data:Buffer.from([...br.deposit,...g])})}function Tu(r,e,t,n,i,o,s,a,u,c,l,m,p,d,y){let f=L([w("lpAmount"),w("amountMinA"),w("amountMinB")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:Yo,isSigner:!1,isWritable:!1},{pubkey:Pu,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Ks,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);return f.encode({lpAmount:p,amountMinA:d,amountMinB:y},g),new yr({keys:b,programId:r,data:Buffer.from([...br.withdraw,...g])})}function Iu(r,e,t,n,i,o,s,a,u,c,l,m,p,d,y,f){let b=L([w("amountIn"),w("amounOutMin")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],A=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},A),new yr({keys:g,programId:r,data:Buffer.from([...br.swapBaseInput,...A])})}function xu(r,e,t,n,i,o,s,a,u,c,l,m,p,d,y,f){let b=L([w("amountInMax"),w("amountOut")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],A=Buffer.alloc(b.span);return b.encode({amountInMax:y,amountOut:f},A),new yr({keys:g,programId:r,data:Buffer.from([...br.swapBaseOutput,...A])})}import Ye from"bn.js";var Bu=L([me(8),M("bump"),ve("disableCreatePool"),Tt("index"),w("tradeFeeRate"),w("protocolFeeRate"),w("fundFeeRate"),w("createPoolFee"),B("protocolOwner"),B("fundOwner"),W(w(),16)]),Su=L([me(8),B("configId"),B("poolCreator"),B("vaultA"),B("vaultB"),B("mintLp"),B("mintA"),B("mintB"),B("mintProgramA"),B("mintProgramB"),B("observationId"),M("bump"),M("status"),M("lpDecimals"),M("mintDecimalA"),M("mintDecimalB"),w("lpAmount"),w("protocolFeesMintA"),w("protocolFeesMintB"),w("fundFeesMintA"),w("fundFeesMintB"),w("openTime"),W(w(),32)]);var gr=class extends he{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){let n=await this.scope.connection.getAccountInfo(new D(e));if(!n)throw new Error(`pool not found: ${e}`);let i=Su.decode(n.data),[o,s]=await this.scope.connection.getMultipleAccountsInfo([i.vaultA,i.vaultB]);if(!o)throw new Error(`pool vaultA info not found: ${i.vaultA.toBase58()}`);if(!s)throw new Error(`pool vaultB info not found: ${i.vaultB.toBase58()}`);let a;if(t){let u=await this.scope.connection.getAccountInfo(i.configId);u&&(a=Bu.decode(u.data))}return{...i,baseReserve:new Ye(Ku.decode(o.data).amount.toString()).sub(i.protocolFeesMintA).sub(i.fundFeesMintA),quoteReserve:new Ye(Ku.decode(s.data).amount.toString()).sub(i.protocolFeesMintB).sub(i.fundFeesMintB),configInfo:a}}async createPool({programId:e,poolFeeAccount:t,startTime:n,ownerInfo:i,associatedOnly:o=!1,checkCreateATAOwner:s=!1,txVersion:a,computeBudgetConfig:u,...c}){var N,E,z;let l=i.feePayer||((N=this.scope.owner)==null?void 0:N.publicKey),m=new Ye(new D(c.mintA.address).toBuffer()).lte(new Ye(new D(c.mintB.address).toBuffer())),[p,d]=m?[c.mintA,c.mintB]:[c.mintB,c.mintA],[y,f]=m?[c.mintAAmount,c.mintBAmount]:[c.mintBAmount,c.mintAAmount],b=i.useSOLBalance&&p.address===di.toBase58(),g=i.useSOLBalance&&d.address===di.toBase58(),[A,k]=[new D(p.address),new D(d.address)],h=this.createTxBuilder(),{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:A,tokenProgram:p.programId,owner:this.scope.ownerPubKey,createInfo:b?{payer:l,amount:y}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:o,checkCreateATAOwner:s});h.addInstruction(I||{});let{account:S,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({mint:new D(d.address),tokenProgram:d.programId,owner:this.scope.ownerPubKey,createInfo:g?{payer:l,amount:f}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:o,checkCreateATAOwner:s});if(h.addInstruction(x||{}),T===void 0||S===void 0)throw Error("you don't has some token account");let R=Au({programId:e,mintA:A,mintB:k});return h.addInstruction({instructions:[ku(e,this.scope.ownerPubKey,R.configId,R.authority,R.poolId,A,k,R.lpMint,T,S,pe(this.scope.ownerPubKey,R.lpMint).publicKey,R.vaultA,R.vaultB,t,new D((E=p.programId)!=null?E:Ct),new D((z=d.programId)!=null?z:Ct),R.observationId,y,f,n)],instructionTypes:[_.CpmmCreatePool]}),h.addCustomComputeBudget(u),h.versionBuild({txVersion:a,extInfo:{address:{...R,mintA:p,mintB:d,programId:e,poolFeeAccount:t}}})}async addLiquidity(e){let{poolInfo:t,inputAmount:n,baseIn:i,slippage:o,computeResult:s,computeBudgetConfig:a,config:u,txVersion:c}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),n.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:n.toString()});let{account:l}=this.scope,{bypassAssociatedCheck:m,checkCreateATAOwner:p}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...u},d=await this.getRpcPoolInfo(t.id),{liquidity:y,inputAmountFee:f,anotherAmount:b}=s||this.computePairAmount({poolInfo:{...t,mintAmountA:new V(d.baseReserve.toString()).div(10**t.mintA.decimals).toNumber(),mintAmountB:new V(d.quoteReserve.toString()).div(10**t.mintB.decimals).toNumber(),lpAmount:new V(d.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()},slippage:o,baseIn:i,epochInfo:await this.scope.fetchEpochInfo(),amount:new V(n.toString()).div(10**(i?t.mintA.decimals:t.mintB.decimals))}),g=b.amount,A=t.mintA.address===di.toString(),k=t.mintB.address===di.toString(),h=this.createTxBuilder(),[T,I]=[new D(t.mintA.address),new D(t.mintB.address)],{account:S,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new D(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||(i?n:g).isZero()?{payer:this.scope.ownerPubKey,amount:i?n:g}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!1,checkCreateATAOwner:p});h.addInstruction(x||{});let{account:R,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new D(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:k||(i?g:n).isZero()?{payer:this.scope.ownerPubKey,amount:i?g:n}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!1,checkCreateATAOwner:p});h.addInstruction(N||{}),!S&&!R&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let E=await l.getCreatedTokenAccount({mint:new D(t.lpMint.address)}),{tokenAccount:z,...v}=await l.handleTokenAccount({side:"out",amount:0,mint:new D(t.lpMint.address),tokenAccount:E,bypassAssociatedCheck:m,checkCreateATAOwner:p});h.addInstruction(v);let Z=await this.getCpmmPoolKeys(t.id);return h.addInstruction({instructions:[hu(new D(t.programId),this.scope.ownerPubKey,new D(Z.authority),new D(t.id),z,S,R,new D(Z.vault.A),new D(Z.vault.B),T,I,new D(t.lpMint.address),y,i?f.amount:g,i?g:f.amount)],instructionTypes:[_.CpmmAddLiquidity],lookupTableAddress:Z.lookupTableAccount?[Z.lookupTableAccount]:[]}),h.addCustomComputeBudget(a),h.versionBuild({txVersion:c})}async withdrawLiquidity(e){var z,v;let{poolInfo:t,lpAmount:n,slippage:i,computeBudgetConfig:o,txVersion:s}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let a=new Ve(new Ye(1)).sub(i),u=await this.getRpcPoolInfo(t.id),[c,l]=[a.mul(n.mul(u.baseReserve).div(u.lpAmount)).quotient,a.mul(n.mul(u.quoteReserve).div(u.lpAmount)).quotient],m=await this.scope.fetchEpochInfo(),[p,d]=[ge(c,t.mintA.extensions.feeConfig,m,!0),ge(l,t.mintB.extensions.feeConfig,m,!0)],{account:y}=this.scope,f=this.createTxBuilder(),[b,g]=[new D(t.mintA.address),new D(t.mintB.address)],A=b.equals($),k=g.equals($),h,T,{account:I,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new D(t.mintA.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,associatedOnly:!A,checkCreateATAOwner:!1});h=I,S&&f.addInstruction(S);let{account:x,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new D(t.mintB.address),notUseTokenAccount:k,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!k,associatedOnly:!k,checkCreateATAOwner:!1});T=x,R&&f.addInstruction(R),(!h||!T)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",y.tokenAccounts);let N=await y.getCreatedTokenAccount({mint:new D(t.lpMint.address)});N||this.logAndCreateError("cannot found lp token account","tokenAccounts",y.tokenAccounts);let E=await this.getCpmmPoolKeys(t.id);return f.addInstruction({instructions:[Tu(new D(t.programId),this.scope.ownerPubKey,new D(E.authority),new D(t.id),N,h,T,new D(E.vault.A),new D(E.vault.B),b,g,new D(t.lpMint.address),n,c.sub((z=p.fee)!=null?z:new Ye(0)),l.sub((v=d.fee)!=null?v:new Ye(0)))],instructionTypes:[_.CpmmWithdrawLiquidity],lookupTableAddress:E.lookupTableAccount?[E.lookupTableAccount]:[]}),f.addCustomComputeBudget(o),f.versionBuild({txVersion:s})}async swap(e){let{poolInfo:t,baseIn:n,swapResult:i,config:o,computeBudgetConfig:s,txVersion:a,isSell:u=!1}=e,{bypassAssociatedCheck:c,checkCreateATAOwner:l}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...o},m=this.createTxBuilder(),[p,d]=u?[new D(t.mintB.address),new D(t.mintA.address)]:[new D(t.mintA.address),new D(t.mintB.address)],[y,f]=u?[t.mintB.programId,t.mintA.programId]:[t.mintA.programId,t.mintB.programId],b=await this.scope.account.getCreatedTokenAccount({programId:new D(y!=null?y:Ct),mint:p,associatedOnly:!1}),g=await this.scope.account.getCreatedTokenAccount({programId:new D(f!=null?f:Ct),mint:d,associatedOnly:!1}),{tokenAccount:A,...k}=await this.scope.account.handleTokenAccount({side:n?"in":"out",amount:n?i.sourceAmountSwapped:i.destinationAmountSwapped,mint:p,tokenAccount:b,bypassAssociatedCheck:c,checkCreateATAOwner:l,programId:new D(y!=null?y:Ct)});m.addInstruction(k);let{tokenAccount:h,...T}=await this.scope.account.handleTokenAccount({side:n?"out":"in",amount:n?i.destinationAmountSwapped:i.sourceAmountSwapped,mint:d,tokenAccount:g,bypassAssociatedCheck:c,checkCreateATAOwner:l,programId:new D(f!=null?f:Ct)});m.addInstruction(T),!A&&!h&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=await this.getCpmmPoolKeys(t.id),[S,x]=u?[I.vault.B,I.vault.A]:[I.vault.A,I.vault.B];return m.addInstruction({instructions:[n?Iu(new D(t.programId),this.scope.ownerPubKey,new D(I.authority),new D(I.config.id),new D(t.id),A,h,new D(S),new D(x),new D(y!=null?y:Ct),new D(f!=null?f:Ct),p,d,mi(new D(t.programId),new D(t.id)).publicKey,i.sourceAmountSwapped,i.destinationAmountSwapped):xu(new D(t.programId),this.scope.ownerPubKey,new D(I.authority),new D(I.config.id),new D(t.id),h,A,new D(x),new D(S),new D(f!=null?f:Ct),new D(y!=null?y:Ct),d,p,mi(new D(t.programId),new D(t.id)).publicKey,i.sourceAmountSwapped,i.destinationAmountSwapped)],instructionTypes:[n?_.CpmmSwapBaseIn:_.CpmmSwapBaseOut]}),m.addCustomComputeBudget(s),m.versionBuild({txVersion:a})}computePairAmount({poolInfo:e,amount:t,slippage:n,epochInfo:i,baseIn:o}){var A,k,h,T,I,S,x,R;let s=1-Number(n.toSignificant())/100,a=new Ye(new V(t).mul(10**e[o?"mintA":"mintB"].decimals).mul(s).toFixed(0)),u=ge(a,e[o?"mintA":"mintB"].extensions.feeConfig,i,!1),c=a.sub((A=u.fee)!=null?A:new Ye(0)),[l,m]=[new Ye(new V(e.mintAmountA).mul(10**e.mintA.decimals).toString()),new Ye(new V(e.mintAmountB).mul(10**e.mintB.decimals).toString())],p=new Ye(new V(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,V.ROUND_DOWN));this.logDebug("baseReserve:",l.toString(),"quoteReserve:",m.toString()),this.logDebug("tokenIn:",o?e.mintA.symbol:e.mintB.symbol,"amountIn:",a.toString(),"amountInFee:",(h=(k=u.fee)==null?void 0:k.toString())!=null?h:0,"anotherToken:",o?e.mintB.symbol:e.mintA.symbol,"slippage:",`${n.toSignificant()}%`);let d=o?"base":"quote";this.logDebug("input side:",d);let y=c.mul(p).div(d==="base"?l:m),f={amount:Ie,fee:void 0,expirationTime:void 0};c.isZero()||(f=ge(yp(y,l,m,p)[o?"amountB":"amountA"],e[o?"mintB":"mintA"].extensions.feeConfig,i,!0));let b=new Ve(new Ye(1)).add(n),g=ge(b.mul(f.amount.sub((T=f.fee)!=null?T:new Ye(0))).quotient,e[o?"mintB":"mintA"].extensions.feeConfig,i,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(S=(I=f.fee)==null?void 0:I.toString())!=null?S:0,"maxAnotherAmount:",g.amount.toString(),"maxAnotherAmountFee:",(R=(x=g.fee)==null?void 0:x.toString())!=null?R:0),{inputAmountFee:u,anotherAmount:f,maxAnotherAmount:g,liquidity:y}}};function yp(r,e,t,n){let i=r.mul(e).div(n);!i.isZero()&&!r.mul(e).mod(n).isZero()&&(i=i.add(new Ye(1)));let o=r.mul(t).div(n);return!o.isZero()&&!r.mul(t).mod(n).isZero()&&(o=o.add(new Ye(1))),{amountA:i,amountB:o}}var wr=class extends he{constructor(e){super(e)}static getAddLiquidityDefaultPool({addLiquidityPools:e,poolInfosCache:t}){if(e.length===0)return;if(e.length===1||(e.sort((i,o)=>o.version-i.version),e[0].version!==e[1].version))return e[0];let n=e.filter(i=>i.version===e[0].version);return n.sort((i,o)=>this.comparePoolSize(i,o,t)),n[0]}static comparePoolSize(e,t,n){let i=n[e.id],o=n[t.id];return i===void 0?1:o===void 0?-1:e.baseMint===t.baseMint?i.baseReserve.sub(o.baseReserve).gte(Ie)?-1:1:i.baseReserve.sub(o.quoteReserve).gte(Ie)?-1:1}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals($));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n}=e,i=await this.getWSolAccounts(),o=this.createTxBuilder();o.addCustomComputeBudget(e.computeBudgetConfig);let s=await It({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});o.addInstruction(s);let a=q(t);for(let u=0;u<i.length;u++)a.gte(i[u].amount)?(o.addInstruction({instructions:[Mt({tokenAccount:i[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),a.sub(i[u].amount)):(o.addInstruction({instructions:[Mt({tokenAccount:i[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),Yn({destination:s.addresses.newAccount,source:i[u].publicKey,amount:a,owner:this.scope.ownerPubKey,tokenProgram:n}));return o.build()}async wrapWSol(e,t){let n=await this.getWSolAccounts(),i=this.createTxBuilder(),o=await It({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return i.addInstruction(o),n.length&&i.addInstruction({instructions:[Yn({destination:n[0].publicKey,source:o.addresses.newAccount,amount:e,owner:this.scope.ownerPubKey,tokenProgram:t})],endInstructions:[Mt({tokenAccount:o.addresses.newAccount,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:t})]}),i.build()}};import{TOKEN_PROGRAM_ID as bp}from"@solana/spl-token";import{PublicKey as gp,Transaction as Qo,TransactionInstruction as wp}from"@solana/web3.js";import Cu from"bn.js";var Qe=class extends he{static getPdaPoolId(e,t){return re([Qe.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,i){return re([Qe.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),Buffer.from(new Cu(i).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:i,chainTime:o}){if(n.length===0)return[];let s=n.map(l=>Qe.getPdaPoolId(t,l).publicKey),a=[];for(let l=0;l<Qe.VERSION_PROJECT.length;l++)a.push(...s.map(m=>Qe.getPdaOwnerId(t,m,i,l).publicKey));let u=await kt(e,[...s,...a]),c=[];for(let l=0;l<u.length;l++){let m=Math.floor(l/n.length),p=l%n.length,d=s[p],y=a[l],f=u[p],b=u[n.length+l];if(!(f&&b)||f.data.length!==Qe.POOL_LAYOUT.span||b.data.length!==Qe.OWNER_LAYOUT.span)continue;let g=Qe.POOL_LAYOUT.decode(f.data),A=Qe.OWNER_LAYOUT.decode(b.data),k=g.openTime.toNumber(),h=g.endTime.toNumber(),T=A.tokenInfo.map(x=>x.debtAmount.gt(new Cu(0))).filter(x=>!x).length!==3,I=o>k&&o<h&&g.status===1,S=T&&I;c.push({programId:t,poolId:d,ammId:g.ammId,ownerAccountId:y,snapshotLpAmount:A.lpAmount,project:Qe.VERSION_PROJECT[m],openTime:k,endTime:h,canClaim:S,canClaimErrorType:T?I?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:g.tokenInfo.map((x,R)=>({mintAddress:x.mintAddress,mintVault:x.mintVault,mintDecimals:x.mintDecimals,perLpLoss:x.perLpLoss,debtAmount:A.tokenInfo[R].debtAmount.add(A.tokenInfo[R].claimedAmount)}))})}return c}async makeClaimTransaction({poolInfo:e,ownerInfo:t}){t.wallet||this.scope.checkOwner();let n=this.createTxBuilder(),i=t.wallet||this.scope.ownerPubKey,o=[];for(let u of e.tokenInfo){let{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({mint:u.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:u.mintAddress.equals(le.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!u.mintAddress.equals(le.WSOL.mint),associatedOnly:u.mintAddress.equals(le.WSOL.mint)?!1:t.associatedOnly});l&&n.addInstruction(l),o.push(c)}n.addInstruction({instructions:[Qe.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:i,ownerPda:e.ownerAccountId,claimAddress:o}})]});let{transaction:s,signers:a}=n.build();return[{transaction:s,signer:a}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t}){let n=this.createTxBuilder(),i=t.wallet||this.scope.ownerPubKey,o={};for(let c of e){let l=[];for(let m of c.tokenInfo){let{account:p,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:m.mintAddress.equals(le.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!m.mintAddress.equals(le.WSOL.mint),associatedOnly:m.mintAddress.equals(le.WSOL.mint)?!1:t.associatedOnly});d&&n.addInstruction(d),p&&(o[m.mintAddress.toString()]=p,l.push(p))}n.addInstruction({instructions:[Qe.makeClaimInstruction({programId:c.programId,poolInfo:c,ownerInfo:{wallet:i,ownerPda:c.ownerAccountId,claimAddress:l}})]})}let{transaction:s,signers:a}=n.build(),u=n.allInstructions;return vr(u,[i,...a.map(c=>c.publicKey)])?[{transaction:s,signer:a}]:[{transaction:new Qo().add(...u.slice(0,n.AllTxData.instructions.length-1)),signer:a},{transaction:new Qo().add(...u.slice(n.AllTxData.instructions.length-1)),signer:[]},{transaction:new Qo().add(...n.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){let i=L([]),o=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map(u=>({pubkey:u,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:u})=>({pubkey:u,isSigner:!1,isWritable:!0})),{pubkey:bp,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new wp({keys:o,programId:e,data:a})}},ct=Qe;ct.CLAIMED_NUM=3,ct.POOL_LAYOUT=L([me(8),M("bump"),M("status"),w("openTime"),w("endTime"),B("ammId"),W(L([M("mintDecimals"),B("mintAddress"),B("mintVault"),w("perLpLoss"),w("totalClaimedAmount")]),Qe.CLAIMED_NUM,"tokenInfo"),W(w(),10,"padding")]),ct.OWNER_LAYOUT=L([me(8),M("bump"),M("version"),B("poolId"),B("owner"),w("lpAmount"),W(L([B("mintAddress"),w("debtAmount"),w("claimedAmount")]),Qe.CLAIMED_NUM,"tokenInfo"),W(w(),4,"padding")]),ct.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new gp(e)),ct.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},ct.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];import{PublicKey as jo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Mu}from"@solana/spl-token";import Ar from"bn.js";import{TransactionInstruction as Pp,SYSVAR_RENT_PUBKEY as kp}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ru}from"@solana/spl-token";import{createInitializeAccountInstruction as Lu}from"@solana/spl-token";import{SystemProgram as pn,Transaction as Ou}from"@solana/web3.js";function Ap(r="accountFlags"){let e=new Hr(r);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var Ho=L([me(5),Ap("accountFlags"),B("ownAddress"),w("vaultSignerNonce"),B("baseMint"),B("quoteMint"),B("baseVault"),w("baseDepositsTotal"),w("baseFeesAccrued"),B("quoteVault"),w("quoteDepositsTotal"),w("quoteFeesAccrued"),w("quoteDustThreshold"),B("requestQueue"),B("eventQueue"),B("bids"),B("asks"),w("baseLotSize"),w("quoteLotSize"),w("feeRateBps"),w("referrerRebatesAccrued"),me(7)]);function hp({programId:r,marketInfo:e}){let t=L([M("version"),Ue("instruction"),w("baseLotSize"),w("quoteLotSize"),Tt("feeRateBps"),w("vaultSignerNonce"),w("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:kp,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),i=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},i),new Pp({keys:n,programId:r,data:i})}async function Nu({connection:r,wallet:e,marketInfo:t}){let n=new Ou,i=await r.getMinimumBalanceForRentExemption(165);n.add(pn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:i,space:165,programId:Ru}),pn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:i,space:165,programId:Ru}),Lu(t.baseVault.publicKey,t.baseMint,t.vaultOwner),Lu(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner));let o=new Ou;return o.add(pn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await r.getMinimumBalanceForRentExemption(Ho.span),space:Ho.span,programId:t.programId}),pn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:await r.getMinimumBalanceForRentExemption(5120+12),space:5120+12,programId:t.programId}),pn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:await r.getMinimumBalanceForRentExemption(262144+12),space:262144+12,programId:t.programId}),pn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:await r.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:t.programId}),pn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:await r.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:t.programId}),hp({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[_.CreateAccount,_.CreateAccount,_.InitAccount,_.InitAccount]},{transaction:o,signer:[],instructionTypes:[_.CreateAccount,_.CreateAccount,_.CreateAccount,_.CreateAccount,_.CreateAccount,_.InitMarket]}]}var Sn=class extends he{async create({baseInfo:e,quoteInfo:t,lotSize:n,tickSize:i,dexProgramId:o,txVersion:s,computeBudgetConfig:a}){let u=this.scope.ownerPubKey,c=Ge({fromPublicKey:u,programId:o}),l=Ge({fromPublicKey:u,programId:o}),m=Ge({fromPublicKey:u,programId:o}),p=Ge({fromPublicKey:u,programId:o}),d=Ge({fromPublicKey:u,programId:o}),y=Ge({fromPublicKey:u,programId:Mu}),f=Ge({fromPublicKey:u,programId:Mu}),b=0,g=new Ar(100);function A(){let N=new Ar(0);for(;;)try{return{vaultOwner:jo.createProgramAddressSync([c.publicKey.toBuffer(),N.toArrayLike(Buffer,"le",8)],o),vaultSignerNonce:N}}catch{if(N.iaddn(1),N.gt(new Ar(25555)))throw Error("find vault owner error")}}let{vaultOwner:k,vaultSignerNonce:h}=A(),T=new Ar(Math.round(10**e.decimals*n)),I=new Ar(Math.round(n*10**t.decimals*i));if(T.eq(Ie))throw Error("lot size is too small");if(I.eq(Ie))throw Error("tick size or lot size is too small");let S=await Nu({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:o,id:c,baseMint:e.mint,quoteMint:t.mint,baseVault:y,quoteVault:f,vaultOwner:k,requestQueue:l,eventQueue:m,bids:p,asks:d,feeRateBps:b,quoteDustThreshold:g,vaultSignerNonce:h,baseLotSize:T,quoteLotSize:I}}),x=this.createTxBuilder();x.addCustomComputeBudget(a),x.addInstruction({instructions:S[0].transaction.instructions,signers:S[0].signer});let R=[];for await(let N of S.slice(1,S.length)){let E=this.createTxBuilder();E.addCustomComputeBudget(a),E.addInstruction({instructions:N.transaction.instructions,signers:N.signer,instructionTypes:N.instructionTypes});let z=await E.versionBuild({txVersion:s});R.push(z)}return x.versionMultiBuild({extraPreBuildData:R,extInfo:{address:{marketId:c.publicKey,requestQueue:l.publicKey,eventQueue:m.publicKey,bids:p.publicKey,asks:d.publicKey,baseVault:y.publicKey,quoteVault:f.publicKey,baseMint:new jo(e.mint),quoteMin:new jo(t.mint)}},txVersion:s})}};import{PublicKey as kr}from"@solana/web3.js";import{PublicKey as Tp,TransactionInstruction as $o,SYSVAR_CLOCK_PUBKEY as Ip}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jo}from"@solana/spl-token";var Zo=L([M("instruction"),ra("amount")]),Pr=L([M("instruction")]);function mB({programId:r,amount:e,instructionKeys:t}){let n=[{pubkey:new Tp("11111111111111111111111111111111"),isSigner:!1,isWritable:!1},{pubkey:Jo,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:Ni,isSigner:!1,isWritable:!1},...Object.entries(t).map(([o,s])=>({pubkey:s,isSigner:o==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(o)}))],i=Buffer.alloc(Zo.span);return Zo.encode({instruction:1,amount:Number(e)},i),new $o({keys:n,programId:r,data:i})}function pi({programId:r},e){let t=[{pubkey:Jo,isSigner:!1,isWritable:!1},{pubkey:Ni,isSigner:!1,isWritable:!1},...Object.entries(e).map(([i,o])=>({pubkey:o,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],n=Buffer.alloc(Pr.span);return Pr.encode({instruction:2},n),new $o({keys:t,programId:r,data:n})}function es(r){let{poolConfig:e,userKeys:t,side:n}=r,i=n==="base"?t.baseTokenAccount:t.quoteTokenAccount,o=n==="base"?e.baseVault:e.quoteVault,s=Buffer.alloc(Pr.span);Pr.encode({instruction:2},s);let a=[{pubkey:Jo,isWritable:!1,isSigner:!1},{pubkey:Ip,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new $o({programId:e.programId,keys:a,data:s})}import _u from"bn.js";var xp={[Gn.IDO_PROGRAM_ID_V1.toString()]:1,[Gn.IDO_PROGRAM_ID_V2.toString()]:2,[Gn.IDO_PROGRAM_ID_V3.toString()]:3,[Gn.IDO_PROGRAM_ID_V4.toString()]:4},Kn=class extends he{async claim({ownerInfo:e,idoKeys:t,associatedOnly:n=!0,checkCreateATAOwner:i=!1,txVersion:o}){let s=this.createTxBuilder(),a=xp[t.programId];a||this.logAndCreateError("invalid version",a);let u=de(t),[c,l]=[!new _u(e.coin).isZero(),!new _u(e.pc).isZero()],m=u.projectInfo.mint.address.equals($),{account:p,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.projectInfo.mint.programId,mint:u.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!m,notUseTokenAccount:m,associatedOnly:m?!1:n,checkCreateATAOwner:i});!p&&c&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),c&&d&&s.addInstruction(d);let y=u.buyInfo.mint.address.equals($),{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.buyInfo.mint.programId,mint:u.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:n,checkCreateATAOwner:i});if(!p&&l&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),l&&b&&s.addInstruction(b),(!p||!f)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),a===3)return s.addInstruction({instructions:[...c?[pi({programId:u.programId},{idoId:u.id,authority:u.authority,poolTokenAccount:u.projectInfo.vault,userTokenAccount:p,userIdoInfo:new kr(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...l?[pi({programId:new kr(t.programId)},{idoId:u.id,authority:u.authority,poolTokenAccount:u.buyInfo.vault,userTokenAccount:f,userIdoInfo:new kr(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(a<3)return!c&&!l&&this.logAndCreateError("no claimable rewards"),s.addInstruction({instructions:[pi({programId:u.programId},{idoId:u.id,authority:u.authority,poolQuoteTokenAccount:u.buyInfo.vault,poolBaseTokenAccount:u.projectInfo.vault,userQuoteTokenAccount:f,userBaseTokenAccount:p,userIdoInfo:new kr(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let g={poolConfig:{id:u.id,programId:u.programId,authority:u.authority,baseVault:u.projectInfo.vault,quoteVault:u.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:p,quoteTokenAccount:f,ledgerAccount:new kr(e.userIdoInfo),owner:this.scope.ownerPubKey}};return s.addInstruction({instructions:[...c?[es({...g,side:"base"})]:[],...l?[es({...g,side:"quote"})]:[]]}).versionBuild({txVersion:o})}};import{PublicKey as Bp}from"@solana/web3.js";import{MintLayout as Sp,TOKEN_2022_PROGRAM_ID as ts,TOKEN_PROGRAM_ID as ns}from"@solana/spl-token";var hr=class extends he{constructor(t){super(t);this._tokenList=[];this._tokenMap=new Map;this._blackTokenMap=new Map;this._mintGroup={official:new Set,jup:new Set,extra:new Set};this._whiteMap=new Set;this._extraTokenList=[]}async load(t){this.checkDisabled();let{forceUpdate:n=!1,type:i="strict"}=t||{},{mintList:o,blacklist:s,whiteList:a}=await this.scope.fetchV3TokenList(n),u=await this.scope.fetchJupTokenList(i,n);this._tokenList=[],this._tokenMap=new Map,this._blackTokenMap=new Map,this._mintGroup={official:new Set,jup:new Set,extra:new Set},this._whiteMap=new Set(a),this._tokenMap.set(Pt.address,Pt),this._mintGroup.official.add(Pt.address),s.forEach(c=>{this._blackTokenMap.set(c.address,{...c,priority:-1})}),o.forEach(c=>{var l;this._blackTokenMap.has(c.address)||(this._tokenMap.set(c.address,{...c,type:"raydium",priority:2,programId:(l=c.programId)!=null?l:c.tags.includes("token-2022")?ts.toBase58():ns.toBase58()}),this._mintGroup.official.add(c.address))}),u.forEach(c=>{var l;this._blackTokenMap.has(c.address)||this._tokenMap.has(c.address)||(this._tokenMap.set(c.address,{...c,type:"jupiter",priority:1,programId:(l=c.programId)!=null?l:c.tags.includes("token-2022")?ts.toBase58():ns.toBase58()}),this._mintGroup.jup.add(c.address))}),this._extraTokenList.forEach(c=>{this._blackTokenMap.has(c.address)||this._tokenMap.has(c.address)||(this._tokenMap.set(c.address,{...c,type:"extra",priority:1,programId:c.programId||c.tags.includes("token-2022")?ts.toBase58():ns.toBase58()}),this._mintGroup.extra.add(c.address))}),this._tokenList=Array.from(this._tokenMap).map(c=>c[1])}get tokenList(){return this._tokenList}get tokenMap(){return this._tokenMap}get blackTokenMap(){return this._blackTokenMap}get mintGroup(){return this._mintGroup}get whiteListMap(){return this._whiteMap}async getTokenInfo(t){if(!t)throw new Error("please input mint");let n=t.toString(),i=this._tokenMap.get(n);if(i)return i;if(n.toLocaleUpperCase()==="SOL")return Pt;let o=(await this.scope.api.getTokenInfo([n]))[0];if(o)return this._mintGroup.extra.add(n),this._tokenMap.set(n,{...o,priority:2}),o;let s=await this.scope.connection.getAccountInfo(new Bp(n));if(!s)throw new Error(`mint address not found: ${n}`);let a=Sp.decode(s.data),u=n.toString().substring(0,6),c={chainId:101,address:n,programId:s.owner.toBase58(),logoURI:"",symbol:u,name:u,decimals:a.decimals,tags:[],extensions:{},priority:0,type:"unknown"};return this._mintGroup.extra.add(n),this._tokenMap.set(n,c),c}};var fi=class{constructor(e){this.rawBalances=new Map;let{connection:t,cluster:n,owner:i,api:o,defaultChainTime:s,defaultChainTimeOffset:a,apiCacheTime:u}=e;this._connection=t,this.cluster=n||"mainnet",this._owner=i?new ft(i):void 0,this._signAllTransactions=e.signAllTransactions,this.api=o,this._apiCacheTime=u||5*60*1e3,this.logger=oe("Raydium"),this.farm=new ir({scope:this,moduleName:"Raydium_Farm"}),this.account=new Qn({scope:this,moduleName:"Raydium_Account",tokenAccounts:e.tokenAccounts,tokenAccountRawInfos:e.tokenAccountRawInfos}),this.liquidity=new pr({scope:this,moduleName:"Raydium_LiquidityV2"}),this.token=new hr({scope:this,moduleName:"Raydium_tokenV2"}),this.tradeV2=new wr({scope:this,moduleName:"Raydium_tradeV2"}),this.clmm=new fr({scope:this,moduleName:"Raydium_clmm"}),this.cpmm=new gr({scope:this,moduleName:"Raydium_cpmm"}),this.utils1216=new ct({scope:this,moduleName:"Raydium_utils1216"}),this.marketV2=new Sn({scope:this,moduleName:"Raydium_marketV2"}),this.ido=new Kn({scope:this,moduleName:"Raydium_ido"}),this.availability={};let c=new Date().getTime();this.apiData={},a&&(this._chainTime={fetched:c,value:{chainTime:s||Date.now()-a,offset:a}})}static async load(e){var l;let t=Kp({cluster:"mainnet",owner:null,apiRequestInterval:3e5,apiRequestTimeout:1e4,apiCacheTime:3e5,signAllTransactions:void 0,urlConfigs:{},logRequests:!1,logCount:10,jupTokenType:"strict",disableFeatureCheck:!1,disableLoadToken:!1,tokenAccounts:[],tokenAccountRawInfos:[],defaultChainTimeOffset:void 0,defaultChainTime:void 0},e),{cluster:n,apiRequestTimeout:i,logCount:o,logRequests:s,urlConfigs:a}=t,u=new zr({cluster:n,timeout:i,urlConfigs:a,logCount:o,logRequests:s}),c=new fi({...t,api:u});return await c.fetchAvailabilityStatus((l=e.disableFeatureCheck)!=null?l:!0),e.disableLoadToken||await c.token.load({type:e.jupTokenType}),c}get owner(){return this._owner}get ownerPubKey(){if(!this._owner)throw new Error(Yr);return this._owner.publicKey}setOwner(e){return this._owner=e?new ft(e):void 0,this}get connection(){if(!this._connection)throw new Error(Js);return this._connection}setConnection(e){return this._connection=e,this}get signAllTransactions(){return this._signAllTransactions}setSignAllTransactions(e){return this._signAllTransactions=e,this}checkOwner(){if(!this.owner)throw this.logger.error(Yr),new Error(Yr)}isCacheInvalidate(e){return new Date().getTime()-e>this._apiCacheTime}async fetchChainTime(){try{let e=await this.api.getChainTimeOffset();this._chainTime={fetched:Date.now(),value:{chainTime:Date.now()+e.offset*1e3,offset:e.offset*1e3}}}catch{this._chainTime=void 0}}async fetchV3TokenList(e){if(this.apiData.tokenList&&!this.isCacheInvalidate(this.apiData.tokenList.fetched)&&!e)return this.apiData.tokenList.data;let t=await this.api.getTokenList(),n={fetched:Date.now(),data:t};return this.apiData.tokenList=n,n.data}async fetchJupTokenList(e,t){var o;let n=(o=this.apiData.jupTokenList)==null?void 0:o[e];if(n&&!this.isCacheInvalidate(n.fetched)&&!t)return n.data;let i=await this.api.getJupTokenList(e);return this.apiData.jupTokenList={...this.apiData.jupTokenList,[e]:{fetched:Date.now(),data:i}},this.apiData.jupTokenList[e].data}get chainTimeData(){var e;return(e=this._chainTime)==null?void 0:e.value}async chainTimeOffset(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.offset:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.offset)||0)}async currentBlockChainTime(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.chainTime:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.chainTime)||Date.now())}async fetchEpochInfo(){return this._epochInfo&&Date.now()-this._epochInfo.fetched<=1e3*30?this._epochInfo.value:(this._epochInfo={fetched:Date.now(),value:await this.connection.getEpochInfo()},this._epochInfo.value)}async fetchAvailabilityStatus(e){if(e)return{};try{let t=await this.api.fetchAvailabilityStatus(),n=t.all===!1;return this.availability={all:t.all,swap:n?!1:t.swap,createConcentratedPosition:n?!1:t.createConcentratedPosition,addConcentratedPosition:n?!1:t.addConcentratedPosition,addStandardPosition:n?!1:t.addStandardPosition,removeConcentratedPosition:n?!1:t.removeConcentratedPosition,removeStandardPosition:n?!1:t.removeStandardPosition,addFarm:n?!1:t.addFarm,removeFarm:n?!1:t.removeFarm},t}catch{return{}}}};import{TOKEN_PROGRAM_ID as os,TOKEN_2022_PROGRAM_ID as rs}from"@solana/spl-token";import{PublicKey as lt,TransactionInstruction as ss,SystemProgram as Eu}from"@solana/web3.js";import is from"bn.js";function bS(r,e,t,n,i,o,s,a,u,c,l,m){let p=L([M("instruction"),w("amountIn"),w("amountOut")]),d=[{pubkey:Eu.programId,isSigner:!1,isWritable:!1},{pubkey:os,isSigner:!1,isWritable:!1},{pubkey:new lt(t.programId),isSigner:!1,isWritable:!1},{pubkey:new lt(t.id),isSigner:!1,isWritable:!0},{pubkey:new lt(n.id),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=de(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=de(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new lt("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=de(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(p.span);return p.encode({instruction:4,amountIn:c,amountOut:l},y),new ss({keys:d,programId:r,data:y})}function gS(r,e,t,n,i,o,s,a,u,c){let l=L([M("instruction")]),m=[{pubkey:Eu.programId,isSigner:!1,isWritable:!1},{pubkey:os,isSigner:!1,isWritable:!1},{pubkey:new lt(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new lt(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new lt(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=de(n);m.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=de(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new lt("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=de(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let p=Buffer.alloc(l.span);return l.encode({instruction:5},p),new ss({keys:m,programId:r,data:p})}function Vu(r,e,t,n,i,o){if(r.pooltype.includes("StablePool")){let s=de(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:new lt("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]}else if(r.type==="Concentrated"){let s=r,a=de(e),u=s.mintA.address===t;return[{pubkey:new lt(String(r.programId)),isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a.config.id,isSigner:!1,isWritable:!1},{pubkey:a.id,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.A:a.vault.B,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.B:a.vault.A,isSigner:!1,isWritable:!0},{pubkey:a.id,isSigner:!1,isWritable:!0},...a.mintA.programId.equals(rs)||a.mintB.programId.equals(rs)?[{pubkey:rs,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1},{pubkey:u?a.mintA.address:a.mintB.address,isSigner:!1,isWritable:!1},{pubkey:u?a.mintB.address:a.mintA.address,isSigner:!1,isWritable:!1}]:[],...(o!=null?o:[]).map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:at(new lt(String(r.programId)),new lt(r.id)).publicKey,isSigner:!1,isWritable:!0}]}else{let s=de(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},...s.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:s.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:s.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]]}}function Cp(r,e,t,n,i,o,s,a,u,c,l,m,p,d){let y=L([M("instruction"),w("amountIn"),w("amountOut")]),f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:os,isSigner:!1,isWritable:!1}];f.push(...Vu(a,c,o,t,n,d[0])),f.push(...Vu(u,l,s,n,i,d[1]));let b=Buffer.alloc(y.span);return y.encode({instruction:8,amountIn:m,amountOut:p},b),new ss({keys:f,programId:r,data:b})}async function wS({routeProgram:r,ownerInfo:e,inputMint:t,swapInfo:n}){var i,o,s,a,u,c;if(n.routeType==="amm")if(n.poolInfo[0].type==="Concentrated"){let l=de(n.poolKey[0]),m=t.equals(l.mintA.address)?Bt.add(rt):St.sub(rt);return await Te.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,ownerInfo:{wallet:e.wallet,tokenAccountA:l.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:l.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(i=n.minAmountOut.fee)==null?void 0:i.raw)!=null?o:new is(0)),sqrtPriceLimitX64:m,remainingAccounts:n.remainingAccounts[0]})}else{let l=n.poolKey[0];return{signers:[],instructions:[ri({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((a=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?a:new is(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?_.AmmV5SwapBaseIn:_.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],m=n.poolInfo[1],p=n.poolKey[0],d=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Cp(r,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.minMiddleAmountFee.token.mint.toString(),l,m,p,d,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((c=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?c:new is(0)),n.remainingAccounts)],instructionTypes:[_.RouteSwap],lookupTableAddress:[p.lookupTableAccount,d.lookupTableAccount].filter(y=>y!==void 0),address:{}}}else throw Error("route type error")}import vu from"bn.js";var as=new vu(1e6);function Rp(r,e,t){return r.mul(e).add(t).sub(new vu(1)).div(t)}function Fu(r,e,t){return r.mul(e).div(t)}var yi=class{static tradingFee(e,t){return Rp(e,t,as)}static protocolFee(e,t){return Fu(e,t,as)}static fundFee(e,t){return Fu(e,t,as)}};import Tr from"bn.js";function bi(r,e){if(e.isZero())throw Error("divisor is zero");return r.mod(e)}function Lp(r,e){if(e.isZero())throw Error("rhs is zero");let t=r.div(e);if(t.isZero())throw Error("quotient is zero");let n=bi(r,e);if(n.gt(Cn)){t=t.add(new Tr(1));let i=r.div(t);n=bi(r,t),n.gt(Cn)&&(i=i.add(new Tr(1)))}return[t,e]}var Cn=new Tr(0),gi=class{static swapWithoutFees(e,t,n){let i=t.mul(n),o=t.add(e),[s,a]=Lp(i,o),u=a.sub(t),c=n.sub(s);if(c.isZero())throw Error("destinationAmountSwapped is zero");return{sourceAmountSwapped:u,destinationAmountSwapped:c}}static lpTokensToTradingTokens(e,t,n,i,o){let s=e.mul(n).div(t),a=e.mul(i).div(t);if(o===0)return{tokenAmount0:s,tokenAmount1:a};if(o===1)return bi(e.mul(n),t).gt(Cn)&&s.gt(Cn)&&(s=s.add(new Tr(1))),bi(e.mul(i),t).gt(Cn)&&a.gt(Cn)&&(a=a.add(new Tr(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};var Wu=(t=>(t[t.Floor=0]="Floor",t[t.Ceiling=1]="Ceiling",t))(Wu||{}),Du=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,n,i){let o=yi.tradingFee(e,i),s=e.sub(o),{sourceAmountSwapped:a,destinationAmountSwapped:u}=gi.swapWithoutFees(s,t,n),c=a.add(o);return{newSwapSourceAmount:t.add(c),newSwapDestinationAmount:n.sub(u),sourceAmountSwapped:c,destinationAmountSwapped:u,tradeFee:o}}};var qu={[Ur.toBase58()]:3},Uu={3:Ur};var Op=L([me(5),me(8),B("ownAddress"),w("vaultSignerNonce"),B("baseMint"),B("quoteMint"),B("baseVault"),w("baseDepositsTotal"),w("baseFeesAccrued"),B("quoteVault"),w("quoteDepositsTotal"),w("quoteFeesAccrued"),w("quoteDustThreshold"),B("requestQueue"),B("eventQueue"),B("bids"),B("asks"),w("baseLotSize"),w("quoteLotSize"),w("feeRateBps"),w("referrerRebatesAccrued"),me(7)]),Gu={3:Op};import{PublicKey as Xu}from"@solana/web3.js";var wi=oe("Serum"),zu=class{static getProgramId(e){let t=Uu[e];return t||wi.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=qu[t];return n||wi.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=Gu[e];return t||wi.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],i=0,o;for(;i<100;){try{let s=n.concat(Buffer.from([i]),Buffer.alloc(7));o=Xu.createProgramAddressSync(s,e)}catch(s){if(s instanceof TypeError)throw s;i++;continue}return{publicKey:o,nonce:i}}return wi.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:Xu.default,nonce:i}}};var dK=r=>r;export{tb as ACCOUNT_TYPE_SIZE,Cb as ALL_PROGRAM_ID,_d as AMM_CONFIG_SEED,hl as AMM_STABLE,Qi as AMM_V4,Zp as ANAMint,Ee as API_URLS,gl as AccountType,jh as AmmConfigLayout,zr as Api,tu as BIT_PRECISION,Ut as BNDivCeil,nn as BNLayout,sy as BN_100,ay as BN_1000,uy as BN_10000,oy as BN_FIVE,_s as BN_ONE,$t as BN_TEN,iy as BN_THREE,ry as BN_TWO,Ie as BN_ZERO,Vg as BitStructure,na as Blob,Tl as CLMM_PROGRAM_ID,Ni as CLOCK_PROGRAM_ID,Rl as CREATE_CPMM_POOL_AUTH,Ll as CREATE_CPMM_POOL_FEE_ACC,Cl as CREATE_CPMM_POOL_PROGRAM,fr as Clmm,Te as ClmmInstrument,gi as ConstantProductCurve,Bu as CpmmConfigInfoLayout,yi as CpmmFee,Su as CpmmPoolInfoLayout,Vn as Currency,Jt as CurrencyAmount,Du as CurveCalculator,ng as DEV_API_URLS,Sb as DEV_CREATE_CPMM_POOL_AUTH,Kb as DEV_CREATE_CPMM_POOL_FEE_ACC,Bb as DEV_CREATE_CPMM_POOL_PROGRAM,Pd as DataElement,$p as ETHMint,Do as EXTENSION_TICKARRAY_BITMAP_SIZE,Ia as FARM_LOCK_MINT,xa as FARM_LOCK_VAULT,zi as FARM_PROGRAM_ID_V3,Yi as FARM_PROGRAM_ID_V5,kn as FARM_PROGRAM_ID_V6,bt as FARM_PROGRAM_TO_VERSION,Sa as FARM_VERSION_TO_LEDGER_LAYOUT,Ba as FARM_VERSION_TO_STATE_LAYOUT,ai as FEE_RATE_DENOMINATOR,as as FEE_RATE_DENOMINATOR_VALUE,Ud as FETCH_TICKARRAY_COUNT,qd as Fee,J as Fraction,Gn as IDO_ALL_PROGRAM,xl as IDO_PROGRAM_ID_V1,Bl as IDO_PROGRAM_ID_V2,Sl as IDO_PROGRAM_ID_V3,Kl as IDO_PROGRAM_ID_V4,Lr as INSTRUCTION_PROGRAM_ID,_ as InstructionType,Gr as JupTokenType,fu as LIQUIDITY_FEES_DENOMINATOR,pu as LIQUIDITY_FEES_NUMERATOR,jd as LIQUIDITY_VERSION_TO_SERUM_VERSION,dk as LIQUIDITY_VERSION_TO_STATE_LAYOUT,nu as LOG_B_2_X32,ru as LOG_B_P_ERR_MARGIN_LOWER_X64,iu as LOG_B_P_ERR_MARGIN_UPPER_X64,Dr as LOOKUP_TABLE_CACHE,Xn as Layout,ae as LiquidityMath,Hu as LogLevel,hi as Logger,Ho as MARKET_STATE_LAYOUT_V2,Op as MARKET_STATE_LAYOUT_V3,Gu as MARKET_VERSION_TO_STATE_LAYOUT,Us as MAX_BASE64_SIZE,St as MAX_SQRT_PRICE_X64,je as MAX_TICK,bn as MEMO_PROGRAM_ID,Ks as MEMO_PROGRAM_ID2,gn as METADATA_PROGRAM_ID,Bt as MIN_SQRT_PRICE_X64,Xe as MIN_TICK,xn as MODEL_DATA_PUBKEY,zu as Market,H as MathUtil,Wo as MaxU64,eu as MaxUint128,Vt as NEGATIVE_ONE,jp as NRVMint,rt as ONE,kl as OPEN_BOOK_PROGRAM,Wd as OPERATION_SEED,Uo as ObservationInfoLayout,zd as ObservationLayout,uu as OperationLayout,to as OptionLayout,ft as Owner,Up as PAIMint,Fd as POOL_REWARD_VAULT_SEED,Vd as POOL_SEED,Dd as POOL_TICK_ARRAY_BITMAP_SEED,Ed as POOL_VAULT_SEED,Za as POSITION_SEED,Ve as Percent,Zs as PoolFetchType,ui as PoolInfoLayout,ze as PoolUtils,ci as PositionInfoLayout,Qd as PositionRewardInfoLayout,mr as PositionUtils,qe as Price,Zh as ProtocolPositionLayout,si as Q128,it as Q64,qp as RAYMint,$e as RENT_PROGRAM_ID,fi as Raydium,Yd as RewardInfo,Wu as RoundDirection,Ei as Rounding,Il as Router,qu as SERUM_PROGRAMID_TO_VERSION,Ur as SERUM_PROGRAM_ID_V3,Uu as SERUM_VERSION_TO_PROGRAMID,$s as SESSION_KEY,Re as SOLMint,Pt as SOL_INFO,DP as SPL_MINT_LAYOUT,Gp as SRMMint,Hi as STORAGE_KEY,Cs as SYSTEM_PROGRAM_ID,Q as SqrtPriceMath,In as StableLayout,no as Structure,ln as SwapMath,cn as TICK_ARRAY_BITMAP_SIZE,vd as TICK_ARRAY_SEED,Oe as TICK_ARRAY_SIZE,vk as TICK_SPACINGS,Le as TOKEN_WSOL,Et as TickArrayBitmap,au as TickArrayBitmapExtensionLayout,lr as TickArrayBitmapExtensionUtils,cr as TickArrayLayout,Hd as TickLayout,mn as TickMath,ue as TickQuery,U as TickUtils,le as Token,Pe as TokenAmount,qr as TxBuilder,En as TxVersion,ur as U64Resolution,Dk as U64_IGNORE_RANGE,$i as UInt,Xp as USDCMint,Hp as USDHMint,zp as USDTMint,Pl as UTIL1216,ro as Union,ha as Voter,ed as VoterDepositEntry,Jm as VoterLockup,ka as VoterRegistrar,$m as VoterVotingMintConfig,$ as WSOLMint,Hr as WideBits,Nt as WrappedLayout,ce as ZERO,Ls as _100_PERCENT,P as accountMeta,Gf as add,Fr as addComputeBudget,Oo as addLiquidityLayout,kw as array,mo as associatedLedgerAccountLayout,Ji as bits,me as blob,ve as bool,xo as calFarmRewardAmount,Rp as ceilDiv,Fn as checkLegacyTxSize,vn as checkV0TxSize,Ui as chunkArray,Pr as claimLayout,Mt as closeAccountInstruction,Ri as commonSystemAccountMeta,Ra as createAssociatedLedgerAccountInstruction,oe as createLogger,Fa as createPoolFeeLayout,za as createPoolV4InstructionV2,mk as createPoolV4Layout,It as createWSolAccountInstructions,lw as cstr,Kf as currencyEquals,il as decimalToFraction,Km as decodeBool,Wf as div,Mr as divCeil,He as dwLayout,Cm as encodeBool,hg as endlessRetry,tl as eq,ow as f32,sw as f32be,aw as f64,uw as f64be,bo as farmAddRewardLayout,BA as farmLedgerLayoutV3_1,jn as farmLedgerLayoutV3_2,SA as farmLedgerLayoutV5_1,Aa as farmLedgerLayoutV5_2,Pa as farmLedgerLayoutV6_1,Ca as farmRewardInfoToConfig,fo as farmRewardLayout,yo as farmRewardRestartLayout,Zm as farmRewardTimeInfoLayout,ga as farmStateV3Layout,wa as farmStateV5Layout,Hn as farmStateV6Layout,$A as fetchMultipleFarmInfoAndUpdate,ST as fetchMultipleInfo,nb as fetchMultipleMintInfos,re as findProgramAddress,Co as fixedSwapInLayout,Ro as fixedSwapOutLayout,Fu as floorDiv,vr as forecastTransactionSize,Rd as formatLayout,Ge as generatePubKey,pe as getATAAddress,Ka as getAssociatedAuthority,zo as getAssociatedConfigId,et as getAssociatedLedgerAccount,$n as getAssociatedLedgerPoolAccount,ep as getAssociatedOpenOrders,bu as getAssociatedPoolKeys,cp as getCpmmPdaAmmConfigId,lp as getCpmmPdaPoolId,Au as getCreatePoolKeys,Qs as getDate,Bo as getDepositEntryIndex,qa as getDxByDyBaseIn,Da as getDyByDxBaseIn,zy as getEpochInfo,ti as getFarmLedgerLayout,td as getFarmStateLayout,tp as getLiquidityAssociatedAuthority,dn as getLiquidityAssociatedId,Bh as getLiquidityFromAmounts,Uf as getMax,kt as getMultipleAccountsInfo,Pn as getMultipleAccountsInfoWithCustomFlags,Gi as getMultipleLookupTableInfo,Vk as getPdaAmmConfigId,at as getPdaExBitmapAccount,mp as getPdaLpMint,oi as getPdaMetadataKey,mi as getPdaObservationId,ar as getPdaOperationAccount,st as getPdaPersonalPositionAddress,up as getPdaPoolAuthority,$a as getPdaPoolId,Ja as getPdaPoolRewardVaulId,vo as getPdaPoolVaultId,un as getPdaProtocolPositionAddress,ye as getPdaTickArrayAddress,wu as getPdaVault,An as getRecentBlockHash,Ao as getRegistrarAddress,Ml as getSessionKey,Ua as getStablePrice,Al as getTime,_y as getTimestamp,Io as getTokenOwnerRecordAddress,Vb as getTransferAmountFee,ge as getTransferAmountFeeV2,ho as getVoterAddress,To as getVoterWeightRecordAddress,ko as getVotingMintAuthority,Po as getVotingTokenMint,ld as governanceCreateTokenOwnerRecord,Eg as greedy,el as gt,vf as gte,ca as i128,Lk as i16ToBytes,ii as i32ToBytes,jr as i64,ua as i8,Lo as initPoolLayout,co as initTokenAccountInstruction,hp as initializeMarket,Ab as intersection,js as isDateAfter,Hs as isDateBefore,ol as isDecimal,qf as isMeaningfulNumber,Ys as isNumber,go as isValidFarmVersion,sr as isZero,de as jsonInfo2PoolKeys,JA as judgeFarmType,Eo as leadingZeros,ja as leastSignificantBit,gd as liquidityStateV4Layout,wd as liquidityStateV5Layout,Ef as lt,Ff as lte,Yp as mSOLMint,ri as makeAMMSwapInstruction,Xa as makeAddLiquidityInstruction,Ko as makeAddNewRewardInstruction,pi as makeClaimInstruction,es as makeClaimInstructionV4,ku as makeCreateCpmmPoolInInstruction,La as makeCreateFarmInstruction,Nu as makeCreateMarketInstruction,Oa as makeCreatorWithdrawFarmRewardInstruction,hu as makeDepositCpmmInInstruction,Na as makeDepositInstructionV3,Ma as makeDepositInstructionV5,_a as makeDepositInstructionV6,bP as makeDepositTokenInstruction,wP as makeDepositWithdrawInstruction,Ck as makeInitPoolInstructionV4,mB as makePurchaseInstruction,So as makeRestartRewardInstruction,Ya as makeSimulatePoolInfoInstruction,Iu as makeSwapCpmmBaseInInInstruction,xu as makeSwapCpmmBaseOutInInstruction,Nd as makeSwapFixedInInstruction,Md as makeSwapFixedOutInstruction,wS as makeSwapInstruction,Yn as makeTransferInstruction,Tu as makeWithdrawCpmmInInstruction,rr as makeWithdrawInstructionV3,nr as makeWithdrawInstructionV5,tr as makeWithdrawInstructionV6,gP as makeWithdrawTokenInstruction,tn as minExpirationTime,Wk as mockCreatePoolInfo,ou as mockV3CreatePoolInfo,kd as modelDataInfoLayout,Ha as mostSignificantBit,Wi as mul,Di as notInnerObject,$g as ns64,iw as ns64be,ra as nu64,zg as nu64be,eo as offset,Tb as offsetDateTime,bw as option,q as parseBigNumberish,Zt as parseNumberInfo,Xs as parseSimulateLogToJson,Ot as parseSimulateValue,ba as parseTokenAccountResp,HP as parseTokenInfo,Qt as poolTypeV6,en as printSimulate,B as publicKey,Zo as purchaseLayout,Qm as realFarmStateV3Layout,Hm as realFarmStateV5Layout,jm as realFarmV6Layout,Ms as recursivelyDecimalToFraction,Vo as removeLiquidityInstruction,No as removeLiquidityLayout,bS as route1Instruction,gS as route2Instruction,Cp as routeInstruction,Pw as rustEnum,Qg as s16,Jg as s16be,Hg as s24,ew as s24be,Fe as s32,tw as s32be,jg as s40,nw as s40be,Zg as s48,rw as s48be,Yg as s8,W as seq,Vp as setLoggerLevel,nl as shakeFractionDecimal,Gs as simulateMultipleInstruction,Kk as simulatePoolInfoInstruction,dl as simulateTransaction,Fs as sleep,wn as solToWSol,$P as solToWSolToken,Gt as splAccountLayout,Es as splitNumber,Qp as stSOLMint,Aw as str,L as struct,Df as sub,ww as tagged,Fi as tenExponential,rl as toBN,pl as toBuffer,Vs as toFraction,Vf as toFractionWithDecimals,cy as toPercent,Ea as toToken,ZP as toTokenAmount,jP as toTokenInfo,ly as toTokenPrice,my as toTotalPrice,Ns as toUsdCurrency,Fo as trailingZeros,Oi as tryParsePublicKey,X as u128,Tt as u16,Qa as u16ToBytes,Dg as u16be,Fg as u24,qg as u24be,Ue as u32,Ok as u32ToBytes,Ug as u32be,vg as u40,Gg as u40be,Wg as u48,Xg as u48be,w as u64,M as u8,hw as union,dK as unionArr,cw as unionLayoutDiscriminator,kb as uniq,nd as updateFarmPoolInfo,Xr as updateReqHistory,mw as utf8,Li as validateAndParsePublicKey,wo as validateFarmRewards,gw as vec,Rm as vecU8,dd as voterStakeRegistryCreateDepositEntry,md as voterStakeRegistryCreateVoter,ad as voterStakeRegistryDeposit,ud as voterStakeRegistryUpdateVoterWeightRecord,cd as voterStakeRegistryWithdraw,JP as wSolToSolToken,po as withdrawRewardLayout,Pb as xor,Tw as zeros};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map