import{createAssociatedTokenAccountInstruction as Nt,TOKEN_PROGRAM_ID as le,AccountLayout as ae,TOKEN_2022_PROGRAM_ID as lo}from"@solana/spl-token";import{PublicKey as et,SystemProgram as fo}from"@solana/web3.js";import{get as Et,set as Sn}from"lodash";import Dt from"dayjs";import In from"dayjs/plugin/utc";Dt.extend(In);var nt=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Dt().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},_t={},Ln={};function W(e){let t=Et(_t,e);if(!t){let n=Et(Ln,e);t=new nt({name:e,logLevel:n}),Sn(_t,e,t)}return t}import{PublicKey as bs}from"@solana/web3.js";import ws from"bn.js";import Mr from"big.js";import Ji from"bn.js";import H from"bn.js";var pe=9e15,re=1e9,rt="0123456789abcdef",Ee="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",_e="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ot={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-pe,maxE:pe,crypto:!1},vt,Q,k=!0,Me="[DecimalError] ",ne=Me+"Invalid argument: ",Ft=Me+"Precision limit exceeded",Wt=Me+"crypto unavailable",Vt="[object Decimal]",V=Math.floor,K=Math.pow,Cn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Nn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Rn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ut=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,z=1e7,P=7,En=9007199254740991,_n=Ee.length-1,it=_e.length-1,m={toStringTag:Vt};m.absoluteValue=m.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),T(e)};m.ceil=function(){return T(new this.constructor(this),this.e+1,2)};m.clampedTo=m.clamp=function(e,t){var n,r=this,o=r.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(ne+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new o(r)};m.comparedTo=m.cmp=function(e){var t,n,r,o,i=this,s=i.d,a=(e=new i.constructor(e)).d,u=i.s,c=e.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(i.e!==e.e)return i.e>e.e^u<0?1:-1;for(r=s.length,o=a.length,t=0,n=r<o?r:o;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^u<0?1:-1;return r===o?0:r>o^u<0?1:-1};m.cosine=m.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+P,r.rounding=1,n=Dn(r,zt(r,n)),r.precision=e,r.rounding=t,T(Q==2||Q==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};m.cubeRoot=m.cbrt=function(){var e,t,n,r,o,i,s,a,u,c,f=this,l=f.constructor;if(!f.isFinite()||f.isZero())return new l(f);for(k=!1,i=f.s*K(f.s*f,1/3),!i||Math.abs(i)==1/0?(n=v(f.d),e=f.e,(i=(e-n.length+1)%3)&&(n+=i==1||i==-2?"0":"00"),i=K(n,1/3),e=V((e+1)/3)-(e%3==(e<0?-1:2)),i==1/0?n="5e"+e:(n=i.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new l(n),r.s=f.s):r=new l(i.toString()),s=(e=l.precision)+3;;)if(a=r,u=a.times(a).times(a),c=u.plus(f),r=L(c.plus(f).times(a),c.plus(u),s+2,1),v(a.d).slice(0,s)===(n=v(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!o&&n=="4999"){if(!o&&(T(a,e+1,0),a.times(a).times(a).eq(f))){r=a;break}s+=4,o=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(T(r,e+1,1),t=!r.times(r).times(r).eq(f));break}return k=!0,T(r,e,l.rounding,t)};m.decimalPlaces=m.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-V(this.e/P))*P,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};m.dividedBy=m.div=function(e){return L(this,new this.constructor(e))};m.dividedToIntegerBy=m.divToInt=function(e){var t=this,n=t.constructor;return T(L(t,new n(e),0,1,1),n.precision,n.rounding)};m.equals=m.eq=function(e){return this.cmp(e)===0};m.floor=function(){return T(new this.constructor(this),this.e+1,3)};m.greaterThan=m.gt=function(e){return this.cmp(e)>0};m.greaterThanOrEqualTo=m.gte=function(e){var t=this.cmp(e);return t==1||t===0};m.hyperbolicCosine=m.cosh=function(){var e,t,n,r,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(e=Math.ceil(o/3),t=(1/Oe(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),i=de(s,1,i.times(t),new s(1),!0);for(var u,c=e,f=new s(8);c--;)u=i.times(i),i=a.minus(u.times(f.minus(u.times(f))));return T(i,s.precision=n,s.rounding=r,!0)};m.hyperbolicSine=m.sinh=function(){var e,t,n,r,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(t=i.precision,n=i.rounding,i.precision=t+Math.max(o.e,o.sd())+4,i.rounding=1,r=o.d.length,r<3)o=de(i,2,o,o,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,o=o.times(1/Oe(5,e)),o=de(i,2,o,o,!0);for(var s,a=new i(5),u=new i(16),c=new i(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(u.times(s).plus(c))))}return i.precision=t,i.rounding=n,T(o,t,n,!0)};m.hyperbolicTangent=m.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,L(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};m.inverseCosine=m.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),o=n.precision,i=n.rounding;return r!==-1?r===0?t.isNeg()?j(n,o,i):new n(0):new n(NaN):t.isZero()?j(n,o+4,i).times(.5):(n.precision=o+6,n.rounding=1,t=t.asin(),e=j(n,o+4,i).times(.5),n.precision=o,n.rounding=i,e.minus(t))};m.inverseHyperbolicCosine=m.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,k=!1,n=n.times(n).minus(1).sqrt().plus(n),k=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};m.inverseHyperbolicSine=m.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,k=!1,n=n.times(n).plus(1).sqrt().plus(n),k=!0,r.precision=e,r.rounding=t,n.ln())};m.inverseHyperbolicTangent=m.atanh=function(){var e,t,n,r,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=i.precision,t=i.rounding,r=o.sd(),Math.max(r,e)<2*-o.e-1?T(new i(o),e,t,!0):(i.precision=n=r-o.e,o=L(o.plus(1),new i(1).minus(o),n+e,1),i.precision=e+4,i.rounding=1,o=o.ln(),i.precision=e,i.rounding=t,o.times(.5))):new i(NaN)};m.inverseSine=m.asin=function(){var e,t,n,r,o=this,i=o.constructor;return o.isZero()?new i(o):(t=o.abs().cmp(1),n=i.precision,r=i.rounding,t!==-1?t===0?(e=j(i,n+4,r).times(.5),e.s=o.s,e):new i(NaN):(i.precision=n+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=n,i.rounding=r,o.times(2)))};m.inverseTangent=m.atan=function(){var e,t,n,r,o,i,s,a,u,c=this,f=c.constructor,l=f.precision,p=f.rounding;if(c.isFinite()){if(c.isZero())return new f(c);if(c.abs().eq(1)&&l+4<=it)return s=j(f,l+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new f(NaN);if(l+4<=it)return s=j(f,l+4,p).times(.5),s.s=c.s,s}for(f.precision=a=l+10,f.rounding=1,n=Math.min(28,a/P+2|0),e=n;e;--e)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(k=!1,t=Math.ceil(a/P),r=1,u=c.times(c),s=new f(c),o=c;e!==-1;)if(o=o.times(u),i=s.minus(o.div(r+=2)),o=o.times(u),s=i.plus(o.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===i.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),k=!0,T(s,f.precision=l,f.rounding=p,!0)};m.isFinite=function(){return!!this.d};m.isInteger=m.isInt=function(){return!!this.d&&V(this.e/P)>this.d.length-2};m.isNaN=function(){return!this.s};m.isNegative=m.isNeg=function(){return this.s<0};m.isPositive=m.isPos=function(){return this.s>0};m.isZero=function(){return!!this.d&&this.d[0]===0};m.lessThan=m.lt=function(e){return this.cmp(e)<0};m.lessThanOrEqualTo=m.lte=function(e){return this.cmp(e)<1};m.logarithm=m.log=function(e){var t,n,r,o,i,s,a,u,c=this,f=c.constructor,l=f.precision,p=f.rounding,d=5;if(e==null)e=new f(10),t=!0;else{if(e=new f(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new f(NaN);t=e.eq(10)}if(n=c.d,c.s<0||!n||!n[0]||c.eq(1))return new f(n&&!n[0]?-1/0:c.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)i=!0;else{for(o=n[0];o%10===0;)o/=10;i=o!==1}if(k=!1,a=l+d,s=te(c,a),r=t?De(f,a+10):te(e,a),u=L(s,r,a,1),be(u.d,o=l,p))do if(a+=10,s=te(c,a),r=t?De(f,a+10):te(e,a),u=L(s,r,a,1),!i){+v(u.d).slice(o+1,o+15)+1==1e14&&(u=T(u,l+1,0));break}while(be(u.d,o+=10,p));return k=!0,T(u,l,p)};m.minus=m.sub=function(e){var t,n,r,o,i,s,a,u,c,f,l,p,d=this,y=d.constructor;if(e=new y(e),!d.d||!e.d)return!d.s||!e.s?e=new y(NaN):d.d?e.s=-e.s:e=new y(e.d||d.s!==e.s?d:NaN),e;if(d.s!=e.s)return e.s=-e.s,d.plus(e);if(c=d.d,p=e.d,a=y.precision,u=y.rounding,!c[0]||!p[0]){if(p[0])e.s=-e.s;else if(c[0])e=new y(d);else return new y(u===3?-0:0);return k?T(e,a,u):e}if(n=V(e.e/P),f=V(d.e/P),c=c.slice(),i=f-n,i){for(l=i<0,l?(t=c,i=-i,s=p.length):(t=p,n=f,s=c.length),r=Math.max(Math.ceil(a/P),s)+2,i>r&&(i=r,t.length=1),t.reverse(),r=i;r--;)t.push(0);t.reverse()}else{for(r=c.length,s=p.length,l=r<s,l&&(s=r),r=0;r<s;r++)if(c[r]!=p[r]){l=c[r]<p[r];break}i=0}for(l&&(t=c,c=p,p=t,e.s=-e.s),s=c.length,r=p.length-s;r>0;--r)c[s++]=0;for(r=p.length;r>i;){if(c[--r]<p[r]){for(o=r;o&&c[--o]===0;)c[o]=z-1;--c[o],c[r]+=z}c[r]-=p[r]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(e.d=c,e.e=Ke(c,n),k?T(e,a,u):e):new y(u===3?-0:0)};m.modulo=m.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?T(new r(n),r.precision,r.rounding):(k=!1,r.modulo==9?(t=L(n,e.abs(),0,3,1),t.s*=e.s):t=L(n,e,0,r.modulo,1),t=t.times(e),k=!0,n.minus(t))};m.naturalExponential=m.exp=function(){return st(this)};m.naturalLogarithm=m.ln=function(){return te(this)};m.negated=m.neg=function(){var e=new this.constructor(this);return e.s=-e.s,T(e)};m.plus=m.add=function(e){var t,n,r,o,i,s,a,u,c,f,l=this,p=l.constructor;if(e=new p(e),!l.d||!e.d)return!l.s||!e.s?e=new p(NaN):l.d||(e=new p(e.d||l.s===e.s?l:NaN)),e;if(l.s!=e.s)return e.s=-e.s,l.minus(e);if(c=l.d,f=e.d,a=p.precision,u=p.rounding,!c[0]||!f[0])return f[0]||(e=new p(l)),k?T(e,a,u):e;if(i=V(l.e/P),r=V(e.e/P),c=c.slice(),o=i-r,o){for(o<0?(n=c,o=-o,s=f.length):(n=f,r=i,s=c.length),i=Math.ceil(a/P),s=i>s?i+1:s+1,o>s&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(s=c.length,o=f.length,s-o<0&&(o=s,n=f,f=c,c=n),t=0;o;)t=(c[--o]=c[o]+f[o]+t)/z|0,c[o]%=z;for(t&&(c.unshift(t),++r),s=c.length;c[--s]==0;)c.pop();return e.d=c,e.e=Ke(c,r),k?T(e,a,u):e};m.precision=m.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ne+e);return n.d?(t=qt(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};m.round=function(){var e=this,t=e.constructor;return T(new t(e),e.e+1,t.rounding)};m.sine=m.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+P,r.rounding=1,n=Kn(r,zt(r,n)),r.precision=e,r.rounding=t,T(Q>2?n.neg():n,e,t,!0)):new r(NaN)};m.squareRoot=m.sqrt=function(){var e,t,n,r,o,i,s=this,a=s.d,u=s.e,c=s.s,f=s.constructor;if(c!==1||!a||!a[0])return new f(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(k=!1,c=Math.sqrt(+s),c==0||c==1/0?(t=v(a),(t.length+u)%2==0&&(t+="0"),c=Math.sqrt(t),u=V((u+1)/2)-(u<0||u%2),c==1/0?t="5e"+u:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+u),r=new f(t)):r=new f(c.toString()),n=(u=f.precision)+3;;)if(i=r,r=i.plus(L(s,i,n+2,1)).times(.5),v(i.d).slice(0,n)===(t=v(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!o&&t=="4999"){if(!o&&(T(i,u+1,0),i.times(i).eq(s))){r=i;break}n+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(T(r,u+1,1),e=!r.times(r).eq(s));break}return k=!0,T(r,u,f.rounding,e)};m.tangent=m.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=L(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,T(Q==2||Q==4?n.neg():n,e,t,!0)):new r(NaN)};m.times=m.mul=function(e){var t,n,r,o,i,s,a,u,c,f=this,l=f.constructor,p=f.d,d=(e=new l(e)).d;if(e.s*=f.s,!p||!p[0]||!d||!d[0])return new l(!e.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?e.s/0:e.s*0);for(n=V(f.e/P)+V(e.e/P),u=p.length,c=d.length,u<c&&(i=p,p=d,d=i,s=u,u=c,c=s),i=[],s=u+c,r=s;r--;)i.push(0);for(r=c;--r>=0;){for(t=0,o=u+r;o>r;)a=i[o]+d[r]*p[o-r-1]+t,i[o--]=a%z|0,t=a/z|0;i[o]=(i[o]+t)%z|0}for(;!i[--s];)i.pop();return t?++n:i.shift(),e.d=i,e.e=Ke(i,n),k?T(e,l.precision,l.rounding):e};m.toBinary=function(e,t){return ct(this,2,e,t)};m.toDecimalPlaces=m.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(G(e,0,re),t===void 0?t=r.rounding:G(t,0,8),T(n,e+n.e+1,t))};m.toExponential=function(e,t){var n,r=this,o=r.constructor;return e===void 0?n=X(r,!0):(G(e,0,re),t===void 0?t=o.rounding:G(t,0,8),r=T(new o(r),e+1,t),n=X(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};m.toFixed=function(e,t){var n,r,o=this,i=o.constructor;return e===void 0?n=X(o):(G(e,0,re),t===void 0?t=i.rounding:G(t,0,8),r=T(new i(o),e+o.e+1,t),n=X(r,!1,e+r.e+1)),o.isNeg()&&!o.isZero()?"-"+n:n};m.toFraction=function(e){var t,n,r,o,i,s,a,u,c,f,l,p,d=this,y=d.d,g=d.constructor;if(!y)return new g(d);if(c=n=new g(1),r=u=new g(0),t=new g(r),i=t.e=qt(y)-d.e-1,s=i%P,t.d[0]=K(10,s<0?P+s:s),e==null)e=i>0?t:c;else{if(a=new g(e),!a.isInt()||a.lt(c))throw Error(ne+a);e=a.gt(t)?i>0?t:c:a}for(k=!1,a=new g(v(y)),f=g.precision,g.precision=i=y.length*P*2;l=L(a,t,0,1,1),o=n.plus(l.times(r)),o.cmp(e)!=1;)n=r,r=o,o=c,c=u.plus(l.times(o)),u=o,o=t,t=a.minus(l.times(o)),a=o;return o=L(e.minus(n),r,0,1,1),u=u.plus(o.times(c)),n=n.plus(o.times(r)),u.s=c.s=d.s,p=L(c,r,i,1).minus(d).abs().cmp(L(u,n,i,1).minus(d).abs())<1?[c,r]:[u,n],g.precision=f,k=!0,p};m.toHexadecimal=m.toHex=function(e,t){return ct(this,16,e,t)};m.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:G(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(k=!1,n=L(n,e,0,t,1).times(e),k=!0,T(n)):(e.s=n.s,n=e),n};m.toNumber=function(){return+this};m.toOctal=function(e,t){return ct(this,8,e,t)};m.toPower=m.pow=function(e){var t,n,r,o,i,s,a=this,u=a.constructor,c=+(e=new u(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new u(K(+a,c));if(a=new u(a),a.eq(1))return a;if(r=u.precision,i=u.rounding,e.eq(1))return T(a,r,i);if(t=V(e.e/P),t>=e.d.length-1&&(n=c<0?-c:c)<=En)return o=Gt(u,a,n,r),e.s<0?new u(1).div(o):T(o,r,i);if(s=a.s,s<0){if(t<e.d.length-1)return new u(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=K(+a,c),t=n==0||!isFinite(n)?V(c*(Math.log("0."+v(a.d))/Math.LN10+a.e+1)):new u(n+"").e,t>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(k=!1,u.rounding=a.s=1,n=Math.min(12,(t+"").length),o=st(e.times(te(a,r+n)),r),o.d&&(o=T(o,r+5,1),be(o.d,r,i)&&(t=r+10,o=T(st(e.times(te(a,t+n)),t),t+5,1),+v(o.d).slice(r+1,r+15)+1==1e14&&(o=T(o,r+1,0)))),o.s=s,k=!0,u.rounding=i,T(o,r,i))};m.toPrecision=function(e,t){var n,r=this,o=r.constructor;return e===void 0?n=X(r,r.e<=o.toExpNeg||r.e>=o.toExpPos):(G(e,1,re),t===void 0?t=o.rounding:G(t,0,8),r=T(new o(r),e,t),n=X(r,e<=r.e||r.e<=o.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};m.toSignificantDigits=m.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(G(e,1,re),t===void 0?t=r.rounding:G(t,0,8)),T(new r(n),e,t)};m.toString=function(){var e=this,t=e.constructor,n=X(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};m.truncated=m.trunc=function(){return T(new this.constructor(this),this.e+1,1)};m.valueOf=m.toJSON=function(){var e=this,t=e.constructor,n=X(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function v(e){var t,n,r,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)r=e[t]+"",n=P-r.length,n&&(i+=ee(n)),i+=r;s=e[t],r=s+"",n=P-r.length,n&&(i+=ee(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function G(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ne+e)}function be(e,t,n,r){var o,i,s,a;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=P,o=0):(o=Math.ceil((t+1)/P),t%=P),i=K(10,P-t),a=e[o]%i|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==i||n>3&&a+1==i/2)&&(e[o+1]/i/100|0)==K(10,t-2)-1||(a==i/2||a==0)&&(e[o+1]/i/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==i||!r&&n>3&&a+1==i/2)&&(e[o+1]/i/1e3|0)==K(10,t-3)-1,s}function Re(e,t,n){for(var r,o=[0],i,s=0,a=e.length;s<a;){for(i=o.length;i--;)o[i]*=t;for(o[0]+=rt.indexOf(e.charAt(s++)),r=0;r<o.length;r++)o[r]>n-1&&(o[r+1]===void 0&&(o[r+1]=0),o[r+1]+=o[r]/n|0,o[r]%=n)}return o.reverse()}function Dn(e,t){var n,r,o;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),o=(1/Oe(4,n)).toString()):(n=16,o="2.3283064365386962890625e-10"),e.precision+=n,t=de(e,1,t.times(o),new e(1));for(var i=n;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var L=function(){function e(r,o,i){var s,a=0,u=r.length;for(r=r.slice();u--;)s=r[u]*o+a,r[u]=s%i|0,a=s/i|0;return a&&r.unshift(a),r}function t(r,o,i,s){var a,u;if(i!=s)u=i>s?1:-1;else for(a=u=0;a<i;a++)if(r[a]!=o[a]){u=r[a]>o[a]?1:-1;break}return u}function n(r,o,i,s){for(var a=0;i--;)r[i]-=a,a=r[i]<o[i]?1:0,r[i]=a*s+r[i]-o[i];for(;!r[0]&&r.length>1;)r.shift()}return function(r,o,i,s,a,u){var c,f,l,p,d,y,g,w,h,b,x,A,R,I,_,D,U,Z,q,ce,fe=r.constructor,tt=r.s==o.s?1:-1,F=r.d,C=o.d;if(!F||!F[0]||!C||!C[0])return new fe(!r.s||!o.s||(F?C&&F[0]==C[0]:!C)?NaN:F&&F[0]==0||!C?tt*0:tt/0);for(u?(d=1,f=r.e-o.e):(u=z,d=P,f=V(r.e/d)-V(o.e/d)),q=C.length,U=F.length,h=new fe(tt),b=h.d=[],l=0;C[l]==(F[l]||0);l++);if(C[l]>(F[l]||0)&&f--,i==null?(I=i=fe.precision,s=fe.rounding):a?I=i+(r.e-o.e)+1:I=i,I<0)b.push(1),y=!0;else{if(I=I/d+2|0,l=0,q==1){for(p=0,C=C[0],I++;(l<U||p)&&I--;l++)_=p*u+(F[l]||0),b[l]=_/C|0,p=_%C|0;y=p||l<U}else{for(p=u/(C[0]+1)|0,p>1&&(C=e(C,p,u),F=e(F,p,u),q=C.length,U=F.length),D=q,x=F.slice(0,q),A=x.length;A<q;)x[A++]=0;ce=C.slice(),ce.unshift(0),Z=C[0],C[1]>=u/2&&++Z;do p=0,c=t(C,x,q,A),c<0?(R=x[0],q!=A&&(R=R*u+(x[1]||0)),p=R/Z|0,p>1?(p>=u&&(p=u-1),g=e(C,p,u),w=g.length,A=x.length,c=t(g,x,w,A),c==1&&(p--,n(g,q<w?ce:C,w,u))):(p==0&&(c=p=1),g=C.slice()),w=g.length,w<A&&g.unshift(0),n(x,g,A,u),c==-1&&(A=x.length,c=t(C,x,q,A),c<1&&(p++,n(x,q<A?ce:C,A,u))),A=x.length):c===0&&(p++,x=[0]),b[l++]=p,c&&x[0]?x[A++]=F[D]||0:(x=[F[D]],A=1);while((D++<U||x[0]!==void 0)&&I--);y=x[0]!==void 0}b[0]||b.shift()}if(d==1)h.e=f,vt=y;else{for(l=1,p=b[0];p>=10;p/=10)l++;h.e=l+f*d-1,T(h,a?i+h.e+1:i,s,y)}return h}}();function T(e,t,n,r){var o,i,s,a,u,c,f,l,p,d=e.constructor;e:if(t!=null){if(l=e.d,!l)return e;for(o=1,a=l[0];a>=10;a/=10)o++;if(i=t-o,i<0)i+=P,s=t,f=l[p=0],u=f/K(10,o-s-1)%10|0;else if(p=Math.ceil((i+1)/P),a=l.length,p>=a)if(r){for(;a++<=p;)l.push(0);f=u=0,o=1,i%=P,s=i-P+1}else break e;else{for(f=a=l[p],o=1;a>=10;a/=10)o++;i%=P,s=i-P+o,u=s<0?0:f/K(10,o-s-1)%10|0}if(r=r||t<0||l[p+1]!==void 0||(s<0?f:f%K(10,o-s-1)),c=n<4?(u||r)&&(n==0||n==(e.s<0?3:2)):u>5||u==5&&(n==4||r||n==6&&(i>0?s>0?f/K(10,o-s):0:l[p-1])%10&1||n==(e.s<0?8:7)),t<1||!l[0])return l.length=0,c?(t-=e.e+1,l[0]=K(10,(P-t%P)%P),e.e=-t||0):l[0]=e.e=0,e;if(i==0?(l.length=p,a=1,p--):(l.length=p+1,a=K(10,P-i),l[p]=s>0?(f/K(10,o-s)%K(10,s)|0)*a:0),c)for(;;)if(p==0){for(i=1,s=l[0];s>=10;s/=10)i++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(e.e++,l[0]==z&&(l[0]=1));break}else{if(l[p]+=a,l[p]!=z)break;l[p--]=0,a=1}for(i=l.length;l[--i]===0;)l.pop()}return k&&(e.e>d.maxE?(e.d=null,e.e=NaN):e.e<d.minE&&(e.e=0,e.d=[0])),e}function X(e,t,n){if(!e.isFinite())return jt(e);var r,o=e.e,i=v(e.d),s=i.length;return t?(n&&(r=n-s)>0?i=i.charAt(0)+"."+i.slice(1)+ee(r):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):o<0?(i="0."+ee(-o-1)+i,n&&(r=n-s)>0&&(i+=ee(r))):o>=s?(i+=ee(o+1-s),n&&(r=n-o-1)>0&&(i=i+"."+ee(r))):((r=o+1)<s&&(i=i.slice(0,r)+"."+i.slice(r)),n&&(r=n-s)>0&&(o+1===s&&(i+="."),i+=ee(r))),i}function Ke(e,t){var n=e[0];for(t*=P;n>=10;n/=10)t++;return t}function De(e,t,n){if(t>_n)throw k=!0,n&&(e.precision=n),Error(Ft);return T(new e(Ee),t,1,!0)}function j(e,t,n){if(t>it)throw Error(Ft);return T(new e(_e),t,n,!0)}function qt(e){var t=e.length-1,n=t*P+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function ee(e){for(var t="";e--;)t+="0";return t}function Gt(e,t,n,r){var o,i=new e(1),s=Math.ceil(r/P+4);for(k=!1;;){if(n%2&&(i=i.times(t),Kt(i.d,s)&&(o=!0)),n=V(n/2),n===0){n=i.d.length-1,o&&i.d[n]===0&&++i.d[n];break}t=t.times(t),Kt(t.d,s)}return k=!0,i}function Mt(e){return e.d[e.d.length-1]&1}function Ht(e,t,n){for(var r,o=new e(t[0]),i=0;++i<t.length;)if(r=new e(t[i]),r.s)o[n](r)&&(o=r);else{o=r;break}return o}function st(e,t){var n,r,o,i,s,a,u,c=0,f=0,l=0,p=e.constructor,d=p.rounding,y=p.precision;if(!e.d||!e.d[0]||e.e>17)return new p(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(k=!1,u=y):u=t,a=new p(.03125);e.e>-2;)e=e.times(a),l+=5;for(r=Math.log(K(2,l))/Math.LN10*2+5|0,u+=r,n=i=s=new p(1),p.precision=u;;){if(i=T(i.times(e),u,1),n=n.times(++f),a=s.plus(L(i,n,u,1)),v(a.d).slice(0,u)===v(s.d).slice(0,u)){for(o=l;o--;)s=T(s.times(s),u,1);if(t==null)if(c<3&&be(s.d,u-r,d,c))p.precision=u+=10,n=i=a=new p(1),f=0,c++;else return T(s,p.precision=y,d,k=!0);else return p.precision=y,s}s=a}}function te(e,t){var n,r,o,i,s,a,u,c,f,l,p,d=1,y=10,g=e,w=g.d,h=g.constructor,b=h.rounding,x=h.precision;if(g.s<0||!w||!w[0]||!g.e&&w[0]==1&&w.length==1)return new h(w&&!w[0]?-1/0:g.s!=1?NaN:w?0:g);if(t==null?(k=!1,f=x):f=t,h.precision=f+=y,n=v(w),r=n.charAt(0),Math.abs(i=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(e),n=v(g.d),r=n.charAt(0),d++;i=g.e,r>1?(g=new h("0."+n),i++):g=new h(r+"."+n.slice(1))}else return c=De(h,f+2,x).times(i+""),g=te(new h(r+"."+n.slice(1)),f-y).plus(c),h.precision=x,t==null?T(g,x,b,k=!0):g;for(l=g,u=s=g=L(g.minus(1),g.plus(1),f,1),p=T(g.times(g),f,1),o=3;;){if(s=T(s.times(p),f,1),c=u.plus(L(s,new h(o),f,1)),v(c.d).slice(0,f)===v(u.d).slice(0,f))if(u=u.times(2),i!==0&&(u=u.plus(De(h,f+2,x).times(i+""))),u=L(u,new h(d),f,1),t==null)if(be(u.d,f-y,b,a))h.precision=f+=y,c=s=g=L(l.minus(1),l.plus(1),f,1),p=T(g.times(g),f,1),o=a=1;else return T(u,h.precision=x,b,k=!0);else return h.precision=x,u;u=c,o+=2}}function jt(e){return String(e.s*e.s/0)}function at(e,t){var n,r,o;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(r,o),t){if(o-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%P,n<0&&(r+=P),r<o){for(r&&e.d.push(+t.slice(0,r)),o-=P;r<o;)e.d.push(+t.slice(r,r+=P));t=t.slice(r),r=P-t.length}else r-=o;for(;r--;)t+="0";e.d.push(+t),k&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Mn(e,t){var n,r,o,i,s,a,u,c,f;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Ut.test(t))return at(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Nn.test(t))n=16,t=t.toLowerCase();else if(Cn.test(t))n=2;else if(Rn.test(t))n=8;else throw Error(ne+t);for(i=t.search(/p/i),i>0?(u=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),i=t.indexOf("."),s=i>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,i=a-i,o=Gt(r,new r(n),i,i*2)),c=Re(t,n,z),f=c.length-1,i=f;c[i]===0;--i)c.pop();return i<0?new r(e.s*0):(e.e=Ke(c,f),e.d=c,k=!1,s&&(e=L(e,o,a*4)),u&&(e=e.times(Math.abs(u)<54?K(2,u):ve.pow(2,u))),k=!0,e)}function Kn(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:de(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/Oe(5,n)),t=de(e,2,t,t);for(var o,i=new e(5),s=new e(16),a=new e(20);n--;)o=t.times(t),t=t.times(i.plus(o.times(s.times(o).minus(a))));return t}function de(e,t,n,r,o){var i,s,a,u,c=1,f=e.precision,l=Math.ceil(f/P);for(k=!1,u=n.times(n),a=new e(r);;){if(s=L(a.times(u),new e(t++*t++),f,1),a=o?r.plus(s):r.minus(s),r=L(s.times(u),new e(t++*t++),f,1),s=a.plus(r),s.d[l]!==void 0){for(i=l;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=r,r=s,s=i,c++}return k=!0,s.d.length=l+1,s}function Oe(e,t){for(var n=e;--t;)n*=e;return n}function zt(e,t){var n,r=t.s<0,o=j(e,e.precision,1),i=o.times(.5);if(t=t.abs(),t.lte(i))return Q=r?4:1,t;if(n=t.divToInt(o),n.isZero())Q=r?3:2;else{if(t=t.minus(n.times(o)),t.lte(i))return Q=Mt(n)?r?2:3:r?4:1,t;Q=Mt(n)?r?1:4:r?3:2}return t.minus(o).abs()}function ct(e,t,n,r){var o,i,s,a,u,c,f,l,p,d=e.constructor,y=n!==void 0;if(y?(G(n,1,re),r===void 0?r=d.rounding:G(r,0,8)):(n=d.precision,r=d.rounding),!e.isFinite())f=jt(e);else{for(f=X(e),s=f.indexOf("."),y?(o=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):o=t,s>=0&&(f=f.replace(".",""),p=new d(1),p.e=f.length-s,p.d=Re(X(p),10,o),p.e=p.d.length),l=Re(f,10,o),i=u=l.length;l[--u]==0;)l.pop();if(!l[0])f=y?"0p+0":"0";else{if(s<0?i--:(e=new d(e),e.d=l,e.e=i,e=L(e,p,n,r,0,o),l=e.d,i=e.e,c=vt),s=l[n],a=o/2,c=c||l[n+1]!==void 0,c=r<4?(s!==void 0||c)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||c||r===6&&l[n-1]&1||r===(e.s<0?8:7)),l.length=n,c)for(;++l[--n]>o-1;)l[n]=0,n||(++i,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,f="";s<u;s++)f+=rt.charAt(l[s]);if(y){if(u>1)if(t==16||t==8){for(s=t==16?4:3,--u;u%s;u++)f+="0";for(l=Re(f,o,t),u=l.length;!l[u-1];--u);for(s=1,f="1.";s<u;s++)f+=rt.charAt(l[s])}else f=f.charAt(0)+"."+f.slice(1);f=f+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)f="0"+f;f="0."+f}else if(++i>u)for(i-=u;i--;)f+="0";else i<u&&(f=f.slice(0,i)+"."+f.slice(i))}f=(t==16?"0x":t==2?"0b":t==8?"0o":"")+f}return e.s<0?"-"+f:f}function Kt(e,t){if(e.length>t)return e.length=t,!0}function On(e){return new this(e).abs()}function vn(e){return new this(e).acos()}function Fn(e){return new this(e).acosh()}function Wn(e,t){return new this(e).plus(t)}function Vn(e){return new this(e).asin()}function Un(e){return new this(e).asinh()}function qn(e){return new this(e).atan()}function Gn(e){return new this(e).atanh()}function Hn(e,t){e=new this(e),t=new this(t);var n,r=this.precision,o=this.rounding,i=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=j(this,i,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?j(this,r,o):new this(0),n.s=e.s):!e.d||t.isZero()?(n=j(this,i,1).times(.5),n.s=e.s):t.s<0?(this.precision=i,this.rounding=1,n=this.atan(L(e,t,i,1)),t=j(this,i,1),this.precision=r,this.rounding=o,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(L(e,t,i,1)),n}function jn(e){return new this(e).cbrt()}function zn(e){return T(e=new this(e),e.e+1,2)}function Yn(e,t,n){return new this(e).clamp(t,n)}function Zn(e){if(!e||typeof e!="object")throw Error(Me+"Object expected");var t,n,r,o=e.defaults===!0,i=["precision",1,re,"rounding",0,8,"toExpNeg",-pe,0,"toExpPos",0,pe,"maxE",0,pe,"minE",-pe,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(n=i[t],o&&(this[n]=ot[n]),(r=e[n])!==void 0)if(V(r)===r&&r>=i[t+1]&&r<=i[t+2])this[n]=r;else throw Error(ne+n+": "+r);if(n="crypto",o&&(this[n]=ot[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Wt);else this[n]=!1;else throw Error(ne+n+": "+r);return this}function Xn(e){return new this(e).cos()}function Jn(e){return new this(e).cosh()}function Yt(e){var t,n,r;function o(i){var s,a,u,c=this;if(!(c instanceof o))return new o(i);if(c.constructor=o,Ot(i)){c.s=i.s,k?!i.d||i.e>o.maxE?(c.e=NaN,c.d=null):i.e<o.minE?(c.e=0,c.d=[0]):(c.e=i.e,c.d=i.d.slice()):(c.e=i.e,c.d=i.d?i.d.slice():i.d);return}if(u=typeof i,u==="number"){if(i===0){c.s=1/i<0?-1:1,c.e=0,c.d=[0];return}if(i<0?(i=-i,c.s=-1):c.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;k?s>o.maxE?(c.e=NaN,c.d=null):s<o.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[i]):(c.e=s,c.d=[i]);return}else if(i*0!==0){i||(c.s=NaN),c.e=NaN,c.d=null;return}return at(c,i.toString())}else if(u!=="string")throw Error(ne+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),c.s=-1):(a===43&&(i=i.slice(1)),c.s=1),Ut.test(i)?at(c,i):Mn(c,i)}if(o.prototype=m,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=Zn,o.clone=Yt,o.isDecimal=Ot,o.abs=On,o.acos=vn,o.acosh=Fn,o.add=Wn,o.asin=Vn,o.asinh=Un,o.atan=qn,o.atanh=Gn,o.atan2=Hn,o.cbrt=jn,o.ceil=zn,o.clamp=Yn,o.cos=Xn,o.cosh=Jn,o.div=Qn,o.exp=$n,o.floor=er,o.hypot=tr,o.ln=nr,o.log=rr,o.log10=ir,o.log2=or,o.max=sr,o.min=ar,o.mod=cr,o.mul=ur,o.pow=lr,o.random=fr,o.round=pr,o.sign=dr,o.sin=mr,o.sinh=gr,o.sqrt=hr,o.sub=br,o.sum=yr,o.tan=wr,o.tanh=xr,o.trunc=Tr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return o.config(e),o}function Qn(e,t){return new this(e).div(t)}function $n(e){return new this(e).exp()}function er(e){return T(e=new this(e),e.e+1,3)}function tr(){var e,t,n=new this(0);for(k=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return k=!0,new this(1/0);n=t}return k=!0,n.sqrt()}function Ot(e){return e instanceof ve||e&&e.toStringTag===Vt||!1}function nr(e){return new this(e).ln()}function rr(e,t){return new this(e).log(t)}function or(e){return new this(e).log(2)}function ir(e){return new this(e).log(10)}function sr(){return Ht(this,arguments,"lt")}function ar(){return Ht(this,arguments,"gt")}function cr(e,t){return new this(e).mod(t)}function ur(e,t){return new this(e).mul(t)}function lr(e,t){return new this(e).pow(t)}function fr(e){var t,n,r,o,i=0,s=new this(1),a=[];if(e===void 0?e=this.precision:G(e,1,re),r=Math.ceil(e/P),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));i<r;)o=t[i],o>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);i<r;)o=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((t[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,i):(a.push(o%1e7),i+=4);i=r/4}else throw Error(Wt);else for(;i<r;)a[i++]=Math.random()*1e7|0;for(r=a[--i],e%=P,r&&e&&(o=K(10,P-e),a[i]=(r/o|0)*o);a[i]===0;i--)a.pop();if(i<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=P)a.shift();for(r=1,o=a[0];o>=10;o/=10)r++;r<P&&(n-=P-r)}return s.e=n,s.d=a,s}function pr(e){return T(e=new this(e),e.e+1,this.rounding)}function dr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function mr(e){return new this(e).sin()}function gr(e){return new this(e).sinh()}function hr(e){return new this(e).sqrt()}function br(e,t){return new this(e).sub(t)}function yr(){var e=0,t=arguments,n=new this(t[e]);for(k=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return k=!0,T(n,this.precision,this.rounding)}function wr(e){return new this(e).tan()}function xr(e){return new this(e).tanh()}function Tr(e){return T(e=new this(e),e.e+1,1)}m[Symbol.for("nodejs.util.inspect.custom")]=m.toString;m[Symbol.toStringTag]="Decimal";var ve=m.constructor=Yt(ot);Ee=new ve(Ee);_e=new ve(_e);import{PublicKey as lt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Pr}from"@solana/spl-token";import{PublicKey as E,SystemProgram as Zt,SYSVAR_RENT_PUBKEY as Ar}from"@solana/web3.js";function ut({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var To=[ut({pubkey:Pr,isWritable:!1}),ut({pubkey:Zt.programId,isWritable:!1}),ut({pubkey:Ar,isWritable:!1})];function Xt({publicKey:e,transformSol:t}){let n=Jt(e.toString());if(n instanceof E)return t&&n.equals(ye)?oe:n;if(t&&n.toString()===ye.toBase58())return oe;if(typeof n=="string"){if(n===E.default.toBase58())return E.default;try{return new E(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Jt(e){try{return new E(e)}catch{return e}}var Po=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ao=new E("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ko=new E("SysvarRent111111111111111111111111111111111"),Bo=new E("SysvarC1ock11111111111111111111111111111111"),So=new E("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Io=new E("Sysvar1nstructions1111111111111111111111111"),Lo=Zt.programId,Co=new E("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),No=new E("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ro=new E("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Eo=new E("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),_o=new E("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Do=new E("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Mo=new E("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ko=new E("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Oo=new E("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),vo=new E("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Fo=new E("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),oe=new E("So11111111111111111111111111111111111111112"),ye=E.default;import{PublicKey as kr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Qt}from"@solana/spl-token";var $t={chainId:101,address:kr.default.toBase58(),programId:Qt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},$={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Qt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ft=class{constructor({mint:t,decimals:n,symbol:r,name:o,skipMint:i=!1,isToken2022:s=!1}){if(t===ye.toBase58()||t instanceof lt&&ye.equals(t)){this.decimals=$.decimals,this.symbol=$.symbol,this.name=$.name,this.mint=new lt($.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=o||t.toString().substring(0,6),this.mint=i?lt.default:Xt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},me=ft;me.WSOL=new ft({...$,mint:$.address});import We from"big.js";import Ir from"bn.js";import Lr from"decimal.js-light";import Br from"toformat";var Sr=Br,we=Sr;var Fe=W("module/fraction"),pt=we(We),xe=we(Lr),Cr={[0]:xe.ROUND_DOWN,[1]:xe.ROUND_HALF_UP,[2]:xe.ROUND_UP},Nr={[0]:We.roundDown,[1]:We.roundHalfUp,[2]:We.roundUp},N=class{constructor(t,n=new Ir(1)){this.numerator=J(t),this.denominator=J(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(t){let n=t instanceof N?t:new N(J(t));return this.denominator.eq(n.denominator)?new N(this.numerator.add(n.numerator),this.denominator):new N(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof N?t:new N(J(t));return this.denominator.eq(n.denominator)?new N(this.numerator.sub(n.numerator),this.denominator):new N(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof N?t:new N(J(t));return new N(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof N?t:new N(J(t));return new N(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Fe.logWithError(`${t} is not an integer.`),t<=0&&Fe.logWithError(`${t} is not positive.`),xe.set({precision:t+1,rounding:Cr[r]});let o=new xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Fe.logWithError(`${t} is not an integer.`),t<0&&Fe.logWithError(`${t} is negative.`),pt.DP=t,pt.RM=Nr[r]||1,new pt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var fi=W("Raydium_price");var dt=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},Ve=dt;Ve.SOL=new dt($t);import Er from"bn.js";var wi=new N(new Er(100));var _r=new H(0),Fi=new H(1),Wi=new H(2),Vi=new H(3),Ui=new H(5),Dr=new H(10),qi=new H(100),Gi=new H(1e3),Hi=new H(1e4),rn=9007199254740991;function J(e){let t=W("Raydium_parseBigNumberish");if(e instanceof H)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new H(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=rn||e<=-rn)&&t.logWithError(`BigNumberish number overflow: ${e}`),new H(String(e))):typeof e=="bigint"?new H(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new H(0))}var is=W("Raydium_amount"),ss=we(Mr);import{PublicKey as Ae,sendAndConfirmTransaction as bt,Transaction as ke,TransactionMessage as Be,VersionedTransaction as Se}from"@solana/web3.js";import Ur from"axios";var O={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as Kr,ComputeBudgetProgram as on,Transaction as an,TransactionMessage as Or,Keypair as cn,VersionedTransaction as un}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vr}from"@solana/spl-token";var sn=W("Raydium_txUtil"),ln=1644;function Ue(e){let t=[],n=[];return e.microLamports&&(t.push(on.setComputeUnitPrice({microLamports:e.microLamports})),n.push(O.SetComputeUnitPrice)),e.units&&(t.push(on.setComputeUnitLimit({units:e.units})),n.push(O.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function ge(e){var t,n;try{return((n=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:n.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}function Fr(e,t){e.length<1&&sn.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&sn.logWithError(`no signers provided:, ${t.toString()}`);let n=new an;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<ln}catch{return!1}}function fn(e,t){let[n,r]=Kr.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}function Te({instructions:e,payer:t,signers:n}){return Fr(e,[t,...n])}function Pe({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=cn.generate().publicKey.toString()}){let i=new Or({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new un(i).serialize()).toString("base64").length<ln}catch{return!1}}var Wr=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e);function ue(e){let t=[];return e.forEach(n=>{n instanceof an&&(n.recentBlockhash||(n.recentBlockhash=vr.toBase58()),n.feePayer||(n.feePayer=cn.generate().publicKey));let r=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof un&&(r=Wr(r));let o=r.toString("base64");t.push(o)}),console.log("simulate tx string:",t),t}import{PublicKey as dn,AddressLookupTableAccount as qe}from"@solana/web3.js";import{PublicKey as Vr}from"@solana/web3.js";import{getTransferFeeConfig as vs,unpackMint as Fs}from"@solana/spl-token";var mt=W("Raydium_accountInfo_util");async function pn(e,t,n){let{batchRequest:r,commitment:o="confirmed"}={batchRequest:!1,...n},i=gt(t,100),s=new Array(i.length).fill([]);if(r){let a=i.map(f=>{let l=e._buildArgs([f.map(p=>p.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:l}}),u=gt(a,10);s=(await(await Promise.all(u.map(async f=>await e._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(l=>{if(l){let{data:p,executable:d,lamports:y,owner:g,rentEpoch:w}=l;return p.length!==2&&p[1]!=="base64"&&mt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:d,lamports:y,owner:new Vr(g),rentEpoch:w}}return null})))}else try{s=await Promise.all(i.map(a=>e.getMultipleAccountsInfo(a,o)))}catch(a){a instanceof Error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function ht({connection:e,address:t}){let n=await pn(e,[...new Set(t.map(o=>o.toString()))].map(o=>new dn(o))),r={};for(let o=0;o<t.length;o++){let i=n[o],s=t[o];if(!i)continue;let a=new qe({key:s,state:qe.deserialize(i.data)});r[s.toString()]=a,Ge[s.toString()]=a}return r}var Ge={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new qe({key:new dn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:qe.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var He=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Ur.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=Ue(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==Ae.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0({...n||{}}):this.build(n)}build(t){let n=new ke;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var a;let{recentBlockHash:o,skipPreflight:i=!0}=r||{},s=o!=null?o:await ge(this.connection);if(n.recentBlockhash=s,this.signers.length&&n.sign(...this.signers),ue([n]),(a=this.owner)!=null&&a.isKeyPair)return{txId:await bt(this.connection,n,this.signers.find(u=>u.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:i}),signedTx:n};if(this.signAllTransactions){let u=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:i}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:o}=this.build(r),i=n.filter(c=>c.transaction.instructions.length>0),s=[o,...i.map(c=>c.transaction)],a=[this.signers,...i.map(c=>c.signers)],u=[...this.instructionTypes,...i.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var g;let{sequentially:f,onTxUpdate:l,recentBlockHash:p,skipPreflight:d=!0}=c||{},y=p!=null?p:await ge(this.connection);if((g=this.owner)!=null&&g.isKeyPair)return{txIds:await await Promise.all(s.map(async(w,h)=>(w.recentBlockhash=y,await bt(this.connection,w,a[h].find(b=>b.publicKey.equals(this.owner.publicKey))?a[h]:[...a[h],this.owner.signer],{skipPreflight:d})))),signedTxs:s};if(this.signAllTransactions){let w=s.map((b,x)=>(b.recentBlockhash=y,a[x].length&&b.sign(...a[x]),b));ue(w);let h=await this.signAllTransactions(w);if(f){let b=0,x=[],A=async()=>{if(!h[b])return;let R=await this.connection.sendRawTransaction(h[b].serialize(),{skipPreflight:d});x.push({txId:R,status:"sent",signedTx:h[b]}),l==null||l([...x]),b++,this.connection.onSignature(R,I=>{let _=x.findIndex(D=>D.txId===R);_>-1&&(x[_].status=I.err?"error":"success"),l==null||l([...x]),I.err||A()},"processed"),this.connection.getSignatureStatus(R)};return await A(),{txIds:x.map(R=>R.txId),signedTxs:h}}else{let b=[];for(let x=0;x<h.length;x+=1){let A=await this.connection.sendRawTransaction(h[x].serialize(),{skipPreflight:d});b.push(A)}return{txIds:b,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){let{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:o,...i}=t||{},s={...this.cluster==="devnet"?{}:Ge,...n},a=Array.from(new Set([...r,...this.lookupTableAddress])),u=[];for(let p of a)s[p]===void 0&&u.push(new Ae(p));let c=await ht({connection:this.connection,address:u});for(let[p,d]of Object.entries(c))s[p]=d;let f=new Be({payerKey:this.feePayer,recentBlockhash:o?Ae.default.toBase58():await ge(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),l=new Se(f);return l.sign(this.signers),{builder:this,transaction:l,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async p=>{var g;let{recentBlockHash:d,skipPreflight:y=!0}=p||{};if(d&&(l.message.recentBlockhash=d),ue([l]),(g=this.owner)!=null&&g.isKeyPair){this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))||l.sign([this.owner.signer]);let w=await this.connection.sendTransaction(l,{skipPreflight:y}),{lastValidBlockHeight:h,blockhash:b}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:b,lastValidBlockHeight:h,signature:w},"confirmed"),{txId:w,signedTx:l}}if(this.signAllTransactions){let w=await this.signAllTransactions([l]);return{txId:await this.connection.sendTransaction(w[0],{skipPreflight:y}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildV0MultiTx(t){let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:o}=await this.buildV0(r),i=n.filter(c=>c.builder.instructions.length>0),s=[o,...i.map(c=>c.transaction)],a=[this.signers,...i.map(c=>c.signers)],u=[...this.instructionTypes,...i.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,f)=>{c.sign(a[f])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:r,execute:async c=>{var y;let{sequentially:f,onTxUpdate:l,recentBlockHash:p,skipPreflight:d=!0}=c||{};if(p&&s.forEach(g=>g.message.recentBlockhash=p),ue(s),(y=this.owner)!=null&&y.isKeyPair){let{lastValidBlockHeight:g,blockhash:w}=await this.connection.getLatestBlockhash();return s.forEach((h,b)=>{a[b].find(x=>x.publicKey.equals(this.owner.publicKey))||h.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async h=>{let b=await this.connection.sendTransaction(h,{skipPreflight:d});return await this.connection.confirmTransaction({blockhash:w,lastValidBlockHeight:g,signature:b},"confirmed"),b})),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(f){let w=0,h=[],b=async()=>{if(!g[w])return;let x=await this.connection.sendTransaction(g[w],{skipPreflight:d});h.push({txId:x,status:"sent",signedTx:g[w]}),l==null||l([...h]),w++,this.connection.onSignature(x,A=>{let R=h.findIndex(I=>I.txId===x);R>-1&&(h[R].status=A.err?"error":"success"),l==null||l([...h]),A.err||b()},"processed"),this.connection.getSignatureStatus(x)};return b(),{txIds:[],signedTxs:g}}else{let w=[];for(let h=0;h<g.length;h+=1){let b=await this.connection.sendTransaction(g[h],{skipPreflight:d});w.push(b)}return{txIds:w,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){let{computeBudgetConfig:n,...r}=t||{},o=n?Ue(n):{instructions:[],instructionTypes:[]},i=this.signers.reduce((c,f)=>({...c,[f.publicKey.toBase58()]:f}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(c=>{let f=[...u,c],l=n?[...o.instructions,...f]:f,d=[...new Set(f.map(y=>y.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(y=>new Ae(y));if(u.length<12&&Te({instructions:l,payer:this.feePayer,signers:d})||Te({instructions:f,payer:this.feePayer,signers:d}))u.push(c);else{if(u.length===0)throw Error("item ins too big");Te({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:d})?s.push(new ke().add(...o.instructions,...u)):s.push(new ke().add(...u)),a.push(Array.from(new Set(u.map(y=>y.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(y=>i[y]).filter(y=>y!==void 0)),u=[c]}}),u.length>0){let f=[...new Set(u.map(l=>l.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(l=>i[l]).filter(l=>l!==void 0);Te({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:f.map(l=>l.publicKey)})?s.push(new ke().add(...o.instructions,...u)):s.push(new ke().add(...u)),a.push(f)}return s.forEach(c=>c.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async c=>{var g;let{sequentially:f,onTxUpdate:l,recentBlockHash:p,skipPreflight:d=!0}=c||{},y=p!=null?p:await ge(this.connection);if(s.forEach(async(w,h)=>{w.recentBlockhash=y,a[h].length&&w.sign(...a[h])}),ue(s),(g=this.owner)!=null&&g.isKeyPair)return{txIds:await Promise.all(s.map(async(w,h)=>await bt(this.connection,w,a[h].find(b=>b.publicKey.equals(this.owner.publicKey))?a[h]:[...a[h],this.owner.signer],{skipPreflight:d}))),signedTxs:s};if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(f){let h=0,b=[],x=async()=>{if(!w[h])return;let A=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:d});b.push({txId:A,status:"sent",signedTx:w[h]}),l==null||l([...b]),h++,this.connection.onSignature(A,R=>{let I=b.findIndex(_=>_.txId===A);I>-1&&(b[I].status=R.err?"error":"success"),l==null||l([...b]),R.err||x()},"processed"),this.connection.getSignatureStatus(A)};return await x(),{txIds:b.map(A=>A.txId),signedTxs:w}}else{let h=[];for(let b=0;b<w.length;b+=1){let x=await this.connection.sendRawTransaction(w[b].serialize(),{skipPreflight:d});h.push(x)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){let{computeBudgetConfig:n,lookupTableCache:r={},lookupTableAddress:o=[],...i}=t||{},s={...this.cluster==="devnet"?{}:Ge,...r},a=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let w of a)s[w]===void 0&&u.push(new Ae(w));let c=await ht({connection:this.connection,address:u});for(let[w,h]of Object.entries(c))s[w]=h;let f=n?Ue(n):{instructions:[],instructionTypes:[]},l=await ge(this.connection),p=this.signers.reduce((w,h)=>({...w,[h.publicKey.toBase58()]:h}),{}),d=[],y=[],g=[];if(this.allInstructions.forEach(w=>{let h=[...g,w],b=n?[...f.instructions,...h]:h;if(g.length<12&&Pe({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s})||Pe({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(w);else{if(g.length===0)throw Error("item ins too big");let x={};for(let A of[...new Set(a)])s[A]!==void 0&&(x[A]=s[A]);if(n&&Pe({instructions:[...f.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let A=new Be({payerKey:this.feePayer,recentBlockhash:l,instructions:[...f.instructions,...g]}).compileToV0Message(Object.values(s));d.push(new Se(A))}else{let A=new Be({payerKey:this.feePayer,recentBlockhash:l,instructions:[...g]}).compileToV0Message(Object.values(s));d.push(new Se(A))}y.push(Array.from(new Set(g.map(A=>A.keys.filter(R=>R.isSigner).map(R=>R.pubkey.toString())).flat())).map(A=>p[A]).filter(A=>A!==void 0)),g=[w]}}),g.length>0){let h=[...new Set(g.map(b=>b.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(b=>p[b]).filter(b=>b!==void 0);if(n&&Pe({instructions:[...f.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let b=new Be({payerKey:this.feePayer,recentBlockhash:l,instructions:[...f.instructions,...g]}).compileToV0Message(Object.values(s));d.push(new Se(b))}else{let b=new Be({payerKey:this.feePayer,recentBlockhash:l,instructions:[...g]}).compileToV0Message(Object.values(s));d.push(new Se(b))}y.push(h)}return{builder:this,transactions:d,buildProps:t,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var R;let{sequentially:h,onTxUpdate:b,recentBlockHash:x,skipPreflight:A=!0}=w||{};if(d.map(async(I,_)=>{y[_].length&&I.sign(y[_]),x&&(I.message.recentBlockhash=x)}),ue(d),(R=this.owner)!=null&&R.isKeyPair){let{lastValidBlockHeight:I,blockhash:_}=await this.connection.getLatestBlockhash();return d.forEach((D,U)=>{y[U].find(Z=>Z.publicKey.equals(this.owner.publicKey))||D.sign([this.owner.signer])}),{txIds:await Promise.all(d.map(async D=>{let U=await this.connection.sendTransaction(D,{skipPreflight:A});return await this.connection.confirmTransaction({blockhash:_,lastValidBlockHeight:I,signature:U},"confirmed"),U})),signedTxs:d}}if(this.signAllTransactions){let I=await this.signAllTransactions(d);if(h){let _=0,D=[],U=async()=>{if(!I[_])return;let Z=await this.connection.sendTransaction(I[_],{skipPreflight:A});D.push({txId:Z,status:"sent",signedTx:I[_]}),b==null||b([...D]),_++,this.connection.onSignature(Z,q=>{let ce=D.findIndex(fe=>fe.txId===Z);ce>-1&&(D[ce].status=q.err?"error":"success"),b==null||b([...D]),q.err||U()},"processed"),this.connection.getSignatureStatus(Z)};return U(),{txIds:[],signedTxs:I}}else{let _=[];for(let D=0;D<I.length;D+=1){let U=await this.connection.sendTransaction(I[D],{skipPreflight:A});_.push(U)}return{txIds:_,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};function gt(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as M}from"@solana/web3.js";var ca=new M("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ua=new M("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),la=new M("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),fa=new M("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pa=new M("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),da=new M("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ma=new M("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ga=new M("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ha=new M("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ba=new M("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ya=new M("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),wa=new M("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),xa=new M("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ta=new M("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Pa=new M("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Aa=new M("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ka=new M("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ba=new M("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Sa=new M("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Ia=new M("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as qr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gr}from"@solana/spl-token";function je(e,t,n){return fn([e.toBuffer(),(n!=null?n:Gr).toBuffer(),t.toBuffer()],new qr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Da from"bn.js";var yt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),Ie=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=W(n)}createTxBuilder(t){return this.scope.checkOwner(),new He({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(yt(t))}logInfo(...t){this.logger.info(yt(t))}logAndCreateError(...t){let n=yt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{createInitializeAccountInstruction as oo,createCloseAccountInstruction as io,createTransferInstruction as so,TOKEN_PROGRAM_ID as he}from"@solana/spl-token";import{PublicKey as ao,SystemProgram as co}from"@solana/web3.js";import uo from"bn.js";import{PublicKey as An,Keypair as eo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as to}from"@solana/spl-token";import no from"bn.js";import{PublicKey as Zr}from"@solana/web3.js";import gn,{isBN as ru}from"bn.js";import{bits as oc,BitStructure as ic,blob as Hr,Blob as sc,cstr as ac,f32 as cc,f32be as uc,f64 as lc,f64be as fc,greedy as pc,Layout as jr,ns64 as dc,ns64be as mc,nu64 as gc,nu64be as hc,offset as bc,s16 as yc,s16be as wc,s24 as xc,s24be as Tc,s32 as Pc,s32be as Ac,s40 as kc,s40be as Bc,s48 as Sc,s48be as Ic,s8 as Lc,seq as Cc,struct as Nc,Structure as zr,u16 as Rc,u16be as Ec,u24 as _c,u24be as Dc,u32 as Mc,u32be as Kc,u40 as Oc,u40be as vc,u48 as Fc,u48be as Wc,u8 as Vc,UInt as Yr,union as Uc,Union as qc,unionLayoutDiscriminator as Gc,utf8 as Hc}from"@solana/buffer-layout";var wt=jr,mn=zr;var xt=Yr;var Tt=Hr;var Pt=class extends wt{constructor(n,r,o){super(n,o);this.blob=Tt(n),this.signed=r}decode(n,r=0){let o=new gn(this.blob.decode(n,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(n,r,o=0){return typeof n=="number"&&(n=new gn(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,o)}};function hn(e){return new xt(1,e)}function ze(e){return new xt(4,e)}function Ye(e){return new Pt(8,!1,e)}var At=class extends wt{constructor(n,r,o,i){super(n.span,i);this.layout=n,this.decoder=r,this.encoder=o}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,o){return this.layout.encode(this.encoder(n),r,o)}getSpan(n,r){return this.layout.getSpan(n,r)}};function Le(e){return new At(Tt(32),t=>new Zr(t),t=>t.toBuffer(),e)}var kt=class extends mn{decode(t,n){return super.decode(t,n)}};function bn(e,t,n){return new kt(e,t,n)}var Ce=bn([Le("mint"),Le("owner"),Ye("amount"),ze("delegateOption"),Le("delegate"),hn("state"),ze("isNativeOption"),Ye("isNative"),Ye("delegatedAmount"),ze("closeAuthorityOption"),Le("closeAuthority")]);function Xr(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Bt(e,...t){if(!Xr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function St(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function yn(e,t){Bt(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Xe=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Y=(e,t)=>e<<32-t|e>>>t;var fu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Jr(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function It(e){return typeof e=="string"&&(e=Jr(e)),Bt(e),e}var Ze=class{clone(){return this._cloneInto()}},pu={}.toString;function wn(e){let t=r=>e().update(It(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Qr(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),u=r?4:0,c=r?0:4;e.setUint32(t+u,s,r),e.setUint32(t+c,a,r)}var xn=(e,t,n)=>e&t^~e&n,Tn=(e,t,n)=>e&t^e&n^t&n,Je=class extends Ze{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Xe(this.buffer)}update(t){St(this);let{view:n,buffer:r,blockLen:o}=this;t=It(t);let i=t.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let u=Xe(t);for(;o<=i-s;s+=o)this.process(u,s);continue}r.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){St(this),yn(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:i}=this,{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;Qr(r,o-8,BigInt(this.length*8),i),this.process(r,0);let a=Xe(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)a.setUint32(4*l,f[l],i)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:a}=this;return t.length=o,t.pos=a,t.finished=i,t.destroyed=s,o%n&&t.buffer.set(r),t}};var $r=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ie=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),se=new Uint32Array(64),Lt=class extends Je{constructor(){super(64,32,8,!1),this.A=ie[0]|0,this.B=ie[1]|0,this.C=ie[2]|0,this.D=ie[3]|0,this.E=ie[4]|0,this.F=ie[5]|0,this.G=ie[6]|0,this.H=ie[7]|0}get(){let{A:t,B:n,C:r,D:o,E:i,F:s,G:a,H:u}=this;return[t,n,r,o,i,s,a,u]}set(t,n,r,o,i,s,a,u){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=u|0}process(t,n){for(let l=0;l<16;l++,n+=4)se[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){let p=se[l-15],d=se[l-2],y=Y(p,7)^Y(p,18)^p>>>3,g=Y(d,17)^Y(d,19)^d>>>10;se[l]=g+se[l-7]+y+se[l-16]|0}let{A:r,B:o,C:i,D:s,E:a,F:u,G:c,H:f}=this;for(let l=0;l<64;l++){let p=Y(a,6)^Y(a,11)^Y(a,25),d=f+p+xn(a,u,c)+$r[l]+se[l]|0,g=(Y(r,2)^Y(r,13)^Y(r,22))+Tn(r,o,i)|0;f=c,c=u,u=a,a=s+d|0,s=i,i=o,o=r,r=d+g|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(r,o,i,s,a,u,c,f)}roundClean(){se.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Pn=wn(()=>new Lt);var Cu=W("Raydium_Util");function kn({owner:e,solAccountResp:t,tokenAccountResp:n}){let r=[],o=[];for(let{pubkey:i,account:s}of n.value){let a=Ce.decode(s.data),{mint:u,amount:c}=a;r.push({publicKey:i,mint:u,amount:c,isAssociated:je(e,u,s.owner).publicKey.equals(i),isNative:!1,programId:s.owner}),o.push({pubkey:i,accountInfo:a,programId:s.owner})}return t&&r.push({mint:An.default,amount:new no(t.lamports),isNative:!0,programId:t.owner}),{tokenAccounts:r,tokenAccountRawInfos:o}}function Qe({fromPublicKey:e,programId:t=to}){let n=eo.generate().publicKey.toBase58().slice(0,32);return{publicKey:ro(e,n,t),seed:n}}function ro(e,t,n){let r=Buffer.concat([e.toBuffer(),Buffer.from(t),n.toBuffer()]),o=Pn(r);return new An(o)}function Ct(e){let{mint:t,tokenAccount:n,owner:r,programId:o=he}=e;return oo(n,t,r,o)}function Ne(e){let{tokenAccount:t,payer:n,multiSigners:r=[],owner:o,programId:i=he}=e;return io(t,n,o,r,i)}async function $e(e){let{connection:t,amount:n,commitment:r,payer:o,owner:i,skipCloseAccount:s}=e,a=await t.getMinimumBalanceForRentExemption(Ce.span,r),u=J(n).add(new uo(a)),c=Qe({fromPublicKey:o,programId:he});return{addresses:{newAccount:c.publicKey},signers:[],instructions:[co.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:c.seed,newAccountPubkey:c.publicKey,lamports:u.toNumber(),space:Ce.span,programId:he}),Ct({mint:new ao($.address),tokenAccount:c.publicKey,owner:i,programId:he})],instructionTypes:[O.CreateAccount,O.InitAccount],endInstructionTypes:s?[]:[O.CloseAccount],endInstructions:s?[]:[Ne({tokenAccount:c.publicKey,payer:o,owner:i})]}}function Bn({source:e,destination:t,owner:n,amount:r,multiSigners:o=[],tokenProgram:i=he}){return so(e,t,n,BigInt(String(r)),o,i)}var Rt=class extends Ie{constructor(n){super(n);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;let{tokenAccounts:r,tokenAccountRawInfos:o}=n;this._tokenAccounts=r||[],this._tokenAccountRawInfos=o||[],this._clientOwnedToken=!!(r||o)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:n,tokenAccountRawInfos:r}){return n&&(this._tokenAccounts=n),r&&(this._tokenAccountRawInfos=r),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(n){return this._accountListener.push(n),this}removeAccountChangeListener(n){return this._accountListener=this._accountListener.filter(r=>r!==n),this}getAssociatedTokenAccount(n,r){return je(this.scope.ownerPubKey,n,r).publicKey}async fetchWalletTokenAccounts(n){if(this._clientOwnedToken||!(n!=null&&n.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let o={...{},...n},[i,s,a]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:le},o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:lo},o.commitment)]),{tokenAccounts:u,tokenAccountRawInfos:c}=kn({owner:this.scope.ownerPubKey,solAccountResp:i,tokenAccountResp:{context:s.context,value:[...s.value,...a.value]}});return this._tokenAccounts=u,this._tokenAccountRawInfos=c,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),"confirmed"),{tokenAccounts:u,tokenAccountRawInfos:c}}async getCreatedTokenAccount({mint:n,programId:r=le,associatedOnly:o=!0}){await this.fetchWalletTokenAccounts();let i=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(n)).sort((a,u)=>a.amount.lt(u.amount)?1:-1),s=this.getAssociatedTokenAccount(n,r);for(let a of i){let{publicKey:u}=a;if(u&&(!o||o&&s.equals(u)))return u}}async getOrCreateTokenAccount(n){var y,g,w;await this.fetchWalletTokenAccounts();let{mint:r,createInfo:o,associatedOnly:i,owner:s,notUseTokenAccount:a=!1,skipCloseAccount:u=!1,checkCreateATAOwner:c=!1}=n,f=new et(n.tokenProgram||le),l=this.getAssociatedTokenAccount(r,new et(f)),p=(a?[]:this.tokenAccountRawInfos).filter(h=>h.accountInfo.mint.equals(r)&&(!i||h.pubkey.equals(l))).sort((h,b)=>h.accountInfo.amount.lt(b.accountInfo.amount)?1:-1);if(o===void 0||p.length>0)return p.length>0?{account:p[0].pubkey}:{};let d={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(i){let h=Nt(s,l,s,r,f);if(c){let b=await this.scope.connection.getAccountInfo(l);if(b===null)(y=d.instructions)==null||y.push(h),d.instructionTypes.push(O.CreateATA);else if(!(b.owner.equals(f)&&ae.decode(b.data).mint.equals(r)&&ae.decode(b.data).owner.equals(s)))throw Error(`create ata check error -> mint: ${r.toString()}, ata: ${l.toString()}`)}else d.instructions.push(h),d.instructionTypes.push(O.CreateATA);if(r.equals(oe)&&o.amount){let b=await $e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:o.payer||this.scope.ownerPubKey,amount:(g=o.amount)!=null?g:0,skipCloseAccount:u});d.instructions.push(...b.instructions||[]),d.endInstructions.push(...b.endInstructions||[]),d.instructionTypes.push(...b.instructionTypes||[]),d.endInstructionTypes.push(...b.endInstructionTypes||[]),o.amount&&(d.instructions.push(Bn({source:b.addresses.newAccount,destination:l,owner:this.scope.ownerPubKey,amount:o.amount,tokenProgram:le})),d.instructionTypes.push(O.TransferAmount))}return u||(d.endInstructions.push(Ne({owner:s,payer:o.payer||s,tokenAccount:l,programId:f})),d.endInstructionTypes.push(O.CloseAccount)),{account:l,instructionParams:d}}else if(r.equals(oe)){let h=await $e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:o.payer||this.scope.ownerPubKey,amount:(w=o.amount)!=null?w:0,skipCloseAccount:u});return d.instructions.push(...h.instructions||[]),d.endInstructions.push(...h.endInstructions||[]),d.signers.push(...h.signers||[]),d.instructionTypes.push(...h.instructionTypes||[]),d.endInstructionTypes.push(...h.endInstructionTypes||[]),{account:h.addresses.newAccount,instructionParams:d}}else{let h=Qe({fromPublicKey:s,programId:f}),b=await this.scope.connection.getMinimumBalanceForRentExemption(ae.span),x=fo.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:h.seed,newAccountPubkey:h.publicKey,lamports:b,space:ae.span,programId:f});return d.instructions.push(x,Ct({mint:r,tokenAccount:h.publicKey,owner:this.scope.ownerPubKey,programId:f})),d.instructionTypes.push(O.CreateAccount),d.instructionTypes.push(O.InitAccount),u||(d.endInstructions.push(Ne({owner:s,payer:o.payer||s,tokenAccount:h.publicKey,programId:f})),d.endInstructionTypes.push(O.CloseAccount)),{account:h.publicKey,instructionParams:d}}}async checkOrCreateAta({mint:n,programId:r=le,autoUnwrapWSOLToSOL:o}){var u;await this.fetchWalletTokenAccounts();let i=(u=this.scope.account.tokenAccounts.find(({mint:c})=>(c==null?void 0:c.toBase58())===n.toBase58()))==null?void 0:u.publicKey,s=this.scope.ownerPubKey,a={};if(!i){let c=this.getAssociatedTokenAccount(n,r),f=await Nt(s,c,s,n,r);a.instructions=[f],a.instructionTypes=[O.CreateATA],i=c}return o&&oe.toBase58()===n.toBase58()&&(a.endInstructions=[Ne({owner:s,payer:s,tokenAccount:i,programId:r})],a.endInstructionTypes=[O.CloseAccount]),{pubKey:i,newInstructions:a}}async handleTokenAccount(n){let{side:r,amount:o,mint:i,programId:s=le,tokenAccount:a,payer:u=this.scope.ownerPubKey,bypassAssociatedCheck:c,skipCloseAccount:f,checkCreateATAOwner:l}=n,p=this.getAssociatedTokenAccount(i,s);if(new et(oe).equals(i)){let d=await $e({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:u,amount:o,skipCloseAccount:f});return{tokenAccount:d.addresses.newAccount,...d}}else if(!a||r==="out"&&!p.equals(a)&&!c){let d=[],y=Nt(this.scope.ownerPubKey,p,this.scope.ownerPubKey,i,s);if(l){let g=await this.scope.connection.getAccountInfo(p);if(g===null)d.push(y);else if(!(g.owner.equals(s)&&ae.decode(g.data).mint.equals(i)&&ae.decode(g.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${i.toString()}, ata: ${p.toString()}
          ataInfo.owner: ${g.owner.toString()}, programId: ${s.toString()},
          ataInfo.data.mint: ${ae.decode(g.data).mint.toString()}, mint: ${i.toString()},
          ataInfo.data.owner: ${ae.decode(g.data).owner.toString()}, owner: ${this.scope.ownerPubKey.toString()}`)}else d.push(y);return{tokenAccount:p,instructions:d,instructionTypes:[O.CreateATA]}}return{tokenAccount:a}}async processTokenAccount(n){let{mint:r,programId:o=le,amount:i,useSOLBalance:s,handleTokenAccount:a}=n,u,c=this.createTxBuilder();if(r.equals(new et(oe))&&s){let{tokenAccount:f,...l}=await this.handleTokenAccount({side:"in",amount:i||0,mint:r,bypassAssociatedCheck:!0,programId:o});u=f,c.addInstruction(l)}else if(u=await this.getCreatedTokenAccount({mint:r,associatedOnly:!1,programId:o}),!u&&a){let{tokenAccount:f,...l}=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:r,bypassAssociatedCheck:!0,programId:o});u=f,c.addInstruction(l)}return{tokenAccount:u,...c.AllTxData}}};export{Rt as default};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.mjs.map