import{get as Nt,set as gn}from"lodash";import Ct from"dayjs";import hn from"dayjs/plugin/utc";Ct.extend(hn);var $e=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Ct().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},St={},bn={};function Z(t){let e=Nt(St,t);if(!e){let n=Nt(bn,t);e=new $e({name:t,logLevel:n}),gn(St,t,e)}return e}import{PublicKey as is}from"@solana/web3.js";import ss from"bn.js";import Br from"big.js";import vo from"bn.js";import z from"bn.js";var Te=9e15,fe=1e9,et="0123456789abcdef",De="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ve="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",tt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Te,maxE:Te,crypto:!1},Ft,ae,y=!0,qe="[DecimalError] ",de=qe+"Invalid argument: ",Mt=qe+"Precision limit exceeded",_t=qe+"crypto unavailable",Ot="[object Decimal]",U=Math.floor,_=Math.pow,yn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,wn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Tn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Dt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,te=1e7,h=7,xn=9007199254740991,An=De.length-1,nt=ve.length-1,f={toStringTag:Ot};f.absoluteValue=f.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),g(t)};f.ceil=function(){return g(new this.constructor(this),this.e+1,2)};f.clampedTo=f.clamp=function(t,e){var n,r=this,i=r.constructor;if(t=new i(t),e=new i(e),!t.s||!e.s)return new i(NaN);if(t.gt(e))throw Error(de+e);return n=r.cmp(t),n<0?t:r.cmp(e)>0?e:new i(r)};f.comparedTo=f.cmp=function(t){var e,n,r,i,o=this,s=o.d,a=(t=new o.constructor(t)).d,c=o.s,u=t.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==t.e)return o.e>t.e^c<0?1:-1;for(r=s.length,i=a.length,e=0,n=r<i?r:i;e<n;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};f.cosine=f.cos=function(){var t,e,n=this,r=n.constructor;return n.d?n.d[0]?(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+h,r.rounding=1,n=kn(r,Vt(r,n)),r.precision=t,r.rounding=e,g(ae==2||ae==3?n.neg():n,t,e,!0)):new r(1):new r(NaN)};f.cubeRoot=f.cbrt=function(){var t,e,n,r,i,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(y=!1,o=l.s*_(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=K(l.d),t=l.e,(o=(t-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=_(n,1/3),t=U((t+1)/3)-(t%3==(t<0?-1:2)),o==1/0?n="5e"+t:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+t),r=new m(n),r.s=l.s):r=new m(o.toString()),s=(t=m.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=P(u.plus(l).times(a),u.plus(c),s+2,1),K(a.d).slice(0,s)===(n=K(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(g(a,t+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(g(r,t+1,1),e=!r.times(r).times(r).eq(l));break}return y=!0,g(r,t,m.rounding,e)};f.decimalPlaces=f.dp=function(){var t,e=this.d,n=NaN;if(e){if(t=e.length-1,n=(t-U(this.e/h))*h,t=e[t],t)for(;t%10==0;t/=10)n--;n<0&&(n=0)}return n};f.dividedBy=f.div=function(t){return P(this,new this.constructor(t))};f.dividedToIntegerBy=f.divToInt=function(t){var e=this,n=e.constructor;return g(P(e,new n(t),0,1,1),n.precision,n.rounding)};f.equals=f.eq=function(t){return this.cmp(t)===0};f.floor=function(){return g(new this.constructor(this),this.e+1,3)};f.greaterThan=f.gt=function(t){return this.cmp(t)>0};f.greaterThanOrEqualTo=f.gte=function(t){var e=this.cmp(t);return e==1||e===0};f.hyperbolicCosine=f.cosh=function(){var t,e,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(t=Math.ceil(i/3),e=(1/Ve(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),o=xe(s,1,o.times(e),new s(1),!0);for(var c,u=t,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return g(o,s.precision=n,s.rounding=r,!0)};f.hyperbolicSine=f.sinh=function(){var t,e,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,n=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=xe(o,2,i,i,!0);else{t=1.4*Math.sqrt(r),t=t>16?16:t|0,i=i.times(1/Ve(5,t)),i=xe(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);t--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=n,g(i,e,n,!0)};f.hyperbolicTangent=f.tanh=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+7,r.rounding=1,P(n.sinh(),n.cosh(),r.precision=t,r.rounding=e)):new r(n.s)};f.inverseCosine=f.acos=function(){var t,e=this,n=e.constructor,r=e.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?e.isNeg()?ee(n,i,o):new n(0):new n(NaN):e.isZero()?ee(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,e=e.asin(),t=ee(n,i+4,o).times(.5),n.precision=i,n.rounding=o,t.minus(e))};f.inverseHyperbolicCosine=f.acosh=function(){var t,e,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(t=r.precision,e=r.rounding,r.precision=t+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,y=!1,n=n.times(n).minus(1).sqrt().plus(n),y=!0,r.precision=t,r.rounding=e,n.ln()):new r(n)};f.inverseHyperbolicSine=f.asinh=function(){var t,e,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,y=!1,n=n.times(n).plus(1).sqrt().plus(n),y=!0,r.precision=t,r.rounding=e,n.ln())};f.inverseHyperbolicTangent=f.atanh=function(){var t,e,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(t=o.precision,e=o.rounding,r=i.sd(),Math.max(r,t)<2*-i.e-1?g(new o(i),t,e,!0):(o.precision=n=r-i.e,i=P(i.plus(1),new o(1).minus(i),n+t,1),o.precision=t+4,o.rounding=1,i=i.ln(),o.precision=t,o.rounding=e,i.times(.5))):new o(NaN)};f.inverseSine=f.asin=function(){var t,e,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),n=o.precision,r=o.rounding,e!==-1?e===0?(t=ee(o,n+4,r).times(.5),t.s=i.s,t):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};f.inverseTangent=f.atan=function(){var t,e,n,r,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=nt)return s=ee(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=nt)return s=ee(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,n=Math.min(28,a/h+2|0),t=n;t;--t)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(y=!1,e=Math.ceil(a/h),r=1,c=u.times(u),s=new l(u),i=u;t!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===o.d[t]&&t--;);return n&&(s=s.times(2<<n-1)),y=!0,g(s,l.precision=m,l.rounding=d,!0)};f.isFinite=function(){return!!this.d};f.isInteger=f.isInt=function(){return!!this.d&&U(this.e/h)>this.d.length-2};f.isNaN=function(){return!this.s};f.isNegative=f.isNeg=function(){return this.s<0};f.isPositive=f.isPos=function(){return this.s>0};f.isZero=function(){return!!this.d&&this.d[0]===0};f.lessThan=f.lt=function(t){return this.cmp(t)<0};f.lessThanOrEqualTo=f.lte=function(t){return this.cmp(t)<1};f.logarithm=f.log=function(t){var e,n,r,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(t==null)t=new l(10),e=!0;else{if(t=new l(t),n=t.d,t.s<0||!n||!n[0]||t.eq(1))return new l(NaN);e=t.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(e)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(y=!1,a=m+p,s=me(u,a),r=e?Ke(l,a+10):me(t,a),c=P(s,r,a,1),Be(c.d,i=m,d))do if(a+=10,s=me(u,a),r=e?Ke(l,a+10):me(t,a),c=P(s,r,a,1),!o){+K(c.d).slice(i+1,i+15)+1==1e14&&(c=g(c,m+1,0));break}while(Be(c.d,i+=10,d));return y=!0,g(c,m,d)};f.minus=f.sub=function(t){var e,n,r,i,o,s,a,c,u,l,m,d,p=this,w=p.constructor;if(t=new w(t),!p.d||!t.d)return!p.s||!t.s?t=new w(NaN):p.d?t.s=-t.s:t=new w(t.d||p.s!==t.s?p:NaN),t;if(p.s!=t.s)return t.s=-t.s,p.plus(t);if(u=p.d,d=t.d,a=w.precision,c=w.rounding,!u[0]||!d[0]){if(d[0])t.s=-t.s;else if(u[0])t=new w(p);else return new w(c===3?-0:0);return y?g(t,a,c):t}if(n=U(t.e/h),l=U(p.e/h),u=u.slice(),o=l-n,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,n=l,s=u.length),r=Math.max(Math.ceil(a/h),s)+2,o>r&&(o=r,e.length=1),e.reverse(),r=o;r--;)e.push(0);e.reverse()}else{for(r=u.length,s=d.length,m=r<s,m&&(s=r),r=0;r<s;r++)if(u[r]!=d[r]){m=u[r]<d[r];break}o=0}for(m&&(e=u,u=d,d=e,t.s=-t.s),s=u.length,r=d.length-s;r>0;--r)u[s++]=0;for(r=d.length;r>o;){if(u[--r]<d[r]){for(i=r;i&&u[--i]===0;)u[i]=te-1;--u[i],u[r]+=te}u[r]-=d[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(t.d=u,t.e=Ge(u,n),y?g(t,a,c):t):new w(c===3?-0:0)};f.modulo=f.mod=function(t){var e,n=this,r=n.constructor;return t=new r(t),!n.d||!t.s||t.d&&!t.d[0]?new r(NaN):!t.d||n.d&&!n.d[0]?g(new r(n),r.precision,r.rounding):(y=!1,r.modulo==9?(e=P(n,t.abs(),0,3,1),e.s*=t.s):e=P(n,t,0,r.modulo,1),e=e.times(t),y=!0,n.minus(e))};f.naturalExponential=f.exp=function(){return rt(this)};f.naturalLogarithm=f.ln=function(){return me(this)};f.negated=f.neg=function(){var t=new this.constructor(this);return t.s=-t.s,g(t)};f.plus=f.add=function(t){var e,n,r,i,o,s,a,c,u,l,m=this,d=m.constructor;if(t=new d(t),!m.d||!t.d)return!m.s||!t.s?t=new d(NaN):m.d||(t=new d(t.d||m.s===t.s?m:NaN)),t;if(m.s!=t.s)return t.s=-t.s,m.minus(t);if(u=m.d,l=t.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(t=new d(m)),y?g(t,a,c):t;if(o=U(m.e/h),r=U(t.e/h),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/h),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),e=0;i;)e=(u[--i]=u[i]+l[i]+e)/te|0,u[i]%=te;for(e&&(u.unshift(e),++r),s=u.length;u[--s]==0;)u.pop();return t.d=u,t.e=Ge(u,r),y?g(t,a,c):t};f.precision=f.sd=function(t){var e,n=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(de+t);return n.d?(e=vt(n.d),t&&n.e+1>e&&(e=n.e+1)):e=NaN,e};f.round=function(){var t=this,e=t.constructor;return g(new e(t),t.e+1,e.rounding)};f.sine=f.sin=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+h,r.rounding=1,n=Bn(r,Vt(r,n)),r.precision=t,r.rounding=e,g(ae>2?n.neg():n,t,e,!0)):new r(NaN)};f.squareRoot=f.sqrt=function(){var t,e,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(y=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=K(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=U((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),r=new l(e)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(P(s,o,n+2,1)).times(.5),K(o.d).slice(0,n)===(e=K(r.d)).slice(0,n))if(e=e.slice(n-3,n+1),e=="9999"||!i&&e=="4999"){if(!i&&(g(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(g(r,c+1,1),t=!r.times(r).eq(s));break}return y=!0,g(r,c,l.rounding,t)};f.tangent=f.tan=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+10,r.rounding=1,n=n.sin(),n.s=1,n=P(n,new r(1).minus(n.times(n)).sqrt(),t+10,0),r.precision=t,r.rounding=e,g(ae==2||ae==4?n.neg():n,t,e,!0)):new r(NaN)};f.times=f.mul=function(t){var e,n,r,i,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(t=new m(t)).d;if(t.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!t.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?t.s/0:t.s*0);for(n=U(l.e/h)+U(t.e/h),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(e=0,i=c+r;i>r;)a=o[i]+p[r]*d[i-r-1]+e,o[i--]=a%te|0,e=a/te|0;o[i]=(o[i]+e)%te|0}for(;!o[--s];)o.pop();return e?++n:o.shift(),t.d=o,t.e=Ge(o,n),y?g(t,m.precision,m.rounding):t};f.toBinary=function(t,e){return ot(this,2,t,e)};f.toDecimalPlaces=f.toDP=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(X(t,0,fe),e===void 0?e=r.rounding:X(e,0,8),g(n,t+n.e+1,e))};f.toExponential=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=ne(r,!0):(X(t,0,fe),e===void 0?e=i.rounding:X(e,0,8),r=g(new i(r),t+1,e),n=ne(r,!0,t+1)),r.isNeg()&&!r.isZero()?"-"+n:n};f.toFixed=function(t,e){var n,r,i=this,o=i.constructor;return t===void 0?n=ne(i):(X(t,0,fe),e===void 0?e=o.rounding:X(e,0,8),r=g(new o(i),t+i.e+1,e),n=ne(r,!1,t+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};f.toFraction=function(t){var e,n,r,i,o,s,a,c,u,l,m,d,p=this,w=p.d,b=p.constructor;if(!w)return new b(p);if(u=n=new b(1),r=c=new b(0),e=new b(r),o=e.e=vt(w)-p.e-1,s=o%h,e.d[0]=_(10,s<0?h+s:s),t==null)t=o>0?e:u;else{if(a=new b(t),!a.isInt()||a.lt(u))throw Error(de+a);t=a.gt(e)?o>0?e:u:a}for(y=!1,a=new b(K(w)),l=b.precision,b.precision=o=w.length*h*2;m=P(a,e,0,1,1),i=n.plus(m.times(r)),i.cmp(t)!=1;)n=r,r=i,i=u,u=c.plus(m.times(i)),c=i,i=e,e=a.minus(m.times(i)),a=i;return i=P(t.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=p.s,d=P(u,r,o,1).minus(p).abs().cmp(P(c,n,o,1).minus(p).abs())<1?[u,r]:[c,n],b.precision=l,y=!0,d};f.toHexadecimal=f.toHex=function(t,e){return ot(this,16,t,e)};f.toNearest=function(t,e){var n=this,r=n.constructor;if(n=new r(n),t==null){if(!n.d)return n;t=new r(1),e=r.rounding}else{if(t=new r(t),e===void 0?e=r.rounding:X(e,0,8),!n.d)return t.s?n:t;if(!t.d)return t.s&&(t.s=n.s),t}return t.d[0]?(y=!1,n=P(n,t,0,e,1).times(t),y=!0,g(n)):(t.s=n.s,n=t),n};f.toNumber=function(){return+this};f.toOctal=function(t,e){return ot(this,8,t,e)};f.toPower=f.pow=function(t){var e,n,r,i,o,s,a=this,c=a.constructor,u=+(t=new c(t));if(!a.d||!t.d||!a.d[0]||!t.d[0])return new c(_(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,t.eq(1))return g(a,r,o);if(e=U(t.e/h),e>=t.d.length-1&&(n=u<0?-u:u)<=xn)return i=Kt(c,a,n,r),t.s<0?new c(1).div(i):g(i,r,o);if(s=a.s,s<0){if(e<t.d.length-1)return new c(NaN);if((t.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=_(+a,u),e=n==0||!isFinite(n)?U(u*(Math.log("0."+K(a.d))/Math.LN10+a.e+1)):new c(n+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(y=!1,c.rounding=a.s=1,n=Math.min(12,(e+"").length),i=rt(t.times(me(a,r+n)),r),i.d&&(i=g(i,r+5,1),Be(i.d,r,o)&&(e=r+10,i=g(rt(t.times(me(a,e+n)),e),e+5,1),+K(i.d).slice(r+1,r+15)+1==1e14&&(i=g(i,r+1,0)))),i.s=s,y=!0,c.rounding=o,g(i,r,o))};f.toPrecision=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=ne(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(X(t,1,fe),e===void 0?e=i.rounding:X(e,0,8),r=g(new i(r),t,e),n=ne(r,t<=r.e||r.e<=i.toExpNeg,t)),r.isNeg()&&!r.isZero()?"-"+n:n};f.toSignificantDigits=f.toSD=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(X(t,1,fe),e===void 0?e=r.rounding:X(e,0,8)),g(new r(n),t,e)};f.toString=function(){var t=this,e=t.constructor,n=ne(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+n:n};f.truncated=f.trunc=function(){return g(new this.constructor(this),this.e+1,1)};f.valueOf=f.toJSON=function(){var t=this,e=t.constructor,n=ne(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+n:n};function K(t){var e,n,r,i=t.length-1,o="",s=t[0];if(i>0){for(o+=s,e=1;e<i;e++)r=t[e]+"",n=h-r.length,n&&(o+=le(n)),o+=r;s=t[e],r=s+"",n=h-r.length,n&&(o+=le(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function X(t,e,n){if(t!==~~t||t<e||t>n)throw Error(de+t)}function Be(t,e,n,r){var i,o,s,a;for(o=t[0];o>=10;o/=10)--e;return--e<0?(e+=h,i=0):(i=Math.ceil((e+1)/h),e%=h),o=_(10,h-e),a=t[i]%o|0,r==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(t[i+1]/o/100|0)==_(10,e-2)-1||(a==o/2||a==0)&&(t[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(t[i+1]/o/1e3|0)==_(10,e-3)-1,s}function Oe(t,e,n){for(var r,i=[0],o,s=0,a=t.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=et.indexOf(t.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function kn(t,e){var n,r,i;if(e.isZero())return e;r=e.d.length,r<32?(n=Math.ceil(r/3),i=(1/Ve(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),t.precision+=n,e=xe(t,1,e.times(i),new t(1));for(var o=n;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=n,e}var P=function(){function t(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function e(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,m,d,p,w,b,v,L,J,k,G,Re,se,je,Fe,Pe,Qe,$,Me,_e=r.constructor,Je=r.s==i.s?1:-1,V=r.d,N=i.d;if(!V||!V[0]||!N||!N[0])return new _e(!r.s||!i.s||(V?N&&V[0]==N[0]:!N)?NaN:V&&V[0]==0||!N?Je*0:Je/0);for(c?(p=1,l=r.e-i.e):(c=te,p=h,l=U(r.e/p)-U(i.e/p)),$=N.length,Pe=V.length,L=new _e(Je),J=L.d=[],m=0;N[m]==(V[m]||0);m++);if(N[m]>(V[m]||0)&&l--,o==null?(se=o=_e.precision,s=_e.rounding):a?se=o+(r.e-i.e)+1:se=o,se<0)J.push(1),w=!0;else{if(se=se/p+2|0,m=0,$==1){for(d=0,N=N[0],se++;(m<Pe||d)&&se--;m++)je=d*c+(V[m]||0),J[m]=je/N|0,d=je%N|0;w=d||m<Pe}else{for(d=c/(N[0]+1)|0,d>1&&(N=t(N,d,c),V=t(V,d,c),$=N.length,Pe=V.length),Fe=$,k=V.slice(0,$),G=k.length;G<$;)k[G++]=0;Me=N.slice(),Me.unshift(0),Qe=N[0],N[1]>=c/2&&++Qe;do d=0,u=e(N,k,$,G),u<0?(Re=k[0],$!=G&&(Re=Re*c+(k[1]||0)),d=Re/Qe|0,d>1?(d>=c&&(d=c-1),b=t(N,d,c),v=b.length,G=k.length,u=e(b,k,v,G),u==1&&(d--,n(b,$<v?Me:N,v,c))):(d==0&&(u=d=1),b=N.slice()),v=b.length,v<G&&b.unshift(0),n(k,b,G,c),u==-1&&(G=k.length,u=e(N,k,$,G),u<1&&(d++,n(k,$<G?Me:N,G,c))),G=k.length):u===0&&(d++,k=[0]),J[m++]=d,u&&k[0]?k[G++]=V[Fe]||0:(k=[V[Fe]],G=1);while((Fe++<Pe||k[0]!==void 0)&&se--);w=k[0]!==void 0}J[0]||J.shift()}if(p==1)L.e=l,Ft=w;else{for(m=1,d=J[0];d>=10;d/=10)m++;L.e=m+l*p-1,g(L,a?o+L.e+1:o,s,w)}return L}}();function g(t,e,n,r){var i,o,s,a,c,u,l,m,d,p=t.constructor;e:if(e!=null){if(m=t.d,!m)return t;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=h,s=e,l=m[d=0],c=l/_(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/h),a=m.length,d>=a)if(r){for(;a++<=d;)m.push(0);l=c=0,i=1,o%=h,s=o-h+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=h,s=o-h+i,c=s<0?0:l/_(10,i-s-1)%10|0}if(r=r||e<0||m[d+1]!==void 0||(s<0?l:l%_(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(t.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/_(10,i-s):0:m[d-1])%10&1||n==(t.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=t.e+1,m[0]=_(10,(h-e%h)%h),t.e=-e||0):m[0]=t.e=0,t;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=_(10,h-o),m[d]=s>0?(l/_(10,i-s)%_(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(t.e++,m[0]==te&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=te)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return y&&(t.e>p.maxE?(t.d=null,t.e=NaN):t.e<p.minE&&(t.e=0,t.d=[0])),t}function ne(t,e,n){if(!t.isFinite())return Gt(t);var r,i=t.e,o=K(t.d),s=o.length;return e?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+le(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(t.e<0?"e":"e+")+t.e):i<0?(o="0."+le(-i-1)+o,n&&(r=n-s)>0&&(o+=le(r))):i>=s?(o+=le(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+le(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=le(r))),o}function Ge(t,e){var n=t[0];for(e*=h;n>=10;n/=10)e++;return e}function Ke(t,e,n){if(e>An)throw y=!0,n&&(t.precision=n),Error(Mt);return g(new t(De),e,1,!0)}function ee(t,e,n){if(e>nt)throw Error(Mt);return g(new t(ve),e,n,!0)}function vt(t){var e=t.length-1,n=e*h+1;if(e=t[e],e){for(;e%10==0;e/=10)n--;for(e=t[0];e>=10;e/=10)n++}return n}function le(t){for(var e="";t--;)e+="0";return e}function Kt(t,e,n,r){var i,o=new t(1),s=Math.ceil(r/h+4);for(y=!1;;){if(n%2&&(o=o.times(e),Et(o.d,s)&&(i=!0)),n=U(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}e=e.times(e),Et(e.d,s)}return y=!0,o}function Lt(t){return t.d[t.d.length-1]&1}function qt(t,e,n){for(var r,i=new t(e[0]),o=0;++o<e.length;)if(r=new t(e[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function rt(t,e){var n,r,i,o,s,a,c,u=0,l=0,m=0,d=t.constructor,p=d.rounding,w=d.precision;if(!t.d||!t.d[0]||t.e>17)return new d(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(y=!1,c=w):c=e,a=new d(.03125);t.e>-2;)t=t.times(a),m+=5;for(r=Math.log(_(2,m))/Math.LN10*2+5|0,c+=r,n=o=s=new d(1),d.precision=c;;){if(o=g(o.times(t),c,1),n=n.times(++l),a=s.plus(P(o,n,c,1)),K(a.d).slice(0,c)===K(s.d).slice(0,c)){for(i=m;i--;)s=g(s.times(s),c,1);if(e==null)if(u<3&&Be(s.d,c-r,p,u))d.precision=c+=10,n=o=a=new d(1),l=0,u++;else return g(s,d.precision=w,p,y=!0);else return d.precision=w,s}s=a}}function me(t,e){var n,r,i,o,s,a,c,u,l,m,d,p=1,w=10,b=t,v=b.d,L=b.constructor,J=L.rounding,k=L.precision;if(b.s<0||!v||!v[0]||!b.e&&v[0]==1&&v.length==1)return new L(v&&!v[0]?-1/0:b.s!=1?NaN:v?0:b);if(e==null?(y=!1,l=k):l=e,L.precision=l+=w,n=K(v),r=n.charAt(0),Math.abs(o=b.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)b=b.times(t),n=K(b.d),r=n.charAt(0),p++;o=b.e,r>1?(b=new L("0."+n),o++):b=new L(r+"."+n.slice(1))}else return u=Ke(L,l+2,k).times(o+""),b=me(new L(r+"."+n.slice(1)),l-w).plus(u),L.precision=k,e==null?g(b,k,J,y=!0):b;for(m=b,c=s=b=P(b.minus(1),b.plus(1),l,1),d=g(b.times(b),l,1),i=3;;){if(s=g(s.times(d),l,1),u=c.plus(P(s,new L(i),l,1)),K(u.d).slice(0,l)===K(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Ke(L,l+2,k).times(o+""))),c=P(c,new L(p),l,1),e==null)if(Be(c.d,l-w,J,a))L.precision=l+=w,u=s=b=P(m.minus(1),m.plus(1),l,1),d=g(b.times(b),l,1),i=a=1;else return g(c,L.precision=k,J,y=!0);else return L.precision=k,c;c=u,i+=2}}function Gt(t){return String(t.s*t.s/0)}function it(t,e){var n,r,i;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;r++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(r,i),e){if(i-=r,t.e=n=n-r-1,t.d=[],r=(n+1)%h,n<0&&(r+=h),r<i){for(r&&t.d.push(+e.slice(0,r)),i-=h;r<i;)t.d.push(+e.slice(r,r+=h));e=e.slice(r),r=h-e.length}else r-=i;for(;r--;)e+="0";t.d.push(+e),y&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function Pn(t,e){var n,r,i,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Dt.test(e))return it(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(wn.test(e))n=16,e=e.toLowerCase();else if(yn.test(e))n=2;else if(Tn.test(e))n=8;else throw Error(de+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,r=t.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Kt(r,new r(n),o,o*2)),u=Oe(e,n,te),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(t.s*0):(t.e=Ge(u,l),t.d=u,y=!1,s&&(t=P(t,i,a*4)),c&&(t=t.times(Math.abs(c)<54?_(2,c):Ie.pow(2,c))),y=!0,t)}function Bn(t,e){var n,r=e.d.length;if(r<3)return e.isZero()?e:xe(t,2,e,e);n=1.4*Math.sqrt(r),n=n>16?16:n|0,e=e.times(1/Ve(5,n)),e=xe(t,2,e,e);for(var i,o=new t(5),s=new t(16),a=new t(20);n--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function xe(t,e,n,r,i){var o,s,a,c,u=1,l=t.precision,m=Math.ceil(l/h);for(y=!1,c=n.times(n),a=new t(r);;){if(s=P(a.times(c),new t(e++*e++),l,1),a=i?r.plus(s):r.minus(s),r=P(s.times(c),new t(e++*e++),l,1),s=a.plus(r),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return y=!0,s.d.length=m+1,s}function Ve(t,e){for(var n=t;--e;)n*=t;return n}function Vt(t,e){var n,r=e.s<0,i=ee(t,t.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return ae=r?4:1,e;if(n=e.divToInt(i),n.isZero())ae=r?3:2;else{if(e=e.minus(n.times(i)),e.lte(o))return ae=Lt(n)?r?2:3:r?4:1,e;ae=Lt(n)?r?1:4:r?3:2}return e.minus(i).abs()}function ot(t,e,n,r){var i,o,s,a,c,u,l,m,d,p=t.constructor,w=n!==void 0;if(w?(X(n,1,fe),r===void 0?r=p.rounding:X(r,0,8)):(n=p.precision,r=p.rounding),!t.isFinite())l=Gt(t);else{for(l=ne(t),s=l.indexOf("."),w?(i=2,e==16?n=n*4-3:e==8&&(n=n*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Oe(ne(d),10,i),d.e=d.d.length),m=Oe(l,10,i),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=w?"0p+0":"0";else{if(s<0?o--:(t=new p(t),t.d=m,t.e=o,t=P(t,d,n,r,0,i),m=t.d,o=t.e,u=Ft),s=m[n],a=i/2,u=u||m[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(t.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&m[n-1]&1||r===(t.s<0?8:7)),m.length=n,u)for(;++m[--n]>i-1;)m[n]=0,n||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=et.charAt(m[s]);if(w){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Oe(l,i,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=et.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return t.s<0?"-"+l:l}function Et(t,e){if(t.length>e)return t.length=e,!0}function In(t){return new this(t).abs()}function Nn(t){return new this(t).acos()}function Sn(t){return new this(t).acosh()}function Cn(t,e){return new this(t).plus(e)}function Ln(t){return new this(t).asin()}function En(t){return new this(t).asinh()}function Rn(t){return new this(t).atan()}function Fn(t){return new this(t).atanh()}function Mn(t,e){t=new this(t),e=new this(e);var n,r=this.precision,i=this.rounding,o=r+4;return!t.s||!e.s?n=new this(NaN):!t.d&&!e.d?(n=ee(this,o,1).times(e.s>0?.25:.75),n.s=t.s):!e.d||t.isZero()?(n=e.s<0?ee(this,r,i):new this(0),n.s=t.s):!t.d||e.isZero()?(n=ee(this,o,1).times(.5),n.s=t.s):e.s<0?(this.precision=o,this.rounding=1,n=this.atan(P(t,e,o,1)),e=ee(this,o,1),this.precision=r,this.rounding=i,n=t.s<0?n.minus(e):n.plus(e)):n=this.atan(P(t,e,o,1)),n}function _n(t){return new this(t).cbrt()}function On(t){return g(t=new this(t),t.e+1,2)}function Dn(t,e,n){return new this(t).clamp(e,n)}function vn(t){if(!t||typeof t!="object")throw Error(qe+"Object expected");var e,n,r,i=t.defaults===!0,o=["precision",1,fe,"rounding",0,8,"toExpNeg",-Te,0,"toExpPos",0,Te,"maxE",0,Te,"minE",-Te,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(n=o[e],i&&(this[n]=tt[n]),(r=t[n])!==void 0)if(U(r)===r&&r>=o[e+1]&&r<=o[e+2])this[n]=r;else throw Error(de+n+": "+r);if(n="crypto",i&&(this[n]=tt[n]),(r=t[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(_t);else this[n]=!1;else throw Error(de+n+": "+r);return this}function Kn(t){return new this(t).cos()}function qn(t){return new this(t).cosh()}function Ut(t){var e,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Rt(o)){u.s=o.s,y?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;y?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return it(u,o.toString())}else if(c!=="string")throw Error(de+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Dt.test(o)?it(u,o):Pn(u,o)}if(i.prototype=f,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=vn,i.clone=Ut,i.isDecimal=Rt,i.abs=In,i.acos=Nn,i.acosh=Sn,i.add=Cn,i.asin=Ln,i.asinh=En,i.atan=Rn,i.atanh=Fn,i.atan2=Mn,i.cbrt=_n,i.ceil=On,i.clamp=Dn,i.cos=Kn,i.cosh=qn,i.div=Gn,i.exp=Vn,i.floor=Un,i.hypot=Wn,i.ln=Xn,i.log=zn,i.log10=Yn,i.log2=Hn,i.max=Zn,i.min=jn,i.mod=Qn,i.mul=Jn,i.pow=$n,i.random=er,i.round=tr,i.sign=nr,i.sin=rr,i.sinh=ir,i.sqrt=or,i.sub=sr,i.sum=ar,i.tan=ur,i.tanh=cr,i.trunc=lr,t===void 0&&(t={}),t&&t.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return i.config(t),i}function Gn(t,e){return new this(t).div(e)}function Vn(t){return new this(t).exp()}function Un(t){return g(t=new this(t),t.e+1,3)}function Wn(){var t,e,n=new this(0);for(y=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)n.d&&(n=n.plus(e.times(e)));else{if(e.s)return y=!0,new this(1/0);n=e}return y=!0,n.sqrt()}function Rt(t){return t instanceof Ie||t&&t.toStringTag===Ot||!1}function Xn(t){return new this(t).ln()}function zn(t,e){return new this(t).log(e)}function Hn(t){return new this(t).log(2)}function Yn(t){return new this(t).log(10)}function Zn(){return qt(this,arguments,"lt")}function jn(){return qt(this,arguments,"gt")}function Qn(t,e){return new this(t).mod(e)}function Jn(t,e){return new this(t).mul(e)}function $n(t,e){return new this(t).pow(e)}function er(t){var e,n,r,i,o=0,s=new this(1),a=[];if(t===void 0?t=this.precision:X(t,1,fe),r=Math.ceil(t/h),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));o<r;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);o<r;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(_t);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],t%=h,r&&t&&(i=_(10,h-t),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=h)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<h&&(n-=h-r)}return s.e=n,s.d=a,s}function tr(t){return g(t=new this(t),t.e+1,this.rounding)}function nr(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function rr(t){return new this(t).sin()}function ir(t){return new this(t).sinh()}function or(t){return new this(t).sqrt()}function sr(t,e){return new this(t).sub(e)}function ar(){var t=0,e=arguments,n=new this(e[t]);for(y=!1;n.s&&++t<e.length;)n=n.plus(e[t]);return y=!0,g(n,this.precision,this.rounding)}function ur(t){return new this(t).tan()}function cr(t){return new this(t).tanh()}function lr(t){return g(t=new this(t),t.e+1,1)}f[Symbol.for("nodejs.util.inspect.custom")]=f.toString;f[Symbol.toStringTag]="Decimal";var Ie=f.constructor=Ut(tt);De=new Ie(De);ve=new Ie(ve);var W=Ie;import{PublicKey as at}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mr}from"@solana/spl-token";import{PublicKey as C,SystemProgram as Xt,SYSVAR_RENT_PUBKEY as dr}from"@solana/web3.js";function st({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var ci=[st({pubkey:mr,isWritable:!1}),st({pubkey:Xt.programId,isWritable:!1}),st({pubkey:dr,isWritable:!1})];function zt({publicKey:t,transformSol:e}){let n=Ht(t.toString());if(n instanceof C)return e&&n.equals(Ne)?Wt:n;if(e&&n.toString()===Ne.toBase58())return Wt;if(typeof n=="string"){if(n===C.default.toBase58())return C.default;try{return new C(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ht(t){try{return new C(t)}catch{return t}}var li=new C("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),mi=new C("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),di=new C("SysvarRent111111111111111111111111111111111"),fi=new C("SysvarC1ock11111111111111111111111111111111"),fr=new C("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),pi=new C("Sysvar1nstructions1111111111111111111111111"),gi=Xt.programId,hi=new C("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),bi=new C("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),yi=new C("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),wi=new C("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ti=new C("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),xi=new C("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ai=new C("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ki=new C("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Pi=new C("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Bi=new C("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ii=new C("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Wt=new C("So11111111111111111111111111111111111111112"),Ne=C.default;import{PublicKey as pr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yt}from"@solana/spl-token";var Zt={chainId:101,address:pr.default.toBase58(),programId:Yt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},be={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Yt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ut=class{constructor({mint:e,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Ne.toBase58()||e instanceof at&&Ne.equals(e)){this.decimals=be.decimals,this.symbol=be.symbol,this.name=be.name,this.mint=new at(be.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?at.default:zt({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ye=ut;ye.WSOL=new ut({...be,mint:be.address});import We from"big.js";import br from"bn.js";import yr from"decimal.js-light";import gr from"toformat";var hr=gr,Se=hr;var Ue=Z("module/fraction"),ct=Se(We),Ce=Se(yr),wr={[0]:Ce.ROUND_DOWN,[1]:Ce.ROUND_HALF_UP,[2]:Ce.ROUND_UP},Tr={[0]:We.roundDown,[1]:We.roundHalfUp,[2]:We.roundUp},S=class{constructor(e,n=new br(1)){this.numerator=pe(e),this.denominator=pe(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new S(this.denominator,this.numerator)}add(e){let n=e instanceof S?e:new S(pe(e));return this.denominator.eq(n.denominator)?new S(this.numerator.add(n.numerator),this.denominator):new S(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof S?e:new S(pe(e));return this.denominator.eq(n.denominator)?new S(this.numerator.sub(n.numerator),this.denominator):new S(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof S?e:new S(pe(e));return new S(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof S?e:new S(pe(e));return new S(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},r=1){Number.isInteger(e)||Ue.logWithError(`${e} is not an integer.`),e<=0&&Ue.logWithError(`${e} is not positive.`),Ce.set({precision:e+1,rounding:wr[r]});let i=new Ce(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},r=1){return Number.isInteger(e)||Ue.logWithError(`${e} is not an integer.`),e<0&&Ue.logWithError(`${e} is negative.`),ct.DP=e,ct.RM=Tr[r]||1,new ct(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var Ji=Z("Raydium_price");var lt=class{constructor({decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=r}equals(e){return this===e}},Xe=lt;Xe.SOL=new lt(Zt);import Ar from"bn.js";var so=new S(new Ar(100));var kr=new z(0),Io=new z(1),No=new z(2),So=new z(3),Co=new z(5),Pr=new z(10),Lo=new z(100),Eo=new z(1e3),Ro=new z(1e4),jt=9007199254740991;function pe(t){let e=Z("Raydium_parseBigNumberish");if(t instanceof z)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new z(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=jt||t<=-jt)&&e.logWithError(`BigNumberish number overflow: ${t}`),new z(String(t))):typeof t=="bigint"?new z(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new z(0))}var zo=Z("Raydium_amount"),Ho=Se(Br);import{PublicKey as Qs,sendAndConfirmTransaction as Js,Transaction as ea,TransactionMessage as na,VersionedTransaction as ra}from"@solana/web3.js";import oa from"axios";import{PublicKey as Ir,ComputeBudgetProgram as ps,Transaction as hs,TransactionMessage as ys,Keypair as ws,VersionedTransaction as xs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ks}from"@solana/spl-token";var Is=Z("Raydium_txUtil");function pt(t,e){let[n,r]=Ir.findProgramAddressSync(t,e);return{publicKey:n,nonce:r}}import{PublicKey as Sr,AddressLookupTableAccount as Qt}from"@solana/web3.js";import{PublicKey as Nr}from"@solana/web3.js";import{getTransferFeeConfig as Fs,unpackMint as Ms}from"@solana/spl-token";var gt=Z("Raydium_accountInfo_util");async function ze(t,e,n){let{batchRequest:r,commitment:i="confirmed"}={batchRequest:!1,...n},o=ht(e,100),s=new Array(o.length).fill([]);if(r){let a=o.map(l=>{let m=t._buildArgs([l.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),c=ht(a,10);s=(await(await Promise.all(c.map(async l=>await t._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&gt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:w,owner:b,rentEpoch:v}=m;return d.length!==2&&d[1]!=="base64"&&gt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:w,owner:new Nr(b),rentEpoch:v}}return null})))}else try{s=await Promise.all(o.map(a=>t.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&gt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}var Cr={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Qt({key:new Sr("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Qt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function ht(t,e=1,n=[]){let r=[...t];if(e<=0)return n;for(;r.length;)n.push(r.splice(0,e));return n}import{PublicKey as M}from"@solana/web3.js";var ga=new M("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ha=new M("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),ba=new M("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ya=new M("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),wa=new M("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ta=new M("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),xa=new M("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Aa=new M("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ka=new M("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Pa=new M("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ba=new M("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ia=new M("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Na=new M("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Sa=new M("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ca=new M("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),La=new M("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ea=new M("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ra=new M("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Fa=new M("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Ma=new M("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as Da}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as qa}from"@solana/spl-token";import Ua from"bn.js";import{PublicKey as vr}from"@solana/web3.js";import tn,{isBN as nn}from"bn.js";import{bits as cu,BitStructure as lu,blob as Lr,Blob as mu,cstr as du,f32 as fu,f32be as pu,f64 as gu,f64be as hu,greedy as bu,Layout as Er,ns64 as yu,ns64be as wu,nu64 as Tu,nu64be as xu,offset as Au,s16 as ku,s16be as Pu,s24 as Bu,s24be as Iu,s32 as Rr,s32be as Nu,s40 as Su,s40be as Cu,s48 as Lu,s48be as Eu,s8 as Ru,seq as Fr,struct as Fu,Structure as Mr,u16 as _r,u16be as Mu,u24 as _u,u24be as Ou,u32 as Du,u32be as vu,u40 as Ku,u40be as qu,u48 as Gu,u48be as Vu,u8 as Or,UInt as Dr,union as Uu,Union as Wu,unionLayoutDiscriminator as Xu,utf8 as zu}from"@solana/buffer-layout";var bt=Er,Jt=Mr;var yt=Dr;var $t=Or,Ae=_r;var ge=Rr;var en=Fr;var j=Lr;var Le=class extends bt{constructor(n,r,i){super(n,i);this.blob=j(n),this.signed=r}decode(n,r=0){let i=new tn(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new tn(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}};function Q(t){return new yt(1,t)}function Ee(t){return new yt(4,t)}function B(t){return new Le(8,!1,t)}function I(t){return new Le(16,!1,t)}function rn(t){return new Le(16,!0,t)}var He=class extends bt{constructor(n,r,i,o){super(n.span,o);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function O(t){return new He(j(32),e=>new vr(e),e=>e.toBuffer(),t)}function on(t){return new He($t(),Kr,qr,t)}function Kr(t){if(t===0)return!1;if(t===1)return!0;throw new Error("Invalid bool: "+t)}function qr(t){return t?1:0}var wt=class extends Jt{decode(e,n){return super.decode(e,n)}};function H(t,e,n){return new wt(t,e,n)}function R(t,e,n){let r,i=typeof e=="number"?e:nn(e)?e.toNumber():new Proxy(e,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=nn(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return en(t,i,n)}import Zr from"bn.js";function sn(t){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,t,!1),new Uint8Array(e)}var cc=Buffer.from("amm_config","utf8"),lc=Buffer.from("pool","utf8"),mc=Buffer.from("pool_vault","utf8"),dc=Buffer.from("pool_reward_vault","utf8"),fc=Buffer.from("position","utf8"),Gr=Buffer.from("tick_array","utf8"),pc=Buffer.from("operation","utf8"),gc=Buffer.from("pool_tick_array_bitmap_extension","utf8");function ue(t,e,n){return pt([Gr,e.toBuffer(),sn(n)],t)}import re from"bn.js";var ie=new re(0),ke=new re(1),an=new re(-1),Ye=new re(1).shln(64),Ze=new re(1).shln(128),Vr=Ye.sub(ke),Tt=64,un=Ze.subn(1),ce=-443636,he=-ce,xt=new re("4295048016"),At=new re("79226673521066979257578248091"),cn=16,ln="59543866431248",mn="184467440737095516",dn="15793534762490258745",Ur=new re(10).pow(new re(6));var yc=new re("18446744073700000000");import A from"bn.js";import{PublicKey as Xc}from"@solana/web3.js";import Zc from"bn.js";var kt=14;import Ec from"bn.js";import{TOKEN_2022_PROGRAM_ID as ll}from"@solana/spl-token";var oe=class{static mulDivRoundingUp(e,n,r){let i=e.mul(n),o=i.div(r);return i.mod(r).eq(ie)||(o=o.add(ke)),o}static mulDivFloor(e,n,r){if(r.eq(ie))throw new Error("division by 0");return e.mul(n).div(r)}static mulDivCeil(e,n,r){if(r.eq(ie))throw new Error("division by 0");return e.mul(n).add(r.sub(ke)).div(r)}static x64ToDecimal(e,n){return new W(e.toString()).div(W.pow(2,64)).toDecimalPlaces(n)}static decimalToX64(e){return new A(e.mul(W.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,n){return e.add(Ze).sub(n).mod(Ze)}};function D(t,e){return It(t.mul(e),64,256)}function Yr(t,e,n){let r=t.toTwos(n).shln(e);return r.imaskn(n+1),r.fromTwos(n)}function It(t,e,n){let r=t.toTwos(n).shrn(e);return r.imaskn(n-e+1),r.fromTwos(n-e)}var F=class{static sqrtPriceX64ToPrice(e,n,r){return oe.x64ToDecimal(e).pow(2).mul(W.pow(10,n-r))}static priceToSqrtPriceX64(e,n,r){return oe.decimalToX64(e.mul(W.pow(10,r-n)).sqrt())}static getNextSqrtPriceX64FromInput(e,n,r,i){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!n.gt(ie))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,n,r,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,n,r,!0)}static getNextSqrtPriceX64FromOutput(e,n,r,i){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!n.gt(ie))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,n,r,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,n,r,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,n,r,i){if(r.eq(ie))return e;let o=n.shln(Tt);if(i){let s=o,a=o.add(r.mul(e));return a.gte(s)?oe.mulDivCeil(s,e,a):oe.mulDivRoundingUp(s,ke,s.div(e).add(r))}else{let s=r.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return oe.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,n,r,i){let o=r.shln(Tt);if(i)return e.add(o.div(n));{let s=oe.mulDivRoundingUp(o,ke,n);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<ce||e>he)throw new Error("tick must be in MIN_TICK and MAX_TICK");let n=e<0?e*-1:e,r=(n&1)!=0?new A("18445821805675395072"):new A("18446744073709551616");return(n&2)!=0&&(r=D(r,new A("18444899583751176192"))),(n&4)!=0&&(r=D(r,new A("18443055278223355904"))),(n&8)!=0&&(r=D(r,new A("18439367220385607680"))),(n&16)!=0&&(r=D(r,new A("18431993317065453568"))),(n&32)!=0&&(r=D(r,new A("18417254355718170624"))),(n&64)!=0&&(r=D(r,new A("18387811781193609216"))),(n&128)!=0&&(r=D(r,new A("18329067761203558400"))),(n&256)!=0&&(r=D(r,new A("18212142134806163456"))),(n&512)!=0&&(r=D(r,new A("17980523815641700352"))),(n&1024)!=0&&(r=D(r,new A("17526086738831433728"))),(n&2048)!=0&&(r=D(r,new A("16651378430235570176"))),(n&4096)!=0&&(r=D(r,new A("15030750278694412288"))),(n&8192)!=0&&(r=D(r,new A("12247334978884435968"))),(n&16384)!=0&&(r=D(r,new A("8131365268886854656"))),(n&32768)!=0&&(r=D(r,new A("3584323654725218816"))),(n&65536)!=0&&(r=D(r,new A("696457651848324352"))),(n&131072)!=0&&(r=D(r,new A("26294789957507116"))),(n&262144)!=0&&(r=D(r,new A("37481735321082"))),e>0&&(r=un.div(r)),r}static getTickFromPrice(e,n,r){return F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,n,r))}static getTickFromSqrtPriceX64(e){if(e.gt(At)||e.lt(xt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let n=e.bitLength()-1,r=new A(n-64),i=Yr(r,32,128),o=new A("8000000000000000","hex"),s=0,a=new A(0),c=n>=64?e.shrn(n-63):e.shln(63-n);for(;o.gt(new A(0))&&s<cn;){c=c.mul(c);let w=c.shrn(127);c=c.shrn(63+w.toNumber()),a=a.add(o.mul(w)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=i.add(u).mul(new A(ln)),d=It(m.sub(new A(mn)),64,128).toNumber(),p=It(m.add(new A(dn)),64,128).toNumber();return d==p?d:F.getSqrtPriceX64FromTick(p).lte(e)?p:d}},we=class{static getTickWithPriceAndTickspacing(e,n,r,i){let s=F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,r,i))/n;return s<0?s=Math.floor(s):s=Math.ceil(s),s*n}static roundPriceWithTickspacing(e,n,r,i){let o=we.getTickWithPriceAndTickspacing(e,n,r,i),s=F.getSqrtPriceX64FromTick(o);return F.sqrtPriceX64ToPrice(s,r,i)}};var q=60,Pt=512,E=class{static getTickArrayAddressByTick(e,n,r,i){let o=E.getTickArrayStartIndexByTick(r,i),{publicKey:s}=ue(e,n,o);return s}static getTickOffsetInArray(e,n){if(e%n!=0)throw new Error("tickIndex % tickSpacing not equal 0");let r=E.getTickArrayStartIndexByTick(e,n),i=Math.floor((e-r)/n);if(i<0||i>=q)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,n){let r=Y.tickCount(n),i=e/r;return e<0&&e%r!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,n){return this.getTickArrayBitIndex(e,n)*Y.tickCount(n)}static getTickArrayOffsetInBitmapByTick(e,n){let r=n*q,i=Math.floor(e/r)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,n,r){let i=r*q,o=Math.floor(n/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,n,r){return r?e-n*q:e+n*q}static mergeTickArrayBitmap(e){let n=new Zr(0);for(let r=0;r<e.length;r++)n=n.add(e[r].shln(64*r));return n}static getInitializedTickArrayInRange(e,n,r,i,o){let s=Math.floor(i/(r*q));return[...E.searchLowBitFromStart(e,n,s-1,o,r),...E.searchHightBitFromStart(e,n,s,o,r)]}static getAllInitializedTickArrayStartIndex(e,n,r){return E.searchHightBitFromStart(e,n,0,Pt,r)}static getAllInitializedTickArrayInfo(e,n,r,i,o){let s=[],a=E.getAllInitializedTickArrayStartIndex(r,i,o);for(let c of a){let{publicKey:u}=ue(e,n,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(n=>n.liquidityGross.gtn(0))}static searchLowBitFromStart(e,n,r,i,o){let s=[...[...n.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...n.positiveTickArrayBitmap].map(u=>E.mergeTickArrayBitmap(u)),a=[];for(;r>=-7680;){let u=Math.floor((r+7680)/512),l=(r+7680)%512;if(s[u].testn(l)&&a.push(r),r--,a.length===i)break}let c=Y.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,n,r,i,o){let s=[...[...n.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...n.positiveTickArrayBitmap].map(u=>E.mergeTickArrayBitmap(u)),a=[];for(;r<7680;){let u=Math.floor((r+7680)/512),l=(r+7680)%512;if(s[u].testn(l)&&a.push(r),r++,a.length===i)break}let c=Y.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<ce||e>he}static nextInitTick(e,n,r,i,o){if(Y.getArrayStartIndex(n,r)!=e.startTickIndex)return null;let a=Math.floor((n-e.startTickIndex)/r);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<q;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,n){if(n){let r=q-1;for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r-1}}else{let r=0;for(;r<q;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r=r+1}}throw Error(`firstInitializedTick check error: ${e} - ${n}`)}static _getTickPriceLegacy({poolInfo:e,tick:n,baseIn:r}){let i=F.getSqrtPriceX64FromTick(n),o=F.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return r?{tick:n,price:o,tickSqrtPriceX64:i}:{tick:n,price:new W(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:n,baseIn:r}){let i=r?n:new W(1).div(n),o=we.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return r?{tick:o,price:a}:{tick:o,price:new W(1).div(a)}}static getTickPrice({poolInfo:e,tick:n,baseIn:r}){let i=F.getSqrtPriceX64FromTick(n),o=F.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return r?{tick:n,price:o,tickSqrtPriceX64:i}:{tick:n,price:new W(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:n,baseIn:r}){let i=r?n:new W(1).div(n),o=we.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return r?{tick:o,price:a}:{tick:o,price:new W(1).div(a)}}};var Ol=H([j(8),Q("bump"),Ae("index"),O(""),Ee("protocolFeeRate"),Ee("tradeFeeRate"),Ae("tickSpacing"),R(B(),8,"")]),jr=H([Ee("blockTimestamp"),I("sqrtPriceX64"),I("cumulativeTimePriceX64"),R(I(),1,"")]),Dl=H([j(8),on("initialized"),O("poolId"),R(jr,1e3,"observations"),R(I(),5,"")]),Qr=H([Q("rewardState"),B("openTime"),B("endTime"),B("lastUpdateTime"),I("emissionsPerSecondX64"),B("rewardTotalEmissioned"),B("rewardClaimed"),O("tokenMint"),O("tokenVault"),O("creator"),I("rewardGrowthGlobalX64")]),Xr=H([j(8),Q("bump"),O("ammConfig"),O("creator"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("observationId"),Q("mintDecimalsA"),Q("mintDecimalsB"),Ae("tickSpacing"),I("liquidity"),I("sqrtPriceX64"),ge("tickCurrent"),Ae("observationIndex"),Ae("observationUpdateDuration"),I("feeGrowthGlobalX64A"),I("feeGrowthGlobalX64B"),B("protocolFeesTokenA"),B("protocolFeesTokenB"),I("swapInAmountTokenA"),I("swapOutAmountTokenB"),I("swapInAmountTokenB"),I("swapOutAmountTokenA"),Q("status"),R(Q(),7,""),R(Qr,3,"rewardInfos"),R(B(),16,"tickArrayBitmap"),B("totalFeesTokenA"),B("totalFeesClaimedTokenA"),B("totalFeesTokenB"),B("totalFeesClaimedTokenB"),B("fundFeesTokenA"),B("fundFeesTokenB"),B("startTime"),R(B(),15*4-3,"padding")]),Jr=H([I("growthInsideLastX64"),B("rewardAmountOwed")]),zr=H([j(8),Q("bump"),O("nftMint"),O("poolId"),ge("tickLower"),ge("tickUpper"),I("liquidity"),I("feeGrowthInsideLastX64A"),I("feeGrowthInsideLastX64B"),B("tokenFeesOwedA"),B("tokenFeesOwedB"),R(Jr,3,"rewardInfos"),R(B(),8,"")]),vl=H([j(8),Q("bump"),O("poolId"),ge("tickLowerIndex"),ge("tickUpperIndex"),I("liquidity"),I("feeGrowthInsideLastX64A"),I("feeGrowthInsideLastX64B"),B("tokenFeesOwedA"),B("tokenFeesOwedB"),R(I(),3,"rewardGrowthInside"),R(B(),8,"")]),$r=H([ge("tick"),rn("liquidityNet"),I("liquidityGross"),I("feeGrowthOutsideX64A"),I("feeGrowthOutsideX64B"),R(I(),3,"rewardGrowthsOutsideX64"),R(Ee(),13,"")]),Bt=H([j(8),O("poolId"),ge("startTickIndex"),R($r,q,"ticks"),Q("initializedTickCount"),R(Q(),115,"")]),Kl=H([j(329),R(O(),100,"whitelistMints")]),Hr=H([j(8),O("poolId"),R(R(B(),8),kt,"positiveTickArrayBitmap"),R(R(B(),8),kt,"negativeTickArrayBitmap")]);var ei=15,Y=class{static async getTickArrays(e,n,r,i,o,s,a){let c=[],u=E.getTickArrayStartIndexByTick(i,o),l=E.getInitializedTickArrayInRange(s,a,o,u,Math.floor(ei/2));for(let p=0;p<l.length;p++){let{publicKey:w}=ue(n,r,l[p]);c.push(w)}let m=(await ze(e,c)).map(p=>p!==null?Bt.decode(p.data):null),d={};for(let p=0;p<c.length;p++){let w=m[p];w!==null&&(d[w.startTickIndex]={...w,address:c[p]})}return d}static nextInitializedTick(e,n,r,i,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,n,r,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=E.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=r[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,n,l,s);[a,c,u]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,n,r,i,o){let s=Math.floor(e/Y.tickCount(n)),a=r?E.searchLowBitFromStart(i,o,s-1,1,n):E.searchHightBitFromStart(i,o,s+1,1,n);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,n,r,i){let o;if(i){let a=q-1;for(;a>=0;){let c=r.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<q;){let c=r.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=ue(e,n,r.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:r.startTickIndex}}static nextInitializedTickInOneArray(e,n,r,i,o,s){let a=E.getTickArrayStartIndexByTick(i,o),c=Math.floor((i-a)/o),u=r[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<q;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=ue(e,n,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,n){let r=this.tickCount(n);return Math.floor(e/r)*r}static checkIsValidStartIndex(e,n){if(E.checkIsOutOfBoundary(e)){if(e>he)return!1;let r=E.getTickArrayStartIndexByTick(ce,n);return e==r}return e%this.tickCount(n)==0}static tickCount(e){return q*e}};export{ei as FETCH_TICKARRAY_COUNT,Y as TickQuery};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
//# sourceMappingURL=tickQuery.mjs.map