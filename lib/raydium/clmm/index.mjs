import{PublicKey as V}from"@solana/web3.js";var bt=9e15,Je=1e9,bn="0123456789abcdef",Gt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ut="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",gn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-bt,maxE:bt,crypto:!1},ri,Xe,D=!0,Ht="[DecimalError] ",$e=Ht+"Invalid argument: ",oi=Ht+"Precision limit exceeded",si=Ht+"crypto unavailable",ai="[object Decimal]",we=Math.floor,ce=Math.pow,cr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ur=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,lr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ci=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Re=1e7,N=7,mr=9007199254740991,dr=Gt.length-1,yn=Ut.length-1,T={toStringTag:ai};T.absoluteValue=T.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),K(i)};T.ceil=function(){return K(new this.constructor(this),this.e+1,2)};T.clampedTo=T.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error($e+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};T.comparedTo=T.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};T.cosine=T.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+N,n.rounding=1,t=pr(n,pi(n,t)),n.precision=i,n.rounding=e,K(Xe==2||Xe==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};T.cubeRoot=T.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(D=!1,o=l.s*ce(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=pe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ce(t,1/3),i=we((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=j(u.plus(l).times(a),u.plus(c),s+2,1),pe(a.d).slice(0,s)===(t=pe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(K(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(K(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return D=!0,K(n,i,m.rounding,e)};T.decimalPlaces=T.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-we(this.e/N))*N,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};T.dividedBy=T.div=function(i){return j(this,new this.constructor(i))};T.dividedToIntegerBy=T.divToInt=function(i){var e=this,t=e.constructor;return K(j(e,new t(i),0,1,1),t.precision,t.rounding)};T.equals=T.eq=function(i){return this.cmp(i)===0};T.floor=function(){return K(new this.constructor(this),this.e+1,3)};T.greaterThan=T.gt=function(i){return this.cmp(i)>0};T.greaterThanOrEqualTo=T.gte=function(i){var e=this.cmp(i);return e==1||e===0};T.hyperbolicCosine=T.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Yt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=gt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return K(o,s.precision=t,s.rounding=n,!0)};T.hyperbolicSine=T.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=gt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Yt(5,i)),r=gt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,K(r,e,t,!0)};T.hyperbolicTangent=T.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,j(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};T.inverseCosine=T.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Le(t,r,o):new t(0):new t(NaN):e.isZero()?Le(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Le(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};T.inverseHyperbolicCosine=T.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,D=!1,t=t.times(t).minus(1).sqrt().plus(t),D=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};T.inverseHyperbolicSine=T.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,D=!1,t=t.times(t).plus(1).sqrt().plus(t),D=!0,n.precision=i,n.rounding=e,t.ln())};T.inverseHyperbolicTangent=T.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?K(new o(r),i,e,!0):(o.precision=t=n-r.e,r=j(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};T.inverseSine=T.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Le(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};T.inverseTangent=T.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=yn)return s=Le(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=yn)return s=Le(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/N+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(D=!1,e=Math.ceil(a/N),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),D=!0,K(s,l.precision=m,l.rounding=d,!0)};T.isFinite=function(){return!!this.d};T.isInteger=T.isInt=function(){return!!this.d&&we(this.e/N)>this.d.length-2};T.isNaN=function(){return!this.s};T.isNegative=T.isNeg=function(){return this.s<0};T.isPositive=T.isPos=function(){return this.s>0};T.isZero=function(){return!!this.d&&this.d[0]===0};T.lessThan=T.lt=function(i){return this.cmp(i)<0};T.lessThanOrEqualTo=T.lte=function(i){return this.cmp(i)<1};T.logarithm=T.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(D=!1,a=m+p,s=Qe(u,a),n=e?Xt(l,a+10):Qe(i,a),c=j(s,n,a,1),Pt(c.d,r=m,d))do if(a+=10,s=Qe(u,a),n=e?Xt(l,a+10):Qe(i,a),c=j(s,n,a,1),!o){+pe(c.d).slice(r+1,r+15)+1==1e14&&(c=K(c,m+1,0));break}while(Pt(c.d,r+=10,d));return D=!0,K(c,m,d)};T.minus=T.sub=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,p=this,g=p.constructor;if(i=new g(i),!p.d||!i.d)return!p.s||!i.s?i=new g(NaN):p.d?i.s=-i.s:i=new g(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(u=p.d,d=i.d,a=g.precision,c=g.rounding,!u[0]||!d[0]){if(d[0])i.s=-i.s;else if(u[0])i=new g(p);else return new g(c===3?-0:0);return D?K(i,a,c):i}if(t=we(i.e/N),l=we(p.e/N),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/N),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}o=0}for(m&&(e=u,u=d,d=e,i.s=-i.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=Re-1;--u[r],u[n]+=Re}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=zt(u,t),D?K(i,a,c):i):new g(c===3?-0:0)};T.modulo=T.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?K(new n(t),n.precision,n.rounding):(D=!1,n.modulo==9?(e=j(t,i.abs(),0,3,1),e.s*=i.s):e=j(t,i,0,n.modulo,1),e=e.times(i),D=!0,t.minus(e))};T.naturalExponential=T.exp=function(){return wn(this)};T.naturalLogarithm=T.ln=function(){return Qe(this)};T.negated=T.neg=function(){var i=new this.constructor(this);return i.s=-i.s,K(i)};T.plus=T.add=function(i){var e,t,n,r,o,s,a,c,u,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(u=m.d,l=i.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(i=new d(m)),D?K(i,a,c):i;if(o=we(m.e/N),n=we(i.e/N),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/N),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Re|0,u[r]%=Re;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=zt(u,n),D?K(i,a,c):i};T.precision=T.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error($e+i);return t.d?(e=ui(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};T.round=function(){var i=this,e=i.constructor;return K(new e(i),i.e+1,e.rounding)};T.sine=T.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+N,n.rounding=1,t=br(n,pi(n,t)),n.precision=i,n.rounding=e,K(Xe>2?t.neg():t,i,e,!0)):new n(NaN)};T.squareRoot=T.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(D=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=pe(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=we((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(j(s,o,t+2,1)).times(.5),pe(o.d).slice(0,t)===(e=pe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(K(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(K(n,c+1,1),i=!n.times(n).eq(s));break}return D=!0,K(n,c,l.rounding,i)};T.tangent=T.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=j(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,K(Xe==2||Xe==4?t.neg():t,i,e,!0)):new n(NaN)};T.times=T.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=we(l.e/N)+we(i.e/N),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%Re|0,e=a/Re|0;o[r]=(o[r]+e)%Re|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=zt(o,t),D?K(i,m.precision,m.rounding):i};T.toBinary=function(i,e){return An(this,2,i,e)};T.toDecimalPlaces=T.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(xe(i,0,Je),e===void 0?e=n.rounding:xe(e,0,8),K(t,i+t.e+1,e))};T.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,!0):(xe(i,0,Je),e===void 0?e=r.rounding:xe(e,0,8),n=K(new r(n),i+1,e),t=ve(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=ve(r):(xe(i,0,Je),e===void 0?e=o.rounding:xe(e,0,8),n=K(new o(r),i+r.e+1,e),t=ve(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};T.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(u=t=new f(1),n=c=new f(0),e=new f(n),o=e.e=ui(g)-p.e-1,s=o%N,e.d[0]=ce(10,s<0?N+s:s),i==null)i=o>0?e:u;else{if(a=new f(i),!a.isInt()||a.lt(u))throw Error($e+a);i=a.gt(e)?o>0?e:u:a}for(D=!1,a=new f(pe(g)),l=f.precision,f.precision=o=g.length*N*2;m=j(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=j(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=p.s,d=j(u,n,o,1).minus(p).abs().cmp(j(c,t,o,1).minus(p).abs())<1?[u,n]:[c,t],f.precision=l,D=!0,d};T.toHexadecimal=T.toHex=function(i,e){return An(this,16,i,e)};T.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:xe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(D=!1,t=j(t,i,0,e,1).times(i),D=!0,K(t)):(i.s=t.s,t=i),t};T.toNumber=function(){return+this};T.toOctal=function(i,e){return An(this,8,i,e)};T.toPower=T.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ce(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return K(a,n,o);if(e=we(i.e/N),e>=i.d.length-1&&(t=u<0?-u:u)<=mr)return r=li(c,a,t,n),i.s<0?new c(1).div(r):K(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ce(+a,u),e=t==0||!isFinite(t)?we(u*(Math.log("0."+pe(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(D=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=wn(i.times(Qe(a,n+t)),n),r.d&&(r=K(r,n+5,1),Pt(r.d,n,o)&&(e=n+10,r=K(wn(i.times(Qe(a,e+t)),e),e+5,1),+pe(r.d).slice(n+1,n+15)+1==1e14&&(r=K(r,n+1,0)))),r.s=s,D=!0,c.rounding=o,K(r,n,o))};T.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(xe(i,1,Je),e===void 0?e=r.rounding:xe(e,0,8),n=K(new r(n),i,e),t=ve(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};T.toSignificantDigits=T.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(xe(i,1,Je),e===void 0?e=n.rounding:xe(e,0,8)),K(new n(t),i,e)};T.toString=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};T.truncated=T.trunc=function(){return K(new this.constructor(this),this.e+1,1)};T.valueOf=T.toJSON=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function pe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=N-n.length,t&&(o+=Ze(t)),o+=n;s=i[e],n=s+"",t=N-n.length,t&&(o+=Ze(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function xe(i,e,t){if(i!==~~i||i<e||i>t)throw Error($e+i)}function Pt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=N,r=0):(r=Math.ceil((e+1)/N),e%=N),o=ce(10,N-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ce(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ce(10,e-3)-1,s}function Wt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=bn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function pr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Yt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=gt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var j=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,m,d,p,g,f,b,y,w,h,A,P,k,x,I,O,_,q,ye,te=n.constructor,ke=n.s==r.s?1:-1,ee=n.d,z=r.d;if(!ee||!ee[0]||!z||!z[0])return new te(!n.s||!r.s||(ee?z&&ee[0]==z[0]:!z)?NaN:ee&&ee[0]==0||!z?ke*0:ke/0);for(c?(p=1,l=n.e-r.e):(c=Re,p=N,l=we(n.e/p)-we(r.e/p)),q=z.length,O=ee.length,y=new te(ke),w=y.d=[],m=0;z[m]==(ee[m]||0);m++);if(z[m]>(ee[m]||0)&&l--,o==null?(k=o=te.precision,s=te.rounding):a?k=o+(n.e-r.e)+1:k=o,k<0)w.push(1),g=!0;else{if(k=k/p+2|0,m=0,q==1){for(d=0,z=z[0],k++;(m<O||d)&&k--;m++)x=d*c+(ee[m]||0),w[m]=x/z|0,d=x%z|0;g=d||m<O}else{for(d=c/(z[0]+1)|0,d>1&&(z=i(z,d,c),ee=i(ee,d,c),q=z.length,O=ee.length),I=q,h=ee.slice(0,q),A=h.length;A<q;)h[A++]=0;ye=z.slice(),ye.unshift(0),_=z[0],z[1]>=c/2&&++_;do d=0,u=e(z,h,q,A),u<0?(P=h[0],q!=A&&(P=P*c+(h[1]||0)),d=P/_|0,d>1?(d>=c&&(d=c-1),f=i(z,d,c),b=f.length,A=h.length,u=e(f,h,b,A),u==1&&(d--,t(f,q<b?ye:z,b,c))):(d==0&&(u=d=1),f=z.slice()),b=f.length,b<A&&f.unshift(0),t(h,f,A,c),u==-1&&(A=h.length,u=e(z,h,q,A),u<1&&(d++,t(h,q<A?ye:z,A,c))),A=h.length):u===0&&(d++,h=[0]),w[m++]=d,u&&h[0]?h[A++]=ee[I]||0:(h=[ee[I]],A=1);while((I++<O||h[0]!==void 0)&&k--);g=h[0]!==void 0}w[0]||w.shift()}if(p==1)y.e=l,ri=g;else{for(m=1,d=w[0];d>=10;d/=10)m++;y.e=m+l*p-1,K(y,a?o+y.e+1:o,s,g)}return y}}();function K(i,e,t,n){var r,o,s,a,c,u,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=N,s=e,l=m[d=0],c=l/ce(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/N),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=N,s=o-N+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=N,s=o-N+r,c=s<0?0:l/ce(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ce(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ce(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=i.e+1,m[0]=ce(10,(N-e%N)%N),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ce(10,N-o),m[d]=s>0?(l/ce(10,r-s)%ce(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Re&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Re)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return D&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function ve(i,e,t){if(!i.isFinite())return di(i);var n,r=i.e,o=pe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Ze(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+Ze(-r-1)+o,t&&(n=t-s)>0&&(o+=Ze(n))):r>=s?(o+=Ze(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+Ze(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=Ze(n))),o}function zt(i,e){var t=i[0];for(e*=N;t>=10;t/=10)e++;return e}function Xt(i,e,t){if(e>dr)throw D=!0,t&&(i.precision=t),Error(oi);return K(new i(Gt),e,1,!0)}function Le(i,e,t){if(e>yn)throw Error(oi);return K(new i(Ut),e,t,!0)}function ui(i){var e=i.length-1,t=e*N+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function Ze(i){for(var e="";i--;)e+="0";return e}function li(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/N+4);for(D=!1;;){if(t%2&&(o=o.times(e),ni(o.d,s)&&(r=!0)),t=we(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ni(e.d,s)}return D=!0,o}function ti(i){return i.d[i.d.length-1]&1}function mi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function wn(i,e){var t,n,r,o,s,a,c,u=0,l=0,m=0,d=i.constructor,p=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(D=!1,c=g):c=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ce(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=K(o.times(i),c,1),t=t.times(++l),a=s.plus(j(o,t,c,1)),pe(a.d).slice(0,c)===pe(s.d).slice(0,c)){for(r=m;r--;)s=K(s.times(s),c,1);if(e==null)if(u<3&&Pt(s.d,c-n,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return K(s,d.precision=g,p,D=!0);else return d.precision=g,s}s=a}}function Qe(i,e){var t,n,r,o,s,a,c,u,l,m,d,p=1,g=10,f=i,b=f.d,y=f.constructor,w=y.rounding,h=y.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new y(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(D=!1,l=h):l=e,y.precision=l+=g,t=pe(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=pe(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new y("0."+t),o++):f=new y(n+"."+t.slice(1))}else return u=Xt(y,l+2,h).times(o+""),f=Qe(new y(n+"."+t.slice(1)),l-g).plus(u),y.precision=h,e==null?K(f,h,w,D=!0):f;for(m=f,c=s=f=j(f.minus(1),f.plus(1),l,1),d=K(f.times(f),l,1),r=3;;){if(s=K(s.times(d),l,1),u=c.plus(j(s,new y(r),l,1)),pe(u.d).slice(0,l)===pe(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Xt(y,l+2,h).times(o+""))),c=j(c,new y(p),l,1),e==null)if(Pt(c.d,l-g,w,a))y.precision=l+=g,u=s=f=j(m.minus(1),m.plus(1),l,1),d=K(f.times(f),l,1),r=a=1;else return K(c,y.precision=h,w,D=!0);else return y.precision=h,c;c=u,r+=2}}function di(i){return String(i.s*i.s/0)}function hn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%N,t<0&&(n+=N),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=N;n<r;)i.d.push(+e.slice(n,n+=N));e=e.slice(n),n=N-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),D&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function fr(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ci.test(e))return hn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(ur.test(e))t=16,e=e.toLowerCase();else if(cr.test(e))t=2;else if(lr.test(e))t=8;else throw Error($e+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=li(n,new n(t),o,o*2)),u=Wt(e,t,Re),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=zt(u,l),i.d=u,D=!1,s&&(i=j(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ce(2,c):Tt.pow(2,c))),D=!0,i)}function br(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:gt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Yt(5,t)),e=gt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function gt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,m=Math.ceil(l/N);for(D=!1,c=t.times(t),a=new i(n);;){if(s=j(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=j(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return D=!0,s.d.length=m+1,s}function Yt(i,e){for(var t=i;--e;)t*=i;return t}function pi(i,e){var t,n=e.s<0,r=Le(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Xe=n?4:1,e;if(t=e.divToInt(r),t.isZero())Xe=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Xe=ti(t)?n?2:3:n?4:1,e;Xe=ti(t)?n?1:4:n?3:2}return e.minus(r).abs()}function An(i,e,t,n){var r,o,s,a,c,u,l,m,d,p=i.constructor,g=t!==void 0;if(g?(xe(t,1,Je),n===void 0?n=p.rounding:xe(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=di(i);else{for(l=ve(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Wt(ve(d),10,r),d.e=d.d.length),m=Wt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=j(i,d,t,n,0,r),m=i.d,o=i.e,u=ri),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=bn.charAt(m[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Wt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=bn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ni(i,e){if(i.length>e)return i.length=e,!0}function gr(i){return new this(i).abs()}function yr(i){return new this(i).acos()}function wr(i){return new this(i).acosh()}function hr(i,e){return new this(i).plus(e)}function Ar(i){return new this(i).asin()}function Pr(i){return new this(i).asinh()}function Tr(i){return new this(i).atan()}function kr(i){return new this(i).atanh()}function xr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Le(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Le(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Le(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(j(i,e,o,1)),e=Le(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(j(i,e,o,1)),t}function Br(i){return new this(i).cbrt()}function Ir(i){return K(i=new this(i),i.e+1,2)}function Sr(i,e,t){return new this(i).clamp(e,t)}function Cr(i){if(!i||typeof i!="object")throw Error(Ht+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Je,"rounding",0,8,"toExpNeg",-bt,0,"toExpPos",0,bt,"maxE",0,bt,"minE",-bt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=gn[t]),(n=i[t])!==void 0)if(we(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error($e+t+": "+n);if(t="crypto",r&&(this[t]=gn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(si);else this[t]=!1;else throw Error($e+t+": "+n);return this}function Kr(i){return new this(i).cos()}function Nr(i){return new this(i).cosh()}function fi(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ii(o)){u.s=o.s,D?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;D?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return hn(u,o.toString())}else if(c!=="string")throw Error($e+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),ci.test(o)?hn(u,o):fr(u,o)}if(r.prototype=T,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Cr,r.clone=fi,r.isDecimal=ii,r.abs=gr,r.acos=yr,r.acosh=wr,r.add=hr,r.asin=Ar,r.asinh=Pr,r.atan=Tr,r.atanh=kr,r.atan2=xr,r.cbrt=Br,r.ceil=Ir,r.clamp=Sr,r.cos=Kr,r.cosh=Nr,r.div=Lr,r.exp=Rr,r.floor=Mr,r.hypot=Er,r.ln=Or,r.log=Fr,r.log10=_r,r.log2=Dr,r.max=vr,r.min=qr,r.mod=Vr,r.mul=Wr,r.pow=Gr,r.random=Ur,r.round=Xr,r.sign=Hr,r.sin=zr,r.sinh=Yr,r.sqrt=jr,r.sub=Zr,r.sum=Qr,r.tan=$r,r.tanh=Jr,r.trunc=eo,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Lr(i,e){return new this(i).div(e)}function Rr(i){return new this(i).exp()}function Mr(i){return K(i=new this(i),i.e+1,3)}function Er(){var i,e,t=new this(0);for(D=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return D=!0,new this(1/0);t=e}return D=!0,t.sqrt()}function ii(i){return i instanceof Tt||i&&i.toStringTag===ai||!1}function Or(i){return new this(i).ln()}function Fr(i,e){return new this(i).log(e)}function Dr(i){return new this(i).log(2)}function _r(i){return new this(i).log(10)}function vr(){return mi(this,arguments,"lt")}function qr(){return mi(this,arguments,"gt")}function Vr(i,e){return new this(i).mod(e)}function Wr(i,e){return new this(i).mul(e)}function Gr(i,e){return new this(i).pow(e)}function Ur(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:xe(i,1,Je),n=Math.ceil(i/N),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(si);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=N,n&&i&&(r=ce(10,N-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=N)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<N&&(t-=N-n)}return s.e=t,s.d=a,s}function Xr(i){return K(i=new this(i),i.e+1,this.rounding)}function Hr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function zr(i){return new this(i).sin()}function Yr(i){return new this(i).sinh()}function jr(i){return new this(i).sqrt()}function Zr(i,e){return new this(i).sub(e)}function Qr(){var i=0,e=arguments,t=new this(e[i]);for(D=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return D=!0,K(t,this.precision,this.rounding)}function $r(i){return new this(i).tan()}function Jr(i){return new this(i).tanh()}function eo(i){return K(i=new this(i),i.e+1,1)}T[Symbol.for("nodejs.util.inspect.custom")]=T.toString;T[Symbol.toStringTag]="Decimal";var Tt=T.constructor=fi(gn);Gt=new Tt(Gt);Ut=new Tt(Ut);var S=Tt;import{get as bi,set as to}from"lodash";import yi from"dayjs";import no from"dayjs/plugin/utc";yi.extend(no);var Pn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return yi().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},gi={},io={};function ue(i){let e=bi(gi,i);if(!e){let t=bi(io,i);e=new Pn({name:i,logLevel:t}),to(gi,i,e)}return e}import{PublicKey as sc}from"@solana/web3.js";import cc from"bn.js";import wo from"big.js";import Jt from"bn.js";import Be from"bn.js";import{PublicKey as Bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ro}from"@solana/spl-token";import{PublicKey as $,SystemProgram as wi,SYSVAR_RENT_PUBKEY as oo}from"@solana/web3.js";function Tn({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var As=[Tn({pubkey:ro,isWritable:!1}),Tn({pubkey:wi.programId,isWritable:!1}),Tn({pubkey:oo,isWritable:!1})];function kn({publicKey:i,transformSol:e}){let t=hi(i.toString());if(t instanceof $)return e&&t.equals(kt)?Q:t;if(e&&t.toString()===kt.toBase58())return Q;if(typeof t=="string"){if(t===$.default.toBase58())return $.default;try{return new $(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function hi(i){try{return new $(i)}catch{return i}}var jt=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ps=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xt=new $("SysvarRent111111111111111111111111111111111"),Ts=new $("SysvarC1ock11111111111111111111111111111111"),yt=new $("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ks=new $("Sysvar1nstructions1111111111111111111111111"),xs=wi.programId,Bs=new $("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Is=new $("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ss=new $("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Cs=new $("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ks=new $("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ns=new $("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ls=new $("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Rs=new $("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ms=new $("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Es=new $("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Os=new $("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Q=new $("So11111111111111111111111111111111111111112"),kt=$.default;function xn(i){return kn({publicKey:i,transformSol:!0})}import{PublicKey as so}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ai}from"@solana/spl-token";var Pi={chainId:101,address:so.default.toBase58(),programId:Ai.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},at={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ai.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var In=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===kt.toBase58()||e instanceof Bn&&kt.equals(e)){this.decimals=at.decimals,this.symbol=at.symbol,this.name=at.name,this.mint=new Bn(at.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Bn.default:kn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},He=In;He.WSOL=new In({...at,mint:at.address});import Qt from"big.js";import uo from"bn.js";import lo from"decimal.js-light";import ao from"toformat";var co=ao,Bt=co;var Zt=ue("module/fraction"),Sn=Bt(Qt),It=Bt(lo),mo={[0]:It.ROUND_DOWN,[1]:It.ROUND_HALF_UP,[2]:It.ROUND_UP},po={[0]:Qt.roundDown,[1]:Qt.roundHalfUp,[2]:Qt.roundUp},H=class{constructor(e,t=new uo(1)){this.numerator=fe(e),this.denominator=fe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(fe(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(fe(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(fe(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(fe(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<=0&&Zt.logWithError(`${e} is not positive.`),It.set({precision:e+1,rounding:mo[n]});let r=new It(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<0&&Zt.logWithError(`${e} is negative.`),Sn.DP=e,Sn.RM=po[n]||1,new Sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var bo=ue("Raydium_price"),Me=class extends H{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new H(Cn(n.decimals),Cn(r.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&bo.logWithError("mul token not equals");let n=super.mul(t);return new Me({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Kn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},$t=Kn;$t.SOL=new Kn(Pi);import go from"bn.js";var Ti=new H(new go(100)),ct=class extends H{toSignificant(e=5,t,n){return this.mul(Ti).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ti).toFixed(e,t,n)}};var yo=new Be(0),La=new Be(1),Ra=new Be(2),Ma=new Be(3),Ea=new Be(5),Nn=new Be(10),Oa=new Be(100),Fa=new Be(1e3),Da=new Be(1e4),ki=9007199254740991;function fe(i){let e=ue("Raydium_parseBigNumberish");if(i instanceof Be)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Be(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ki||i<=-ki)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Be(String(i))):typeof i=="bigint"?new Be(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Be(0))}function Cn(i){return Nn.pow(fe(i))}var ho=ue("Raydium_amount"),xi=Bt(wo);function Ao(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):ho.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var he=class extends H{constructor(t,n,r=!0,o){let s=new Jt(0),a=Nn.pow(new Jt(t.decimals));if(r)s=fe(n);else{let c=new Jt(0),u=new Jt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Ao(n.toString(),t.decimals);c=fe(l),u=fe(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ue(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new he(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new he(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return xi.DP=this.token.decimals,new xi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Kt,sendAndConfirmTransaction as On,Transaction as Nt,TransactionMessage as Lt,VersionedTransaction as Rt}from"@solana/web3.js";import Co from"axios";var se={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as Po,ComputeBudgetProgram as Bi,Transaction as Si,TransactionMessage as To,Keypair as Ci,VersionedTransaction as Ki}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ko}from"@solana/spl-token";var Ii=ue("Raydium_txUtil"),Ni=1644;function en(i){let e=[],t=[];return i.microLamports&&(e.push(Bi.setComputeUnitPrice({microLamports:i.microLamports})),t.push(se.SetComputeUnitPrice)),i.units&&(e.push(Bi.setComputeUnitLimit({units:i.units})),t.push(se.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function wt(i){var e,t;try{return((t=await((e=i.getLatestBlockhash)==null?void 0:e.call(i)))==null?void 0:t.blockhash)||(await i.getRecentBlockhash()).blockhash}catch{return(await i.getRecentBlockhash()).blockhash}}function xo(i,e){i.length<1&&Ii.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Ii.logWithError(`no signers provided:, ${e.toString()}`);let t=new Si;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ni}catch{return!1}}function Ie(i,e){let[t,n]=Po.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function St({instructions:i,payer:e,signers:t}){return xo(i,[e,...t])}function Ct({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Ci.generate().publicKey.toString()}){let o=new To({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ki(o).serialize()).toString("base64").length<Ni}catch{return!1}}var Bo=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i);function ut(i){let e=[];return i.forEach(t=>{t instanceof Si&&(t.recentBlockhash||(t.recentBlockhash=ko.toBase58()),t.feePayer||(t.feePayer=Ci.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Ki&&(n=Bo(n));let r=n.toString("base64");e.push(r)}),console.log("simulate tx string:",e),e}import{PublicKey as Li,AddressLookupTableAccount as tn}from"@solana/web3.js";import{PublicKey as Io}from"@solana/web3.js";import{getTransferFeeConfig as Sc,unpackMint as Cc}from"@solana/spl-token";var Ln=ue("Raydium_accountInfo_util");async function et(i,e,t){let{batchRequest:n,commitment:r="confirmed"}={batchRequest:!1,...t},o=Rn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=i._buildArgs([l.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),c=Rn(a,10);s=(await(await Promise.all(c.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Ln.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:g,owner:f,rentEpoch:b}=m;return d.length!==2&&d[1]!=="base64"&&Ln.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:g,owner:new Io(f),rentEpoch:b}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&Ln.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Mn(i,e,t){let n=await et(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}async function En({connection:i,address:e}){let t=await et(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Li(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new tn({key:s,state:tn.deserialize(o.data)});n[s.toString()]=a,nn[s.toString()]=a}return n}var nn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new tn({key:new Li("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:tn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var rn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Co.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=en(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Kt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0({...t||{}}):this.build(t)}build(e){let t=new Nt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async n=>{var a;let{recentBlockHash:r,skipPreflight:o=!0}=n||{},s=r!=null?r:await wt(this.connection);if(t.recentBlockhash=s,this.signers.length&&t.sign(...this.signers),ut([t]),(a=this.owner)!=null&&a.isKeyPair)return{txId:await On(this.connection,t,this.signers.find(c=>c.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:o}),signedTx:t};if(this.signAllTransactions){let c=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:o}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(u=>u.transaction.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var f;let{sequentially:l,onTxUpdate:m,recentBlockHash:d,skipPreflight:p=!0}=u||{},g=d!=null?d:await wt(this.connection);if((f=this.owner)!=null&&f.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,y)=>(b.recentBlockhash=g,await On(this.connection,b,a[y].find(w=>w.publicKey.equals(this.owner.publicKey))?a[y]:[...a[y],this.owner.signer],{skipPreflight:p})))),signedTxs:s};if(this.signAllTransactions){let b=s.map((w,h)=>(w.recentBlockhash=g,a[h].length&&w.sign(...a[h]),w));ut(b);let y=await this.signAllTransactions(b);if(l){let w=0,h=[],A=async()=>{if(!y[w])return;let P=await this.connection.sendRawTransaction(y[w].serialize(),{skipPreflight:p});h.push({txId:P,status:"sent",signedTx:y[w]}),m==null||m([...h]),w++,this.connection.onSignature(P,k=>{let x=h.findIndex(I=>I.txId===P);x>-1&&(h[x].status=k.err?"error":"success"),m==null||m([...h]),k.err||A()},"processed"),this.connection.getSignatureStatus(P)};return await A(),{txIds:h.map(P=>P.txId),signedTxs:y}}else{let w=[];for(let h=0;h<y.length;h+=1){let A=await this.connection.sendRawTransaction(y[h].serialize(),{skipPreflight:p});w.push(A)}return{txIds:w,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,...o}=e||{},s={...this.cluster==="devnet"?{}:nn,...t},a=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let d of a)s[d]===void 0&&c.push(new Kt(d));let u=await En({connection:this.connection,address:c});for(let[d,p]of Object.entries(u))s[d]=p;let l=new Lt({payerKey:this.feePayer,recentBlockhash:r?Kt.default.toBase58():await wt(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new Rt(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async d=>{var f;let{recentBlockHash:p,skipPreflight:g=!0}=d||{};if(p&&(m.message.recentBlockhash=p),ut([m]),(f=this.owner)!=null&&f.isKeyPair){this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))||m.sign([this.owner.signer]);let b=await this.connection.sendTransaction(m,{skipPreflight:g}),{lastValidBlockHeight:y,blockhash:w}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:w,lastValidBlockHeight:y,signature:b},"confirmed"),{txId:b,signedTx:m}}if(this.signAllTransactions){let b=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:g}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(u=>u.builder.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{var g;let{sequentially:l,onTxUpdate:m,recentBlockHash:d,skipPreflight:p=!0}=u||{};if(d&&s.forEach(f=>f.message.recentBlockhash=d),ut(s),(g=this.owner)!=null&&g.isKeyPair){let{lastValidBlockHeight:f,blockhash:b}=await this.connection.getLatestBlockhash();return s.forEach((y,w)=>{a[w].find(h=>h.publicKey.equals(this.owner.publicKey))||y.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async y=>{let w=await this.connection.sendTransaction(y,{skipPreflight:p});return await this.connection.confirmTransaction({blockhash:b,lastValidBlockHeight:f,signature:w},"confirmed"),w})),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(l){let b=0,y=[],w=async()=>{if(!f[b])return;let h=await this.connection.sendTransaction(f[b],{skipPreflight:p});y.push({txId:h,status:"sent",signedTx:f[b]}),m==null||m([...y]),b++,this.connection.onSignature(h,A=>{let P=y.findIndex(k=>k.txId===h);P>-1&&(y[P].status=A.err?"error":"success"),m==null||m([...y]),A.err||w()},"processed"),this.connection.getSignatureStatus(h)};return w(),{txIds:[],signedTxs:f}}else{let b=[];for(let y=0;y<f.length;y+=1){let w=await this.connection.sendTransaction(f[y],{skipPreflight:p});b.push(w)}return{txIds:b,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){let{computeBudgetConfig:t,...n}=e||{},r=t?en(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((u,l)=>({...u,[l.publicKey.toBase58()]:l}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(u=>{let l=[...c,u],m=t?[...r.instructions,...l]:l,p=[...new Set(l.map(g=>g.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(g=>new Kt(g));if(c.length<12&&St({instructions:m,payer:this.feePayer,signers:p})||St({instructions:l,payer:this.feePayer,signers:p}))c.push(u);else{if(c.length===0)throw Error("item ins too big");St({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:p})?s.push(new Nt().add(...r.instructions,...c)):s.push(new Nt().add(...c)),a.push(Array.from(new Set(c.map(g=>g.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat())).map(g=>o[g]).filter(g=>g!==void 0)),c=[u]}}),c.length>0){let l=[...new Set(c.map(m=>m.keys.filter(d=>d.isSigner).map(d=>d.pubkey.toString())).flat()).values()].map(m=>o[m]).filter(m=>m!==void 0);St({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:l.map(m=>m.publicKey)})?s.push(new Nt().add(...r.instructions,...c)):s.push(new Nt().add(...c)),a.push(l)}return s.forEach(u=>u.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async u=>{var f;let{sequentially:l,onTxUpdate:m,recentBlockHash:d,skipPreflight:p=!0}=u||{},g=d!=null?d:await wt(this.connection);if(s.forEach(async(b,y)=>{b.recentBlockhash=g,a[y].length&&b.sign(...a[y])}),ut(s),(f=this.owner)!=null&&f.isKeyPair)return{txIds:await Promise.all(s.map(async(b,y)=>await On(this.connection,b,a[y].find(w=>w.publicKey.equals(this.owner.publicKey))?a[y]:[...a[y],this.owner.signer],{skipPreflight:p}))),signedTxs:s};if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(l){let y=0,w=[],h=async()=>{if(!b[y])return;let A=await this.connection.sendRawTransaction(b[y].serialize(),{skipPreflight:p});w.push({txId:A,status:"sent",signedTx:b[y]}),m==null||m([...w]),y++,this.connection.onSignature(A,P=>{let k=w.findIndex(x=>x.txId===A);k>-1&&(w[k].status=P.err?"error":"success"),m==null||m([...w]),P.err||h()},"processed"),this.connection.getSignatureStatus(A)};return await h(),{txIds:w.map(A=>A.txId),signedTxs:b}}else{let y=[];for(let w=0;w<b.length;w+=1){let h=await this.connection.sendRawTransaction(b[w].serialize(),{skipPreflight:p});y.push(h)}return{txIds:y,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[],...o}=e||{},s={...this.cluster==="devnet"?{}:nn,...n},a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let b of a)s[b]===void 0&&c.push(new Kt(b));let u=await En({connection:this.connection,address:c});for(let[b,y]of Object.entries(u))s[b]=y;let l=t?en(t):{instructions:[],instructionTypes:[]},m=await wt(this.connection),d=this.signers.reduce((b,y)=>({...b,[y.publicKey.toBase58()]:y}),{}),p=[],g=[],f=[];if(this.allInstructions.forEach(b=>{let y=[...f,b],w=t?[...l.instructions,...y]:y;if(f.length<12&&Ct({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||Ct({instructions:y,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(b);else{if(f.length===0)throw Error("item ins too big");let h={};for(let A of[...new Set(a)])s[A]!==void 0&&(h[A]=s[A]);if(t&&Ct({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Rt(A))}else{let A=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Rt(A))}g.push(Array.from(new Set(f.map(A=>A.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat())).map(A=>d[A]).filter(A=>A!==void 0)),f=[b]}}),f.length>0){let y=[...new Set(f.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(w=>d[w]).filter(w=>w!==void 0);if(t&&Ct({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let w=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Rt(w))}else{let w=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Rt(w))}g.push(y)}return{builder:this,transactions:p,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async b=>{var P;let{sequentially:y,onTxUpdate:w,recentBlockHash:h,skipPreflight:A=!0}=b||{};if(p.map(async(k,x)=>{g[x].length&&k.sign(g[x]),h&&(k.message.recentBlockhash=h)}),ut(p),(P=this.owner)!=null&&P.isKeyPair){let{lastValidBlockHeight:k,blockhash:x}=await this.connection.getLatestBlockhash();return p.forEach((I,O)=>{g[O].find(_=>_.publicKey.equals(this.owner.publicKey))||I.sign([this.owner.signer])}),{txIds:await Promise.all(p.map(async I=>{let O=await this.connection.sendTransaction(I,{skipPreflight:A});return await this.connection.confirmTransaction({blockhash:x,lastValidBlockHeight:k,signature:O},"confirmed"),O})),signedTxs:p}}if(this.signAllTransactions){let k=await this.signAllTransactions(p);if(y){let x=0,I=[],O=async()=>{if(!k[x])return;let _=await this.connection.sendTransaction(k[x],{skipPreflight:A});I.push({txId:_,status:"sent",signedTx:k[x]}),w==null||w([...I]),x++,this.connection.onSignature(_,q=>{let ye=I.findIndex(te=>te.txId===_);ye>-1&&(I[ye].status=q.err?"error":"success"),w==null||w([...I]),q.err||O()},"processed"),this.connection.getSignatureStatus(_)};return O(),{txIds:[],signedTxs:k}}else{let x=[];for(let I=0;I<k.length;I+=1){let O=await this.connection.sendTransaction(k[I],{skipPreflight:A});x.push(O)}return{txIds:x,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};function Rn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as ae}from"@solana/web3.js";var Zc=new ae("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Qc=new ae("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),$c=new ae("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Jc=new ae("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),eu=new ae("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),tu=new ae("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),nu=new ae("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),iu=new ae("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ru=new ae("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ou=new ae("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),su=new ae("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),au=new ae("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),cu=new ae("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),uu=new ae("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),lu=new ae("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),mu=new ae("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),du=new ae("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),pu=new ae("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),fu=new ae("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),bu=new ae("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as Ko}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as No}from"@solana/spl-token";function Ee(i,e,t){return Ie([i.toBuffer(),(t!=null?t:No).toBuffer(),e.toBuffer()],new Ko("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Oe from"bn.js";var Mt=1e4;function ie(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Oe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Mt){let c=new Oe(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Fn(i.mul(new Oe(Mt)),new Oe(Mt-o.transferFeeBasisPoints)),u=new Oe(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,m=Fn(l.mul(new Oe(o.transferFeeBasisPoints)),new Oe(Mt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Fn(i.mul(new Oe(o.transferFeeBasisPoints)),new Oe(Mt)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function lt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Fn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Oe(0))?t.add(new Oe(1)):t}var Dn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Et=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ue(t)}createTxBuilder(e){return this.scope.checkOwner(),new rn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Dn(e))}logInfo(...e){this.logger.info(Dn(e))}logAndCreateError(...e){let t=Dn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import qe from"bn.js";var X=new qe(0),Ve=new qe(1),ze=new qe(-1),Se=new qe(1).shln(64),on=new qe(1).shln(128),_n=Se.sub(Ve),Ot=64,Ri=on.subn(1),Ae=-443636,Te=-Ae,tt=new qe("4295048016"),nt=new qe("79226673521066979257578248091"),Mi=16,Ei="59543866431248",Oi="184467440737095516",Fi="15793534762490258745",sn=new qe(10).pow(new qe(6)),Lo=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(Lo||{}),Xu={[500]:10,[3e3]:60,[1e4]:200},Hu={version:6,liquidity:X,tickCurrent:0,observationIndex:0,observationUpdateDuration:0,feeGrowthGlobalX64A:X,feeGrowthGlobalX64B:X,protocolFeesTokenA:X,protocolFeesTokenB:X,swapInAmountTokenA:X,swapOutAmountTokenB:X,swapInAmountTokenB:X,swapOutAmountTokenA:X,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},Di={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},zu=new qe("18446744073700000000");import v from"bn.js";function _i(i){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,i,!1),new Uint8Array(e)}function ju(i){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,i,!1),new Uint8Array(e)}function Zu(i){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,i,!1),new Uint8Array(e)}function an(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function vn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function qn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Ft(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function vi(i,e){return Ft(i,e)?null:vn(i,e)}function qi(i,e){return Ft(i,e)?null:qn(i,e)}var Ro=Buffer.from("amm_config","utf8"),Mo=Buffer.from("pool","utf8"),Eo=Buffer.from("pool_vault","utf8"),Oo=Buffer.from("pool_reward_vault","utf8"),Vi=Buffer.from("position","utf8"),Fo=Buffer.from("tick_array","utf8"),Do=Buffer.from("operation","utf8"),_o=Buffer.from("pool_tick_array_bitmap_extension","utf8");function el(i,e){return Ie([Ro,_i(e)],i)}function Wi(i,e,t,n){return Ie([Mo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Vn(i,e,t){return Ie([Eo,e.toBuffer(),t.toBuffer()],i)}function Gi(i,e,t){return Ie([Oo,e.toBuffer(),t.toBuffer()],i)}function Y(i,e,t){return Ie([Fo,e.toBuffer(),an(t)],i)}function mt(i,e,t,n){return Ie([Vi,e.toBuffer(),an(t),an(n)],i)}function Ce(i,e){return Ie([Vi,e.toBuffer()],i)}function cn(i){return Ie([Buffer.from("metadata","utf8"),yt.toBuffer(),i.toBuffer()],yt)}function Dt(i){return Ie([Do],i)}function We(i,e){return Ie([_o,e.toBuffer()],i)}import{PublicKey as it}from"@solana/web3.js";import oe from"bn.js";import ts from"bn.js";import{PublicKey as zo}from"@solana/web3.js";import zi,{isBN as Yi}from"bn.js";import{bits as il,BitStructure as rl,blob as vo,Blob as ol,cstr as sl,f32 as al,f32be as cl,f64 as ul,f64be as ll,greedy as ml,Layout as qo,ns64 as dl,ns64be as pl,nu64 as fl,nu64be as bl,offset as gl,s16 as yl,s16be as wl,s24 as hl,s24be as Al,s32 as Vo,s32be as Pl,s40 as Tl,s40be as kl,s48 as xl,s48be as Bl,s8 as Il,seq as Wo,struct as Sl,Structure as Go,u16 as Uo,u16be as Cl,u24 as Kl,u24be as Nl,u32 as Ll,u32be as Rl,u40 as Ml,u40be as El,u48 as Ol,u48be as Fl,u8 as Xo,UInt as Ho,union as Dl,Union as _l,unionLayoutDiscriminator as vl,utf8 as ql}from"@solana/buffer-layout";var Wn=qo,Ui=Go;var Gn=Ho;var Xi=Xo,ht=Uo;var be=Vo;var Hi=Wo;var Ke=vo;var _t=class extends Wn{constructor(t,n,r){super(t,r);this.blob=Ke(t),this.signed=n}decode(t,n=0){let r=new zi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new zi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function re(i){return new Gn(1,i)}function Ye(i){return new Gn(4,i)}function M(i){return new _t(8,!1,i)}function W(i){return new _t(16,!1,i)}function ji(i){return new _t(16,!0,i)}var un=class extends Wn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function J(i){return new un(Ke(32),e=>new zo(e),e=>e.toBuffer(),i)}function Ge(i){return new un(Xi(),Yo,jo,i)}function Yo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function jo(i){return i?1:0}var Un=class extends Ui{decode(e,t){return super.decode(e,t)}};function Z(i,e,t){return new Un(i,e,t)}function ne(i,e,t){let n,r=typeof e=="number"?e:Yi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Yi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Hi(i,r,t)}var Xn=14,je=class{static maxTickInTickarrayBitmap(e){return e*le*dt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-U.tickCount(n):t+U.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*le,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),m=vi(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=qi(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}},vt=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=je.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=je.maxTickInTickarrayBitmap(e),n=-t;if(Te<=t)throw Error(`extensionTickBoundary check error: ${Te}, ${t}`);if(n<=Ae)throw Error(`extensionTickBoundary check error: ${n}, ${Ae}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:C.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=U.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=je.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=C.mergeTickArrayBitmap(e).shln(dt-1-a),u=Ft(512,c)?null:vn(512,c);if(u!==null){let l=t-u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=C.mergeTickArrayBitmap(e).shrn(a),u=Ft(512,c)?null:qn(512,c);if(u!==null){let l=t+u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%je.maxTickInTickarrayBitmap(t),r=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(r=dt-r),r}};var am=Z([Ke(8),re("bump"),ht("index"),J(""),Ye("protocolFeeRate"),Ye("tradeFeeRate"),ht("tickSpacing"),ne(M(),8,"")]),Zo=Z([Ye("blockTimestamp"),W("sqrtPriceX64"),W("cumulativeTimePriceX64"),ne(W(),1,"")]),Hn=Z([Ke(8),Ge("initialized"),J("poolId"),ne(Zo,1e3,"observations"),ne(W(),5,"")]),Qo=Z([re("rewardState"),M("openTime"),M("endTime"),M("lastUpdateTime"),W("emissionsPerSecondX64"),M("rewardTotalEmissioned"),M("rewardClaimed"),J("tokenMint"),J("tokenVault"),J("creator"),W("rewardGrowthGlobalX64")]),ln=Z([Ke(8),re("bump"),J("ammConfig"),J("creator"),J("mintA"),J("mintB"),J("vaultA"),J("vaultB"),J("observationId"),re("mintDecimalsA"),re("mintDecimalsB"),ht("tickSpacing"),W("liquidity"),W("sqrtPriceX64"),be("tickCurrent"),ht("observationIndex"),ht("observationUpdateDuration"),W("feeGrowthGlobalX64A"),W("feeGrowthGlobalX64B"),M("protocolFeesTokenA"),M("protocolFeesTokenB"),W("swapInAmountTokenA"),W("swapOutAmountTokenB"),W("swapInAmountTokenB"),W("swapOutAmountTokenA"),re("status"),ne(re(),7,""),ne(Qo,3,"rewardInfos"),ne(M(),16,"tickArrayBitmap"),M("totalFeesTokenA"),M("totalFeesClaimedTokenA"),M("totalFeesTokenB"),M("totalFeesClaimedTokenB"),M("fundFeesTokenA"),M("fundFeesTokenB"),M("startTime"),ne(M(),15*4-3,"padding")]),$o=Z([W("growthInsideLastX64"),M("rewardAmountOwed")]),mn=Z([Ke(8),re("bump"),J("nftMint"),J("poolId"),be("tickLower"),be("tickUpper"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),M("tokenFeesOwedA"),M("tokenFeesOwedB"),ne($o,3,"rewardInfos"),ne(M(),8,"")]),cm=Z([Ke(8),re("bump"),J("poolId"),be("tickLowerIndex"),be("tickUpperIndex"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),M("tokenFeesOwedA"),M("tokenFeesOwedB"),ne(W(),3,"rewardGrowthInside"),ne(M(),8,"")]),Jo=Z([be("tick"),ji("liquidityNet"),W("liquidityGross"),W("feeGrowthOutsideX64A"),W("feeGrowthOutsideX64B"),ne(W(),3,"rewardGrowthsOutsideX64"),ne(Ye(),13,"")]),qt=Z([Ke(8),J("poolId"),be("startTickIndex"),ne(Jo,le,"ticks"),re("initializedTickCount"),ne(re(),115,"")]),Zi=Z([Ke(329),ne(J(),100,"whitelistMints")]),Qi=Z([Ke(8),J("poolId"),ne(ne(M(),8),Xn,"positiveTickArrayBitmap"),ne(ne(M(),8),Xn,"negativeTickArrayBitmap")]);var es=15,U=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=C.getTickArrayStartIndexByTick(r,o),l=C.getInitializedTickArrayInRange(s,a,o,u,Math.floor(es/2));for(let p=0;p<l.length;p++){let{publicKey:g}=Y(t,n,l[p]);c.push(g)}let m=(await et(e,c)).map(p=>p!==null?qt.decode(p.data):null),d={};for(let p=0;p<c.length;p++){let g=m[p];g!==null&&(d[g.startTickIndex]={...g,address:c[p]})}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=C.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/U.tickCount(t)),a=n?C.searchLowBitFromStart(r,o,s-1,1,t):C.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=le-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<le;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=Y(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=C.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<le;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=Y(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(C.checkIsOutOfBoundary(e)){if(e>Te)return!1;let n=C.getTickArrayStartIndexByTick(Ae,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return le*e}};var le=60,dt=512,C=class{static getTickArrayAddressByTick(e,t,n,r){let o=C.getTickArrayStartIndexByTick(n,r),{publicKey:s}=Y(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=C.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=le)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*le,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*le,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*le:e+t*le}static mergeTickArrayBitmap(e){let t=new ts(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*le));return[...C.searchLowBitFromStart(e,t,s-1,o,n),...C.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return C.searchHightBitFromStart(e,t,0,dt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=C.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=Y(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>C.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>C.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Ae||e>Te}static nextInitTick(e,t,n,r,o){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<le;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=le-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<le;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=E.getSqrtPriceX64FromTick(t),o=E.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=E.getSqrtPriceX64FromTick(o),a=E.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=E.getSqrtPriceX64FromTick(t),o=E.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=E.getSqrtPriceX64FromTick(o),a=E.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};import Ue from"bn.js";var Vt=class{static getfeeGrowthInside(e,t,n){let r=new Ue(0),o=new Ue(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ue(0),a=new Ue(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=F.wrappingSubU128(F.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=F.wrappingSubU128(F.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=F.mulDivFloor(F.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Se),c=t.tokenFeesOwedA.add(a),u=F.mulDivFloor(F.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Se),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=F.mulDivFloor(F.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Se),c=t.tokenFeesOwedA.add(a),u=F.mulDivFloor(F.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Se),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=F.wrappingSubU128(c,u.growthInsideLastX64),m=F.mulDivFloor(l,t.liquidity,Se),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=F.wrappingSubU128(c,u.growthInsideLastX64),m=F.mulDivFloor(l,t.liquidity,Se),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ue(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ue(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(F.wrappingSubU128(F.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ue(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ue(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(F.wrappingSubU128(F.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,y,w,h;let a=E.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),c=E.getSqrtPriceX64FromTick(t.tickLower),u=E.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=G.getAmountsFromLiquidity(a,c,u,n,o),[d,p]=[ie(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ie(m.amountB,(y=e.mintB.extensions)==null?void 0:y.feeConfig,s,!0)],[g,f]=[ie(new Ue(new S(m.amountA.toString()).mul(l).toFixed(0)),(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),ie(new Ue(new S(m.amountB.toString()).mul(l).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:lt(d.expirationTime,p.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as $i}from"@solana/spl-token";var Pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintA.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=ft.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,u,o);return a.push(...d),{expectedAmountOut:m.mul(ze),remainingAccounts:a,executionPrice:p,feeAmount:g}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=Y(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=ft.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(ze),u,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?vt.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):C.checkTickArrayIsInitialized(C.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Y(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Y(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),r=t?C.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):C.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=je.nextInitializedTickArrayStartIndex(C.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=vt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ae||t>Te)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let p={...m,perSecond:F.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new it(d)};if(p.tokenMint.equals(it.default))continue;if(n<=p.openTime.toNumber()||r.eq(X)){s.push(p);continue}let g=new oe(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),b=F.mulDivFloor(f,p.emissionsPerSecondX64,r),y=p.rewardGrowthGlobalX64.add(b),w=F.mulDivFloor(f,p.emissionsPerSecondX64,Se),h=p.rewardTotalEmissioned.add(w);s.push({...p,rewardGrowthGlobalX64:y,rewardTotalEmissioned:h,lastUpdateTime:g})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=C.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=je.maxTickInTickarrayBitmap(e),n=-t;return t>Te&&(t=U.getArrayStartIndex(Te,e)+U.tickCount(e)),n<Ae&&(n=U.getArrayStartIndex(Ae,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*dt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Mn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Qi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=C.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=C.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=Y(c.programId,c.id,m);o.push({pubkey:d}),r[d.toString()]=c.id}}let s=await Mn(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=qt.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]={...l,address:c.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let p of s)u.push(Ce(p,d).publicKey);let l=await et(t,u,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=mn.decode(d.data),g=p.poolId.toString(),f=e.find(I=>I.state.id.toBase58()===g);if(f===void 0)continue;let b=f.state,y=C._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),w=C._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:h,amountB:A}=G.getAmountsFromLiquidity(b.sqrtPriceX64,y.tickSqrtPriceX64,w.tickSqrtPriceX64,p.liquidity,!1),P=1/(1-Math.sqrt(Math.sqrt(y.price.div(w.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:y.price,priceUpper:w.price,amountA:h,amountB:A,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(I=>({...I,pendingReward:new oe(0)})),leverage:P,tokenFeeAmountA:new oe(0),tokenFeeAmountB:new oe(0)}];let k=await C.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),x=await C.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=k,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=x}if(o){let d=Object.values(m),p=await et(t,d,{batchRequest:r}),g={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let y=d[f].toString();g[y]=qt.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let y of b){let w=`${f.programId.toString()}-${f.id.toString()}-${y.tickLower}`,h=`${f.programId.toString()}-${f.id.toString()}-${y.tickUpper}`,A=g[m[w].toString()],P=g[m[h].toString()],k=A.ticks[C.getTickOffsetInArray(y.tickLower,f.tickSpacing)],x=P.ticks[C.getTickOffsetInArray(y.tickUpper,f.tickSpacing)],{tokenFeeAmountA:I,tokenFeeAmountB:O}=await Vt.GetPositionFees(f,y,k,x),_=await Vt.GetPositionRewards(f,y,k,x);y.tokenFeeAmountA=I.gte(new oe(0))?I:new oe(0),y.tokenFeeAmountB=O.gte(new oe(0))?O:new oe(0);for(let q=0;q<_.length;q++)y.rewardInfos[q].pendingReward=_[q].gte(new oe(0))?_[q]:new oe(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new S(0)}){var _;let c,u=n.toBase58()===e.mintA.address,[l,m]=u?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?c=u?tt.add(new oe(1)):nt.sub(new oe(1)):c=E.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=ie(o,l,r,!1),{expectedAmountOut:p,remainingAccounts:g,executionPrice:f,feeAmount:b}=Pe.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((_=d.fee)!=null?_:X),c),y=ie(p,m,r,!1),w=E.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),h=u?w:new S(1).div(w),A=p.mul(new oe(Math.floor((1-s)*1e10))).div(new oe(1e10)),P=ie(A,m,r,!1),k=u?e.currentPrice:new S(1).div(e.currentPrice),x=new S(h).sub(k).abs(),I=k,O=new ct(new S(x).mul(10**15).toFixed(0),new S(I).mul(10**15).toFixed(0));return{realAmountIn:d,amountOut:y,minAmountOut:P,expirationTime:lt(d.expirationTime,y.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:O,fee:b,remainingAccounts:g}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s}){let a=r.address===e.mintB.address,[c,u]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,m]=[new He({...c,mint:c.address,isToken2022:c.programId===$i.toBase58()}),new He({...u,mint:u.address,isToken2022:u.programId===$i.toBase58()})],{realAmountIn:d,amountOut:p,minAmountOut:g,expirationTime:f,currentPrice:b,executionPrice:y,priceImpact:w,fee:h,remainingAccounts:A}=await Pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new it(c.address),amountIn:n,slippage:o,epochInfo:s}),P={...d,amount:new he(l,d.amount),fee:d.fee===void 0?void 0:new he(l,d.fee)},k={...p,amount:new he(m,p.amount),fee:p.fee===void 0?void 0:new he(m,p.fee)},x={...g,amount:new he(m,g.amount),fee:g.fee===void 0?void 0:new he(m,g.fee)},I=new Me({baseToken:l,denominator:new oe(10).pow(new oe(20+l.decimals)),quoteToken:m,numerator:b.mul(new S(10**(20+m.decimals))).toFixed(0)}),O=new Me({baseToken:l,denominator:new oe(10).pow(new oe(20+l.decimals)),quoteToken:m,numerator:y.mul(new S(10**(20+m.decimals))).toFixed(0)}),_=new he(l,h);return{realAmountIn:P,amountOut:k,minAmountOut:x,expirationTime:f,currentPrice:I,executionPrice:O,priceImpact:w,fee:_,remainingAccounts:A}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,b;let o=e[t],s=C.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=C.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[(g=o.rewardApr[0])!=null?g:0*p,(f=o.rewardApr[1])!=null?f:0*p,(b=o.rewardApr[2])!=null?b:0*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[xn(e.mintA.address).toString()],d=r[xn(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=E.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),b=E.getSqrtPriceX64FromTick(s),y=E.getSqrtPriceX64FromTick(a),{amountSlippageA:w,amountSlippageB:h}=G.getAmountsFromLiquidityWithSlippage(f,b,y,t,!1,!1,0),{amountSlippageA:A,amountSlippageB:P}=G.getAmountsFromLiquidityWithSlippage(f,b,y,o,!1,!1,0),k=new S(w.toString()).div(new S(10).pow(p)).mul(m.value).add(new S(h.toString()).div(new S(10).pow(g)).mul(d.value)),x=new S(A.toString()).div(new S(10).pow(p)).mul(m.value).add(new S(P.toString()).div(new S(10).pow(g)).mul(d.value)),I=x.div(k.add(x)).div(x),_=new S(l.volumeFee).mul(365).div(u).mul(I).mul(100).toNumber(),q=3600*24*365,ye=e.rewardDefaultInfos.map(te=>{var z,ei;let ke=te.mint.decimals,ee=r[te.mint.address];return c<((z=te.startTime)!=null?z:0)||c>((ei=te.endTime)!=null?ei:0)||!te.perSecond||!ee||ke===void 0?0:new S(ee.value).mul(new S(te.perSecond).mul(q)).div(new S(10).pow(ke)).mul(I).mul(100).toNumber()});return{feeApr:_,rewardsApr:ye,apr:_+ye.reduce((te,ke)=>te+ke,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var y,w;let l=E.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=E.getSqrtPriceX64FromTick(n),d=E.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,g=ie(o,(y=e[t?"mintA":"mintB"].extensions)==null?void 0:y.feeConfig,c,!u),f=new oe(new S(g.amount.sub((w=g.fee)!=null?w:X).toString()).mul(p).toFixed(0)),b;if(l.lte(m))b=t?G.getLiquidityFromTokenAmountA(m,d,f,!a):new oe(0);else if(l.lte(d)){let h=G.getLiquidityFromTokenAmountA(l,d,f,!a),A=G.getLiquidityFromTokenAmountB(m,l,f);b=t?h:A}else b=t?new oe(0):G.getLiquidityFromTokenAmountB(m,d,f);return Pe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,y,w,h;let c=E.getSqrtPriceX64FromTick(n),u=E.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=G.getAmountsFromLiquidity(E.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,p]=[ie(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ie(m.amountB,(y=t.mintB.extensions)==null?void 0:y.feeConfig,e,!0)],[g,f]=[ie(m.amountA.muln(l),(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),ie(m.amountB.muln(l),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:lt(d.expirationTime,p.expirationTime)}}static async fetchComputeClmmInfo({owner:e,connection:t,poolInfo:n}){let r=await t.getAccountInfo(new it(n.id));if(!r)throw new Error(`pool not found ${n.id}`);let o=ln.decode(r.data),s=We(e,new it(n.id)).publicKey,a=await Pe.fetchExBitmaps({connection:t,exBitmapAddress:[s],batchRequest:!1});return{...o,id:new it(n.id),programId:new it(n.programId),mintA:n.mintA,mintB:n.mintB,ammConfig:{...n.config,id:new it(n.config.id),fundOwner:""},currentPrice:new S(n.price),exBitmapInfo:a[s.toBase58()],startTime:o.startTime.toNumber()}}};function jm({poolInfo:i,tickLower:e,tickUpper:t,amountA:n,amountB:r,slippage:o,add:s,epochInfo:a,amountHasFee:c}){var h,A,P,k;let[u,l,m,d]=e<t?[e,t,n,r]:[t,e,r,n],p=E.priceToSqrtPriceX64(new S(i.price),i.mintA.decimals,i.mintB.decimals),g=E.getSqrtPriceX64FromTick(u),f=E.getSqrtPriceX64FromTick(l),[b,y]=[ie(m,(h=i.mintA.extensions)==null?void 0:h.feeConfig,a,!c),ie(d,(A=i.mintB.extensions)==null?void 0:A.feeConfig,a,!c)],w=G.getLiquidityFromTokenAmounts(p,g,f,b.amount.sub((P=b.fee)!=null?P:X),y.amount.sub((k=y.fee)!=null?k:X));return G.getAmountsOutFromLiquidity({poolInfo:i,tickLower:e,tickUpper:t,liquidity:w,slippage:o,add:s,epochInfo:a,amountAddFee:!c})}var F=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(X)||(o=o.add(Ve)),o}static mulDivFloor(e,t,n){if(n.eq(X))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(X))throw new Error("division by 0");return e.mul(t).add(n.sub(Ve)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new v(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(on).sub(t).mod(on)}};function de(i,e){return zn(i.mul(e),64,256)}function ns(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function zn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var E=class{static sqrtPriceX64ToPrice(e,t,n){return F.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return F.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(X))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(X))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(X))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(X))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(X))return e;let o=t.shln(Ot);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?F.mulDivCeil(s,e,a):F.mulDivRoundingUp(s,Ve,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return F.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Ot);if(r)return e.add(o.div(t));{let s=F.mulDivRoundingUp(o,Ve,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ae||e>Te)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new v("18445821805675395072"):new v("18446744073709551616");return(t&2)!=0&&(n=de(n,new v("18444899583751176192"))),(t&4)!=0&&(n=de(n,new v("18443055278223355904"))),(t&8)!=0&&(n=de(n,new v("18439367220385607680"))),(t&16)!=0&&(n=de(n,new v("18431993317065453568"))),(t&32)!=0&&(n=de(n,new v("18417254355718170624"))),(t&64)!=0&&(n=de(n,new v("18387811781193609216"))),(t&128)!=0&&(n=de(n,new v("18329067761203558400"))),(t&256)!=0&&(n=de(n,new v("18212142134806163456"))),(t&512)!=0&&(n=de(n,new v("17980523815641700352"))),(t&1024)!=0&&(n=de(n,new v("17526086738831433728"))),(t&2048)!=0&&(n=de(n,new v("16651378430235570176"))),(t&4096)!=0&&(n=de(n,new v("15030750278694412288"))),(t&8192)!=0&&(n=de(n,new v("12247334978884435968"))),(t&16384)!=0&&(n=de(n,new v("8131365268886854656"))),(t&32768)!=0&&(n=de(n,new v("3584323654725218816"))),(t&65536)!=0&&(n=de(n,new v("696457651848324352"))),(t&131072)!=0&&(n=de(n,new v("26294789957507116"))),(t&262144)!=0&&(n=de(n,new v("37481735321082"))),e>0&&(n=Ri.div(n)),n}static getTickFromPrice(e,t,n){return E.getTickFromSqrtPriceX64(E.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(nt)||e.lt(tt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new v(t-64),r=ns(n,32,128),o=new v("8000000000000000","hex"),s=0,a=new v(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new v(0))&&s<Mi;){c=c.mul(c);let g=c.shrn(127);c=c.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=r.add(u).mul(new v(Ei)),d=zn(m.sub(new v(Oi)),64,128).toNumber(),p=zn(m.add(new v(Fi)),64,128).toNumber();return d==p?d:E.getSqrtPriceX64FromTick(p).lte(e)?p:d}},pt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=E.getTickFromSqrtPriceX64(E.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=pt.getTickWithPriceAndTickspacing(e,t,n,r),s=E.getSqrtPriceX64FromTick(o);return E.sqrtPriceX64ToPrice(s,n,r)}},G=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(X))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Ot),s=t.sub(e);return r?F.mulDivRoundingUp(F.mulDivCeil(o,s,t),Ve,e):F.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(X))throw new Error("sqrtPriceX64A must greater than 0");return r?F.mulDivCeil(n,t.sub(e),Se):F.mulDivFloor(n,t.sub(e),Se)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?F.mulDivRoundingUp(a,Ve,_n):a.shrn(Ot)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),F.mulDivFloor(n,_n,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return G.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=G.getLiquidityFromTokenAmountA(e,n,r,!1),a=G.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return G.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:G.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new v(0)};if(e.lt(n)){let s=G.getTokenAmountAFromLiquidity(e,n,r,o),a=G.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new v(0),amountB:G.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=G.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new v(new S(c.toString()).mul(l).toFixed(0)),d=new v(new S(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var w,h,A,P;let u=E.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=E.getSqrtPriceX64FromTick(t),m=E.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=G.getAmountsFromLiquidity(u,l,m,r,s),[g,f]=[ie(p.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,a,c),ie(p.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,c)],[b,y]=[ie(new v(new S(p.amountA.toString()).mul(d).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),ie(new v(new S(p.amountB.toString()).mul(d).toFixed(0)),(P=e.mintB.extensions)==null?void 0:P.feeConfig,a,c)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:b,amountSlippageB:y,expirationTime:lt(g.expirationTime,f.expirationTime)}}},ft=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,m,d,p,g){if(d.eq(X))throw new Error("amountSpecified must not be 0");if(g||(g=s?tt.add(Ve):nt.sub(Ve)),s){if(g.lt(tt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(nt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=d.gt(X),b={amountSpecifiedRemaining:d,amountCalculated:X,sqrtPriceX64:m,tick:u>p?Math.min(p+U.tickCount(l)-1,u):p,accounts:[],liquidity:c,feeAmount:new v(0)},y=p,w=n[p],h=0,A=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(X)&&!b.sqrtPriceX64.eq(g);){if(h>10)throw Error("liquidity limit");let P={};P.sqrtPriceStartX64=b.sqrtPriceX64;let k=C.nextInitTick(w,b.tick,l,s,A),x=k||null,I=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let _=Pe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},y,s);if(!_.isExist)throw Error("swapCompute LiquidityInsufficient");y=_.nextStartIndex;let{publicKey:q}=Y(e,t,y);I=q,w=n[y],x=C.firstInitializedTick(w,s)}P.tickNext=x.tick,P.initialized=x.liquidityGross.gtn(0),p!==y&&I&&(b.accounts.push(I),p=y),P.tickNext<Ae?P.tickNext=Ae:P.tickNext>Te&&(P.tickNext=Te),P.sqrtPriceNextX64=E.getSqrtPriceX64FromTick(P.tickNext);let O;if(s&&P.sqrtPriceNextX64.lt(g)||!s&&P.sqrtPriceNextX64.gt(g)?O=g:O=P.sqrtPriceNextX64,[b.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=ft.swapStepCompute(b.sqrtPriceX64,O,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(P.feeAmount),f?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),b.amountCalculated=b.amountCalculated.sub(P.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(P.amountOut),b.amountCalculated=b.amountCalculated.add(P.amountIn.add(P.feeAmount))),b.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let _=x.liquidityNet;s&&(_=_.mul(ze)),b.liquidity=G.addDelta(b.liquidity,_)}A=P.tickNext!=b.tick&&!s&&w.startTickIndex===P.tickNext,b.tick=s?P.tickNext-1:P.tickNext}else if(b.sqrtPriceX64!=P.sqrtPriceStartX64){let _=E.getTickFromSqrtPriceX64(b.sqrtPriceX64);A=_!=b.tick&&!s&&w.startTickIndex===_,b.tick=_}++h}try{let{nextStartIndex:P,isExist:k}=U.nextInitializedTickArray(b.tick,l,s,r,o);k&&p!==P&&(b.accounts.push(Y(e,t,P).publicKey),p=P)}catch{}return{amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new v(0),amountIn:new v(0),amountOut:new v(0),feeAmount:new v(0)},a=e.gte(t),c=r.gte(X);if(c){let l=F.mulDivFloor(r,sn.sub(new v(o.toString())),sn);s.amountIn=a?G.getTokenAmountAFromLiquidity(t,e,n,!0):G.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=E.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?G.getTokenAmountBFromLiquidity(t,e,n,!1):G.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=E.getNextSqrtPriceX64FromOutput(e,n,r.mul(ze),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=G.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=G.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:G.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:G.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(ze))&&(s.amountOut=r.mul(ze)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=F.mulDivCeil(s.amountIn,new v(o),sn.sub(new v(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as ge,TOKEN_2022_PROGRAM_ID as st,ASSOCIATED_TOKEN_PROGRAM_ID as or}from"@solana/spl-token";import{PublicKey as B,TransactionInstruction as De,SystemProgram as At,Keypair as $n}from"@solana/web3.js";import sr from"bn.js";import{PublicKey as cs,Keypair as us}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ls}from"@solana/spl-token";import Cd from"bn.js";var is=Z([J("mint"),J("owner"),M("amount"),Ye("delegateOption"),J("delegate"),re("state"),Ye("isNativeOption"),M("isNative"),M("delegatedAmount"),Ye("closeAuthorityOption"),J("closeAuthority")]);function rs(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Yn(i,...e){if(!rs(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function jn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Ji(i,e){Yn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var pn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Fe=(i,e)=>i<<32-e|i>>>e;var pd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function os(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Zn(i){return typeof i=="string"&&(i=os(i)),Yn(i),i}var dn=class{clone(){return this._cloneInto()}},fd={}.toString;function er(i){let e=n=>i().update(Zn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function ss(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var tr=(i,e,t)=>i&e^~i&t,nr=(i,e,t)=>i&e^i&t^e&t,fn=class extends dn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=pn(this.buffer)}update(e){jn(this);let{view:t,buffer:n,blockLen:r}=this;e=Zn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=pn(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){jn(this),Ji(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;ss(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=pn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<u;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var as=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ot=new Uint32Array(64),Qn=class extends fn{constructor(){super(64,32,8,!1),this.A=rt[0]|0,this.B=rt[1]|0,this.C=rt[2]|0,this.D=rt[3]|0,this.E=rt[4]|0,this.F=rt[5]|0,this.G=rt[6]|0,this.H=rt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let m=0;m<16;m++,t+=4)ot[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=ot[m-15],p=ot[m-2],g=Fe(d,7)^Fe(d,18)^d>>>3,f=Fe(p,17)^Fe(p,19)^p>>>10;ot[m]=f+ot[m-7]+g+ot[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:l}=this;for(let m=0;m<64;m++){let d=Fe(a,6)^Fe(a,11)^Fe(a,25),p=l+d+tr(a,c,u)+as[m]+ot[m]|0,f=(Fe(n,2)^Fe(n,13)^Fe(n,22))+nr(n,r,o)|0;l=u,u=c,c=a,a=s+p|0,s=o,o=r,r=n,n=p+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,c,u,l)}roundClean(){ot.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var ir=er(()=>new Qn);var Rd=ue("Raydium_Util");function rr({fromPublicKey:i,programId:e=ls}){let t=us.generate().publicKey.toBase58().slice(0,32);return{publicKey:ms(i,t,e),seed:t}}function ms(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=ir(n);return new cs(r)}var ar=ue("Raydium_Clmm"),_e={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},me=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g){let f=Z([W("sqrtPriceX64"),M("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1}],y=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:g},y);let w=Buffer.from([..._e.createPool,...y]);return new De({keys:b,programId:e,data:w})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:c,startTime:u,forerunCreate:l}=e,m=rr({fromPublicKey:r,programId:n}),[d,p]=[new B(o.address),new B(s.address)],g=[At.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Hn.span),space:Hn.span,programId:n})],{publicKey:f}=Wi(n,a,d,p),{publicKey:b}=Vn(n,f,d),{publicKey:y}=Vn(n,f,p);return g.push(this.createPoolInstruction(n,f,r,a,m.publicKey,d,b,new B(o.programId||ge),p,y,new B(s.programId||ge),We(n,f).publicKey,c,u)),{signers:[],instructions:g,instructionTypes:[se.CreateAccount,se.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:b,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,b,y,w,h,A,P,k,x,I,O,_){let q=Z([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),W("liquidity"),M("amountMaxA"),M("amountMaxB"),Ge("withMetadata"),re("optionBaseFlag"),Ge("baseFlag")]),ye=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],te=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:or,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ye],ke=Buffer.alloc(q.span);q.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:P,liquidity:k,amountMaxA:x,amountMaxB:I,withMetadata:O==="create",baseFlag:!1,optionBaseFlag:0},ke);let ee=Buffer.from([..._e.openPosition,...ke]);return new De({keys:te,programId:e,data:ee})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new B(e.programId),new B(e.id)],g;if(l)g=new B((await l(1))[0]);else{let I=$n.generate();m.push(I),g=I.publicKey}let f=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=Y(d,p,f),{publicKey:w}=Y(d,p,b),{publicKey:h}=Ee(n.wallet,g,ge),{publicKey:A}=cn(g),{publicKey:P}=Ce(d,g),{publicKey:k}=mt(d,p,r,o),x=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,g,h,A,k,y,w,P,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,f,b,s,a,c,u);return{signers:m,instructions:[x],instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:y,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:P,protocolPosition:k}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new B(e.programId),new B(e.id)],g;if(l)g=new B((await l(1))[0]);else{let I=$n.generate();m.push(I),g=I.publicKey}let f=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=Y(d,p,f),{publicKey:w}=Y(d,p,b),{publicKey:h}=Ee(n.wallet,g,ge),{publicKey:A}=cn(g),{publicKey:P}=Ce(d,g),{publicKey:k}=mt(d,p,r,o),x=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,g,h,A,k,y,w,P,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,f,b,u,s,a,c,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?We(d,p).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:y,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:P,protocolPosition:k},instructions:[x],signers:m,instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,b,y,w,h,A,P,k,x,I,O,_){let q=Z([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),W("liquidity"),M("amountMaxA"),M("amountMaxB"),Ge("withMetadata"),re("optionBaseFlag"),Ge("baseFlag")]),ye=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],te=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:or,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ye],ke=Buffer.alloc(q.span);q.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:P,liquidity:new sr(0),amountMaxA:x==="MintA"?I:O,amountMaxB:x==="MintA"?O:I,withMetadata:k==="create",baseFlag:x==="MintA",optionBaseFlag:1},ke);let ee=Buffer.from([..._e.openPosition,...ke]);return new De({keys:te,programId:e,data:ee})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m,d=[];if(l)m=new B((await l(1))[0]);else{let I=$n.generate();d.push(I),m=I.publicKey}let[p,g]=[new B(e.programId),new B(e.id)],f=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=Y(p,g,f),{publicKey:w}=Y(p,g,b),{publicKey:h}=Ee(n.wallet,m,ge),{publicKey:A}=cn(m),{publicKey:P}=Ce(p,m),{publicKey:k}=mt(p,g,r,o),x=this.openPositionFromLiquidityInstruction(p,n.wallet,g,n.wallet,m,h,A,k,y,w,P,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,f,b,s,a,c,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?We(p,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:y,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:P,protocolPosition:k},instructions:[x],signers:d,instructionTypes:[se.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=Z([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([..._e.closePosition,...c]);return new De({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new B(e.programId),{publicKey:s}=Ee(n.wallet,r.nftMint,ge),{publicKey:a}=Ce(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[se.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,b,y,w){let h=Z([W("liquidity"),M("amountMaxA"),M("amountMaxB"),re("optionBaseFlag"),Ge("baseFlag")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],k=Buffer.alloc(h.span);h.encode({liquidity:f,amountMaxA:b,amountMaxB:y,optionBaseFlag:0,baseFlag:!1},k);let x=Buffer.from([..._e.increaseLiquidity,...k]);return new De({keys:P,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new B(e.programId),new B(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Y(c,u,l),{publicKey:p}=Y(c,u,m),{publicKey:g}=Ee(r.wallet,n.nftMint,ge),{publicKey:f}=Ce(c,n.nftMint),{publicKey:b}=mt(c,u,n.tickLower,n.tickUpper),y=this.increasePositionFromLiquidityInstruction(c,r.wallet,g,f,u,b,d,p,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?We(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:b},signers:[],instructions:[y],instructionTypes:[se.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new B(e.programId),new B(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Y(c,u,l),{publicKey:p}=Y(c,u,m),{publicKey:g}=Ee(r.wallet,n.nftMint,ge),{publicKey:f}=Ce(c,n.nftMint),{publicKey:b}=mt(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,g,f,u,b,d,p,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?We(c,u).publicKey:void 0)],signers:[],instructionTypes:[se.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,b,y,w){let h=Z([W("liquidity"),M("amountMaxA"),M("amountMaxB"),re("optionBaseFlag"),Ge("baseFlag")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],k=Buffer.alloc(h.span);h.encode({liquidity:new sr(0),amountMaxA:f==="MintA"?b:y,amountMaxB:f==="MintA"?y:b,baseFlag:f==="MintA",optionBaseFlag:1},k);let x=Buffer.from([..._e.increaseLiquidity,...k]);return new De({keys:P,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,b,y,w,h){let A=Z([W("liquidity"),M("amountMinA"),M("amountMinB")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...f.map(O=>[{pubkey:O.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:O.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:O.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],x=Buffer.alloc(A.span);A.encode({liquidity:b,amountMinA:y,amountMinB:w},x);let I=Buffer.from([..._e.decreaseLiquidity,...x]);return new De({keys:k,programId:e,data:I})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new B(e.programId),new B(e.id)],m=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(u,l,m),{publicKey:g}=Y(u,l,d),{publicKey:f}=Ee(r.wallet,n.nftMint,c),{publicKey:b}=Ce(u,n.nftMint),{publicKey:y}=mt(u,l,n.tickLower,n.tickUpper),w=[];for(let A=0;A<e.rewardDefaultInfos.length;A++)w.push({poolRewardVault:new B(t.rewardInfos[A].vault),ownerRewardVault:r.rewardAccounts[A],rewardMint:new B(e.rewardDefaultInfos[A].mint.address)});let h=[];return h.push(this.decreaseLiquidityInstruction(u,r.wallet,f,b,l,y,p,g,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),w,o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?We(u,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:b,protocolPosition:y},signers:[],instructions:h,instructionTypes:[se.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,b,y){let w=Z([M("amount"),M("otherAmountThreshold"),W("sqrtPriceLimitX64"),Ge("isBaseInput")]),h=[...y?[{pubkey:y,isSigner:!1,isWritable:!0}]:[],...m.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...h],P=Buffer.alloc(w.span);w.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:b},P);let k=Buffer.from([..._e.swap,...P]);return new De({keys:A,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:c}){let[u,l]=[new B(e.programId),new B(e.id)],[m,d]=[new B(t.vault.A),new B(t.vault.B)],[p,g]=[new B(e.mintA.address),new B(e.mintB.address)],f=e.mintA.address===r.toString(),b=[this.swapInstruction(u,n.wallet,l,new B(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:d,f?d:m,f?p:g,f?g:p,c,m,o,s,a,!0,We(u,l).publicKey)];return{signers:[],instructions:b,instructionTypes:[se.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let p=Z([M("openTime"),M("endTime"),W("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:fe(l),endTime:fe(m),emissionsPerSecondX64:d},f);let b=Buffer.from([..._e.initReward,...f]);return new De({keys:g,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a=Gi(o,s,r.mint).publicKey,c=Dt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new B(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[se.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let p=Z([re("rewardIndex"),W("emissionsPerSecondX64"),M("openTime"),M("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:fe(l),endTime:fe(m)},f);let b=Buffer.from([..._e.setRewardEmissions,...f]);return new De({keys:g,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new B(t.rewardInfos[d].vault),u=new B(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&ar.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Dt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new B(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[se.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=Z([re("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([..._e.collectReward,...l]);return new De({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new B(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&ar.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[se.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:c}){let[u,l]=[new B(e.programId),new B(e.id)],[m,d]=[new B(t.vault.A),new B(t.vault.B)],[p,g]=[new B(e.mintA.address),new B(e.mintB.address)],f=e.mintA.address===r.toString(),b=[this.swapInstruction(u,n.wallet,l,new B(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:m,f?m:d,f?p:g,f?g:p,c,m,o,s,a,!1)];return{signers:[],instructions:b,instructionTypes:[se.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Ne from"bn.js";var Jn=class extends Et{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||V.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,txVersion:m}=e,d=this.createTxBuilder(),[p,g,f]=new Ne(new V(r.address).toBuffer()).gt(new Ne(new V(o.address).toBuffer()))?[o,r,new S(1).div(a)]:[r,o,a],b=E.priceToSqrtPriceX64(f,p.decimals,g.decimals),y=await me.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:p,mintB:g,ammConfigId:s.id,initialPriceX64:b,startTime:c,forerunCreate:l});return d.addInstruction(y),d.addCustomComputeBudget(u),d.versionBuild({txVersion:m,extInfo:{address:{...y.address,programId:t.toString(),id:y.address.poolId.toString(),mintA:p,mintB:g,openTime:c.toString(),vault:{A:y.address.mintAVault.toString(),B:y.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},mockPoolInfo:{type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:y.address.poolId.toString(),mintA:p,mintB:g,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:f.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},...Di},forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:p,txVersion:g}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),b=null,y=null,w=n.useSOLBalance&&e.mintA.address===Q.toString(),h=n.useSOLBalance&&e.mintB.address===Q.toString(),[A,P]=s==="MintA"?[a,c]:[c,a],{account:k,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new V(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:w||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});k&&(b=k),f.addInstruction(x||{});let{account:I,instructionParams:O}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new V(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:u,checkCreateATAOwner:l});I&&(y=I),f.addInstruction(O||{}),(!b||!y)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let _=t||await this.getClmmPoolKeys(e.id),q=await me.openPositionFromBaseInstructions({poolInfo:e,poolKeys:_,ownerInfo:{...n,feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:y},tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:m,getEphemeralSigners:d});return f.addInstruction(q),f.addCustomComputeBudget(p),f.versionBuild({txVersion:g,extInfo:q.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,getEphemeralSigners:p}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let g=this.createTxBuilder(),f=null,b=null,y=n.useSOLBalance&&e.mintA.address===Q.toBase58(),w=n.useSOLBalance&&e.mintB.address===Q.toBase58(),{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new V(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:y?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:u,checkCreateATAOwner:l});h&&(f=h),g.addInstruction(A||{});let{account:P,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new V(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});P&&(b=P),g.addInstruction(k||{}),(f===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=t||await this.getClmmPoolKeys(e.id),I=await me.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:m,getEphemeralSigners:p});return g.addInstruction(I),g.versionBuild({txVersion:d,extInfo:{address:I.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:r,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,g,f=a.useSOLBalance&&t.mintA.address===Q.toString(),b=a.useSOLBalance&&t.mintB.address===Q.toString(),{account:y,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new V(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:c,checkCreateATAOwner:u});y&&(p=y),d.addInstruction(w||{});let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new V(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});h&&(g=h),d.addInstruction(A||{}),!p&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let P=await this.getClmmPoolKeys(t.id),k=me.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:P,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g},liquidity:s,amountMaxA:r,amountMaxB:o});return d.addInstruction(k),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:k.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,g,f=a.useSOLBalance&&t.mintA.address===Q.toString(),b=a.useSOLBalance&&t.mintB.address===Q.toString(),{account:y,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new V(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:c,checkCreateATAOwner:u});y&&(p=y),d.addInstruction(w||{});let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new V(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});h&&(g=h),d.addInstruction(A||{}),!p&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let P=await this.getClmmPoolKeys(t.id),k=me.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:P,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(k),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:k.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:r,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let d=this.createTxBuilder(),p=r.useSOLBalance&&t.mintA.address===Q.toString(),g=r.useSOLBalance&&t.mintB.address===Q.toString(),f,b,{account:y,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new V(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});f=y,w&&d.addInstruction(w);let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new V(t.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:u});b=h,A&&d.addInstruction(A);let P=[];for(let O of t.rewardDefaultInfos){let _=r.useSOLBalance&&O.mint.address===Q.toString(),q;if(O.mint.address===t.mintA.address)q=f;else if(O.mint.address===t.mintB.address)q=b;else{let{account:ye,instructionParams:te}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(O.mint.programId),mint:new V(O.mint.address),notUseTokenAccount:_,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!_,associatedOnly:_?!1:c,checkCreateATAOwner:u});q=ye,te&&d.addInstruction(te)}P.push(q)}!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let k=await this.getClmmPoolKeys(t.id),x=await me.decreaseLiquidityInstructions({poolInfo:t,poolKeys:k,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:P},liquidity:a,amountMinA:o,amountMinB:s});d.addInstruction({instructions:x.instructions,instructionTypes:[se.ClmmDecreasePosition]});let I={...x.address};if(r.closePosition){let O=await me.closePositionInstructions({poolInfo:t,poolKeys:k,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});d.addInstruction({endInstructions:O.instructions,endInstructionTypes:O.instructionTypes}),I={...I,...O.address}}return d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:I}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let r=this.createTxBuilder(),o=await this.getClmmPoolKeys(e.id),s=me.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return r.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===Q.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(n.mint.address),mint:new V(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.getClmmPoolKeys(e.id),g=me.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new V(n.mint.programId),mint:new V(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:F.decimalToX64(n.perSecond)}});return c.addInstruction(g),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:g.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let c=this.createTxBuilder(),u={};for(let l of n){let m=t.useSOLBalance&&l.mint.address===Q.toString(),d=l.perSecond.mul(l.endTime-l.openTime),{account:p,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(l.mint.programId),mint:new V(l.mint.address),notUseTokenAccount:!!m,skipCloseAccount:!m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(d.toFixed(0)).gte(d)?d.toFixed(0):d.add(1).toFixed(0))}:void 0,associatedOnly:m?!1:r,checkCreateATAOwner:o});g&&c.addInstruction(g),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),b=me.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{programId:new V(l.mint.programId),mint:new V(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:F.decimalToX64(l.perSecond)}});u={...u,...b.address},c.addInstruction(b)}return c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:u}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(Q),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),p=me.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:F.decimalToX64(n.perSecond)}});return c.addInstruction(p),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:p.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let c=this.createTxBuilder(),u={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let m=t.useSOLBalance&&l.mint.address===Q.toString(),{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(l.mint.programId),mint:new V(l.mint.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,createInfo:m?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:m?!1:r,checkCreateATAOwner:o});p&&c.addInstruction(p),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let g=await this.getClmmPoolKeys(e.id),f=me.setRewardInstructions({poolInfo:e,poolKeys:g,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{mint:new V(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:F.decimalToX64(l.perSecond)}});c.addInstruction(f),u={...u,...f.address}}return c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:u}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(p=>p.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(Q),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),d=me.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(f=>f.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(Q),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let p=await this.getClmmPoolKeys(e.id),g=me.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(g),a={...a,...g.address}}return s.build({address:a})}async swap({poolInfo:e,inputMint:t,amountIn:n,amountOutMin:r,priceLimit:o,ownerInfo:s,remainingAccounts:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,txVersion:l}){let m=this.createTxBuilder(),d=s.useSOLBalance&&e.mintA.address===Q.toBase58(),p=s.useSOLBalance&&e.mintB.address===Q.toBase58(),g;!o||o.equals(new S(0))?g=t.toString()===e.mintA.address?tt.add(new Ne(1)):nt.sub(new Ne(1)):g=E.priceToSqrtPriceX64(o,e.mintA.decimals,e.mintB.decimals);let f;if(!f){let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new V(e.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,skipCloseAccount:!d,createInfo:{payer:s.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:d?!1:c,checkCreateATAOwner:u});f=w,h&&m.addInstruction(h)}let b;if(!b){let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new V(e.mintB.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!p,createInfo:{payer:s.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:c,checkCreateATAOwner:u});b=w,h&&m.addInstruction(h)}(!f||!b)&&this.logAndCreateError("user do not have token account",this.scope.account.tokenAccountRawInfos);let y=await this.getClmmPoolKeys(e.id);return m.addInstruction(me.makeSwapBaseInInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},inputMint:new V(t),amountIn:n,amountOutMin:r,sqrtPriceLimitX64:g,remainingAccounts:a})),m.versionBuild({txVersion:l})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:c}){let u={};for(let m of this.scope.account.tokenAccountRawInfos)r?Ee(this.scope.ownerPubKey,m.accountInfo.mint,s).publicKey.equals(m.pubkey)&&(u[m.accountInfo.mint.toString()]=m.pubkey):u[m.accountInfo.mint.toString()]=m.pubkey;let l=this.createTxBuilder();for(let m of Object.values(e)){if(t[m.id]===void 0||!t[m.id].find(h=>!h.liquidity.isZero()||h.rewardInfos.find(A=>!A.rewardAmountOwed.isZero())))continue;let d=m,p=n.useSOLBalance&&d.mintA.address===Q.toString(),g=n.useSOLBalance&&d.mintB.address===Q.toString(),f=u[d.mintA.address];if(!f){let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new V(d.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!p,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:r,checkCreateATAOwner:o});f=h,A&&l.addInstruction(A)}let b=u[d.mintB.address];if(!b){let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new V(d.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:r,checkCreateATAOwner:o});b=h,A&&l.addInstruction(A)}u[d.mintA.address]=f,u[d.mintB.address]=b;let y=[];for(let h of d.rewardDefaultInfos){let A=n.useSOLBalance&&h.mint.address===Q.toString(),P=u[h.mint.address];if(!P){let{account:k,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new V(h.mint.programId),mint:new V(h.mint.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,skipCloseAccount:!A,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:A?!1:r});P=k,x&&l.addInstruction(x)}u[h.mint.address]=P,y.push(P)}let w=await this.getClmmPoolKeys(d.id);for(let h of t[m.id]){let A=me.decreaseLiquidityInstructions({poolInfo:d,poolKeys:w,ownerPosition:h,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b,rewardAccounts:y},liquidity:new Ne(0),amountMinA:new Ne(0),amountMinB:new Ne(0)});l.addInstruction(A)}}return a===0?l.sizeCheckBuildV0({computeBudgetConfig:c}):l.sizeCheckBuild({computeBudgetConfig:c})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Dt(e).publicKey);return t?Zi.decode(t.data).whitelistMints.filter(r=>!r.equals(V.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Ne(1))).map(s=>Ce(new V(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=mn.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){let t=await this.scope.connection.getAccountInfo(new V(e)),n=ln.decode(t.data),r=E.sqrtPriceX64ToPrice(n.sqrtPriceX64,n.mintDecimalsA,n.mintDecimalsB).toNumber();return{...n,currentPrice:r}}};export{Ro as AMM_CONFIG_SEED,am as AmmConfigLayout,Mi as BIT_PRECISION,Jn as Clmm,me as ClmmInstrument,Xn as EXTENSION_TICKARRAY_BITMAP_SIZE,sn as FEE_RATE_DENOMINATOR,es as FETCH_TICKARRAY_COUNT,Lo as Fee,Ei as LOG_B_2_X32,Oi as LOG_B_P_ERR_MARGIN_LOWER_X64,Fi as LOG_B_P_ERR_MARGIN_UPPER_X64,G as LiquidityMath,nt as MAX_SQRT_PRICE_X64,Te as MAX_TICK,tt as MIN_SQRT_PRICE_X64,Ae as MIN_TICK,F as MathUtil,_n as MaxU64,Ri as MaxUint128,ze as NEGATIVE_ONE,Ve as ONE,Do as OPERATION_SEED,Hn as ObservationInfoLayout,Zo as ObservationLayout,Zi as OperationLayout,Oo as POOL_REWARD_VAULT_SEED,Mo as POOL_SEED,_o as POOL_TICK_ARRAY_BITMAP_SEED,Eo as POOL_VAULT_SEED,Vi as POSITION_SEED,ln as PoolInfoLayout,Pe as PoolUtils,mn as PositionInfoLayout,$o as PositionRewardInfoLayout,Vt as PositionUtils,cm as ProtocolPositionLayout,on as Q128,Se as Q64,Qo as RewardInfo,E as SqrtPriceMath,ft as SwapMath,dt as TICK_ARRAY_BITMAP_SIZE,Fo as TICK_ARRAY_SEED,le as TICK_ARRAY_SIZE,Xu as TICK_SPACINGS,je as TickArrayBitmap,Qi as TickArrayBitmapExtensionLayout,vt as TickArrayBitmapExtensionUtils,qt as TickArrayLayout,Jo as TickLayout,pt as TickMath,U as TickQuery,C as TickUtils,Ot as U64Resolution,zu as U64_IGNORE_RANGE,X as ZERO,jm as getLiquidityFromAmounts,el as getPdaAmmConfigId,We as getPdaExBitmapAccount,cn as getPdaMetadataKey,Dt as getPdaOperationAccount,Ce as getPdaPersonalPositionAddress,Wi as getPdaPoolId,Gi as getPdaPoolRewardVaulId,Vn as getPdaPoolVaultId,mt as getPdaProtocolPositionAddress,Y as getPdaTickArrayAddress,ju as i16ToBytes,an as i32ToBytes,Ft as isZero,vn as leadingZeros,qi as leastSignificantBit,Hu as mockCreatePoolInfo,Di as mockV3CreatePoolInfo,vi as mostSignificantBit,qn as trailingZeros,_i as u16ToBytes,Zu as u32ToBytes};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map