import{PublicKey as W}from"@solana/web3.js";var gt=9e15,Je=1e9,gn="0123456789abcdef",Ut="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Gt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",bn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-gt,maxE:gt,crypto:!1},ii,Xe,F=!0,Ht="[DecimalError] ",$e=Ht+"Invalid argument: ",ri=Ht+"Precision limit exceeded",oi=Ht+"crypto unavailable",si="[object Decimal]",we=Math.floor,ae=Math.pow,ar=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,cr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ur=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ai=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Re=1e7,N=7,lr=9007199254740991,dr=Ut.length-1,yn=Gt.length-1,k={toStringTag:si};k.absoluteValue=k.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),K(i)};k.ceil=function(){return K(new this.constructor(this),this.e+1,2)};k.clampedTo=k.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error($e+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};k.comparedTo=k.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};k.cosine=k.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+N,n.rounding=1,t=mr(n,mi(n,t)),n.precision=i,n.rounding=e,K(Xe==2||Xe==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};k.cubeRoot=k.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(F=!1,o=l.s*ae(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=fe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ae(t,1/3),i=we((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new d(t),n.s=l.s):n=new d(o.toString()),s=(i=d.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=j(u.plus(l).times(a),u.plus(c),s+2,1),fe(a.d).slice(0,s)===(t=fe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(K(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(K(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return F=!0,K(n,i,d.rounding,e)};k.decimalPlaces=k.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-we(this.e/N))*N,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};k.dividedBy=k.div=function(i){return j(this,new this.constructor(i))};k.dividedToIntegerBy=k.divToInt=function(i){var e=this,t=e.constructor;return K(j(e,new t(i),0,1,1),t.precision,t.rounding)};k.equals=k.eq=function(i){return this.cmp(i)===0};k.floor=function(){return K(new this.constructor(this),this.e+1,3)};k.greaterThan=k.gt=function(i){return this.cmp(i)>0};k.greaterThanOrEqualTo=k.gte=function(i){var e=this.cmp(i);return e==1||e===0};k.hyperbolicCosine=k.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/jt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=bt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return K(o,s.precision=t,s.rounding=n,!0)};k.hyperbolicSine=k.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=bt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/jt(5,i)),r=bt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,K(r,e,t,!0)};k.hyperbolicTangent=k.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,j(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};k.inverseCosine=k.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Le(t,r,o):new t(0):new t(NaN):e.isZero()?Le(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Le(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};k.inverseHyperbolicCosine=k.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,F=!1,t=t.times(t).minus(1).sqrt().plus(t),F=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};k.inverseHyperbolicSine=k.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,F=!1,t=t.times(t).plus(1).sqrt().plus(t),F=!0,n.precision=i,n.rounding=e,t.ln())};k.inverseHyperbolicTangent=k.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?K(new o(r),i,e,!0):(o.precision=t=n-r.e,r=j(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};k.inverseSine=k.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Le(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};k.inverseTangent=k.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&d+4<=yn)return s=Le(l,d+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(d+4<=yn)return s=Le(l,d+4,m).times(.5),s.s=u.s,s}for(l.precision=a=d+10,l.rounding=1,t=Math.min(28,a/N+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(F=!1,e=Math.ceil(a/N),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),F=!0,K(s,l.precision=d,l.rounding=m,!0)};k.isFinite=function(){return!!this.d};k.isInteger=k.isInt=function(){return!!this.d&&we(this.e/N)>this.d.length-2};k.isNaN=function(){return!this.s};k.isNegative=k.isNeg=function(){return this.s<0};k.isPositive=k.isPos=function(){return this.s>0};k.isZero=function(){return!!this.d&&this.d[0]===0};k.lessThan=k.lt=function(i){return this.cmp(i)<0};k.lessThanOrEqualTo=k.lte=function(i){return this.cmp(i)<1};k.logarithm=k.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(F=!1,a=d+f,s=Qe(u,a),n=e?Xt(l,a+10):Qe(i,a),c=j(s,n,a,1),Pt(c.d,r=d,m))do if(a+=10,s=Qe(u,a),n=e?Xt(l,a+10):Qe(i,a),c=j(s,n,a,1),!o){+fe(c.d).slice(r+1,r+15)+1==1e14&&(c=K(c,d+1,0));break}while(Pt(c.d,r+=10,m));return F=!0,K(c,d,m)};k.minus=k.sub=function(i){var e,t,n,r,o,s,a,c,u,l,d,m,f=this,b=f.constructor;if(i=new b(i),!f.d||!i.d)return!f.s||!i.s?i=new b(NaN):f.d?i.s=-i.s:i=new b(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(u=f.d,m=i.d,a=b.precision,c=b.rounding,!u[0]||!m[0]){if(m[0])i.s=-i.s;else if(u[0])i=new b(f);else return new b(c===3?-0:0);return F?K(i,a,c):i}if(t=we(i.e/N),l=we(f.e/N),u=u.slice(),o=l-t,o){for(d=o<0,d?(e=u,o=-o,s=m.length):(e=m,t=l,s=u.length),n=Math.max(Math.ceil(a/N),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=m.length,d=n<s,d&&(s=n),n=0;n<s;n++)if(u[n]!=m[n]){d=u[n]<m[n];break}o=0}for(d&&(e=u,u=m,m=e,i.s=-i.s),s=u.length,n=m.length-s;n>0;--n)u[s++]=0;for(n=m.length;n>o;){if(u[--n]<m[n]){for(r=n;r&&u[--r]===0;)u[r]=Re-1;--u[r],u[n]+=Re}u[n]-=m[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=zt(u,t),F?K(i,a,c):i):new b(c===3?-0:0)};k.modulo=k.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?K(new n(t),n.precision,n.rounding):(F=!1,n.modulo==9?(e=j(t,i.abs(),0,3,1),e.s*=i.s):e=j(t,i,0,n.modulo,1),e=e.times(i),F=!0,t.minus(e))};k.naturalExponential=k.exp=function(){return wn(this)};k.naturalLogarithm=k.ln=function(){return Qe(this)};k.negated=k.neg=function(){var i=new this.constructor(this);return i.s=-i.s,K(i)};k.plus=k.add=function(i){var e,t,n,r,o,s,a,c,u,l,d=this,m=d.constructor;if(i=new m(i),!d.d||!i.d)return!d.s||!i.s?i=new m(NaN):d.d||(i=new m(i.d||d.s===i.s?d:NaN)),i;if(d.s!=i.s)return i.s=-i.s,d.minus(i);if(u=d.d,l=i.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(i=new m(d)),F?K(i,a,c):i;if(o=we(d.e/N),n=we(i.e/N),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/N),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Re|0,u[r]%=Re;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=zt(u,n),F?K(i,a,c):i};k.precision=k.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error($e+i);return t.d?(e=ci(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};k.round=function(){var i=this,e=i.constructor;return K(new e(i),i.e+1,e.rounding)};k.sine=k.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+N,n.rounding=1,t=pr(n,mi(n,t)),n.precision=i,n.rounding=e,K(Xe>2?t.neg():t,i,e,!0)):new n(NaN)};k.squareRoot=k.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(F=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=fe(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=we((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(j(s,o,t+2,1)).times(.5),fe(o.d).slice(0,t)===(e=fe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(K(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(K(n,c+1,1),i=!n.times(n).eq(s));break}return F=!0,K(n,c,l.rounding,i)};k.tangent=k.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=j(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,K(Xe==2||Xe==4?t.neg():t,i,e,!0)):new n(NaN)};k.times=k.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,d=l.constructor,m=l.d,f=(i=new d(i)).d;if(i.s*=l.s,!m||!m[0]||!f||!f[0])return new d(!i.s||m&&!m[0]&&!f||f&&!f[0]&&!m?NaN:!m||!f?i.s/0:i.s*0);for(t=we(l.e/N)+we(i.e/N),c=m.length,u=f.length,c<u&&(o=m,m=f,f=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+f[n]*m[r-n-1]+e,o[r--]=a%Re|0,e=a/Re|0;o[r]=(o[r]+e)%Re|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=zt(o,t),F?K(i,d.precision,d.rounding):i};k.toBinary=function(i,e){return An(this,2,i,e)};k.toDecimalPlaces=k.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(xe(i,0,Je),e===void 0?e=n.rounding:xe(e,0,8),K(t,i+t.e+1,e))};k.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,!0):(xe(i,0,Je),e===void 0?e=r.rounding:xe(e,0,8),n=K(new r(n),i+1,e),t=ve(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=ve(r):(xe(i,0,Je),e===void 0?e=o.rounding:xe(e,0,8),n=K(new o(r),i+r.e+1,e),t=ve(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};k.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,d,m,f=this,b=f.d,p=f.constructor;if(!b)return new p(f);if(u=t=new p(1),n=c=new p(0),e=new p(n),o=e.e=ci(b)-f.e-1,s=o%N,e.d[0]=ae(10,s<0?N+s:s),i==null)i=o>0?e:u;else{if(a=new p(i),!a.isInt()||a.lt(u))throw Error($e+a);i=a.gt(e)?o>0?e:u:a}for(F=!1,a=new p(fe(b)),l=p.precision,p.precision=o=b.length*N*2;d=j(a,e,0,1,1),r=t.plus(d.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(d.times(r)),c=r,r=e,e=a.minus(d.times(r)),a=r;return r=j(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=f.s,m=j(u,n,o,1).minus(f).abs().cmp(j(c,t,o,1).minus(f).abs())<1?[u,n]:[c,t],p.precision=l,F=!0,m};k.toHexadecimal=k.toHex=function(i,e){return An(this,16,i,e)};k.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:xe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(F=!1,t=j(t,i,0,e,1).times(i),F=!0,K(t)):(i.s=t.s,t=i),t};k.toNumber=function(){return+this};k.toOctal=function(i,e){return An(this,8,i,e)};k.toPower=k.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ae(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return K(a,n,o);if(e=we(i.e/N),e>=i.d.length-1&&(t=u<0?-u:u)<=lr)return r=ui(c,a,t,n),i.s<0?new c(1).div(r):K(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ae(+a,u),e=t==0||!isFinite(t)?we(u*(Math.log("0."+fe(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(F=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=wn(i.times(Qe(a,n+t)),n),r.d&&(r=K(r,n+5,1),Pt(r.d,n,o)&&(e=n+10,r=K(wn(i.times(Qe(a,e+t)),e),e+5,1),+fe(r.d).slice(n+1,n+15)+1==1e14&&(r=K(r,n+1,0)))),r.s=s,F=!0,c.rounding=o,K(r,n,o))};k.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(xe(i,1,Je),e===void 0?e=r.rounding:xe(e,0,8),n=K(new r(n),i,e),t=ve(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toSignificantDigits=k.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(xe(i,1,Je),e===void 0?e=n.rounding:xe(e,0,8)),K(new n(t),i,e)};k.toString=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};k.truncated=k.trunc=function(){return K(new this.constructor(this),this.e+1,1)};k.valueOf=k.toJSON=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function fe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=N-n.length,t&&(o+=Ye(t)),o+=n;s=i[e],n=s+"",t=N-n.length,t&&(o+=Ye(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function xe(i,e,t){if(i!==~~i||i<e||i>t)throw Error($e+i)}function Pt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=N,r=0):(r=Math.ceil((e+1)/N),e%=N),o=ae(10,N-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ae(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ae(10,e-3)-1,s}function Vt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=gn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function mr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/jt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=bt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var j=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,d,m,f,b,p,g,y,w,h,A,P,T,x,I,R,_,q,ye,ee=n.constructor,Te=n.s==r.s?1:-1,J=n.d,H=r.d;if(!J||!J[0]||!H||!H[0])return new ee(!n.s||!r.s||(J?H&&J[0]==H[0]:!H)?NaN:J&&J[0]==0||!H?Te*0:Te/0);for(c?(f=1,l=n.e-r.e):(c=Re,f=N,l=we(n.e/f)-we(r.e/f)),q=H.length,R=J.length,y=new ee(Te),w=y.d=[],d=0;H[d]==(J[d]||0);d++);if(H[d]>(J[d]||0)&&l--,o==null?(T=o=ee.precision,s=ee.rounding):a?T=o+(n.e-r.e)+1:T=o,T<0)w.push(1),b=!0;else{if(T=T/f+2|0,d=0,q==1){for(m=0,H=H[0],T++;(d<R||m)&&T--;d++)x=m*c+(J[d]||0),w[d]=x/H|0,m=x%H|0;b=m||d<R}else{for(m=c/(H[0]+1)|0,m>1&&(H=i(H,m,c),J=i(J,m,c),q=H.length,R=J.length),I=q,h=J.slice(0,q),A=h.length;A<q;)h[A++]=0;ye=H.slice(),ye.unshift(0),_=H[0],H[1]>=c/2&&++_;do m=0,u=e(H,h,q,A),u<0?(P=h[0],q!=A&&(P=P*c+(h[1]||0)),m=P/_|0,m>1?(m>=c&&(m=c-1),p=i(H,m,c),g=p.length,A=h.length,u=e(p,h,g,A),u==1&&(m--,t(p,q<g?ye:H,g,c))):(m==0&&(u=m=1),p=H.slice()),g=p.length,g<A&&p.unshift(0),t(h,p,A,c),u==-1&&(A=h.length,u=e(H,h,q,A),u<1&&(m++,t(h,q<A?ye:H,A,c))),A=h.length):u===0&&(m++,h=[0]),w[d++]=m,u&&h[0]?h[A++]=J[I]||0:(h=[J[I]],A=1);while((I++<R||h[0]!==void 0)&&T--);b=h[0]!==void 0}w[0]||w.shift()}if(f==1)y.e=l,ii=b;else{for(d=1,m=w[0];m>=10;m/=10)d++;y.e=d+l*f-1,K(y,a?o+y.e+1:o,s,b)}return y}}();function K(i,e,t,n){var r,o,s,a,c,u,l,d,m,f=i.constructor;e:if(e!=null){if(d=i.d,!d)return i;for(r=1,a=d[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=N,s=e,l=d[m=0],c=l/ae(10,r-s-1)%10|0;else if(m=Math.ceil((o+1)/N),a=d.length,m>=a)if(n){for(;a++<=m;)d.push(0);l=c=0,r=1,o%=N,s=o-N+1}else break e;else{for(l=a=d[m],r=1;a>=10;a/=10)r++;o%=N,s=o-N+r,c=s<0?0:l/ae(10,r-s-1)%10|0}if(n=n||e<0||d[m+1]!==void 0||(s<0?l:l%ae(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ae(10,r-s):0:d[m-1])%10&1||t==(i.s<0?8:7)),e<1||!d[0])return d.length=0,u?(e-=i.e+1,d[0]=ae(10,(N-e%N)%N),i.e=-e||0):d[0]=i.e=0,i;if(o==0?(d.length=m,a=1,m--):(d.length=m+1,a=ae(10,N-o),d[m]=s>0?(l/ae(10,r-s)%ae(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=d[0];s>=10;s/=10)o++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,d[0]==Re&&(d[0]=1));break}else{if(d[m]+=a,d[m]!=Re)break;d[m--]=0,a=1}for(o=d.length;d[--o]===0;)d.pop()}return F&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function ve(i,e,t){if(!i.isFinite())return di(i);var n,r=i.e,o=fe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Ye(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+Ye(-r-1)+o,t&&(n=t-s)>0&&(o+=Ye(n))):r>=s?(o+=Ye(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+Ye(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=Ye(n))),o}function zt(i,e){var t=i[0];for(e*=N;t>=10;t/=10)e++;return e}function Xt(i,e,t){if(e>dr)throw F=!0,t&&(i.precision=t),Error(ri);return K(new i(Ut),e,1,!0)}function Le(i,e,t){if(e>yn)throw Error(ri);return K(new i(Gt),e,t,!0)}function ci(i){var e=i.length-1,t=e*N+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function Ye(i){for(var e="";i--;)e+="0";return e}function ui(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/N+4);for(F=!1;;){if(t%2&&(o=o.times(e),ti(o.d,s)&&(r=!0)),t=we(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ti(e.d,s)}return F=!0,o}function ei(i){return i.d[i.d.length-1]&1}function li(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function wn(i,e){var t,n,r,o,s,a,c,u=0,l=0,d=0,m=i.constructor,f=m.rounding,b=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(F=!1,c=b):c=e,a=new m(.03125);i.e>-2;)i=i.times(a),d+=5;for(n=Math.log(ae(2,d))/Math.LN10*2+5|0,c+=n,t=o=s=new m(1),m.precision=c;;){if(o=K(o.times(i),c,1),t=t.times(++l),a=s.plus(j(o,t,c,1)),fe(a.d).slice(0,c)===fe(s.d).slice(0,c)){for(r=d;r--;)s=K(s.times(s),c,1);if(e==null)if(u<3&&Pt(s.d,c-n,f,u))m.precision=c+=10,t=o=a=new m(1),l=0,u++;else return K(s,m.precision=b,f,F=!0);else return m.precision=b,s}s=a}}function Qe(i,e){var t,n,r,o,s,a,c,u,l,d,m,f=1,b=10,p=i,g=p.d,y=p.constructor,w=y.rounding,h=y.precision;if(p.s<0||!g||!g[0]||!p.e&&g[0]==1&&g.length==1)return new y(g&&!g[0]?-1/0:p.s!=1?NaN:g?0:p);if(e==null?(F=!1,l=h):l=e,y.precision=l+=b,t=fe(g),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=fe(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new y("0."+t),o++):p=new y(n+"."+t.slice(1))}else return u=Xt(y,l+2,h).times(o+""),p=Qe(new y(n+"."+t.slice(1)),l-b).plus(u),y.precision=h,e==null?K(p,h,w,F=!0):p;for(d=p,c=s=p=j(p.minus(1),p.plus(1),l,1),m=K(p.times(p),l,1),r=3;;){if(s=K(s.times(m),l,1),u=c.plus(j(s,new y(r),l,1)),fe(u.d).slice(0,l)===fe(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Xt(y,l+2,h).times(o+""))),c=j(c,new y(f),l,1),e==null)if(Pt(c.d,l-b,w,a))y.precision=l+=b,u=s=p=j(d.minus(1),d.plus(1),l,1),m=K(p.times(p),l,1),r=a=1;else return K(c,y.precision=h,w,F=!0);else return y.precision=h,c;c=u,r+=2}}function di(i){return String(i.s*i.s/0)}function hn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%N,t<0&&(n+=N),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=N;n<r;)i.d.push(+e.slice(n,n+=N));e=e.slice(n),n=N-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),F&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function fr(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ai.test(e))return hn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(cr.test(e))t=16,e=e.toLowerCase();else if(ar.test(e))t=2;else if(ur.test(e))t=8;else throw Error($e+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ui(n,new n(t),o,o*2)),u=Vt(e,t,Re),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=zt(u,l),i.d=u,F=!1,s&&(i=j(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ae(2,c):kt.pow(2,c))),F=!0,i)}function pr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:bt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/jt(5,t)),e=bt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function bt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,d=Math.ceil(l/N);for(F=!1,c=t.times(t),a=new i(n);;){if(s=j(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=j(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[d]!==void 0){for(o=d;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return F=!0,s.d.length=d+1,s}function jt(i,e){for(var t=i;--e;)t*=i;return t}function mi(i,e){var t,n=e.s<0,r=Le(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Xe=n?4:1,e;if(t=e.divToInt(r),t.isZero())Xe=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Xe=ei(t)?n?2:3:n?4:1,e;Xe=ei(t)?n?1:4:n?3:2}return e.minus(r).abs()}function An(i,e,t,n){var r,o,s,a,c,u,l,d,m,f=i.constructor,b=t!==void 0;if(b?(xe(t,1,Je),n===void 0?n=f.rounding:xe(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=di(i);else{for(l=ve(i),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),m=new f(1),m.e=l.length-s,m.d=Vt(ve(m),10,r),m.e=m.d.length),d=Vt(l,10,r),o=c=d.length;d[--c]==0;)d.pop();if(!d[0])l=b?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=d,i.e=o,i=j(i,m,t,n,0,r),d=i.d,o=i.e,u=ii),s=d[t],a=r/2,u=u||d[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&d[t-1]&1||n===(i.s<0?8:7)),d.length=t,u)for(;++d[--t]>r-1;)d[t]=0,t||(++o,d.unshift(1));for(c=d.length;!d[c-1];--c);for(s=0,l="";s<c;s++)l+=gn.charAt(d[s]);if(b){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(d=Vt(l,r,e),c=d.length;!d[c-1];--c);for(s=1,l="1.";s<c;s++)l+=gn.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ti(i,e){if(i.length>e)return i.length=e,!0}function gr(i){return new this(i).abs()}function br(i){return new this(i).acos()}function yr(i){return new this(i).acosh()}function wr(i,e){return new this(i).plus(e)}function hr(i){return new this(i).asin()}function Ar(i){return new this(i).asinh()}function Pr(i){return new this(i).atan()}function kr(i){return new this(i).atanh()}function Tr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Le(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Le(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Le(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(j(i,e,o,1)),e=Le(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(j(i,e,o,1)),t}function xr(i){return new this(i).cbrt()}function Br(i){return K(i=new this(i),i.e+1,2)}function Ir(i,e,t){return new this(i).clamp(e,t)}function Sr(i){if(!i||typeof i!="object")throw Error(Ht+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Je,"rounding",0,8,"toExpNeg",-gt,0,"toExpPos",0,gt,"maxE",0,gt,"minE",-gt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=bn[t]),(n=i[t])!==void 0)if(we(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error($e+t+": "+n);if(t="crypto",r&&(this[t]=bn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(oi);else this[t]=!1;else throw Error($e+t+": "+n);return this}function Cr(i){return new this(i).cos()}function Kr(i){return new this(i).cosh()}function fi(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ni(o)){u.s=o.s,F?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;F?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return hn(u,o.toString())}else if(c!=="string")throw Error($e+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),ai.test(o)?hn(u,o):fr(u,o)}if(r.prototype=k,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Sr,r.clone=fi,r.isDecimal=ni,r.abs=gr,r.acos=br,r.acosh=yr,r.add=wr,r.asin=hr,r.asinh=Ar,r.atan=Pr,r.atanh=kr,r.atan2=Tr,r.cbrt=xr,r.ceil=Br,r.clamp=Ir,r.cos=Cr,r.cosh=Kr,r.div=Nr,r.exp=Lr,r.floor=Rr,r.hypot=Mr,r.ln=Er,r.log=Or,r.log10=Dr,r.log2=Fr,r.max=_r,r.min=vr,r.mod=qr,r.mul=Wr,r.pow=Vr,r.random=Ur,r.round=Gr,r.sign=Xr,r.sin=Hr,r.sinh=zr,r.sqrt=jr,r.sub=Zr,r.sum=Yr,r.tan=Qr,r.tanh=$r,r.trunc=Jr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Nr(i,e){return new this(i).div(e)}function Lr(i){return new this(i).exp()}function Rr(i){return K(i=new this(i),i.e+1,3)}function Mr(){var i,e,t=new this(0);for(F=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return F=!0,new this(1/0);t=e}return F=!0,t.sqrt()}function ni(i){return i instanceof kt||i&&i.toStringTag===si||!1}function Er(i){return new this(i).ln()}function Or(i,e){return new this(i).log(e)}function Fr(i){return new this(i).log(2)}function Dr(i){return new this(i).log(10)}function _r(){return li(this,arguments,"lt")}function vr(){return li(this,arguments,"gt")}function qr(i,e){return new this(i).mod(e)}function Wr(i,e){return new this(i).mul(e)}function Vr(i,e){return new this(i).pow(e)}function Ur(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:xe(i,1,Je),n=Math.ceil(i/N),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(oi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=N,n&&i&&(r=ae(10,N-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=N)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<N&&(t-=N-n)}return s.e=t,s.d=a,s}function Gr(i){return K(i=new this(i),i.e+1,this.rounding)}function Xr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Hr(i){return new this(i).sin()}function zr(i){return new this(i).sinh()}function jr(i){return new this(i).sqrt()}function Zr(i,e){return new this(i).sub(e)}function Yr(){var i=0,e=arguments,t=new this(e[i]);for(F=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return F=!0,K(t,this.precision,this.rounding)}function Qr(i){return new this(i).tan()}function $r(i){return new this(i).tanh()}function Jr(i){return K(i=new this(i),i.e+1,1)}k[Symbol.for("nodejs.util.inspect.custom")]=k.toString;k[Symbol.toStringTag]="Decimal";var kt=k.constructor=fi(bn);Ut=new kt(Ut);Gt=new kt(Gt);var S=kt;import{get as pi,set as eo}from"lodash";import bi from"dayjs";import to from"dayjs/plugin/utc";bi.extend(to);var Pn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return bi().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},gi={},no={};function ce(i){let e=pi(gi,i);if(!e){let t=pi(no,i);e=new Pn({name:i,logLevel:t}),eo(gi,i,e)}return e}import{PublicKey as ic}from"@solana/web3.js";import oc from"bn.js";import yo from"big.js";import Jt from"bn.js";import Be from"bn.js";import{PublicKey as Bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as io}from"@solana/spl-token";import{PublicKey as Q,SystemProgram as yi,SYSVAR_RENT_PUBKEY as ro}from"@solana/web3.js";function kn({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ys=[kn({pubkey:io,isWritable:!1}),kn({pubkey:yi.programId,isWritable:!1}),kn({pubkey:ro,isWritable:!1})];function Tn({publicKey:i,transformSol:e}){let t=wi(i.toString());if(t instanceof Q)return e&&t.equals(Tt)?Y:t;if(e&&t.toString()===Tt.toBase58())return Y;if(typeof t=="string"){if(t===Q.default.toBase58())return Q.default;try{return new Q(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function wi(i){try{return new Q(i)}catch{return i}}var Zt=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ws=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xt=new Q("SysvarRent111111111111111111111111111111111"),hs=new Q("SysvarC1ock11111111111111111111111111111111"),yt=new Q("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),As=new Q("Sysvar1nstructions1111111111111111111111111"),Ps=yi.programId,ks=new Q("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ts=new Q("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xs=new Q("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Bs=new Q("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Is=new Q("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ss=new Q("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Cs=new Q("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ks=new Q("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ns=new Q("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ls=new Q("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Rs=new Q("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Y=new Q("So11111111111111111111111111111111111111112"),Tt=Q.default;function xn(i){return Tn({publicKey:i,transformSol:!0})}import{PublicKey as oo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as hi}from"@solana/spl-token";var Ai={chainId:101,address:oo.default.toBase58(),programId:hi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},at={chainId:101,address:"So11111111111111111111111111111111111111112",programId:hi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var In=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Tt.toBase58()||e instanceof Bn&&Tt.equals(e)){this.decimals=at.decimals,this.symbol=at.symbol,this.name=at.name,this.mint=new Bn(at.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Bn.default:Tn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},He=In;He.WSOL=new In({...at,mint:at.address});import Qt from"big.js";import co from"bn.js";import uo from"decimal.js-light";import so from"toformat";var ao=so,Bt=ao;var Yt=ce("module/fraction"),Sn=Bt(Qt),It=Bt(uo),lo={[0]:It.ROUND_DOWN,[1]:It.ROUND_HALF_UP,[2]:It.ROUND_UP},mo={[0]:Qt.roundDown,[1]:Qt.roundHalfUp,[2]:Qt.roundUp},X=class{constructor(e,t=new co(1)){this.numerator=pe(e),this.denominator=pe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new X(this.denominator,this.numerator)}add(e){let t=e instanceof X?e:new X(pe(e));return this.denominator.eq(t.denominator)?new X(this.numerator.add(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof X?e:new X(pe(e));return this.denominator.eq(t.denominator)?new X(this.numerator.sub(t.numerator),this.denominator):new X(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof X?e:new X(pe(e));return new X(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof X?e:new X(pe(e));return new X(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Yt.logWithError(`${e} is not an integer.`),e<=0&&Yt.logWithError(`${e} is not positive.`),It.set({precision:e+1,rounding:lo[n]});let r=new It(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Yt.logWithError(`${e} is not an integer.`),e<0&&Yt.logWithError(`${e} is negative.`),Sn.DP=e,Sn.RM=mo[n]||1,new Sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var po=ce("Raydium_price"),Me=class extends X{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new X(Cn(n.decimals),Cn(r.decimals))}get raw(){return new X(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&po.logWithError("mul token not equals");let n=super.mul(t);return new Me({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Kn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},$t=Kn;$t.SOL=new Kn(Ai);import go from"bn.js";var Pi=new X(new go(100)),ct=class extends X{toSignificant(e=5,t,n){return this.mul(Pi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Pi).toFixed(e,t,n)}};var bo=new Be(0),Ca=new Be(1),Ka=new Be(2),Na=new Be(3),La=new Be(5),Nn=new Be(10),Ra=new Be(100),Ma=new Be(1e3),Ea=new Be(1e4),ki=9007199254740991;function pe(i){let e=ce("Raydium_parseBigNumberish");if(i instanceof Be)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Be(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ki||i<=-ki)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Be(String(i))):typeof i=="bigint"?new Be(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Be(0))}function Cn(i){return Nn.pow(pe(i))}var wo=ce("Raydium_amount"),Ti=Bt(yo);function ho(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):wo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var he=class extends X{constructor(t,n,r=!0,o){let s=new Jt(0),a=Nn.pow(new Jt(t.decimals));if(r)s=pe(n);else{let c=new Jt(0),u=new Jt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=ho(n.toString(),t.decimals);c=pe(l),u=pe(d)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ce(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new he(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new he(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Ti.DP=this.token.decimals,new Ti(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Kt,sendAndConfirmTransaction as On,Transaction as Nt,TransactionMessage as Lt,VersionedTransaction as Rt}from"@solana/web3.js";import So from"axios";var re={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as Ao,ComputeBudgetProgram as xi,Transaction as Ii,TransactionMessage as Po,Keypair as Si,VersionedTransaction as Ci}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ko}from"@solana/spl-token";var Bi=ce("Raydium_txUtil"),Ki=1644;function en(i){let e=[],t=[];return i.microLamports&&(e.push(xi.setComputeUnitPrice({microLamports:i.microLamports})),t.push(re.SetComputeUnitPrice)),i.units&&(e.push(xi.setComputeUnitLimit({units:i.units})),t.push(re.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function wt(i){var e,t;try{return((t=await((e=i.getLatestBlockhash)==null?void 0:e.call(i)))==null?void 0:t.blockhash)||(await i.getRecentBlockhash()).blockhash}catch{return(await i.getRecentBlockhash()).blockhash}}function To(i,e){i.length<1&&Bi.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Bi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ii;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ki}catch{return!1}}function Se(i,e){let[t,n]=Ao.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function St({instructions:i,payer:e,signers:t}){return To(i,[e,...t])}function Ct({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Si.generate().publicKey.toString()}){let o=new Po({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ci(o).serialize()).toString("base64").length<Ki}catch{return!1}}var xo=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i);function ut(i){let e=[];return i.forEach(t=>{t instanceof Ii&&(t.recentBlockhash||(t.recentBlockhash=ko.toBase58()),t.feePayer||(t.feePayer=Si.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Ci&&(n=xo(n));let r=n.toString("base64");e.push(r)}),console.log("simulate tx string:",e),e}import{PublicKey as Ni,AddressLookupTableAccount as tn}from"@solana/web3.js";import{PublicKey as Bo}from"@solana/web3.js";import{getTransferFeeConfig as xc,unpackMint as Bc}from"@solana/spl-token";var Ln=ce("Raydium_accountInfo_util");async function et(i,e,t){let{batchRequest:n,commitment:r="confirmed"}={batchRequest:!1,...t},o=Rn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let d=i._buildArgs([l.map(m=>m.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Rn(a,10);s=(await(await Promise.all(c.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Ln.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:m,executable:f,lamports:b,owner:p,rentEpoch:g}=d;return m.length!==2&&m[1]!=="base64"&&Ln.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:f,lamports:b,owner:new Bo(p),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&Ln.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Mn(i,e,t){let n=await et(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}async function En({connection:i,address:e}){let t=await et(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Ni(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new tn({key:s,state:tn.deserialize(o.data)});n[s.toString()]=a,nn[s.toString()]=a}return n}var nn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new tn({key:new Ni("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:tn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var rn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await So.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=en(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Kt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0({...t||{}}):this.build(t)}build(e){let t=new Nt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async n=>{var a;let{recentBlockHash:r,skipPreflight:o=!0}=n||{},s=r!=null?r:await wt(this.connection);if(t.recentBlockhash=s,this.signers.length&&t.sign(...this.signers),ut([t]),(a=this.owner)!=null&&a.isKeyPair)return{txId:await On(this.connection,t,this.signers.find(c=>c.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:o}),signedTx:t};if(this.signAllTransactions){let c=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:o}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(u=>u.transaction.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var p;let{sequentially:l,onTxUpdate:d,recentBlockHash:m,skipPreflight:f=!0}=u||{},b=m!=null?m:await wt(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(g,y)=>(g.recentBlockhash=b,await On(this.connection,g,a[y].find(w=>w.publicKey.equals(this.owner.publicKey))?a[y]:[...a[y],this.owner.signer],{skipPreflight:f})))),signedTxs:s};if(this.signAllTransactions){let g=s.map((w,h)=>(w.recentBlockhash=b,a[h].length&&w.sign(...a[h]),w));ut(g);let y=await this.signAllTransactions(g);if(l){let w=0,h=[],A=async()=>{if(!y[w])return;let P=await this.connection.sendRawTransaction(y[w].serialize(),{skipPreflight:f});h.push({txId:P,status:"sent",signedTx:y[w]}),d==null||d([...h]),w++,this.connection.onSignature(P,T=>{let x=h.findIndex(I=>I.txId===P);x>-1&&(h[x].status=T.err?"error":"success"),d==null||d([...h]),T.err||A()},"processed"),this.connection.getSignatureStatus(P)};return await A(),{txIds:h.map(P=>P.txId),signedTxs:y}}else{let w=[];for(let h=0;h<y.length;h+=1){let A=await this.connection.sendRawTransaction(y[h].serialize(),{skipPreflight:f});w.push(A)}return{txIds:w,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,...o}=e||{},s={...this.cluster==="devnet"?{}:nn,...t},a=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let m of a)s[m]===void 0&&c.push(new Kt(m));let u=await En({connection:this.connection,address:c});for(let[m,f]of Object.entries(u))s[m]=f;let l=new Lt({payerKey:this.feePayer,recentBlockhash:r?Kt.default.toBase58():await wt(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),d=new Rt(l);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async m=>{var p;let{recentBlockHash:f,skipPreflight:b=!0}=m||{};if(f&&(d.message.recentBlockhash=f),ut([d]),(p=this.owner)!=null&&p.isKeyPair){this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))||d.sign([this.owner.signer]);let g=await this.connection.sendTransaction(d,{skipPreflight:b}),{lastValidBlockHeight:y,blockhash:w}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:w,lastValidBlockHeight:y,signature:g},"confirmed"),{txId:g,signedTx:d}}if(this.signAllTransactions){let g=await this.signAllTransactions([d]);return{txId:await this.connection.sendTransaction(g[0],{skipPreflight:b}),signedTx:g[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(u=>u.builder.instructions.length>0),s=[r,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{var b;let{sequentially:l,onTxUpdate:d,recentBlockHash:m,skipPreflight:f=!0}=u||{};if(m&&s.forEach(p=>p.message.recentBlockhash=m),ut(s),(b=this.owner)!=null&&b.isKeyPair){let{lastValidBlockHeight:p,blockhash:g}=await this.connection.getLatestBlockhash();return s.forEach((y,w)=>{a[w].find(h=>h.publicKey.equals(this.owner.publicKey))||y.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async y=>{let w=await this.connection.sendTransaction(y,{skipPreflight:f});return await this.connection.confirmTransaction({blockhash:g,lastValidBlockHeight:p,signature:w},"confirmed"),w})),signedTxs:s}}if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(l){let g=0,y=[],w=async()=>{if(!p[g])return;let h=await this.connection.sendTransaction(p[g],{skipPreflight:f});y.push({txId:h,status:"sent",signedTx:p[g]}),d==null||d([...y]),g++,this.connection.onSignature(h,A=>{let P=y.findIndex(T=>T.txId===h);P>-1&&(y[P].status=A.err?"error":"success"),d==null||d([...y]),A.err||w()},"processed"),this.connection.getSignatureStatus(h)};return w(),{txIds:[],signedTxs:p}}else{let g=[];for(let y=0;y<p.length;y+=1){let w=await this.connection.sendTransaction(p[y],{skipPreflight:f});g.push(w)}return{txIds:g,signedTxs:p}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){let{computeBudgetConfig:t,...n}=e||{},r=t?en(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((u,l)=>({...u,[l.publicKey.toBase58()]:l}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(u=>{let l=[...c,u],d=t?[...r.instructions,...l]:l,f=[...new Set(l.map(b=>b.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(b=>new Kt(b));if(c.length<12&&St({instructions:d,payer:this.feePayer,signers:f})||St({instructions:l,payer:this.feePayer,signers:f}))c.push(u);else{if(c.length===0)throw Error("item ins too big");St({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:f})?s.push(new Nt().add(...r.instructions,...c)):s.push(new Nt().add(...c)),a.push(Array.from(new Set(c.map(b=>b.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat())).map(b=>o[b]).filter(b=>b!==void 0)),c=[u]}}),c.length>0){let l=[...new Set(c.map(d=>d.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()).values()].map(d=>o[d]).filter(d=>d!==void 0);St({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:l.map(d=>d.publicKey)})?s.push(new Nt().add(...r.instructions,...c)):s.push(new Nt().add(...c)),a.push(l)}return s.forEach(u=>u.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async u=>{var p;let{sequentially:l,onTxUpdate:d,recentBlockHash:m,skipPreflight:f=!0}=u||{},b=m!=null?m:await wt(this.connection);if(s.forEach(async(g,y)=>{g.recentBlockhash=b,a[y].length&&g.sign(...a[y])}),ut(s),(p=this.owner)!=null&&p.isKeyPair)return{txIds:await Promise.all(s.map(async(g,y)=>await On(this.connection,g,a[y].find(w=>w.publicKey.equals(this.owner.publicKey))?a[y]:[...a[y],this.owner.signer],{skipPreflight:f}))),signedTxs:s};if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(l){let y=0,w=[],h=async()=>{if(!g[y])return;let A=await this.connection.sendRawTransaction(g[y].serialize(),{skipPreflight:f});w.push({txId:A,status:"sent",signedTx:g[y]}),d==null||d([...w]),y++,this.connection.onSignature(A,P=>{let T=w.findIndex(x=>x.txId===A);T>-1&&(w[T].status=P.err?"error":"success"),d==null||d([...w]),P.err||h()},"processed"),this.connection.getSignatureStatus(A)};return await h(),{txIds:w.map(A=>A.txId),signedTxs:g}}else{let y=[];for(let w=0;w<g.length;w+=1){let h=await this.connection.sendRawTransaction(g[w].serialize(),{skipPreflight:f});y.push(h)}return{txIds:y,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[],...o}=e||{},s={...this.cluster==="devnet"?{}:nn,...n},a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let g of a)s[g]===void 0&&c.push(new Kt(g));let u=await En({connection:this.connection,address:c});for(let[g,y]of Object.entries(u))s[g]=y;let l=t?en(t):{instructions:[],instructionTypes:[]},d=await wt(this.connection),m=this.signers.reduce((g,y)=>({...g,[y.publicKey.toBase58()]:y}),{}),f=[],b=[],p=[];if(this.allInstructions.forEach(g=>{let y=[...p,g],w=t?[...l.instructions,...y]:y;if(p.length<12&&Ct({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||Ct({instructions:y,payer:this.feePayer,lookupTableAddressAccount:s}))p.push(g);else{if(p.length===0)throw Error("item ins too big");let h={};for(let A of[...new Set(a)])s[A]!==void 0&&(h[A]=s[A]);if(t&&Ct({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let A=new Lt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Rt(A))}else{let A=new Lt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Rt(A))}b.push(Array.from(new Set(p.map(A=>A.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat())).map(A=>m[A]).filter(A=>A!==void 0)),p=[g]}}),p.length>0){let y=[...new Set(p.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(w=>m[w]).filter(w=>w!==void 0);if(t&&Ct({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let w=new Lt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Rt(w))}else{let w=new Lt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Rt(w))}b.push(y)}return{builder:this,transactions:f,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async g=>{var P;let{sequentially:y,onTxUpdate:w,recentBlockHash:h,skipPreflight:A=!0}=g||{};if(f.map(async(T,x)=>{b[x].length&&T.sign(b[x]),h&&(T.message.recentBlockhash=h)}),ut(f),(P=this.owner)!=null&&P.isKeyPair){let{lastValidBlockHeight:T,blockhash:x}=await this.connection.getLatestBlockhash();return f.forEach((I,R)=>{b[R].find(_=>_.publicKey.equals(this.owner.publicKey))||I.sign([this.owner.signer])}),{txIds:await Promise.all(f.map(async I=>{let R=await this.connection.sendTransaction(I,{skipPreflight:A});return await this.connection.confirmTransaction({blockhash:x,lastValidBlockHeight:T,signature:R},"confirmed"),R})),signedTxs:f}}if(this.signAllTransactions){let T=await this.signAllTransactions(f);if(y){let x=0,I=[],R=async()=>{if(!T[x])return;let _=await this.connection.sendTransaction(T[x],{skipPreflight:A});I.push({txId:_,status:"sent",signedTx:T[x]}),w==null||w([...I]),x++,this.connection.onSignature(_,q=>{let ye=I.findIndex(ee=>ee.txId===_);ye>-1&&(I[ye].status=q.err?"error":"success"),w==null||w([...I]),q.err||R()},"processed"),this.connection.getSignatureStatus(_)};return R(),{txIds:[],signedTxs:T}}else{let x=[];for(let I=0;I<T.length;I+=1){let R=await this.connection.sendTransaction(T[I],{skipPreflight:A});x.push(R)}return{txIds:x,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};function Rn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as oe}from"@solana/web3.js";var zc=new oe("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),jc=new oe("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Zc=new oe("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Yc=new oe("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Qc=new oe("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),$c=new oe("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Jc=new oe("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),eu=new oe("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),tu=new oe("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),nu=new oe("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),iu=new oe("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ru=new oe("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ou=new oe("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),su=new oe("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),au=new oe("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),cu=new oe("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),uu=new oe("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),lu=new oe("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),du=new oe("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),mu=new oe("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as Co}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ko}from"@solana/spl-token";function Ee(i,e,t){return Se([i.toBuffer(),(t!=null?t:Ko).toBuffer(),e.toBuffer()],new Co("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Oe from"bn.js";var Mt=1e4;function ue(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Oe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Mt){let c=new Oe(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Fn(i.mul(new Oe(Mt)),new Oe(Mt-o.transferFeeBasisPoints)),u=new Oe(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,d=Fn(l.mul(new Oe(o.transferFeeBasisPoints)),new Oe(Mt)),m=d.gt(s)?s:d;return{amount:l,fee:m,expirationTime:a}}else{let c=Fn(i.mul(new Oe(o.transferFeeBasisPoints)),new Oe(Mt)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function lt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Fn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Oe(0))?t.add(new Oe(1)):t}var Dn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Et=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ce(t)}createTxBuilder(e){return this.scope.checkOwner(),new rn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Dn(e))}logInfo(...e){this.logger.info(Dn(e))}logAndCreateError(...e){let t=Dn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import qe from"bn.js";var se=new qe(0),We=new qe(1),ze=new qe(-1),Ie=new qe(1).shln(64),on=new qe(1).shln(128),_n=Ie.sub(We),Ot=64,Li=on.subn(1),Ae=-443636,ke=-Ae,tt=new qe("4295048016"),nt=new qe("79226673521066979257578248091"),Ri=16,Mi="59543866431248",Ei="184467440737095516",Oi="15793534762490258745",sn=new qe(10).pow(new qe(6));var Fi={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Vu=new qe("18446744073700000000");import v from"bn.js";function an(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function vn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function qn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Ft(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Di(i,e){return Ft(i,e)?null:vn(i,e)}function _i(i,e){return Ft(i,e)?null:qn(i,e)}var ju=Buffer.from("amm_config","utf8"),No=Buffer.from("pool","utf8"),Lo=Buffer.from("pool_vault","utf8"),Ro=Buffer.from("pool_reward_vault","utf8"),vi=Buffer.from("position","utf8"),Mo=Buffer.from("tick_array","utf8"),Eo=Buffer.from("operation","utf8"),Oo=Buffer.from("pool_tick_array_bitmap_extension","utf8");function qi(i,e,t,n){return Se([No,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Wn(i,e,t){return Se([Lo,e.toBuffer(),t.toBuffer()],i)}function Wi(i,e,t){return Se([Ro,e.toBuffer(),t.toBuffer()],i)}function z(i,e,t){return Se([Mo,e.toBuffer(),an(t)],i)}function dt(i,e,t,n){return Se([vi,e.toBuffer(),an(t),an(n)],i)}function Ce(i,e){return Se([vi,e.toBuffer()],i)}function cn(i){return Se([Buffer.from("metadata","utf8"),yt.toBuffer(),i.toBuffer()],yt)}function Dt(i){return Se([Eo],i)}function Ve(i,e){return Se([Oo,e.toBuffer()],i)}import{PublicKey as it}from"@solana/web3.js";import ie from"bn.js";import $o from"bn.js";import{PublicKey as Go}from"@solana/web3.js";import Xi,{isBN as Hi}from"bn.js";import{bits as Qu,BitStructure as $u,blob as Fo,Blob as Ju,cstr as el,f32 as tl,f32be as nl,f64 as il,f64be as rl,greedy as ol,Layout as Do,ns64 as sl,ns64be as al,nu64 as cl,nu64be as ul,offset as ll,s16 as dl,s16be as ml,s24 as fl,s24be as pl,s32 as _o,s32be as gl,s40 as bl,s40be as yl,s48 as wl,s48be as hl,s8 as Al,seq as vo,struct as Pl,Structure as qo,u16 as Wo,u16be as kl,u24 as Tl,u24be as xl,u32 as Bl,u32be as Il,u40 as Sl,u40be as Cl,u48 as Kl,u48be as Nl,u8 as Vo,UInt as Uo,union as Ll,Union as Rl,unionLayoutDiscriminator as Ml,utf8 as El}from"@solana/buffer-layout";var Vn=Do,Vi=qo;var Un=Uo;var Ui=Vo,ht=Wo;var ge=_o;var Gi=vo;var Ke=Fo;var _t=class extends Vn{constructor(t,n,r){super(t,r);this.blob=Ke(t),this.signed=n}decode(t,n=0){let r=new Xi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Xi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function ne(i){return new Un(1,i)}function je(i){return new Un(4,i)}function L(i){return new _t(8,!1,i)}function V(i){return new _t(16,!1,i)}function zi(i){return new _t(16,!0,i)}var un=class extends Vn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function $(i){return new un(Ke(32),e=>new Go(e),e=>e.toBuffer(),i)}function Ue(i){return new un(Ui(),Xo,Ho,i)}function Xo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Ho(i){return i?1:0}var Gn=class extends Vi{decode(e,t){return super.decode(e,t)}};function Z(i,e,t){return new Gn(i,e,t)}function te(i,e,t){let n,r=typeof e=="number"?e:Hi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Hi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Gi(i,r,t)}var Xn=14,Ze=class{static maxTickInTickarrayBitmap(e){return e*le*mt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-U.tickCount(n):t+U.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*le,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),d=Di(1024,l);if(d!==null){let m=(u-d-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),d=_i(1024,l);if(d!==null){let m=(u+d-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}},vt=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Ze.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;if(ke<=t)throw Error(`extensionTickBoundary check error: ${ke}, ${t}`);if(n<=Ae)throw Error(`extensionTickBoundary check error: ${n}, ${Ae}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:C.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=U.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=Ze.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=C.mergeTickArrayBitmap(e).shln(mt-1-a),u=Ft(512,c)?null:vn(512,c);if(u!==null){let l=t-u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=C.mergeTickArrayBitmap(e).shrn(a),u=Ft(512,c)?null:qn(512,c);if(u!==null){let l=t+u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Ze.maxTickInTickarrayBitmap(t),r=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(r=mt-r),r}};var td=Z([Ke(8),ne("bump"),ht("index"),$(""),je("protocolFeeRate"),je("tradeFeeRate"),ht("tickSpacing"),te(L(),8,"")]),zo=Z([je("blockTimestamp"),V("sqrtPriceX64"),V("cumulativeTimePriceX64"),te(V(),1,"")]),Hn=Z([Ke(8),Ue("initialized"),$("poolId"),te(zo,1e3,"observations"),te(V(),5,"")]),jo=Z([ne("rewardState"),L("openTime"),L("endTime"),L("lastUpdateTime"),V("emissionsPerSecondX64"),L("rewardTotalEmissioned"),L("rewardClaimed"),$("tokenMint"),$("tokenVault"),$("creator"),V("rewardGrowthGlobalX64")]),ln=Z([Ke(8),ne("bump"),$("ammConfig"),$("creator"),$("mintA"),$("mintB"),$("vaultA"),$("vaultB"),$("observationId"),ne("mintDecimalsA"),ne("mintDecimalsB"),ht("tickSpacing"),V("liquidity"),V("sqrtPriceX64"),ge("tickCurrent"),ht("observationIndex"),ht("observationUpdateDuration"),V("feeGrowthGlobalX64A"),V("feeGrowthGlobalX64B"),L("protocolFeesTokenA"),L("protocolFeesTokenB"),V("swapInAmountTokenA"),V("swapOutAmountTokenB"),V("swapInAmountTokenB"),V("swapOutAmountTokenA"),ne("status"),te(ne(),7,""),te(jo,3,"rewardInfos"),te(L(),16,"tickArrayBitmap"),L("totalFeesTokenA"),L("totalFeesClaimedTokenA"),L("totalFeesTokenB"),L("totalFeesClaimedTokenB"),L("fundFeesTokenA"),L("fundFeesTokenB"),L("startTime"),te(L(),15*4-3,"padding")]),Zo=Z([V("growthInsideLastX64"),L("rewardAmountOwed")]),dn=Z([Ke(8),ne("bump"),$("nftMint"),$("poolId"),ge("tickLower"),ge("tickUpper"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),L("tokenFeesOwedA"),L("tokenFeesOwedB"),te(Zo,3,"rewardInfos"),te(L(),8,"")]),nd=Z([Ke(8),ne("bump"),$("poolId"),ge("tickLowerIndex"),ge("tickUpperIndex"),V("liquidity"),V("feeGrowthInsideLastX64A"),V("feeGrowthInsideLastX64B"),L("tokenFeesOwedA"),L("tokenFeesOwedB"),te(V(),3,"rewardGrowthInside"),te(L(),8,"")]),Yo=Z([ge("tick"),zi("liquidityNet"),V("liquidityGross"),V("feeGrowthOutsideX64A"),V("feeGrowthOutsideX64B"),te(V(),3,"rewardGrowthsOutsideX64"),te(je(),13,"")]),qt=Z([Ke(8),$("poolId"),ge("startTickIndex"),te(Yo,le,"ticks"),ne("initializedTickCount"),te(ne(),115,"")]),ji=Z([Ke(329),te($(),100,"whitelistMints")]),Zi=Z([Ke(8),$("poolId"),te(te(L(),8),Xn,"positiveTickArrayBitmap"),te(te(L(),8),Xn,"negativeTickArrayBitmap")]);var Qo=15,U=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=C.getTickArrayStartIndexByTick(r,o),l=C.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Qo/2));for(let f=0;f<l.length;f++){let{publicKey:b}=z(t,n,l[f]);c.push(b)}let d=(await et(e,c)).map(f=>f!==null?qt.decode(f.data):null),m={};for(let f=0;f<c.length;f++){let b=d[f];b!==null&&(m[b.startTickIndex]={...b,address:c[f]})}return m}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=C.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:d,tickArrayAddress:m,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[d,m,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/U.tickCount(t)),a=n?C.searchLowBitFromStart(r,o,s-1,1,t):C.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=le-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<le;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=z(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=C.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c-1}else for(c=c+1;c<le;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c+1}let{publicKey:d}=z(e,t,a);return{initializedTick:l,tickArrayAddress:d,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(C.checkIsOutOfBoundary(e)){if(e>ke)return!1;let n=C.getTickArrayStartIndexByTick(Ae,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return le*e}};var le=60,mt=512,C=class{static getTickArrayAddressByTick(e,t,n,r){let o=C.getTickArrayStartIndexByTick(n,r),{publicKey:s}=z(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=C.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=le)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*le,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*le,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*le:e+t*le}static mergeTickArrayBitmap(e){let t=new $o(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*le));return[...C.searchLowBitFromStart(e,t,s-1,o,n),...C.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return C.searchHightBitFromStart(e,t,0,mt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=C.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=z(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>C.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>C.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Ae||e>ke}static nextInitTick(e,t,n,r,o){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<le;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=le-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<le;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};import Ge from"bn.js";var Wt=class{static getfeeGrowthInside(e,t,n){let r=new Ge(0),o=new Ge(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ge(0),a=new Ge(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=O.wrappingSubU128(O.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=O.wrappingSubU128(O.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=O.mulDivFloor(O.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ie),c=t.tokenFeesOwedA.add(a),u=O.mulDivFloor(O.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ie),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=O.mulDivFloor(O.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ie),c=t.tokenFeesOwedA.add(a),u=O.mulDivFloor(O.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ie),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=O.wrappingSubU128(c,u.growthInsideLastX64),d=O.mulDivFloor(l,t.liquidity,Ie),m=u.rewardAmountOwed.add(d);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=O.wrappingSubU128(c,u.growthInsideLastX64),d=O.mulDivFloor(l,t.liquidity,Ie),m=u.rewardAmountOwed.add(d);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ge(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ge(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(O.wrappingSubU128(O.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ge(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ge(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(O.wrappingSubU128(O.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var g,y,w,h;let a=D.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),c=D.getSqrtPriceX64FromTick(t.tickLower),u=D.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,d=G.getAmountsFromLiquidity(a,c,u,n,o),[m,f]=[ue(d.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),ue(d.amountB,(y=e.mintB.extensions)==null?void 0:y.feeConfig,s,!0)],[b,p]=[ue(new Ge(new S(d.amountA.toString()).mul(l).toFixed(0)),(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),ue(new Ge(new S(d.amountB.toString()).mul(l).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:m,amountB:f,amountSlippageA:b,amountSlippageB:p,expirationTime:lt(m.expirationTime,f.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as Yi}from"@solana/spl-token";var Pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintA.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:d,accounts:m,sqrtPriceX64:f,feeAmount:b}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,u,o);return a.push(...m),{expectedAmountOut:d.mul(ze),remainingAccounts:a,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:g}=z(e.programId,e.id,p.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:d,accounts:m,sqrtPriceX64:f,feeAmount:b}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(ze),u,o);return a.push(...m),{expectedAmountIn:d,remainingAccounts:a,executionPrice:f,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?vt.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):C.checkTickArrayIsInitialized(C.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=z(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=z(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),r=t?C.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):C.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=Ze.nextInitializedTickArrayStartIndex(C.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=vt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ae||t>ke)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let d=o[l],m=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(d.tokenMint))==null?void 0:c.owner;if(m===void 0)throw Error("get new reward mint info error");let f={...d,perSecond:O.x64ToDecimal(d.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new it(m)};if(f.tokenMint.equals(it.default))continue;if(n<=f.openTime.toNumber()||r.eq(se)){s.push(f);continue}let b=new ie(Math.min(f.endTime.toNumber(),n)),p=b.sub(f.lastUpdateTime),g=O.mulDivFloor(p,f.emissionsPerSecondX64,r),y=f.rewardGrowthGlobalX64.add(g),w=O.mulDivFloor(p,f.emissionsPerSecondX64,Ie),h=f.rewardTotalEmissioned.add(w);s.push({...f,rewardGrowthGlobalX64:y,rewardTotalEmissioned:h,lastUpdateTime:b})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=C.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;return t>ke&&(t=U.getArrayStartIndex(ke,e)+U.tickCount(e)),n<Ae&&(n=U.getArrayStartIndex(Ae,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*mt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Mn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Zi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=C.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=C.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let d of l){let{publicKey:m}=z(c.programId,c.id,d);o.push({pubkey:m}),r[m.toString()]=c.id}}let s=await Mn(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=qt.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]={...l,address:c.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(m=>m.accountInfo.mint),u=[];for(let m of c)for(let f of s)u.push(Ce(f,m).publicKey);let l=await et(t,u,{batchRequest:r}),d={};for(let m of l){if(m===null)continue;let f=dn.decode(m.data),b=f.poolId.toString(),p=e.find(I=>I.state.id.toBase58()===b);if(p===void 0)continue;let g=p.state,y=C._getTickPriceLegacy({poolInfo:g,tick:f.tickLower,baseIn:!0}),w=C._getTickPriceLegacy({poolInfo:g,tick:f.tickUpper,baseIn:!0}),{amountA:h,amountB:A}=G.getAmountsFromLiquidity(g.sqrtPriceX64,y.tickSqrtPriceX64,w.tickSqrtPriceX64,f.liquidity,!1),P=1/(1-Math.sqrt(Math.sqrt(y.price.div(w.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:y.price,priceUpper:w.price,amountA:h,amountB:A,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(I=>({...I,pendingReward:new ie(0)})),leverage:P,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let T=await C.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),x=await C.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);d[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=T,d[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=x}if(o){let m=Object.values(d),f=await et(t,m,{batchRequest:r}),b={};for(let p=0;p<m.length;p++){let g=f[p];if(g===null)continue;let y=m[p].toString();b[y]=qt.decode(g.data)}for(let{state:p,positionAccount:g}of e)if(!!g)for(let y of g){let w=`${p.programId.toString()}-${p.id.toString()}-${y.tickLower}`,h=`${p.programId.toString()}-${p.id.toString()}-${y.tickUpper}`,A=b[d[w].toString()],P=b[d[h].toString()],T=A.ticks[C.getTickOffsetInArray(y.tickLower,p.tickSpacing)],x=P.ticks[C.getTickOffsetInArray(y.tickUpper,p.tickSpacing)],{tokenFeeAmountA:I,tokenFeeAmountB:R}=await Wt.GetPositionFees(p,y,T,x),_=await Wt.GetPositionRewards(p,y,T,x);y.tokenFeeAmountA=I.gte(new ie(0))?I:new ie(0),y.tokenFeeAmountB=R.gte(new ie(0))?R:new ie(0);for(let q=0;q<_.length;q++)y.rewardInfos[q].pendingReward=_[q].gte(new ie(0))?_[q]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new S(0)}){var _;let c,u=n.toBase58()===e.mintA.address,[l,d]=u?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?c=u?tt.add(new ie(1)):nt.sub(new ie(1)):c=D.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ue(o,l,r,!1),{expectedAmountOut:f,remainingAccounts:b,executionPrice:p,feeAmount:g}=Pe.getOutputAmountAndRemainAccounts(e,t,n,m.amount.sub((_=m.fee)!=null?_:se),c),y=ue(f,d,r,!1),w=D.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),h=u?w:new S(1).div(w),A=f.mul(new ie(Math.floor((1-s)*1e10))).div(new ie(1e10)),P=ue(A,d,r,!1),T=u?e.currentPrice:new S(1).div(e.currentPrice),x=new S(h).sub(T).abs(),I=T,R=new ct(new S(x).mul(10**15).toFixed(0),new S(I).mul(10**15).toFixed(0));return{realAmountIn:m,amountOut:y,minAmountOut:P,expirationTime:lt(m.expirationTime,y.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:R,fee:g,remainingAccounts:b}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s}){let a=r.address===e.mintB.address,[c,u]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,d]=[new He({...c,mint:c.address,isToken2022:c.programId===Yi.toBase58()}),new He({...u,mint:u.address,isToken2022:u.programId===Yi.toBase58()})],{realAmountIn:m,amountOut:f,minAmountOut:b,expirationTime:p,currentPrice:g,executionPrice:y,priceImpact:w,fee:h,remainingAccounts:A}=await Pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new it(c.address),amountIn:n,slippage:o,epochInfo:s}),P={...m,amount:new he(l,m.amount),fee:m.fee===void 0?void 0:new he(l,m.fee)},T={...f,amount:new he(d,f.amount),fee:f.fee===void 0?void 0:new he(d,f.fee)},x={...b,amount:new he(d,b.amount),fee:b.fee===void 0?void 0:new he(d,b.fee)},I=new Me({baseToken:l,denominator:new ie(10).pow(new ie(20+l.decimals)),quoteToken:d,numerator:g.mul(new S(10**(20+d.decimals))).toFixed(0)}),R=new Me({baseToken:l,denominator:new ie(10).pow(new ie(20+l.decimals)),quoteToken:d,numerator:y.mul(new S(10**(20+d.decimals))).toFixed(0)}),_=new he(l,h);return{realAmountIn:P,amountOut:T,minAmountOut:x,expirationTime:p,currentPrice:I,executionPrice:R,priceImpact:w,fee:_,remainingAccounts:A}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var b,p,g;let o=e[t],s=C.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=C.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,d=a-s,m=o.priceMax-o.priceMin,f;return l<=0?f=0:d===l?f=m/l:m===l?f=l/d:f=l/m*(l/d),{feeApr:o.feeApr*f,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*f,(p=o.rewardApr[1])!=null?p:0*f,(g=o.rewardApr[2])!=null?g:0*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],d=r[xn(e.mintA.address).toString()],m=r[xn(e.mintB.address).toString()],f=e.mintA.decimals,b=e.mintB.decimals;if(!l||!d||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=D.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),g=D.getSqrtPriceX64FromTick(s),y=D.getSqrtPriceX64FromTick(a),{amountSlippageA:w,amountSlippageB:h}=G.getAmountsFromLiquidityWithSlippage(p,g,y,t,!1,!1,0),{amountSlippageA:A,amountSlippageB:P}=G.getAmountsFromLiquidityWithSlippage(p,g,y,o,!1,!1,0),T=new S(w.toString()).div(new S(10).pow(f)).mul(d.value).add(new S(h.toString()).div(new S(10).pow(b)).mul(m.value)),x=new S(A.toString()).div(new S(10).pow(f)).mul(d.value).add(new S(P.toString()).div(new S(10).pow(b)).mul(m.value)),I=x.div(T.add(x)).div(x),_=new S(l.volumeFee).mul(365).div(u).mul(I).mul(100).toNumber(),q=3600*24*365,ye=e.rewardDefaultInfos.map(ee=>{var H,Jn;let Te=ee.mint.decimals,J=r[ee.mint.address];return c<((H=ee.startTime)!=null?H:0)||c>((Jn=ee.endTime)!=null?Jn:0)||!ee.perSecond||!J||Te===void 0?0:new S(J.value).mul(new S(ee.perSecond).mul(q)).div(new S(10).pow(Te)).mul(I).mul(100).toNumber()});return{feeApr:_,rewardsApr:ye,apr:_+ye.reduce((ee,Te)=>ee+Te,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var y,w;let l=D.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),d=D.getSqrtPriceX64FromTick(n),m=D.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,b=ue(o,(y=e[t?"mintA":"mintB"].extensions)==null?void 0:y.feeConfig,c,!u),p=new ie(new S(b.amount.sub((w=b.fee)!=null?w:se).toString()).mul(f).toFixed(0)),g;if(l.lte(d))g=t?G.getLiquidityFromTokenAmountA(d,m,p,!a):new ie(0);else if(l.lte(m)){let h=G.getLiquidityFromTokenAmountA(l,m,p,!a),A=G.getLiquidityFromTokenAmountB(d,l,p);g=t?h:A}else g=t?new ie(0):G.getLiquidityFromTokenAmountB(d,m,p);return Pe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var g,y,w,h;let c=D.getSqrtPriceX64FromTick(n),u=D.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,d=G.getAmountsFromLiquidity(D.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[m,f]=[ue(d.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),ue(d.amountB,(y=t.mintB.extensions)==null?void 0:y.feeConfig,e,!0)],[b,p]=[ue(d.amountA.muln(l),(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),ue(d.amountB.muln(l),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:f,amountSlippageA:b,amountSlippageB:p,expirationTime:lt(m.expirationTime,f.expirationTime)}}static async fetchComputeClmmInfo({owner:e,connection:t,poolInfo:n}){let r=await t.getAccountInfo(new it(n.id));if(!r)throw new Error(`pool not found ${n.id}`);let o=ln.decode(r.data),s=Ve(e,new it(n.id)).publicKey,a=await Pe.fetchExBitmaps({connection:t,exBitmapAddress:[s],batchRequest:!1});return{...o,id:new it(n.id),programId:new it(n.programId),mintA:n.mintA,mintB:n.mintB,ammConfig:{...n.config,id:new it(n.config.id),fundOwner:""},currentPrice:new S(n.price),exBitmapInfo:a[s.toBase58()],startTime:o.startTime.toNumber()}}};var O=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(se)||(o=o.add(We)),o}static mulDivFloor(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).add(n.sub(We)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new v(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(on).sub(t).mod(on)}};function me(i,e){return zn(i.mul(e),64,256)}function Jo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function zn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var D=class{static sqrtPriceX64ToPrice(e,t,n){return O.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return O.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(se))return e;let o=t.shln(Ot);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?O.mulDivCeil(s,e,a):O.mulDivRoundingUp(s,We,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return O.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Ot);if(r)return e.add(o.div(t));{let s=O.mulDivRoundingUp(o,We,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ae||e>ke)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new v("18445821805675395072"):new v("18446744073709551616");return(t&2)!=0&&(n=me(n,new v("18444899583751176192"))),(t&4)!=0&&(n=me(n,new v("18443055278223355904"))),(t&8)!=0&&(n=me(n,new v("18439367220385607680"))),(t&16)!=0&&(n=me(n,new v("18431993317065453568"))),(t&32)!=0&&(n=me(n,new v("18417254355718170624"))),(t&64)!=0&&(n=me(n,new v("18387811781193609216"))),(t&128)!=0&&(n=me(n,new v("18329067761203558400"))),(t&256)!=0&&(n=me(n,new v("18212142134806163456"))),(t&512)!=0&&(n=me(n,new v("17980523815641700352"))),(t&1024)!=0&&(n=me(n,new v("17526086738831433728"))),(t&2048)!=0&&(n=me(n,new v("16651378430235570176"))),(t&4096)!=0&&(n=me(n,new v("15030750278694412288"))),(t&8192)!=0&&(n=me(n,new v("12247334978884435968"))),(t&16384)!=0&&(n=me(n,new v("8131365268886854656"))),(t&32768)!=0&&(n=me(n,new v("3584323654725218816"))),(t&65536)!=0&&(n=me(n,new v("696457651848324352"))),(t&131072)!=0&&(n=me(n,new v("26294789957507116"))),(t&262144)!=0&&(n=me(n,new v("37481735321082"))),e>0&&(n=Li.div(n)),n}static getTickFromPrice(e,t,n){return D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(nt)||e.lt(tt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new v(t-64),r=Jo(n,32,128),o=new v("8000000000000000","hex"),s=0,a=new v(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new v(0))&&s<Ri;){c=c.mul(c);let b=c.shrn(127);c=c.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let u=a.shrn(32),d=r.add(u).mul(new v(Mi)),m=zn(d.sub(new v(Ei)),64,128).toNumber(),f=zn(d.add(new v(Oi)),64,128).toNumber();return m==f?m:D.getSqrtPriceX64FromTick(f).lte(e)?f:m}},ft=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ft.getTickWithPriceAndTickspacing(e,t,n,r),s=D.getSqrtPriceX64FromTick(o);return D.sqrtPriceX64ToPrice(s,n,r)}},G=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Ot),s=t.sub(e);return r?O.mulDivRoundingUp(O.mulDivCeil(o,s,t),We,e):O.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");return r?O.mulDivCeil(n,t.sub(e),Ie):O.mulDivFloor(n,t.sub(e),Ie)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?O.mulDivRoundingUp(a,We,_n):a.shrn(Ot)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),O.mulDivFloor(n,_n,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return G.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=G.getLiquidityFromTokenAmountA(e,n,r,!1),a=G.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return G.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:G.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new v(0)};if(e.lt(n)){let s=G.getTokenAmountAFromLiquidity(e,n,r,o),a=G.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new v(0),amountB:G.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=G.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,d=new v(new S(c.toString()).mul(l).toFixed(0)),m=new v(new S(u.toString()).mul(l).toFixed(0));return{amountSlippageA:d,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var w,h,A,P;let u=D.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=D.getSqrtPriceX64FromTick(t),d=D.getSqrtPriceX64FromTick(n),m=s?1+o:1-o,f=G.getAmountsFromLiquidity(u,l,d,r,s),[b,p]=[ue(f.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,a,c),ue(f.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,c)],[g,y]=[ue(new v(new S(f.amountA.toString()).mul(m).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),ue(new v(new S(f.amountB.toString()).mul(m).toFixed(0)),(P=e.mintB.extensions)==null?void 0:P.feeConfig,a,c)];return{liquidity:r,amountA:b,amountB:p,amountSlippageA:g,amountSlippageB:y,expirationTime:lt(b.expirationTime,p.expirationTime)}}},pt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,d,m,f,b){if(m.eq(se))throw new Error("amountSpecified must not be 0");if(b||(b=s?tt.add(We):nt.sub(We)),s){if(b.lt(tt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(d))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(nt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(d))throw new Error("sqrtPriceX64 must greater than current")}let p=m.gt(se),g={amountSpecifiedRemaining:m,amountCalculated:se,sqrtPriceX64:d,tick:u>f?Math.min(f+U.tickCount(l)-1,u):f,accounts:[],liquidity:c,feeAmount:new v(0)},y=f,w=n[f],h=0,A=!s&&w.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(se)&&!g.sqrtPriceX64.eq(b);){if(h>10)throw Error("liquidity limit");let P={};P.sqrtPriceStartX64=g.sqrtPriceX64;let T=C.nextInitTick(w,g.tick,l,s,A),x=T||null,I=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let _=Pe.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},y,s);if(!_.isExist)throw Error("swapCompute LiquidityInsufficient");y=_.nextStartIndex;let{publicKey:q}=z(e,t,y);I=q,w=n[y],x=C.firstInitializedTick(w,s)}P.tickNext=x.tick,P.initialized=x.liquidityGross.gtn(0),f!==y&&I&&(g.accounts.push(I),f=y),P.tickNext<Ae?P.tickNext=Ae:P.tickNext>ke&&(P.tickNext=ke),P.sqrtPriceNextX64=D.getSqrtPriceX64FromTick(P.tickNext);let R;if(s&&P.sqrtPriceNextX64.lt(b)||!s&&P.sqrtPriceNextX64.gt(b)?R=b:R=P.sqrtPriceNextX64,[g.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=pt.swapStepCompute(g.sqrtPriceX64,R,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(P.feeAmount),p?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),g.amountCalculated=g.amountCalculated.sub(P.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(P.amountOut),g.amountCalculated=g.amountCalculated.add(P.amountIn.add(P.feeAmount))),g.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let _=x.liquidityNet;s&&(_=_.mul(ze)),g.liquidity=G.addDelta(g.liquidity,_)}A=P.tickNext!=g.tick&&!s&&w.startTickIndex===P.tickNext,g.tick=s?P.tickNext-1:P.tickNext}else if(g.sqrtPriceX64!=P.sqrtPriceStartX64){let _=D.getTickFromSqrtPriceX64(g.sqrtPriceX64);A=_!=g.tick&&!s&&w.startTickIndex===_,g.tick=_}++h}try{let{nextStartIndex:P,isExist:T}=U.nextInitializedTickArray(g.tick,l,s,r,o);T&&f!==P&&(g.accounts.push(z(e,t,P).publicKey),f=P)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new v(0),amountIn:new v(0),amountOut:new v(0),feeAmount:new v(0)},a=e.gte(t),c=r.gte(se);if(c){let l=O.mulDivFloor(r,sn.sub(new v(o.toString())),sn);s.amountIn=a?G.getTokenAmountAFromLiquidity(t,e,n,!0):G.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?G.getTokenAmountBFromLiquidity(t,e,n,!1):G.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromOutput(e,n,r.mul(ze),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=G.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=G.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:G.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:G.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(ze))&&(s.amountOut=r.mul(ze)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=O.mulDivCeil(s.amountIn,new v(o),sn.sub(new v(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as be,TOKEN_2022_PROGRAM_ID as st,ASSOCIATED_TOKEN_PROGRAM_ID as ir}from"@solana/spl-token";import{PublicKey as B,TransactionInstruction as De,SystemProgram as At,Keypair as $n}from"@solana/web3.js";import rr from"bn.js";import{PublicKey as os,Keypair as ss}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as as}from"@solana/spl-token";import Pm from"bn.js";var es=Z([$("mint"),$("owner"),L("amount"),je("delegateOption"),$("delegate"),ne("state"),je("isNativeOption"),L("isNative"),L("delegatedAmount"),je("closeAuthorityOption"),$("closeAuthority")]);function ts(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function jn(i,...e){if(!ts(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Zn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Qi(i,e){jn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var fn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Fe=(i,e)=>i<<32-e|i>>>e;var sm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ns(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Yn(i){return typeof i=="string"&&(i=ns(i)),jn(i),i}var mn=class{clone(){return this._cloneInto()}},am={}.toString;function $i(i){let e=n=>i().update(Yn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function is(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var Ji=(i,e,t)=>i&e^~i&t,er=(i,e,t)=>i&e^i&t^e&t,pn=class extends mn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=fn(this.buffer)}update(e){Zn(this);let{view:t,buffer:n,blockLen:r}=this;e=Yn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=fn(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Zn(this),Qi(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let d=s;d<r;d++)t[d]=0;is(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=fn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,l[d],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var rs=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ot=new Uint32Array(64),Qn=class extends pn{constructor(){super(64,32,8,!1),this.A=rt[0]|0,this.B=rt[1]|0,this.C=rt[2]|0,this.D=rt[3]|0,this.E=rt[4]|0,this.F=rt[5]|0,this.G=rt[6]|0,this.H=rt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)ot[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){let m=ot[d-15],f=ot[d-2],b=Fe(m,7)^Fe(m,18)^m>>>3,p=Fe(f,17)^Fe(f,19)^f>>>10;ot[d]=p+ot[d-7]+b+ot[d-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:l}=this;for(let d=0;d<64;d++){let m=Fe(a,6)^Fe(a,11)^Fe(a,25),f=l+m+Ji(a,c,u)+rs[d]+ot[d]|0,p=(Fe(n,2)^Fe(n,13)^Fe(n,22))+er(n,r,o)|0;l=u,u=c,c=a,a=s+f|0,s=o,o=r,r=n,n=f+p|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,c,u,l)}roundClean(){ot.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var tr=$i(()=>new Qn);var Bm=ce("Raydium_Util");function nr({fromPublicKey:i,programId:e=as}){let t=ss.generate().publicKey.toBase58().slice(0,32);return{publicKey:cs(i,t,e),seed:t}}function cs(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=tr(n);return new os(r)}var or=ce("Raydium_Clmm"),_e={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},de=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,b){let p=Z([V("sqrtPriceX64"),L("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1}],y=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:b},y);let w=Buffer.from([..._e.createPool,...y]);return new De({keys:g,programId:e,data:w})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:c,startTime:u,forerunCreate:l}=e,d=nr({fromPublicKey:r,programId:n}),[m,f]=[new B(o.address),new B(s.address)],b=[At.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:d.seed,newAccountPubkey:d.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Hn.span),space:Hn.span,programId:n})],{publicKey:p}=qi(n,a,m,f),{publicKey:g}=Wn(n,p,m),{publicKey:y}=Wn(n,p,f);return b.push(this.createPoolInstruction(n,p,r,a,d.publicKey,m,g,new B(o.programId||be),f,y,new B(s.programId||be),Ve(n,p).publicKey,c,u)),{signers:[],instructions:b,instructionTypes:[re.CreateAccount,re.ClmmCreatePool],address:{poolId:p,observationId:d.publicKey,mintAVault:g,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,b,p,g,y,w,h,A,P,T,x,I,R,_){let q=Z([ge("tickLowerIndex"),ge("tickUpperIndex"),ge("tickArrayLowerStartIndex"),ge("tickArrayUpperStartIndex"),V("liquidity"),L("amountMaxA"),L("amountMaxB"),Ue("withMetadata"),ne("optionBaseFlag"),Ue("baseFlag")]),ye=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],ee=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ir,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ye],Te=Buffer.alloc(q.span);q.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:P,liquidity:T,amountMaxA:x,amountMaxB:I,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},Te);let J=Buffer.from([..._e.openPosition,...Te]);return new De({keys:ee,programId:e,data:J})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let d=[],[m,f]=[new B(e.programId),new B(e.id)],b;if(l)b=new B((await l(1))[0]);else{let I=$n.generate();d.push(I),b=I.publicKey}let p=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=z(m,f,p),{publicKey:w}=z(m,f,g),{publicKey:h}=Ee(n.wallet,b,be),{publicKey:A}=cn(b),{publicKey:P}=Ce(m,b),{publicKey:T}=dt(m,f,r,o),x=this.openPositionFromLiquidityInstruction(m,n.feePayer,f,n.wallet,b,h,A,T,y,w,P,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,p,g,s,a,c,u);return{signers:d,instructions:[x],instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:y,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:P,protocolPosition:T}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let d=[],[m,f]=[new B(e.programId),new B(e.id)],b;if(l)b=new B((await l(1))[0]);else{let I=$n.generate();d.push(I),b=I.publicKey}let p=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=z(m,f,p),{publicKey:w}=z(m,f,g),{publicKey:h}=Ee(n.wallet,b,be),{publicKey:A}=cn(b),{publicKey:P}=Ce(m,b),{publicKey:T}=dt(m,f,r,o),x=this.openPositionFromBaseInstruction(m,n.feePayer,f,n.wallet,b,h,A,T,y,w,P,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,p,g,u,s,a,c,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,g])?Ve(m,f).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:y,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:P,protocolPosition:T},instructions:[x],signers:d,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,b,p,g,y,w,h,A,P,T,x,I,R,_){let q=Z([ge("tickLowerIndex"),ge("tickUpperIndex"),ge("tickArrayLowerStartIndex"),ge("tickArrayUpperStartIndex"),V("liquidity"),L("amountMaxA"),L("amountMaxB"),Ue("withMetadata"),ne("optionBaseFlag"),Ue("baseFlag")]),ye=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],ee=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ir,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ye],Te=Buffer.alloc(q.span);q.encode({tickLowerIndex:w,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:P,liquidity:new rr(0),amountMaxA:x==="MintA"?I:R,amountMaxB:x==="MintA"?R:I,withMetadata:T==="create",baseFlag:x==="MintA",optionBaseFlag:1},Te);let J=Buffer.from([..._e.openPosition,...Te]);return new De({keys:ee,programId:e,data:J})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let d,m=[];if(l)d=new B((await l(1))[0]);else{let I=$n.generate();m.push(I),d=I.publicKey}let[f,b]=[new B(e.programId),new B(e.id)],p=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:y}=z(f,b,p),{publicKey:w}=z(f,b,g),{publicKey:h}=Ee(n.wallet,d,be),{publicKey:A}=cn(d),{publicKey:P}=Ce(f,d),{publicKey:T}=dt(f,b,r,o),x=this.openPositionFromLiquidityInstruction(f,n.wallet,b,n.wallet,d,h,A,T,y,w,P,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,p,g,s,a,c,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,g])?Ve(f,b).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:y,tickArrayUpper:w,positionNftAccount:h,metadataAccount:A,personalPosition:P,protocolPosition:T},instructions:[x],signers:m,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=Z([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([..._e.closePosition,...c]);return new De({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new B(e.programId),{publicKey:s}=Ee(n.wallet,r.nftMint,be),{publicKey:a}=Ce(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[re.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,b,p,g,y,w){let h=Z([V("liquidity"),L("amountMaxA"),L("amountMaxB"),ne("optionBaseFlag"),Ue("baseFlag")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(h.span);h.encode({liquidity:p,amountMaxA:g,amountMaxB:y,optionBaseFlag:0,baseFlag:!1},T);let x=Buffer.from([..._e.increaseLiquidity,...T]);return new De({keys:P,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new B(e.programId),new B(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:m}=z(c,u,l),{publicKey:f}=z(c,u,d),{publicKey:b}=Ee(r.wallet,n.nftMint,be),{publicKey:p}=Ce(c,n.nftMint),{publicKey:g}=dt(c,u,n.tickLower,n.tickUpper),y=this.increasePositionFromLiquidityInstruction(c,r.wallet,b,p,u,g,m,f,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?Ve(c,u).publicKey:void 0);return{address:{tickArrayLower:m,tickArrayUpper:f,positionNftAccount:b,personalPosition:p,protocolPosition:g},signers:[],instructions:[y],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new B(e.programId),new B(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:m}=z(c,u,l),{publicKey:f}=z(c,u,d),{publicKey:b}=Ee(r.wallet,n.nftMint,be),{publicKey:p}=Ce(c,n.nftMint),{publicKey:g}=dt(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:m,tickArrayUpper:f,positionNftAccount:b,personalPosition:p,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,b,p,u,g,m,f,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?Ve(c,u).publicKey:void 0)],signers:[],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,b,p,g,y,w){let h=Z([V("liquidity"),L("amountMaxA"),L("amountMaxB"),ne("optionBaseFlag"),Ue("baseFlag")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(h.span);h.encode({liquidity:new rr(0),amountMaxA:p==="MintA"?g:y,amountMaxB:p==="MintA"?y:g,baseFlag:p==="MintA",optionBaseFlag:1},T);let x=Buffer.from([..._e.increaseLiquidity,...T]);return new De({keys:P,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,b,p,g,y,w,h){let A=Z([V("liquidity"),L("amountMinA"),L("amountMinB")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...p.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],x=Buffer.alloc(A.span);A.encode({liquidity:g,amountMinA:y,amountMinB:w},x);let I=Buffer.from([..._e.decreaseLiquidity,...x]);return new De({keys:T,programId:e,data:I})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new B(e.programId),new B(e.id)],d=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=z(u,l,d),{publicKey:b}=z(u,l,m),{publicKey:p}=Ee(r.wallet,n.nftMint,c),{publicKey:g}=Ce(u,n.nftMint),{publicKey:y}=dt(u,l,n.tickLower,n.tickUpper),w=[];for(let A=0;A<e.rewardDefaultInfos.length;A++)w.push({poolRewardVault:new B(t.rewardInfos[A].vault),ownerRewardVault:r.rewardAccounts[A],rewardMint:new B(e.rewardDefaultInfos[A].mint.address)});let h=[];return h.push(this.decreaseLiquidityInstruction(u,r.wallet,p,g,l,y,f,b,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),w,o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,m])?Ve(u,l).publicKey:void 0)),{address:{tickArrayLower:f,tickArrayUpper:b,positionNftAccount:p,personalPosition:g,protocolPosition:y},signers:[],instructions:h,instructionTypes:[re.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,d,m,f,b,p,g,y){let w=Z([L("amount"),L("otherAmountThreshold"),V("sqrtPriceLimitX64"),Ue("isBaseInput")]),h=[...y?[{pubkey:y,isSigner:!1,isWritable:!0}]:[],...d.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...h],P=Buffer.alloc(w.span);w.encode({amount:f,otherAmountThreshold:b,sqrtPriceLimitX64:p,isBaseInput:g},P);let T=Buffer.from([..._e.swap,...P]);return new De({keys:A,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:c}){let[u,l]=[new B(e.programId),new B(e.id)],[d,m]=[new B(t.vault.A),new B(t.vault.B)],[f,b]=[new B(e.mintA.address),new B(e.mintB.address)],p=e.mintA.address===r.toString(),g=[this.swapInstruction(u,n.wallet,l,new B(e.config.id),p?n.tokenAccountA:n.tokenAccountB,p?n.tokenAccountB:n.tokenAccountA,p?d:m,p?m:d,p?f:b,p?b:f,c,d,o,s,a,!0,Ve(u,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[re.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,d,m){let f=Z([L("openTime"),L("endTime"),V("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:At.programId,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:pe(l),endTime:pe(d),emissionsPerSecondX64:m},p);let g=Buffer.from([..._e.initReward,...p]);return new De({keys:b,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a=Wi(o,s,r.mint).publicKey,c=Dt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new B(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[re.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,d,m){let f=Z([ne("rewardIndex"),V("emissionsPerSecondX64"),L("openTime"),L("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:u,emissionsPerSecondX64:m,openTime:pe(l),endTime:pe(d)},p);let g=Buffer.from([..._e.setRewardEmissions,...p]);return new De({keys:b,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,c,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(a=m,c=new B(t.rewardInfos[m].vault),u=new B(t.rewardInfos[m].mint.address));(a===void 0||c===void 0)&&or.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Dt(o).publicKey,d=[this.setRewardInstruction(o,n.wallet,s,l,new B(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:d,instructionTypes:[re.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=Z([ne("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let d=Buffer.from([..._e.collectReward,...l]);return new De({keys:u,programId:e,data:d})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new B(e.programId),new B(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new B(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&or.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[re.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:c}){let[u,l]=[new B(e.programId),new B(e.id)],[d,m]=[new B(t.vault.A),new B(t.vault.B)],[f,b]=[new B(e.mintA.address),new B(e.mintB.address)],p=e.mintA.address===r.toString(),g=[this.swapInstruction(u,n.wallet,l,new B(e.config.id),p?n.tokenAccountB:n.tokenAccountA,p?n.tokenAccountA:n.tokenAccountB,p?m:d,p?d:m,p?f:b,p?b:f,c,d,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[re.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Ne from"bn.js";var sr=class extends Et{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||W.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,txVersion:d}=e,m=this.createTxBuilder(),[f,b,p]=new Ne(new W(r.address).toBuffer()).gt(new Ne(new W(o.address).toBuffer()))?[o,r,new S(1).div(a)]:[r,o,a],g=D.priceToSqrtPriceX64(p,f.decimals,b.decimals),y=await de.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:f,mintB:b,ammConfigId:s.id,initialPriceX64:g,startTime:c,forerunCreate:l});return m.addInstruction(y),m.addCustomComputeBudget(u),m.versionBuild({txVersion:d,extInfo:{address:{...y.address,programId:t.toString(),id:y.address.poolId.toString(),mintA:f,mintB:b,openTime:c.toString(),vault:{A:y.address.mintAVault.toString(),B:y.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},mockPoolInfo:{type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:y.address.poolId.toString(),mintA:f,mintB:b,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:p.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},...Fi},forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:d="create",getEphemeralSigners:m,computeBudgetConfig:f,txVersion:b}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let p=this.createTxBuilder(),g=null,y=null,w=n.useSOLBalance&&e.mintA.address===Y.toString(),h=n.useSOLBalance&&e.mintB.address===Y.toString(),[A,P]=s==="MintA"?[a,c]:[c,a],{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new W(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:w||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});T&&(g=T),p.addInstruction(x||{});let{account:I,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new W(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:u,checkCreateATAOwner:l});I&&(y=I),p.addInstruction(R||{}),(!g||!y)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let _=t||await this.getClmmPoolKeys(e.id),q=await de.openPositionFromBaseInstructions({poolInfo:e,poolKeys:_,ownerInfo:{...n,feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:y},tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:d,getEphemeralSigners:m});return p.addInstruction(q),p.addCustomComputeBudget(f),p.versionBuild({txVersion:b,extInfo:q.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:d="create",txVersion:m,getEphemeralSigners:f}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let b=this.createTxBuilder(),p=null,g=null,y=n.useSOLBalance&&e.mintA.address===Y.toBase58(),w=n.useSOLBalance&&e.mintB.address===Y.toBase58(),{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new W(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:y?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:u,checkCreateATAOwner:l});h&&(p=h),b.addInstruction(A||{});let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new W(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});P&&(g=P),b.addInstruction(T||{}),(p===void 0||g===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=t||await this.getClmmPoolKeys(e.id),I=await de.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:d,getEphemeralSigners:f});return b.addInstruction(I),b.versionBuild({txVersion:m,extInfo:{address:I.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,ownerPosition:n,amountMaxA:r,amountMaxB:o,liquidity:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:d}=e,m=this.createTxBuilder(),f,b,p=a.useSOLBalance&&t.mintA.address===Y.toString(),g=a.useSOLBalance&&t.mintB.address===Y.toString(),{account:y,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new W(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:p?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});y&&(f=y),m.addInstruction(w||{});let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new W(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:o}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:u});h&&(b=h),m.addInstruction(A||{}),!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let P=await this.getClmmPoolKeys(t.id),T=de.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:P,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},liquidity:s,amountMaxA:r,amountMaxB:o});return m.addInstruction(T),m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:T.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:d}=e,m=this.createTxBuilder(),f,b,p=a.useSOLBalance&&t.mintA.address===Y.toString(),g=a.useSOLBalance&&t.mintB.address===Y.toString(),{account:y,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new W(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:p?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});y&&(f=y),m.addInstruction(w||{});let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new W(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:u});h&&(b=h),m.addInstruction(A||{}),!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let P=await this.getClmmPoolKeys(t.id),T=de.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:P,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:b},base:r,baseAmount:o,otherAmountMax:s});return m.addInstruction(T),m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:T.address}})}async decreaseLiquidity(e){let{poolInfo:t,ownerPosition:n,ownerInfo:r,amountMinA:o,amountMinB:s,liquidity:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let m=this.createTxBuilder(),f=r.useSOLBalance&&t.mintA.address===Y.toString(),b=r.useSOLBalance&&t.mintB.address===Y.toString(),p,g,{account:y,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new W(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:f?!1:c,checkCreateATAOwner:u});p=y,w&&m.addInstruction(w);let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new W(t.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});g=h,A&&m.addInstruction(A);let P=[];for(let R of t.rewardDefaultInfos){let _=r.useSOLBalance&&R.mint.address===Y.toString(),q;if(R.mint.address===t.mintA.address)q=p;else if(R.mint.address===t.mintB.address)q=g;else{let{account:ye,instructionParams:ee}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new W(R.mint.programId),mint:new W(R.mint.address),notUseTokenAccount:_,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!_,associatedOnly:_?!1:c,checkCreateATAOwner:u});q=ye,ee&&m.addInstruction(ee)}P.push(q)}!p&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let T=await this.getClmmPoolKeys(t.id),x=await de.decreaseLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g,rewardAccounts:P},liquidity:a,amountMinA:o,amountMinB:s});m.addInstruction({instructions:x.instructions,instructionTypes:[re.ClmmDecreasePosition]});let I={...x.address};if(r.closePosition){let R=await de.closePositionInstructions({poolInfo:t,poolKeys:T,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});m.addInstruction({endInstructions:R.instructions,endInstructionTypes:R.instructionTypes}),I={...I,...R.address}}return m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:I}})}async closePosition({poolInfo:e,ownerPosition:t,txVersion:n}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let r=this.createTxBuilder(),o=await this.getClmmPoolKeys(e.id),s=de.closePositionInstructions({poolInfo:e,poolKeys:o,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:t});return r.addInstruction(s).versionBuild({txVersion:n,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===Y.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:d,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new W(n.mint.address),mint:new W(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),b=de.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardInfo:{programId:new W(n.mint.programId),mint:new W(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:O.decimalToX64(n.perSecond)}});return c.addInstruction(b),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:b.address}})}async initRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){for(let l of n)l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let c=this.createTxBuilder(),u={};for(let l of n){let d=t.useSOLBalance&&l.mint.address===Y.toString(),m=l.perSecond.mul(l.endTime-l.openTime),{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new W(l.mint.programId),mint:new W(l.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(m.toFixed(0)).gte(m)?m.toFixed(0):m.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:r,checkCreateATAOwner:o});b&&c.addInstruction(b),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.getClmmPoolKeys(e.id),g=de.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{programId:new W(l.mint.programId),mint:new W(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:O.decimalToX64(l.perSecond)}});u={...u,...g.address},c.addInstruction(g)}return c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:u}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(Y),{account:l,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),f=de.setRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:O.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async setRewards({poolInfo:e,ownerInfo:t,rewardInfos:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let c=this.createTxBuilder(),u={};for(let l of n){l.endTime<=l.openTime&&this.logAndCreateError("reward time error","rewardInfo",l);let d=t.useSOLBalance&&l.mint.address===Y.toString(),{account:m,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new W(l.mint.programId),mint:new W(l.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ne(new S(l.perSecond.sub(l.endTime-l.openTime).toFixed(0)).gte(l.perSecond.sub(l.endTime-l.openTime))?l.perSecond.sub(l.endTime-l.openTime).toFixed(0):l.perSecond.sub(l.endTime-l.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:r,checkCreateATAOwner:o});f&&c.addInstruction(f),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let b=await this.getClmmPoolKeys(e.id),p=de.setRewardInstructions({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{mint:new W(l.mint.address),openTime:l.openTime,endTime:l.endTime,emissionsPerSecondX64:O.decimalToX64(l.perSecond)}});c.addInstruction(p),u={...u,...p.address}}return c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:u}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(f=>f.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(Y),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new W(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),m=de.collectRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(m),a.build({address:m.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(p=>p.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(Y),{account:d,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new W(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});d||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),m&&s.addInstruction(m);let f=await this.getClmmPoolKeys(e.id),b=de.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:d},rewardMint:c});s.addInstruction(b),a={...a,...b.address}}return s.build({address:a})}async swap({poolInfo:e,inputMint:t,amountIn:n,amountOutMin:r,priceLimit:o,ownerInfo:s,remainingAccounts:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,txVersion:l}){let d=this.createTxBuilder(),m=s.useSOLBalance&&e.mintA.address===Y.toBase58(),f=s.useSOLBalance&&e.mintB.address===Y.toBase58(),b;!o||o.equals(new S(0))?b=t.toString()===e.mintA.address?tt.add(new Ne(1)):nt.sub(new Ne(1)):b=D.priceToSqrtPriceX64(o,e.mintA.decimals,e.mintB.decimals);let p;if(!p){let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new W(e.mintA.address),notUseTokenAccount:m,owner:this.scope.ownerPubKey,skipCloseAccount:!m,createInfo:{payer:s.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:m?!1:c,checkCreateATAOwner:u});p=w,h&&d.addInstruction(h)}let g;if(!g){let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new W(e.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!f,createInfo:{payer:s.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:c,checkCreateATAOwner:u});g=w,h&&d.addInstruction(h)}(!p||!g)&&this.logAndCreateError("user do not have token account",this.scope.account.tokenAccountRawInfos);let y=await this.getClmmPoolKeys(e.id);return d.addInstruction(de.makeSwapBaseInInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g},inputMint:new W(t),amountIn:n,amountOutMin:r,sqrtPriceLimitX64:b,remainingAccounts:a})),d.versionBuild({txVersion:l})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:c}){let u={};for(let d of this.scope.account.tokenAccountRawInfos)r?Ee(this.scope.ownerPubKey,d.accountInfo.mint,s).publicKey.equals(d.pubkey)&&(u[d.accountInfo.mint.toString()]=d.pubkey):u[d.accountInfo.mint.toString()]=d.pubkey;let l=this.createTxBuilder();for(let d of Object.values(e)){if(t[d.id]===void 0||!t[d.id].find(h=>!h.liquidity.isZero()||h.rewardInfos.find(A=>!A.rewardAmountOwed.isZero())))continue;let m=d,f=n.useSOLBalance&&m.mintA.address===Y.toString(),b=n.useSOLBalance&&m.mintB.address===Y.toString(),p=u[m.mintA.address];if(!p){let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:m.mintA.programId,mint:new W(m.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!f,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:r,checkCreateATAOwner:o});p=h,A&&l.addInstruction(A)}let g=u[m.mintB.address];if(!g){let{account:h,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:m.mintB.programId,mint:new W(m.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:b?!1:r,checkCreateATAOwner:o});g=h,A&&l.addInstruction(A)}u[m.mintA.address]=p,u[m.mintB.address]=g;let y=[];for(let h of m.rewardDefaultInfos){let A=n.useSOLBalance&&h.mint.address===Y.toString(),P=u[h.mint.address];if(!P){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new W(h.mint.programId),mint:new W(h.mint.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,skipCloseAccount:!A,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:A?!1:r});P=T,x&&l.addInstruction(x)}u[h.mint.address]=P,y.push(P)}let w=await this.getClmmPoolKeys(m.id);for(let h of t[d.id]){let A=de.decreaseLiquidityInstructions({poolInfo:m,poolKeys:w,ownerPosition:h,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g,rewardAccounts:y},liquidity:new Ne(0),amountMinA:new Ne(0),amountMinB:new Ne(0)});l.addInstruction(A)}}return a===0?l.sizeCheckBuildV0({computeBudgetConfig:c}):l.sizeCheckBuild({computeBudgetConfig:c})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Dt(e).publicKey);return t?ji.decode(t.data).whitelistMints.filter(r=>!r.equals(W.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Ne(1))).map(s=>Ce(new W(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=dn.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){let t=await this.scope.connection.getAccountInfo(new W(e)),n=ln.decode(t.data),r=D.sqrtPriceX64ToPrice(n.sqrtPriceX64,n.mintDecimalsA,n.mintDecimalsB).toNumber();return{...n,currentPrice:r}}};export{sr as Clmm};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=clmm.mjs.map