import{createAssociatedTokenAccountInstruction as Di}from"@solana/spl-token";import{PublicKey as q,SystemProgram as Oi}from"@solana/web3.js";import{get as br,set as Ln}from"lodash";import Pr from"dayjs";import Bn from"dayjs/plugin/utc";Pr.extend(Bn);var It=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Pr().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let r=t.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},wr={},Rn={};function Z(e){let t=br(wr,e);if(!t){let r=br(Rn,e);t=new It({name:e,logLevel:r}),Ln(wr,e,t)}return t}import{PublicKey as Wo}from"@solana/web3.js";import Uo from"bn.js";import _o from"big.js";import dt from"bn.js";import se from"bn.js";var Fe=9e15,ke=1e9,St="0123456789abcdef",rt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",nt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Lt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Fe,maxE:Fe,crypto:!1},Ar,me,L=!0,it="[DecimalError] ",Te=it+"Invalid argument: ",Ir=it+"Precision limit exceeded",Sr=it+"crypto unavailable",Lr="[object Decimal]",ne=Math.floor,$=Math.pow,Kn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Cn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Vn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Br=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ce=1e7,I=7,Fn=9007199254740991,Nn=rt.length-1,Bt=nt.length-1,y={toStringTag:Lr};y.absoluteValue=y.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),A(e)};y.ceil=function(){return A(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(e,t){var r,n=this,o=n.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(Te+t);return r=n.cmp(e),r<0?e:n.cmp(t)>0?t:new o(n)};y.comparedTo=y.cmp=function(e){var t,r,n,o,i=this,s=i.d,a=(e=new i.constructor(e)).d,c=i.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==e.e)return i.e>e.e^c<0?1:-1;for(n=s.length,o=a.length,t=0,r=n<o?n:o;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return n===o?0:n>o^c<0?1:-1};y.cosine=y.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+I,n.rounding=1,r=vn(n,Fr(n,r)),n.precision=e,n.rounding=t,A(me==2||me==3?r.neg():r,e,t,!0)):new n(1):new n(NaN)};y.cubeRoot=y.cbrt=function(){var e,t,r,n,o,i,s,a,c,u,d=this,l=d.constructor;if(!d.isFinite()||d.isZero())return new l(d);for(L=!1,i=d.s*$(d.s*d,1/3),!i||Math.abs(i)==1/0?(r=te(d.d),e=d.e,(i=(e-r.length+1)%3)&&(r+=i==1||i==-2?"0":"00"),i=$(r,1/3),e=ne((e+1)/3)-(e%3==(e<0?-1:2)),i==1/0?r="5e"+e:(r=i.toExponential(),r=r.slice(0,r.indexOf("e")+1)+e),n=new l(r),n.s=d.s):n=new l(i.toString()),s=(e=l.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(d),n=W(u.plus(d).times(a),u.plus(c),s+2,1),te(a.d).slice(0,s)===(r=te(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!o&&r=="4999"){if(!o&&(A(a,e+1,0),a.times(a).times(a).eq(d))){n=a;break}s+=4,o=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(A(n,e+1,1),t=!n.times(n).times(n).eq(d));break}return L=!0,A(n,e,l.rounding,t)};y.decimalPlaces=y.dp=function(){var e,t=this.d,r=NaN;if(t){if(e=t.length-1,r=(e-ne(this.e/I))*I,e=t[e],e)for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r};y.dividedBy=y.div=function(e){return W(this,new this.constructor(e))};y.dividedToIntegerBy=y.divToInt=function(e){var t=this,r=t.constructor;return A(W(t,new r(e),0,1,1),r.precision,r.rounding)};y.equals=y.eq=function(e){return this.cmp(e)===0};y.floor=function(){return A(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(e){return this.cmp(e)>0};y.greaterThanOrEqualTo=y.gte=function(e){var t=this.cmp(e);return t==1||t===0};y.hyperbolicCosine=y.cosh=function(){var e,t,r,n,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(e=Math.ceil(o/3),t=(1/at(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),i=Ne(s,1,i.times(t),new s(1),!0);for(var c,u=e,d=new s(8);u--;)c=i.times(i),i=a.minus(c.times(d.minus(c.times(d))));return A(i,s.precision=r,s.rounding=n,!0)};y.hyperbolicSine=y.sinh=function(){var e,t,r,n,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(t=i.precision,r=i.rounding,i.precision=t+Math.max(o.e,o.sd())+4,i.rounding=1,n=o.d.length,n<3)o=Ne(i,2,o,o,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,o=o.times(1/at(5,e)),o=Ne(i,2,o,o,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=t,i.rounding=r,A(o,t,r,!0)};y.hyperbolicTangent=y.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,W(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)};y.inverseCosine=y.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),o=r.precision,i=r.rounding;return n!==-1?n===0?t.isNeg()?ue(r,o,i):new r(0):new r(NaN):t.isZero()?ue(r,o+4,i).times(.5):(r.precision=o+6,r.rounding=1,t=t.asin(),e=ue(r,o+4,i).times(.5),r.precision=o,r.rounding=i,e.minus(t))};y.inverseHyperbolicCosine=y.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,L=!1,r=r.times(r).minus(1).sqrt().plus(r),L=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)};y.inverseHyperbolicSine=y.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,L=!1,r=r.times(r).plus(1).sqrt().plus(r),L=!0,n.precision=e,n.rounding=t,r.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var e,t,r,n,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=i.precision,t=i.rounding,n=o.sd(),Math.max(n,e)<2*-o.e-1?A(new i(o),e,t,!0):(i.precision=r=n-o.e,o=W(o.plus(1),new i(1).minus(o),r+e,1),i.precision=e+4,i.rounding=1,o=o.ln(),i.precision=e,i.rounding=t,o.times(.5))):new i(NaN)};y.inverseSine=y.asin=function(){var e,t,r,n,o=this,i=o.constructor;return o.isZero()?new i(o):(t=o.abs().cmp(1),r=i.precision,n=i.rounding,t!==-1?t===0?(e=ue(i,r+4,n).times(.5),e.s=o.s,e):new i(NaN):(i.precision=r+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=n,o.times(2)))};y.inverseTangent=y.atan=function(){var e,t,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,f=d.rounding;if(u.isFinite()){if(u.isZero())return new d(u);if(u.abs().eq(1)&&l+4<=Bt)return s=ue(d,l+4,f).times(.25),s.s=u.s,s}else{if(!u.s)return new d(NaN);if(l+4<=Bt)return s=ue(d,l+4,f).times(.5),s.s=u.s,s}for(d.precision=a=l+10,d.rounding=1,r=Math.min(28,a/I+2|0),e=r;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(L=!1,t=Math.ceil(a/I),n=1,c=u.times(u),s=new d(u),o=u;e!==-1;)if(o=o.times(c),i=s.minus(o.div(n+=2)),o=o.times(c),s=i.plus(o.div(n+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===i.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),L=!0,A(s,d.precision=l,d.rounding=f,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&ne(this.e/I)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(e){return this.cmp(e)<0};y.lessThanOrEqualTo=y.lte=function(e){return this.cmp(e)<1};y.logarithm=y.log=function(e){var t,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,f=d.rounding,p=5;if(e==null)e=new d(10),t=!0;else{if(e=new d(e),r=e.d,e.s<0||!r||!r[0]||e.eq(1))return new d(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new d(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(t)if(r.length>1)i=!0;else{for(o=r[0];o%10===0;)o/=10;i=o!==1}if(L=!1,a=l+p,s=xe(u,a),n=t?ot(d,a+10):xe(e,a),c=W(s,n,a,1),De(c.d,o=l,f))do if(a+=10,s=xe(u,a),n=t?ot(d,a+10):xe(e,a),c=W(s,n,a,1),!i){+te(c.d).slice(o+1,o+15)+1==1e14&&(c=A(c,l+1,0));break}while(De(c.d,o+=10,f));return L=!0,A(c,l,f)};y.minus=y.sub=function(e){var t,r,n,o,i,s,a,c,u,d,l,f,p=this,g=p.constructor;if(e=new g(e),!p.d||!e.d)return!p.s||!e.s?e=new g(NaN):p.d?e.s=-e.s:e=new g(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,f=e.d,a=g.precision,c=g.rounding,!u[0]||!f[0]){if(f[0])e.s=-e.s;else if(u[0])e=new g(p);else return new g(c===3?-0:0);return L?A(e,a,c):e}if(r=ne(e.e/I),d=ne(p.e/I),u=u.slice(),i=d-r,i){for(l=i<0,l?(t=u,i=-i,s=f.length):(t=f,r=d,s=u.length),n=Math.max(Math.ceil(a/I),s)+2,i>n&&(i=n,t.length=1),t.reverse(),n=i;n--;)t.push(0);t.reverse()}else{for(n=u.length,s=f.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(u[n]!=f[n]){l=u[n]<f[n];break}i=0}for(l&&(t=u,u=f,f=t,e.s=-e.s),s=u.length,n=f.length-s;n>0;--n)u[s++]=0;for(n=f.length;n>i;){if(u[--n]<f[n]){for(o=n;o&&u[--o]===0;)u[o]=ce-1;--u[o],u[n]+=ce}u[n]-=f[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=st(u,r),L?A(e,a,c):e):new g(c===3?-0:0)};y.modulo=y.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?A(new n(r),n.precision,n.rounding):(L=!1,n.modulo==9?(t=W(r,e.abs(),0,3,1),t.s*=e.s):t=W(r,e,0,n.modulo,1),t=t.times(e),L=!0,r.minus(t))};y.naturalExponential=y.exp=function(){return Rt(this)};y.naturalLogarithm=y.ln=function(){return xe(this)};y.negated=y.neg=function(){var e=new this.constructor(this);return e.s=-e.s,A(e)};y.plus=y.add=function(e){var t,r,n,o,i,s,a,c,u,d,l=this,f=l.constructor;if(e=new f(e),!l.d||!e.d)return!l.s||!e.s?e=new f(NaN):l.d||(e=new f(e.d||l.s===e.s?l:NaN)),e;if(l.s!=e.s)return e.s=-e.s,l.minus(e);if(u=l.d,d=e.d,a=f.precision,c=f.rounding,!u[0]||!d[0])return d[0]||(e=new f(l)),L?A(e,a,c):e;if(i=ne(l.e/I),n=ne(e.e/I),u=u.slice(),o=i-n,o){for(o<0?(r=u,o=-o,s=d.length):(r=d,n=i,s=u.length),i=Math.ceil(a/I),s=i>s?i+1:s+1,o>s&&(o=s,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(s=u.length,o=d.length,s-o<0&&(o=s,r=d,d=u,u=r),t=0;o;)t=(u[--o]=u[o]+d[o]+t)/ce|0,u[o]%=ce;for(t&&(u.unshift(t),++n),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=st(u,n),L?A(e,a,c):e};y.precision=y.sd=function(e){var t,r=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Te+e);return r.d?(t=Rr(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t};y.round=function(){var e=this,t=e.constructor;return A(new t(e),e.e+1,t.rounding)};y.sine=y.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+I,n.rounding=1,r=Mn(n,Fr(n,r)),n.precision=e,n.rounding=t,A(me>2?r.neg():r,e,t,!0)):new n(NaN)};y.squareRoot=y.sqrt=function(){var e,t,r,n,o,i,s=this,a=s.d,c=s.e,u=s.s,d=s.constructor;if(u!==1||!a||!a[0])return new d(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(L=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=te(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=ne((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),n=new d(t)):n=new d(u.toString()),r=(c=d.precision)+3;;)if(i=n,n=i.plus(W(s,i,r+2,1)).times(.5),te(i.d).slice(0,r)===(t=te(n.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!o&&t=="4999"){if(!o&&(A(i,c+1,0),i.times(i).eq(s))){n=i;break}r+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(A(n,c+1,1),e=!n.times(n).eq(s));break}return L=!0,A(n,c,d.rounding,e)};y.tangent=y.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,r=r.sin(),r.s=1,r=W(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,A(me==2||me==4?r.neg():r,e,t,!0)):new n(NaN)};y.times=y.mul=function(e){var t,r,n,o,i,s,a,c,u,d=this,l=d.constructor,f=d.d,p=(e=new l(e)).d;if(e.s*=d.s,!f||!f[0]||!p||!p[0])return new l(!e.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?e.s/0:e.s*0);for(r=ne(d.e/I)+ne(e.e/I),c=f.length,u=p.length,c<u&&(i=f,f=p,p=i,s=c,c=u,u=s),i=[],s=c+u,n=s;n--;)i.push(0);for(n=u;--n>=0;){for(t=0,o=c+n;o>n;)a=i[o]+p[n]*f[o-n-1]+t,i[o--]=a%ce|0,t=a/ce|0;i[o]=(i[o]+t)%ce|0}for(;!i[--s];)i.pop();return t?++r:i.shift(),e.d=i,e.e=st(i,r),L?A(e,l.precision,l.rounding):e};y.toBinary=function(e,t){return Ct(this,2,e,t)};y.toDecimalPlaces=y.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(ie(e,0,ke),t===void 0?t=n.rounding:ie(t,0,8),A(r,e+r.e+1,t))};y.toExponential=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=fe(n,!0):(ie(e,0,ke),t===void 0?t=o.rounding:ie(t,0,8),n=A(new o(n),e+1,t),r=fe(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r};y.toFixed=function(e,t){var r,n,o=this,i=o.constructor;return e===void 0?r=fe(o):(ie(e,0,ke),t===void 0?t=i.rounding:ie(t,0,8),n=A(new i(o),e+o.e+1,t),r=fe(n,!1,e+n.e+1)),o.isNeg()&&!o.isZero()?"-"+r:r};y.toFraction=function(e){var t,r,n,o,i,s,a,c,u,d,l,f,p=this,g=p.d,m=p.constructor;if(!g)return new m(p);if(u=r=new m(1),n=c=new m(0),t=new m(n),i=t.e=Rr(g)-p.e-1,s=i%I,t.d[0]=$(10,s<0?I+s:s),e==null)e=i>0?t:u;else{if(a=new m(e),!a.isInt()||a.lt(u))throw Error(Te+a);e=a.gt(t)?i>0?t:u:a}for(L=!1,a=new m(te(g)),d=m.precision,m.precision=i=g.length*I*2;l=W(a,t,0,1,1),o=r.plus(l.times(n)),o.cmp(e)!=1;)r=n,n=o,o=u,u=c.plus(l.times(o)),c=o,o=t,t=a.minus(l.times(o)),a=o;return o=W(e.minus(r),n,0,1,1),c=c.plus(o.times(u)),r=r.plus(o.times(n)),c.s=u.s=p.s,f=W(u,n,i,1).minus(p).abs().cmp(W(c,r,i,1).minus(p).abs())<1?[u,n]:[c,r],m.precision=d,L=!0,f};y.toHexadecimal=y.toHex=function(e,t){return Ct(this,16,e,t)};y.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),e==null){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),t===void 0?t=n.rounding:ie(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(L=!1,r=W(r,e,0,t,1).times(e),L=!0,A(r)):(e.s=r.s,r=e),r};y.toNumber=function(){return+this};y.toOctal=function(e,t){return Ct(this,8,e,t)};y.toPower=y.pow=function(e){var t,r,n,o,i,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c($(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,i=c.rounding,e.eq(1))return A(a,n,i);if(t=ne(e.e/I),t>=e.d.length-1&&(r=u<0?-u:u)<=Fn)return o=Kr(c,a,r,n),e.s<0?new c(1).div(o):A(o,n,i);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=$(+a,u),t=r==0||!isFinite(r)?ne(u*(Math.log("0."+te(a.d))/Math.LN10+a.e+1)):new c(r+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(L=!1,c.rounding=a.s=1,r=Math.min(12,(t+"").length),o=Rt(e.times(xe(a,n+r)),n),o.d&&(o=A(o,n+5,1),De(o.d,n,i)&&(t=n+10,o=A(Rt(e.times(xe(a,t+r)),t),t+5,1),+te(o.d).slice(n+1,n+15)+1==1e14&&(o=A(o,n+1,0)))),o.s=s,L=!0,c.rounding=i,A(o,n,i))};y.toPrecision=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=fe(n,n.e<=o.toExpNeg||n.e>=o.toExpPos):(ie(e,1,ke),t===void 0?t=o.rounding:ie(t,0,8),n=A(new o(n),e,t),r=fe(n,e<=n.e||n.e<=o.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r};y.toSignificantDigits=y.toSD=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(ie(e,1,ke),t===void 0?t=n.rounding:ie(t,0,8)),A(new n(r),e,t)};y.toString=function(){var e=this,t=e.constructor,r=fe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r};y.truncated=y.trunc=function(){return A(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var e=this,t=e.constructor,r=fe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};function te(e){var t,r,n,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)n=e[t]+"",r=I-n.length,r&&(i+=Pe(r)),i+=n;s=e[t],n=s+"",r=I-n.length,r&&(i+=Pe(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function ie(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Te+e)}function De(e,t,r,n){var o,i,s,a;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=I,o=0):(o=Math.ceil((t+1)/I),t%=I),i=$(10,I-t),a=e[o]%i|0,n==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==i||r>3&&a+1==i/2)&&(e[o+1]/i/100|0)==$(10,t-2)-1||(a==i/2||a==0)&&(e[o+1]/i/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==i||!n&&r>3&&a+1==i/2)&&(e[o+1]/i/1e3|0)==$(10,t-3)-1,s}function tt(e,t,r){for(var n,o=[0],i,s=0,a=e.length;s<a;){for(i=o.length;i--;)o[i]*=t;for(o[0]+=St.indexOf(e.charAt(s++)),n=0;n<o.length;n++)o[n]>r-1&&(o[n+1]===void 0&&(o[n+1]=0),o[n+1]+=o[n]/r|0,o[n]%=r)}return o.reverse()}function vn(e,t){var r,n,o;if(t.isZero())return t;n=t.d.length,n<32?(r=Math.ceil(n/3),o=(1/at(4,r)).toString()):(r=16,o="2.3283064365386962890625e-10"),e.precision+=r,t=Ne(e,1,t.times(o),new e(1));for(var i=r;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}var W=function(){function e(n,o,i){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*o+a,n[c]=s%i|0,a=s/i|0;return a&&n.unshift(a),n}function t(n,o,i,s){var a,c;if(i!=s)c=i>s?1:-1;else for(a=c=0;a<i;a++)if(n[a]!=o[a]){c=n[a]>o[a]?1:-1;break}return c}function r(n,o,i,s){for(var a=0;i--;)n[i]-=a,a=n[i]<o[i]?1:0,n[i]=a*s+n[i]-o[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,i,s,a,c){var u,d,l,f,p,g,m,w,b,x,P,k,F,S,v,O,B,D,H,X,N=n.constructor,re=n.s==o.s?1:-1,z=n.d,M=o.d;if(!z||!z[0]||!M||!M[0])return new N(!n.s||!o.s||(z?M&&z[0]==M[0]:!M)?NaN:z&&z[0]==0||!M?re*0:re/0);for(c?(p=1,d=n.e-o.e):(c=ce,p=I,d=ne(n.e/p)-ne(o.e/p)),H=M.length,B=z.length,b=new N(re),x=b.d=[],l=0;M[l]==(z[l]||0);l++);if(M[l]>(z[l]||0)&&d--,i==null?(S=i=N.precision,s=N.rounding):a?S=i+(n.e-o.e)+1:S=i,S<0)x.push(1),g=!0;else{if(S=S/p+2|0,l=0,H==1){for(f=0,M=M[0],S++;(l<B||f)&&S--;l++)v=f*c+(z[l]||0),x[l]=v/M|0,f=v%M|0;g=f||l<B}else{for(f=c/(M[0]+1)|0,f>1&&(M=e(M,f,c),z=e(z,f,c),H=M.length,B=z.length),O=H,P=z.slice(0,H),k=P.length;k<H;)P[k++]=0;X=M.slice(),X.unshift(0),D=M[0],M[1]>=c/2&&++D;do f=0,u=t(M,P,H,k),u<0?(F=P[0],H!=k&&(F=F*c+(P[1]||0)),f=F/D|0,f>1?(f>=c&&(f=c-1),m=e(M,f,c),w=m.length,k=P.length,u=t(m,P,w,k),u==1&&(f--,r(m,H<w?X:M,w,c))):(f==0&&(u=f=1),m=M.slice()),w=m.length,w<k&&m.unshift(0),r(P,m,k,c),u==-1&&(k=P.length,u=t(M,P,H,k),u<1&&(f++,r(P,H<k?X:M,k,c))),k=P.length):u===0&&(f++,P=[0]),x[l++]=f,u&&P[0]?P[k++]=z[O]||0:(P=[z[O]],k=1);while((O++<B||P[0]!==void 0)&&S--);g=P[0]!==void 0}x[0]||x.shift()}if(p==1)b.e=d,Ar=g;else{for(l=1,f=x[0];f>=10;f/=10)l++;b.e=l+d*p-1,A(b,a?i+b.e+1:i,s,g)}return b}}();function A(e,t,r,n){var o,i,s,a,c,u,d,l,f,p=e.constructor;e:if(t!=null){if(l=e.d,!l)return e;for(o=1,a=l[0];a>=10;a/=10)o++;if(i=t-o,i<0)i+=I,s=t,d=l[f=0],c=d/$(10,o-s-1)%10|0;else if(f=Math.ceil((i+1)/I),a=l.length,f>=a)if(n){for(;a++<=f;)l.push(0);d=c=0,o=1,i%=I,s=i-I+1}else break e;else{for(d=a=l[f],o=1;a>=10;a/=10)o++;i%=I,s=i-I+o,c=s<0?0:d/$(10,o-s-1)%10|0}if(n=n||t<0||l[f+1]!==void 0||(s<0?d:d%$(10,o-s-1)),u=r<4?(c||n)&&(r==0||r==(e.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(i>0?s>0?d/$(10,o-s):0:l[f-1])%10&1||r==(e.s<0?8:7)),t<1||!l[0])return l.length=0,u?(t-=e.e+1,l[0]=$(10,(I-t%I)%I),e.e=-t||0):l[0]=e.e=0,e;if(i==0?(l.length=f,a=1,f--):(l.length=f+1,a=$(10,I-i),l[f]=s>0?(d/$(10,o-s)%$(10,s)|0)*a:0),u)for(;;)if(f==0){for(i=1,s=l[0];s>=10;s/=10)i++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(e.e++,l[0]==ce&&(l[0]=1));break}else{if(l[f]+=a,l[f]!=ce)break;l[f--]=0,a=1}for(i=l.length;l[--i]===0;)l.pop()}return L&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function fe(e,t,r){if(!e.isFinite())return Vr(e);var n,o=e.e,i=te(e.d),s=i.length;return t?(r&&(n=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+Pe(n):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):o<0?(i="0."+Pe(-o-1)+i,r&&(n=r-s)>0&&(i+=Pe(n))):o>=s?(i+=Pe(o+1-s),r&&(n=r-o-1)>0&&(i=i+"."+Pe(n))):((n=o+1)<s&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-s)>0&&(o+1===s&&(i+="."),i+=Pe(n))),i}function st(e,t){var r=e[0];for(t*=I;r>=10;r/=10)t++;return t}function ot(e,t,r){if(t>Nn)throw L=!0,r&&(e.precision=r),Error(Ir);return A(new e(rt),t,1,!0)}function ue(e,t,r){if(t>Bt)throw Error(Ir);return A(new e(nt),t,r,!0)}function Rr(e){var t=e.length-1,r=t*I+1;if(t=e[t],t){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function Pe(e){for(var t="";e--;)t+="0";return t}function Kr(e,t,r,n){var o,i=new e(1),s=Math.ceil(n/I+4);for(L=!1;;){if(r%2&&(i=i.times(t),Tr(i.d,s)&&(o=!0)),r=ne(r/2),r===0){r=i.d.length-1,o&&i.d[r]===0&&++i.d[r];break}t=t.times(t),Tr(t.d,s)}return L=!0,i}function xr(e){return e.d[e.d.length-1]&1}function Cr(e,t,r){for(var n,o=new e(t[0]),i=0;++i<t.length;)if(n=new e(t[i]),n.s)o[r](n)&&(o=n);else{o=n;break}return o}function Rt(e,t){var r,n,o,i,s,a,c,u=0,d=0,l=0,f=e.constructor,p=f.rounding,g=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(L=!1,c=g):c=t,a=new f(.03125);e.e>-2;)e=e.times(a),l+=5;for(n=Math.log($(2,l))/Math.LN10*2+5|0,c+=n,r=i=s=new f(1),f.precision=c;;){if(i=A(i.times(e),c,1),r=r.times(++d),a=s.plus(W(i,r,c,1)),te(a.d).slice(0,c)===te(s.d).slice(0,c)){for(o=l;o--;)s=A(s.times(s),c,1);if(t==null)if(u<3&&De(s.d,c-n,p,u))f.precision=c+=10,r=i=a=new f(1),d=0,u++;else return A(s,f.precision=g,p,L=!0);else return f.precision=g,s}s=a}}function xe(e,t){var r,n,o,i,s,a,c,u,d,l,f,p=1,g=10,m=e,w=m.d,b=m.constructor,x=b.rounding,P=b.precision;if(m.s<0||!w||!w[0]||!m.e&&w[0]==1&&w.length==1)return new b(w&&!w[0]?-1/0:m.s!=1?NaN:w?0:m);if(t==null?(L=!1,d=P):d=t,b.precision=d+=g,r=te(w),n=r.charAt(0),Math.abs(i=m.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)m=m.times(e),r=te(m.d),n=r.charAt(0),p++;i=m.e,n>1?(m=new b("0."+r),i++):m=new b(n+"."+r.slice(1))}else return u=ot(b,d+2,P).times(i+""),m=xe(new b(n+"."+r.slice(1)),d-g).plus(u),b.precision=P,t==null?A(m,P,x,L=!0):m;for(l=m,c=s=m=W(m.minus(1),m.plus(1),d,1),f=A(m.times(m),d,1),o=3;;){if(s=A(s.times(f),d,1),u=c.plus(W(s,new b(o),d,1)),te(u.d).slice(0,d)===te(c.d).slice(0,d))if(c=c.times(2),i!==0&&(c=c.plus(ot(b,d+2,P).times(i+""))),c=W(c,new b(p),d,1),t==null)if(De(c.d,d-g,x,a))b.precision=d+=g,u=s=m=W(l.minus(1),l.plus(1),d,1),f=A(m.times(m),d,1),o=a=1;else return A(c,b.precision=P,x,L=!0);else return b.precision=P,c;c=u,o+=2}}function Vr(e){return String(e.s*e.s/0)}function Kt(e,t){var r,n,o;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;n++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(n,o),t){if(o-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%I,r<0&&(n+=I),n<o){for(n&&e.d.push(+t.slice(0,n)),o-=I;n<o;)e.d.push(+t.slice(n,n+=I));t=t.slice(n),n=I-t.length}else n-=o;for(;n--;)t+="0";e.d.push(+t),L&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function En(e,t){var r,n,o,i,s,a,c,u,d;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Br.test(t))return Kt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Cn.test(t))r=16,t=t.toLowerCase();else if(Kn.test(t))r=2;else if(Vn.test(t))r=8;else throw Error(Te+t);for(i=t.search(/p/i),i>0?(c=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),i=t.indexOf("."),s=i>=0,n=e.constructor,s&&(t=t.replace(".",""),a=t.length,i=a-i,o=Kr(n,new n(r),i,i*2)),u=tt(t,r,ce),d=u.length-1,i=d;u[i]===0;--i)u.pop();return i<0?new n(e.s*0):(e.e=st(u,d),e.d=u,L=!1,s&&(e=W(e,o,a*4)),c&&(e=e.times(Math.abs(c)<54?$(2,c):Oe.pow(2,c))),L=!0,e)}function Mn(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:Ne(e,2,t,t);r=1.4*Math.sqrt(n),r=r>16?16:r|0,t=t.times(1/at(5,r)),t=Ne(e,2,t,t);for(var o,i=new e(5),s=new e(16),a=new e(20);r--;)o=t.times(t),t=t.times(i.plus(o.times(s.times(o).minus(a))));return t}function Ne(e,t,r,n,o){var i,s,a,c,u=1,d=e.precision,l=Math.ceil(d/I);for(L=!1,c=r.times(r),a=new e(n);;){if(s=W(a.times(c),new e(t++*t++),d,1),a=o?n.plus(s):n.minus(s),n=W(s.times(c),new e(t++*t++),d,1),s=a.plus(n),s.d[l]!==void 0){for(i=l;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=n,n=s,s=i,u++}return L=!0,s.d.length=l+1,s}function at(e,t){for(var r=e;--t;)r*=e;return r}function Fr(e,t){var r,n=t.s<0,o=ue(e,e.precision,1),i=o.times(.5);if(t=t.abs(),t.lte(i))return me=n?4:1,t;if(r=t.divToInt(o),r.isZero())me=n?3:2;else{if(t=t.minus(r.times(o)),t.lte(i))return me=xr(r)?n?2:3:n?4:1,t;me=xr(r)?n?1:4:n?3:2}return t.minus(o).abs()}function Ct(e,t,r,n){var o,i,s,a,c,u,d,l,f,p=e.constructor,g=r!==void 0;if(g?(ie(r,1,ke),n===void 0?n=p.rounding:ie(n,0,8)):(r=p.precision,n=p.rounding),!e.isFinite())d=Vr(e);else{for(d=fe(e),s=d.indexOf("."),g?(o=2,t==16?r=r*4-3:t==8&&(r=r*3-2)):o=t,s>=0&&(d=d.replace(".",""),f=new p(1),f.e=d.length-s,f.d=tt(fe(f),10,o),f.e=f.d.length),l=tt(d,10,o),i=c=l.length;l[--c]==0;)l.pop();if(!l[0])d=g?"0p+0":"0";else{if(s<0?i--:(e=new p(e),e.d=l,e.e=i,e=W(e,f,r,n,0,o),l=e.d,i=e.e,u=Ar),s=l[r],a=o/2,u=u||l[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(e.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&l[r-1]&1||n===(e.s<0?8:7)),l.length=r,u)for(;++l[--r]>o-1;)l[r]=0,r||(++i,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,d="";s<c;s++)d+=St.charAt(l[s]);if(g){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)d+="0";for(l=tt(d,o,t),c=l.length;!l[c-1];--c);for(s=1,d="1.";s<c;s++)d+=St.charAt(l[s])}else d=d.charAt(0)+"."+d.slice(1);d=d+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)d="0"+d;d="0."+d}else if(++i>c)for(i-=c;i--;)d+="0";else i<c&&(d=d.slice(0,i)+"."+d.slice(i))}d=(t==16?"0x":t==2?"0b":t==8?"0o":"")+d}return e.s<0?"-"+d:d}function Tr(e,t){if(e.length>t)return e.length=t,!0}function _n(e){return new this(e).abs()}function Dn(e){return new this(e).acos()}function On(e){return new this(e).acosh()}function Wn(e,t){return new this(e).plus(t)}function Un(e){return new this(e).asin()}function qn(e){return new this(e).asinh()}function Gn(e){return new this(e).atan()}function Hn(e){return new this(e).atanh()}function jn(e,t){e=new this(e),t=new this(t);var r,n=this.precision,o=this.rounding,i=n+4;return!e.s||!t.s?r=new this(NaN):!e.d&&!t.d?(r=ue(this,i,1).times(t.s>0?.25:.75),r.s=e.s):!t.d||e.isZero()?(r=t.s<0?ue(this,n,o):new this(0),r.s=e.s):!e.d||t.isZero()?(r=ue(this,i,1).times(.5),r.s=e.s):t.s<0?(this.precision=i,this.rounding=1,r=this.atan(W(e,t,i,1)),t=ue(this,i,1),this.precision=n,this.rounding=o,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(W(e,t,i,1)),r}function Yn(e){return new this(e).cbrt()}function zn(e){return A(e=new this(e),e.e+1,2)}function Zn(e,t,r){return new this(e).clamp(t,r)}function Xn(e){if(!e||typeof e!="object")throw Error(it+"Object expected");var t,r,n,o=e.defaults===!0,i=["precision",1,ke,"rounding",0,8,"toExpNeg",-Fe,0,"toExpPos",0,Fe,"maxE",0,Fe,"minE",-Fe,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(r=i[t],o&&(this[r]=Lt[r]),(n=e[r])!==void 0)if(ne(n)===n&&n>=i[t+1]&&n<=i[t+2])this[r]=n;else throw Error(Te+r+": "+n);if(r="crypto",o&&(this[r]=Lt[r]),(n=e[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(Sr);else this[r]=!1;else throw Error(Te+r+": "+n);return this}function Jn(e){return new this(e).cos()}function Qn(e){return new this(e).cosh()}function Nr(e){var t,r,n;function o(i){var s,a,c,u=this;if(!(u instanceof o))return new o(i);if(u.constructor=o,kr(i)){u.s=i.s,L?!i.d||i.e>o.maxE?(u.e=NaN,u.d=null):i.e<o.minE?(u.e=0,u.d=[0]):(u.e=i.e,u.d=i.d.slice()):(u.e=i.e,u.d=i.d?i.d.slice():i.d);return}if(c=typeof i,c==="number"){if(i===0){u.s=1/i<0?-1:1,u.e=0,u.d=[0];return}if(i<0?(i=-i,u.s=-1):u.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;L?s>o.maxE?(u.e=NaN,u.d=null):s<o.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[i]):(u.e=s,u.d=[i]);return}else if(i*0!==0){i||(u.s=NaN),u.e=NaN,u.d=null;return}return Kt(u,i.toString())}else if(c!=="string")throw Error(Te+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),u.s=-1):(a===43&&(i=i.slice(1)),u.s=1),Br.test(i)?Kt(u,i):En(u,i)}if(o.prototype=y,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=Xn,o.clone=Nr,o.isDecimal=kr,o.abs=_n,o.acos=Dn,o.acosh=On,o.add=Wn,o.asin=Un,o.asinh=qn,o.atan=Gn,o.atanh=Hn,o.atan2=jn,o.cbrt=Yn,o.ceil=zn,o.clamp=Zn,o.cos=Jn,o.cosh=Qn,o.div=$n,o.exp=eo,o.floor=to,o.hypot=ro,o.ln=no,o.log=oo,o.log10=so,o.log2=io,o.max=ao,o.min=uo,o.mod=co,o.mul=lo,o.pow=fo,o.random=po,o.round=mo,o.sign=go,o.sin=yo,o.sinh=ho,o.sqrt=bo,o.sub=wo,o.sum=Po,o.tan=xo,o.tanh=To,o.trunc=ko,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return o.config(e),o}function $n(e,t){return new this(e).div(t)}function eo(e){return new this(e).exp()}function to(e){return A(e=new this(e),e.e+1,3)}function ro(){var e,t,r=new this(0);for(L=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return L=!0,new this(1/0);r=t}return L=!0,r.sqrt()}function kr(e){return e instanceof Oe||e&&e.toStringTag===Lr||!1}function no(e){return new this(e).ln()}function oo(e,t){return new this(e).log(t)}function io(e){return new this(e).log(2)}function so(e){return new this(e).log(10)}function ao(){return Cr(this,arguments,"lt")}function uo(){return Cr(this,arguments,"gt")}function co(e,t){return new this(e).mod(t)}function lo(e,t){return new this(e).mul(t)}function fo(e,t){return new this(e).pow(t)}function po(e){var t,r,n,o,i=0,s=new this(1),a=[];if(e===void 0?e=this.precision:ie(e,1,ke),n=Math.ceil(e/I),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));i<n;)o=t[i],o>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);i<n;)o=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((t[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,i):(a.push(o%1e7),i+=4);i=n/4}else throw Error(Sr);else for(;i<n;)a[i++]=Math.random()*1e7|0;for(n=a[--i],e%=I,n&&e&&(o=$(10,I-e),a[i]=(n/o|0)*o);a[i]===0;i--)a.pop();if(i<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=I)a.shift();for(n=1,o=a[0];o>=10;o/=10)n++;n<I&&(r-=I-n)}return s.e=r,s.d=a,s}function mo(e){return A(e=new this(e),e.e+1,this.rounding)}function go(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function yo(e){return new this(e).sin()}function ho(e){return new this(e).sinh()}function bo(e){return new this(e).sqrt()}function wo(e,t){return new this(e).sub(t)}function Po(){var e=0,t=arguments,r=new this(t[e]);for(L=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return L=!0,A(r,this.precision,this.rounding)}function xo(e){return new this(e).tan()}function To(e){return new this(e).tanh()}function ko(e){return A(e=new this(e),e.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var Oe=y.constructor=Nr(Lt);rt=new Oe(rt);nt=new Oe(nt);var Vt=Oe;import{PublicKey as vt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ao}from"@solana/spl-token";import{PublicKey as j,SystemProgram as vr,SYSVAR_RENT_PUBKEY as Io}from"@solana/web3.js";function h({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var Ft=[h({pubkey:Ao,isWritable:!1}),h({pubkey:vr.programId,isWritable:!1}),h({pubkey:Io,isWritable:!1})];function Er({publicKey:e,transformSol:t}){let r=Nt(e.toString());if(r instanceof j)return t&&r.equals(ee)?Ae:r;if(t&&r.toString()===ee.toBase58())return Ae;if(typeof r=="string"){if(r===j.default.toBase58())return j.default;try{return new j(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Nt(e){try{return new j(e)}catch{return e}}var Zi=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Xi=new j("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),So=new j("SysvarRent111111111111111111111111111111111"),Ji=new j("SysvarC1ock11111111111111111111111111111111"),Qi=new j("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Lo=new j("Sysvar1nstructions1111111111111111111111111"),$i=vr.programId,es=new j("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ts=new j("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),rs=new j("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ns=new j("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),os=new j("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),is=new j("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ss=new j("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),as=new j("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),us=new j("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),cs=new j("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ls=new j("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ae=new j("So11111111111111111111111111111111111111112"),ee=j.default;import{PublicKey as Bo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Mr}from"@solana/spl-token";var _r={chainId:101,address:Bo.default.toBase58(),programId:Mr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},oe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Mr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Et=class{constructor({mint:t,decimals:r,symbol:n,name:o,skipMint:i=!1,isToken2022:s=!1}){if(t===ee.toBase58()||t instanceof vt&&ee.equals(t)){this.decimals=oe.decimals,this.symbol=oe.symbol,this.name=oe.name,this.mint=new vt(oe.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||t.toString().substring(0,6),this.name=o||t.toString().substring(0,6),this.mint=i?vt.default:Er({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Re=Et;Re.WSOL=new Et({...oe,mint:oe.address});import ct from"big.js";import Co from"bn.js";import Vo from"decimal.js-light";import Ro from"toformat";var Ko=Ro,We=Ko;var ut=Z("module/fraction"),Mt=We(ct),Ue=We(Vo),Fo={[0]:Ue.ROUND_DOWN,[1]:Ue.ROUND_HALF_UP,[2]:Ue.ROUND_UP},No={[0]:ct.roundDown,[1]:ct.roundHalfUp,[2]:ct.roundUp},_=class{constructor(t,r=new Co(1)){this.numerator=C(t),this.denominator=C(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new _(this.denominator,this.numerator)}add(t){let r=t instanceof _?t:new _(C(t));return this.denominator.eq(r.denominator)?new _(this.numerator.add(r.numerator),this.denominator):new _(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof _?t:new _(C(t));return this.denominator.eq(r.denominator)?new _(this.numerator.sub(r.numerator),this.denominator):new _(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof _?t:new _(C(t));return new _(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof _?t:new _(C(t));return new _(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||ut.logWithError(`${t} is not an integer.`),t<=0&&ut.logWithError(`${t} is not positive.`),Ue.set({precision:t+1,rounding:Fo[n]});let o=new Ue(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||ut.logWithError(`${t} is not an integer.`),t<0&&ut.logWithError(`${t} is negative.`),Mt.DP=t,Mt.RM=No[n]||1,new Mt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var Eo=Z("Raydium_price"),ge=class extends _{constructor(r){let{baseToken:n,quoteToken:o,numerator:i,denominator:s}=r;super(i,s);this.baseToken=n,this.quoteToken=o,this.scalar=new _(_t(n.decimals),_t(o.decimals))}get raw(){return new _(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ge({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&Eo.logWithError("mul token not equals");let n=super.mul(r);return new ge({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(r,n,o)}toFixed(r=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(r,n,o)}};var Dt=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},lt=Dt;lt.SOL=new Dt(_r);import Mo from"bn.js";var Dr=new _(new Mo(100)),ve=class extends _{toSignificant(t=5,r,n){return this.mul(Dr).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(Dr).toFixed(t,r,n)}};var Ot=new se(0),sa=new se(1),aa=new se(2),ua=new se(3),ca=new se(5),Wt=new se(10),la=new se(100),da=new se(1e3),fa=new se(1e4),Or=9007199254740991;function C(e){let t=Z("Raydium_parseBigNumberish");if(e instanceof se)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new se(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Or||e<=-Or)&&t.logWithError(`BigNumberish number overflow: ${e}`),new se(String(e))):typeof e=="bigint"?new se(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new se(0))}function _t(e){return Wt.pow(C(e))}var Do=Z("Raydium_amount"),Ur=We(_o);function Oo(e,t){let r="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([r,n]=o,n=n.padEnd(t,"0")):Do.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var ye=class extends _{constructor(r,n,o=!0,i){let s=new dt(0),a=Wt.pow(new dt(r.decimals));if(o)s=C(n);else{let c=new dt(0),u=new dt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[d,l]=Oo(n.toString(),r.decimals);c=C(d),u=C(l)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Z(i||"TokenAmount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new ye(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new ye(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,o=0){return super.toSignificant(r,n,o)}toFixed(r=this.token.decimals,n,o=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,o)}toExact(r={groupSeparator:""}){return Ur.DP=this.token.decimals,new Ur(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};function Wr(e){return typeof e=="object"&&e!==null&&![Re,ye,Wo,_,Uo,ge,ve].some(t=>typeof t=="object"&&e instanceof t)}function he(e){return typeof e=="string"?Nt(e):Array.isArray(e)?e.map(t=>he(t)):Wr(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,he(r)])):e}import{PublicKey as He,sendAndConfirmTransaction as Ht,Transaction as je,TransactionMessage as Ye,VersionedTransaction as ze}from"@solana/web3.js";import Xo from"axios";var U={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as qo,ComputeBudgetProgram as qr,Transaction as Hr,TransactionMessage as Go,Keypair as jr,VersionedTransaction as Yr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ho}from"@solana/spl-token";var Gr=Z("Raydium_txUtil"),zr=1644;function ft(e){let t=[],r=[];return e.microLamports&&(t.push(qr.setComputeUnitPrice({microLamports:e.microLamports})),r.push(U.SetComputeUnitPrice)),e.units&&(t.push(qr.setComputeUnitLimit({units:e.units})),r.push(U.SetComputeUnitLimit)),{instructions:t,instructionTypes:r}}async function Ee(e){var t,r;try{return((r=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:r.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}function jo(e,t){e.length<1&&Gr.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&Gr.logWithError(`no signers provided:, ${t.toString()}`);let r=new Hr;r.recentBlockhash="11111111111111111111111111111111",r.feePayer=t[0],r.add(...e);try{return Buffer.from(r.serialize({verifySignatures:!1})).toString("base64").length<zr}catch{return!1}}function Ke(e,t){let[r,n]=qo.findProgramAddressSync(e,t);return{publicKey:r,nonce:n}}function qe({instructions:e,payer:t,signers:r}){return jo(e,[t,...r])}function Ge({instructions:e,payer:t,lookupTableAddressAccount:r,recentBlockhash:n=jr.generate().publicKey.toString()}){let i=new Go({payerKey:t,recentBlockhash:n,instructions:e}).compileToV0Message(Object.values(r!=null?r:{}));try{return Buffer.from(new Yr(i).serialize()).toString("base64").length<zr}catch{return!1}}var Yo=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e);function Ce(e){let t=[];return e.forEach(r=>{r instanceof Hr&&(r.recentBlockhash||(r.recentBlockhash=Ho.toBase58()),r.feePayer||(r.feePayer=jr.generate().publicKey));let n=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Yr&&(n=Yo(n));let o=n.toString("base64");t.push(o)}),console.log("simulate tx string:",t),t}import{PublicKey as Xr,AddressLookupTableAccount as pt}from"@solana/web3.js";import{PublicKey as zo}from"@solana/web3.js";import{getTransferFeeConfig as $a,unpackMint as eu}from"@solana/spl-token";var Ut=Z("Raydium_accountInfo_util");async function Zr(e,t,r){let{batchRequest:n,commitment:o="confirmed"}={batchRequest:!1,...r},i=qt(t,100),s=new Array(i.length).fill([]);if(n){let a=i.map(d=>{let l=e._buildArgs([d.map(f=>f.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:l}}),c=qt(a,10);s=(await(await Promise.all(c.map(async d=>await e._rpcBatchRequest(d)))).flat()).map(d=>(d.error&&Ut.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.error.message}`),d.result.value.map(l=>{if(l){let{data:f,executable:p,lamports:g,owner:m,rentEpoch:w}=l;return f.length!==2&&f[1]!=="base64"&&Ut.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:g,owner:new zo(m),rentEpoch:w}}return null})))}else try{s=await Promise.all(i.map(a=>e.getMultipleAccountsInfo(a,o)))}catch(a){a instanceof Error&&Ut.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Gt({connection:e,address:t}){let r=await Zr(e,[...new Set(t.map(o=>o.toString()))].map(o=>new Xr(o))),n={};for(let o=0;o<t.length;o++){let i=r[o],s=t[o];if(!i)continue;let a=new pt({key:s,state:pt.deserialize(i.data)});n[s.toString()]=a,mt[s.toString()]=a}return n}var mt={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new pt({key:new Xr("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:pt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var gt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let t=(await Xo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:r}=(n=t==null?void 0:t[15])!=null?n:{};if(!!r)return{units:6e5,microLamports:Math.min(Math.ceil(r*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:r,instructionTypes:n}=ft(t);return this.instructions.unshift(...r),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:t,defaultIns:r}){try{let n=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;r&&this.instructions.unshift(...r)}catch{r&&this.instructions.unshift(...r)}}addInstruction({instructions:t=[],endInstructions:r=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...r),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==He.default.toString())),this}async versionBuild({txVersion:t,extInfo:r}){return t===0?await this.buildV0({...r||{}}):this.build(r)}build(t){let r=new je;return this.allInstructions.length&&r.add(...this.allInstructions),r.feePayer=this.feePayer,{builder:this,transaction:r,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async n=>{var a;let{recentBlockHash:o,skipPreflight:i=!0}=n||{},s=o!=null?o:await Ee(this.connection);if(r.recentBlockhash=s,this.signers.length&&r.sign(...this.signers),Ce([r]),(a=this.owner)!=null&&a.isKeyPair)return{txId:await Ht(this.connection,r,this.signers.find(c=>c.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:i}),signedTx:r};if(this.signAllTransactions){let c=await this.signAllTransactions([r]);return{txId:await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:i}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:r=[],extInfo:n}=t,{transaction:o}=this.build(n),i=r.filter(u=>u.transaction.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var m;let{sequentially:d,onTxUpdate:l,recentBlockHash:f,skipPreflight:p=!0}=u||{},g=f!=null?f:await Ee(this.connection);if((m=this.owner)!=null&&m.isKeyPair)return{txIds:await await Promise.all(s.map(async(w,b)=>(w.recentBlockhash=g,await Ht(this.connection,w,a[b].find(x=>x.publicKey.equals(this.owner.publicKey))?a[b]:[...a[b],this.owner.signer],{skipPreflight:p})))),signedTxs:s};if(this.signAllTransactions){let w=s.map((x,P)=>(x.recentBlockhash=g,a[P].length&&x.sign(...a[P]),x));Ce(w);let b=await this.signAllTransactions(w);if(d){let x=0,P=[],k=async()=>{if(!b[x])return;let F=await this.connection.sendRawTransaction(b[x].serialize(),{skipPreflight:p});P.push({txId:F,status:"sent",signedTx:b[x]}),l==null||l([...P]),x++,this.connection.onSignature(F,S=>{let v=P.findIndex(O=>O.txId===F);v>-1&&(P[v].status=S.err?"error":"success"),l==null||l([...P]),S.err||k()},"processed"),this.connection.getSignatureStatus(F)};return await k(),{txIds:P.map(F=>F.txId),signedTxs:b}}else{let x=[];for(let P=0;P<b.length;P+=1){let k=await this.connection.sendRawTransaction(b[P].serialize(),{skipPreflight:p});x.push(k)}return{txIds:x,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:r,extInfo:n}){return r===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:n})}async buildV0(t){let{lookupTableCache:r={},lookupTableAddress:n=[],forerunCreate:o,...i}=t||{},s={...this.cluster==="devnet"?{}:mt,...r},a=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let f of a)s[f]===void 0&&c.push(new He(f));let u=await Gt({connection:this.connection,address:c});for(let[f,p]of Object.entries(u))s[f]=p;let d=new Ye({payerKey:this.feePayer,recentBlockhash:o?He.default.toBase58():await Ee(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),l=new ze(d);return l.sign(this.signers),{builder:this,transaction:l,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async f=>{var m;let{recentBlockHash:p,skipPreflight:g=!0}=f||{};if(p&&(l.message.recentBlockhash=p),Ce([l]),(m=this.owner)!=null&&m.isKeyPair){this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))||l.sign([this.owner.signer]);let w=await this.connection.sendTransaction(l,{skipPreflight:g}),{lastValidBlockHeight:b,blockhash:x}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:x,lastValidBlockHeight:b,signature:w},"confirmed"),{txId:w,signedTx:l}}if(this.signAllTransactions){let w=await this.signAllTransactions([l]);return{txId:await this.connection.sendTransaction(w[0],{skipPreflight:g}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async buildV0MultiTx(t){let{extraPreBuildData:r=[],buildProps:n}=t,{transaction:o}=await this.buildV0(n),i=r.filter(u=>u.builder.instructions.length>0),s=[o,...i.map(u=>u.transaction)],a=[this.signers,...i.map(u=>u.signers)],c=[...this.instructionTypes,...i.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,d)=>{u.sign(a[d])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async u=>{var g;let{sequentially:d,onTxUpdate:l,recentBlockHash:f,skipPreflight:p=!0}=u||{};if(f&&s.forEach(m=>m.message.recentBlockhash=f),Ce(s),(g=this.owner)!=null&&g.isKeyPair){let{lastValidBlockHeight:m,blockhash:w}=await this.connection.getLatestBlockhash();return s.forEach((b,x)=>{a[x].find(P=>P.publicKey.equals(this.owner.publicKey))||b.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async b=>{let x=await this.connection.sendTransaction(b,{skipPreflight:p});return await this.connection.confirmTransaction({blockhash:w,lastValidBlockHeight:m,signature:x},"confirmed"),x})),signedTxs:s}}if(this.signAllTransactions){let m=await this.signAllTransactions(s);if(d){let w=0,b=[],x=async()=>{if(!m[w])return;let P=await this.connection.sendTransaction(m[w],{skipPreflight:p});b.push({txId:P,status:"sent",signedTx:m[w]}),l==null||l([...b]),w++,this.connection.onSignature(P,k=>{let F=b.findIndex(S=>S.txId===P);F>-1&&(b[F].status=k.err?"error":"success"),l==null||l([...b]),k.err||x()},"processed"),this.connection.getSignatureStatus(P)};return x(),{txIds:[],signedTxs:m}}else{let w=[];for(let b=0;b<m.length;b+=1){let x=await this.connection.sendTransaction(m[b],{skipPreflight:p});w.push(x)}return{txIds:w,signedTxs:m}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(t){let{computeBudgetConfig:r,...n}=t||{},o=r?ft(r):{instructions:[],instructionTypes:[]},i=this.signers.reduce((u,d)=>({...u,[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(u=>{let d=[...c,u],l=r?[...o.instructions,...d]:d,p=[...new Set(d.map(g=>g.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()).values()].map(g=>new He(g));if(c.length<12&&qe({instructions:l,payer:this.feePayer,signers:p})||qe({instructions:d,payer:this.feePayer,signers:p}))c.push(u);else{if(c.length===0)throw Error("item ins too big");qe({instructions:r?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:p})?s.push(new je().add(...o.instructions,...c)):s.push(new je().add(...c)),a.push(Array.from(new Set(c.map(g=>g.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat())).map(g=>i[g]).filter(g=>g!==void 0)),c=[u]}}),c.length>0){let d=[...new Set(c.map(l=>l.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(l=>i[l]).filter(l=>l!==void 0);qe({instructions:r?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(l=>l.publicKey)})?s.push(new je().add(...o.instructions,...c)):s.push(new je().add(...c)),a.push(d)}return s.forEach(u=>u.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async u=>{var m;let{sequentially:d,onTxUpdate:l,recentBlockHash:f,skipPreflight:p=!0}=u||{},g=f!=null?f:await Ee(this.connection);if(s.forEach(async(w,b)=>{w.recentBlockhash=g,a[b].length&&w.sign(...a[b])}),Ce(s),(m=this.owner)!=null&&m.isKeyPair)return{txIds:await Promise.all(s.map(async(w,b)=>await Ht(this.connection,w,a[b].find(x=>x.publicKey.equals(this.owner.publicKey))?a[b]:[...a[b],this.owner.signer],{skipPreflight:p}))),signedTxs:s};if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(d){let b=0,x=[],P=async()=>{if(!w[b])return;let k=await this.connection.sendRawTransaction(w[b].serialize(),{skipPreflight:p});x.push({txId:k,status:"sent",signedTx:w[b]}),l==null||l([...x]),b++,this.connection.onSignature(k,F=>{let S=x.findIndex(v=>v.txId===k);S>-1&&(x[S].status=F.err?"error":"success"),l==null||l([...x]),F.err||P()},"processed"),this.connection.getSignatureStatus(k)};return await P(),{txIds:x.map(k=>k.txId),signedTxs:w}}else{let b=[];for(let x=0;x<w.length;x+=1){let P=await this.connection.sendRawTransaction(w[x].serialize(),{skipPreflight:p});b.push(P)}return{txIds:b,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(t){let{computeBudgetConfig:r,lookupTableCache:n={},lookupTableAddress:o=[],...i}=t||{},s={...this.cluster==="devnet"?{}:mt,...n},a=Array.from(new Set([...this.lookupTableAddress,...o])),c=[];for(let w of a)s[w]===void 0&&c.push(new He(w));let u=await Gt({connection:this.connection,address:c});for(let[w,b]of Object.entries(u))s[w]=b;let d=r?ft(r):{instructions:[],instructionTypes:[]},l=await Ee(this.connection),f=this.signers.reduce((w,b)=>({...w,[b.publicKey.toBase58()]:b}),{}),p=[],g=[],m=[];if(this.allInstructions.forEach(w=>{let b=[...m,w],x=r?[...d.instructions,...b]:b;if(m.length<12&&Ge({instructions:x,payer:this.feePayer,lookupTableAddressAccount:s})||Ge({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s}))m.push(w);else{if(m.length===0)throw Error("item ins too big");let P={};for(let k of[...new Set(a)])s[k]!==void 0&&(P[k]=s[k]);if(r&&Ge({instructions:[...d.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let k=new Ye({payerKey:this.feePayer,recentBlockhash:l,instructions:[...d.instructions,...m]}).compileToV0Message(Object.values(s));p.push(new ze(k))}else{let k=new Ye({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m]}).compileToV0Message(Object.values(s));p.push(new ze(k))}g.push(Array.from(new Set(m.map(k=>k.keys.filter(F=>F.isSigner).map(F=>F.pubkey.toString())).flat())).map(k=>f[k]).filter(k=>k!==void 0)),m=[w]}}),m.length>0){let b=[...new Set(m.map(x=>x.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(x=>f[x]).filter(x=>x!==void 0);if(r&&Ge({instructions:[...d.instructions,...m],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let x=new Ye({payerKey:this.feePayer,recentBlockhash:l,instructions:[...d.instructions,...m]}).compileToV0Message(Object.values(s));p.push(new ze(x))}else{let x=new Ye({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m]}).compileToV0Message(Object.values(s));p.push(new ze(x))}g.push(b)}return{builder:this,transactions:p,buildProps:t,signers:g,instructionTypes:this.instructionTypes,execute:async w=>{var F;let{sequentially:b,onTxUpdate:x,recentBlockHash:P,skipPreflight:k=!0}=w||{};if(p.map(async(S,v)=>{g[v].length&&S.sign(g[v]),P&&(S.message.recentBlockhash=P)}),Ce(p),(F=this.owner)!=null&&F.isKeyPair){let{lastValidBlockHeight:S,blockhash:v}=await this.connection.getLatestBlockhash();return p.forEach((O,B)=>{g[B].find(D=>D.publicKey.equals(this.owner.publicKey))||O.sign([this.owner.signer])}),{txIds:await Promise.all(p.map(async O=>{let B=await this.connection.sendTransaction(O,{skipPreflight:k});return await this.connection.confirmTransaction({blockhash:v,lastValidBlockHeight:S,signature:B},"confirmed"),B})),signedTxs:p}}if(this.signAllTransactions){let S=await this.signAllTransactions(p);if(b){let v=0,O=[],B=async()=>{if(!S[v])return;let D=await this.connection.sendTransaction(S[v],{skipPreflight:k});O.push({txId:D,status:"sent",signedTx:S[v]}),x==null||x([...O]),v++,this.connection.onSignature(D,H=>{let X=O.findIndex(N=>N.txId===D);X>-1&&(O[X].status=H.err?"error":"success"),x==null||x([...O]),H.err||B()},"processed"),this.connection.getSignatureStatus(D)};return B(),{txIds:[],signedTxs:S}}else{let v=[];for(let O=0;O<S.length;O+=1){let B=await this.connection.sendTransaction(S[O],{skipPreflight:k});v.push(B)}return{txIds:v,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};function qt(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}import{PublicKey as Q}from"@solana/web3.js";var Jr=new Q("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Qr=new Q("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ze=new Q("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Tu=new Q("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ku=new Q("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Au=new Q("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Iu=new Q("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Su=new Q("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Lu=new Q("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Bu=new Q("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ru=new Q("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ku=new Q("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Cu=new Q("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Vu=new Q("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Fu=new Q("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Nu=new Q("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),vu=new Q("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Eu=new Q("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Mu=new Q("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),_u=new Q("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as Jo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Qo}from"@solana/spl-token";function Me(e,t,r){return Ke([e.toBuffer(),(r!=null?r:Qo).toBuffer(),t.toBuffer()],new Jo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Hu from"bn.js";import{PublicKey as fi,Keypair as pi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mi}from"@solana/spl-token";import Bl from"bn.js";import{PublicKey as ii}from"@solana/web3.js";import rn,{isBN as nn}from"bn.js";import{bits as dc,BitStructure as fc,blob as $o,Blob as pc,cstr as mc,f32 as gc,f32be as yc,f64 as hc,f64be as bc,greedy as wc,Layout as ei,ns64 as Pc,ns64be as xc,nu64 as Tc,nu64be as kc,offset as Ac,s16 as Ic,s16be as Sc,s24 as Lc,s24be as Bc,s32 as Rc,s32be as Kc,s40 as Cc,s40be as Vc,s48 as Fc,s48be as Nc,s8 as vc,seq as ti,struct as Ec,Structure as ri,u16 as Mc,u16be as _c,u24 as Dc,u24be as Oc,u32 as Wc,u32be as Uc,u40 as qc,u40be as Gc,u48 as Hc,u48be as jc,u8 as ni,UInt as oi,union as Yc,Union as zc,unionLayoutDiscriminator as Zc,utf8 as Xc}from"@solana/buffer-layout";var jt=ei,$r=ri;var Yt=oi;var en=ni;var tn=ti;var Ve=$o;var _e=class extends jt{constructor(r,n,o){super(r,o);this.blob=Ve(r),this.signed=n}decode(r,n=0){let o=new rn(this.blob.decode(r,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(r,n,o=0){return typeof r=="number"&&(r=new rn(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,o)}};function J(e){return new Yt(1,e)}function Xe(e){return new Yt(4,e)}function T(e){return new _e(8,!1,e)}function be(e){return new _e(16,!1,e)}function on(e){return new _e(1,!0,e)}function ht(e){return new _e(8,!0,e)}var yt=class extends jt{constructor(r,n,o,i){super(r.span,i);this.layout=r,this.decoder=n,this.encoder=o}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,o){return this.layout.encode(this.encoder(r),n,o)}getSpan(r,n){return this.layout.getSpan(r,n)}};function V(e){return new yt(Ve(32),t=>new ii(t),t=>t.toBuffer(),e)}function bt(e){return new yt(en(),si,ai,e)}function si(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function ai(e){return e?1:0}var zt=class extends $r{decode(t,r){return super.decode(t,r)}};function G(e,t,r){return new zt(e,t,r)}function Y(e,t,r){let n,o=typeof t=="number"?t:nn(t)?t.toNumber():new Proxy(t,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=nn(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return tn(e,o,r)}var Je=G([V("mint"),V("owner"),T("amount"),Xe("delegateOption"),V("delegate"),J("state"),Xe("isNativeOption"),T("isNative"),T("delegatedAmount"),Xe("closeAuthorityOption"),V("closeAuthority")]);function ui(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Zt(e,...t){if(!ui(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Xt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function sn(e,t){Zt(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var Pt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),le=(e,t)=>e<<32-t|e>>>t;var pl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ci(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Jt(e){return typeof e=="string"&&(e=ci(e)),Zt(e),e}var wt=class{clone(){return this._cloneInto()}},ml={}.toString;function an(e){let t=n=>e().update(Jt(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function li(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,u=n?0:4;e.setUint32(t+c,s,n),e.setUint32(t+u,a,n)}var un=(e,t,r)=>e&t^~e&r,cn=(e,t,r)=>e&t^e&r^t&r,xt=class extends wt{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Pt(this.buffer)}update(t){Xt(this);let{view:r,buffer:n,blockLen:o}=this;t=Jt(t);let i=t.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=Pt(t);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Xt(this),sn(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let l=s;l<o;l++)r[l]=0;li(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=Pt(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,d[l],i)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return t.length=o,t.pos=a,t.finished=i,t.destroyed=s,o%r&&t.buffer.set(n),t}};var di=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ie=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Se=new Uint32Array(64),Qt=class extends xt{constructor(){super(64,32,8,!1),this.A=Ie[0]|0,this.B=Ie[1]|0,this.C=Ie[2]|0,this.D=Ie[3]|0,this.E=Ie[4]|0,this.F=Ie[5]|0,this.G=Ie[6]|0,this.H=Ie[7]|0}get(){let{A:t,B:r,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[t,r,n,o,i,s,a,c]}set(t,r,n,o,i,s,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(t,r){for(let l=0;l<16;l++,r+=4)Se[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let f=Se[l-15],p=Se[l-2],g=le(f,7)^le(f,18)^f>>>3,m=le(p,17)^le(p,19)^p>>>10;Se[l]=m+Se[l-7]+g+Se[l-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:u,H:d}=this;for(let l=0;l<64;l++){let f=le(a,6)^le(a,11)^le(a,25),p=d+f+un(a,c,u)+di[l]+Se[l]|0,m=(le(n,2)^le(n,13)^le(n,22))+cn(n,o,i)|0;d=u,u=c,c=a,a=s+p|0,s=i,i=o,o=n,n=p+m|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,o,i,s,a,c,u,d)}roundClean(){Se.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var ln=an(()=>new Qt);var Vl=Z("Raydium_Util");function Tt({fromPublicKey:e,programId:t=mi}){let r=pi.generate().publicKey.toBase58().slice(0,32);return{publicKey:gi(e,r,t),seed:r}}function gi(e,t,r){let n=Buffer.concat([e.toBuffer(),Buffer.from(t),r.toBuffer()]),o=ln(n);return new fi(o)}import{createInitializeAccountInstruction as yi,createCloseAccountInstruction as hi,createTransferInstruction as vl,TOKEN_PROGRAM_ID as Qe}from"@solana/spl-token";import{PublicKey as bi,SystemProgram as wi}from"@solana/web3.js";import Pi from"bn.js";function xi(e){let{mint:t,tokenAccount:r,owner:n,programId:o=Qe}=e;return yi(r,t,n,o)}function Ti(e){let{tokenAccount:t,payer:r,multiSigners:n=[],owner:o,programId:i=Qe}=e;return hi(t,r,o,n,i)}async function $t(e){let{connection:t,amount:r,commitment:n,payer:o,owner:i,skipCloseAccount:s}=e,a=await t.getMinimumBalanceForRentExemption(Je.span,n),c=C(r).add(new Pi(a)),u=Tt({fromPublicKey:o,programId:Qe});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[wi.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:Je.span,programId:Qe}),xi({mint:new bi(oe.address),tokenAccount:u.publicKey,owner:i,programId:Qe})],instructionTypes:[U.CreateAccount,U.InitAccount],endInstructionTypes:s?[]:[U.CloseAccount],endInstructions:s?[]:[Ti({tokenAccount:u.publicKey,payer:o,owner:i})]}}var er=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),$e=class{constructor({scope:t,moduleName:r}){this.disabled=!1;this.scope=t,this.logger=Z(r)}createTxBuilder(t){return this.scope.checkOwner(),new gt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(er(t))}logInfo(...t){this.logger.info(er(t))}logAndCreateError(...t){let r=er(t);throw new Error(r)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as pn}from"@solana/web3.js";var tr=G([J("instruction")]),rr=G([J("instruction")]),ki=G([T("rewardState"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardLastUpdateTime"),T("totalReward"),T("totalRewardEmissioned"),T("rewardClaimed"),T("rewardPerSecond"),be("accRewardPerShare"),V("rewardVault"),V("rewardMint"),V("rewardSender"),T("rewardType"),Y(T(),15,"padding")]),Ai=G([T("state"),T("nonce"),V("lpVault"),V("rewardVault"),V(),V(),T(),T(),T("totalReward"),be("perShareReward"),T("lastSlot"),T("perSlotReward")]),Ii=G([T("state"),T("nonce"),V("lpVault"),V("rewardVaultA"),T("totalRewardA"),be("perShareRewardA"),T("perSlotRewardA"),J("option"),V("rewardVaultB"),Ve(7),T("totalRewardB"),be("perShareRewardB"),T("perSlotRewardB"),T("lastSlot"),V()]),Si=G([T(),T("state"),T("nonce"),T("validRewardTokenNum"),be("rewardMultiplier"),T("rewardPeriodMax"),T("rewardPeriodMin"),T("rewardPeriodExtend"),V("lpMint"),V("lpVault"),Y(ki,5,"rewardInfos"),V("creator"),V(),Y(T(),32,"padding")]),Li=new Proxy(Ai,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return{...o,version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]}}:Reflect.get(e,t,r)}}),Bi=new Proxy(Ii,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return{...o,version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]}}:Reflect.get(e,t,r)}}),kt=new Proxy(Si,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return{...o,version:6,rewardInfos:o.rewardInfos.map(i=>{var s;return{...i,rewardType:((s=Object.entries(Le).find(a=>String(a[1])===i.rewardType.toString()))!=null?s:["Standard SPL"])[0]}})}}:Reflect.get(e,t,r)}}),Ri=G([T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),nr=G([J("instruction"),T("nonce"),Y(Ri,5,"rewardTimeInfo")]),or=G([J("instruction"),T("rewardReopenTime"),T("rewardEndTime"),T("rewardPerSecond")]),ir=G([J("instruction"),T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),od=G([T("state"),V("id"),V("owner"),T("deposited"),Y(T(),1,"rewardDebts")]),sr=G([T("state"),V("id"),V("owner"),T("deposited"),Y(be(),1,"rewardDebts"),T(""),T("voteLockedBalance"),Y(T(),15)]),id=G([T("state"),V("id"),V("owner"),T("deposited"),Y(T(),2,"rewardDebts")]),dn=G([T("state"),V("id"),V("owner"),T("deposited"),Y(be(),2,"rewardDebts"),Y(T(),17)]),fn=G([T(),T("state"),V("id"),V("owner"),T("deposited"),Y(be(),5,"rewardDebts"),Y(T(),16)]),ae=G([J("instruction"),T("amount")]),Ki=G([V("mint"),V("grantAuthority"),T("baselineVoteWeightScaledFactor"),T("maxExtraLockupVoteWeightScaledFactor"),T("lockupSaturationSecs"),on("digitShift"),Y(J(),7,"reserved1"),Y(T(),7,"reserved2")]),Ci=G([Ve(8),V("governanceProgramId"),V("realm"),V("realmGoverningTokenMint"),V("realmAuthority"),Y(J(),32,"reserved1"),Y(Ki,4,"votingMints"),ht("timeOffset"),J("bump"),Y(J(),7,"reserved2"),Y(T(),11,"reserved3")]),Vi=G([ht("startTime"),ht("endTime"),J("kind"),Y(J(),15,"reserved")]),Fi=G([Y(Vi,1,"lockup"),T("amountDeposited_native"),T("amountInitiallyLockedNative"),bt("isUsed"),bt("allowClawback"),J("votingMintConfigIdx"),Y(J(),29,"reserved")]),Ni=G([Ve(8),V("voterAuthority"),V("registrar"),Y(Fi,32,"deposits"),J("voterBump"),J("voterWweightRecordBump"),Y(J(),94,"reserved")]);var pd=Z("Raydium_farm_config"),mn=new pn("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),gn=new pn("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var yn={3:sr,5:dn,6:fn},ar=e=>[3,5,6].indexOf(e)!==-1,ur=e=>{var s;let{version:t,rewardInfos:r,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(r)}, rewardAccount:${JSON.stringify(n)}`,i={3:()=>{if(r.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(r.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||r.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(s=i[t])==null?void 0:s.call(i)},Le={"Standard SPL":0,"Option tokens":1},we={[Jr.toString()]:3,[Qr.toString()]:5,[Ze.toString()]:6};import{PublicKey as E,SystemProgram as wn,SYSVAR_RENT_PUBKEY as Mi,SYSVAR_CLOCK_PUBKEY as At,TransactionInstruction as de}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as Hd,TOKEN_PROGRAM_ID as Be,ASSOCIATED_TOKEN_PROGRAM_ID as jd}from"@solana/spl-token";import Pn from"bn.js";import vi from"bn.js";var Ei=Z("Raydium.farm.util");function et({programId:e,poolId:t,mint:r,type:n}){let{publicKey:o}=Ke([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function pe({programId:e,poolId:t,owner:r,version:n}){let{publicKey:o}=Ke([t.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return o}var hn=({programId:e,poolId:t})=>Ke([t.toBuffer()],e);function bn(e){return{isSet:new vi(1),rewardPerSecond:C(e.perSecond),rewardOpenTime:C(e.openTime),rewardEndTime:C(e.endTime),rewardType:C(Le[e.rewardType])}}function cr(e){return C(e.endTime).sub(C(e.openTime)).mul(C(e.perSecond))}function lr(e){let t=yn[e];return t||Ei.logWithError("invalid version",e),t}var _i=Z("Raydium_farm_instruction"),sf={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function xn(e){let{version:t,id:r,ledger:n,programId:o,owner:i}=e,s={3:9,5:10}[t];s||_i.logWithError(`invalid farm pool version: ${t}`);let a=Buffer.alloc(tr.span);tr.encode({instruction:s},a);let c=[h({pubkey:r}),h({pubkey:n}),h({pubkey:i,isWritable:!1}),h({pubkey:wn.programId,isWritable:!1}),h({pubkey:Mi,isWritable:!1})];return{instruction:new de({programId:o,keys:c,data:a}),instructionType:U.FarmV3CreateLedger}}function Tn(e){var n;let t=Buffer.alloc(nr.span);nr.encode({instruction:0,nonce:new Pn(e.nonce),rewardTimeInfo:e.rewardInfoConfig},t);let r=[...Ft,h({pubkey:e.farmId}),h({pubkey:e.farmAuthority,isWritable:!1}),h({pubkey:e.lpVault}),h({pubkey:e.lpMint,isWritable:!1}),h({pubkey:e.lockVault}),h({pubkey:e.lockMint,isWritable:!1}),h({pubkey:(n=e.lockUserAccount)!=null?n:ee}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)r.push(h({pubkey:o.rewardMint,isWritable:!1}),h({pubkey:o.rewardVault}),h({pubkey:o.userRewardToken}));return{instruction:new de({programId:e.programId,keys:r,data:t}),instructionType:U.FarmV6Create}}function kn(e){let t=Buffer.alloc(rr.span);rr.encode({instruction:5},t);let r=[h({pubkey:Be,isWritable:!1}),h({pubkey:e.id}),h({pubkey:e.authority,isWritable:!1}),h({pubkey:e.lpVault,isWritable:!1}),h({pubkey:e.rewardVault}),h({pubkey:e.userRewardToken}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})];return{instruction:new de({programId:e.programId,keys:r,data:t}),instructionType:U.FarmV6CreatorWithdraw}}function dr({payer:e,rewardVault:t,userRewardTokenPub:r,farmKeys:n,rewardInfo:o}){let i=Buffer.alloc(or.span);or.encode({instruction:3,rewardReopenTime:C(o.openTime),rewardEndTime:C(o.endTime),rewardPerSecond:C(o.perSecond)},i);let s=[h({pubkey:Be,isWritable:!1}),h({pubkey:n.id}),h({pubkey:n.lpVault,isWritable:!1}),h({pubkey:t}),h({pubkey:r}),h({pubkey:e,isWritable:!1,isSigner:!0})];return new de({programId:n.programId,keys:s,data:i})}function fr({payer:e,userRewardTokenPub:t,farmKeys:r,rewardVault:n,rewardInfo:o}){let i=Buffer.alloc(ir.span);ir.encode({instruction:4,isSet:new Pn(1),rewardPerSecond:C(o.perSecond),rewardOpenTime:C(o.openTime),rewardEndTime:C(o.endTime),rewardType:C(Le[o.rewardType])},i);let s=[...Ft,h({pubkey:r.id}),h({pubkey:r.authority,isWritable:!1}),h({pubkey:o.mint,isWritable:!1}),h({pubkey:n}),h({pubkey:t}),h({pubkey:e,isWritable:!1,isSigner:!0})];return new de({programId:r.programId,keys:s,data:i})}function pr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new E(t.programId),new E(t.id)],u=pe({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ae.span);ae.encode({instruction:2,amount:C(s)},d);let l=[h({pubkey:Be,isWritable:!1}),h({pubkey:c}),h({pubkey:new E(r.authority),isWritable:!1}),h({pubkey:new E(r.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)l.push(h({pubkey:new E(r.rewardInfos[f].vault)})),l.push(h({pubkey:o[f]}));return new de({programId:a,keys:l,data:d})}function mr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new E(t.programId),new E(t.id)],d=pe({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ae.span);ae.encode({instruction:12,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new E(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new E(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new E(r.rewardInfos[0].vault)}),h({pubkey:At,isWritable:!1}),h({pubkey:Be,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(h({pubkey:o[p]})),f.push(h({pubkey:new E(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(h({pubkey:p}));return new de({programId:c,keys:f,data:l})}function gr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new E(t.programId),new E(t.id)],d=pe({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ae.span);ae.encode({instruction:11,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new E(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new E(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new E(r.rewardInfos[0].vault)}),h({pubkey:At,isWritable:!1}),h({pubkey:Be,isWritable:!1})];if(a)for(let p of a)f.push(h({pubkey:p}));return new de({programId:c,keys:f,data:l})}function An(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new E(t.programId),new E(t.id)],d=pe({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ae.span);ae.encode({instruction:10,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new E(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new E(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new E(r.rewardInfos[0].vault)}),h({pubkey:At,isWritable:!1}),h({pubkey:Be,isWritable:!1})];if(a)for(let p of a)f.push(h({pubkey:p}));return new de({programId:c,keys:f,data:l})}function In(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new E(t.programId),new E(t.id)],d=pe({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ae.span);ae.encode({instruction:11,amount:C(s)},l);let f=[h({pubkey:u}),h({pubkey:new E(r.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new E(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new E(r.rewardInfos[0].vault)}),h({pubkey:At,isWritable:!1}),h({pubkey:Be,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(h({pubkey:o[p]})),f.push(h({pubkey:new E(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(h({pubkey:p}));return new de({programId:c,keys:f,data:l})}function Sn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new E(t.programId),new E(t.id)],u=pe({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ae.span);ae.encode({instruction:1,amount:C(s)},d);let l=[h({pubkey:Be,isWritable:!1}),h({pubkey:wn.programId,isWritable:!1}),h({pubkey:c}),h({pubkey:new E(r.authority),isWritable:!1}),h({pubkey:new E(r.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)l.push(h({pubkey:new E(r.rewardInfos[f].vault)})),l.push(h({pubkey:o[f]}));return new de({programId:a,keys:l,data:d})}var yr=class extends $e{async _getUserRewardInfo({payer:t,rewardInfo:r}){if(r.mint.equals(ee)){let n=await $t({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:t,amount:cr({...r,openTime:r.openTime.toString(),endTime:r.endTime.toString()})});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:r.mint,associatedOnly:!1})}}async create({poolInfo:t,rewardInfos:r,payer:n,programId:o=Ze,txVersion:i}){this.checkDisabled(),this.scope.checkOwner();let a={lpMint:new q(t.lpMint.address),lockInfo:{lockMint:mn,lockVault:gn},version:6,rewardInfos:r,programId:o},c=this.createTxBuilder(),u=n!=null?n:this.scope.ownerPubKey,d=Tt({fromPublicKey:u,programId:a.programId}),l=await this.scope.connection.getMinimumBalanceForRentExemption(kt.span);c.addInstruction({instructions:[Oi.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:d.seed,newAccountPubkey:d.publicKey,lamports:l,space:kt.span,programId:a.programId})]});let{publicKey:f,nonce:p}=hn({programId:new q(a.programId),poolId:d.publicKey}),g=et({programId:a.programId,poolId:d.publicKey,mint:a.lpMint,type:"lpVault"}),m=[],w=[];for(let k of a.rewardInfos){k.openTime>=k.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",k.openTime.toString()),isNaN(Le[k.rewardType])&&this.logAndCreateError("rewardType error",k.rewardType),Number(k.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",k.perSecond),m.push(bn(k));let{rewardPubKey:F,newInstruction:S}=await this._getUserRewardInfo({rewardInfo:k,payer:u});S&&c.addInstruction(S),F||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let v=k.mint.equals(ee)?new q(oe.address):k.mint;w.push({rewardMint:v,rewardVault:et({programId:a.programId,poolId:d.publicKey,mint:v,type:"rewardVault"}),userRewardToken:F})}let b=await this.scope.account.getCreatedTokenAccount({mint:a.lockInfo.lockMint});b||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:x,instructionType:P}=Tn({farmId:d.publicKey,owner:this.scope.ownerPubKey,farmAuthority:f,lpVault:g,lpMint:a.lpMint,lockVault:a.lockInfo.lockVault,lockMint:a.lockInfo.lockMint,lockUserAccount:b,programId:a.programId,rewardInfo:w,rewardInfoConfig:m,nonce:p});return c.addInstruction({instructions:[x],instructionTypes:[P]}).versionBuild({txVersion:i,extInfo:{farmId:d.publicKey,farmAuthority:f,lpVault:g,lockUserAccount:b,nonce:p}})}async restartReward({farmInfo:t,payer:r,newRewardInfo:n,txVersion:o}){var w;let i=we[t.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=he((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),a={id:s.id,rewardInfos:t.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let c=r||this.scope.ownerPubKey,u=n.mint.equals(ee)?new q(oe.address):n.mint,d=a.rewardInfos.findIndex(b=>new q(b.mint.address).equals(u)),l=s.rewardInfos[d];l||this.logAndCreateError("configuration does not exist","rewardMint",u);let f=(w=l.vault)!=null?w:ee,p=this.createTxBuilder(),{rewardPubKey:g,newInstruction:m}=await this._getUserRewardInfo({rewardInfo:n,payer:c});return m&&p.addInstruction(m),g||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[dr({payer:this.scope.ownerPubKey,rewardVault:f,userRewardTokenPub:g,farmKeys:a,rewardInfo:n})],instructionTypes:[U.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:t,payer:r,newRewardInfos:n,txVersion:o}){var d;let i=we[t.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=he((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),a={id:s.id,rewardInfos:t.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(l=>{l.openTime>=l.endTime&&this.logAndCreateError("start time error","newRewardInfo",l)});let c=r||this.scope.ownerPubKey,u=this.createTxBuilder();for(let l of n){let f=l.mint.equals(ee)?new q(oe.address):l.mint,p=a.rewardInfos.findIndex(P=>new q(P.mint.address).equals(f)),g=s.rewardInfos[p];g||this.logAndCreateError("configuration does not exist","rewardMint",f);let m=(d=g.vault)!=null?d:ee,{rewardPubKey:w,newInstruction:b}=await this._getUserRewardInfo({rewardInfo:l,payer:c});b&&u.addInstruction(b),w||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let x=dr({payer:this.scope.ownerPubKey,rewardVault:m,userRewardTokenPub:w,farmKeys:a,rewardInfo:l});u.addInstruction({instructions:[x],instructionTypes:[U.FarmV6Restart]})}return u.versionBuild({txVersion:o})}async addNewRewardToken(t){let{txVersion:r,farmInfo:n,newRewardInfo:o,payer:i}=t,s=we[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=he((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder(),d=o.mint.equals(ee)?new q(oe.address):o.mint,l=et({programId:new q(n.programId),poolId:new q(n.id),mint:d,type:"rewardVault"}),{rewardPubKey:f,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:o,payer:c});return p&&u.addInstruction(p),f||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=d,u.addInstruction({instructions:[fr({payer:this.scope.ownerPubKey,userRewardTokenPub:f,farmKeys:a,rewardVault:l,rewardInfo:o})],instructionTypes:[U.FarmV6CreatorAddReward]}).versionBuild({txVersion:r})}async addNewRewardsToken(t){let{txVersion:r,farmInfo:n,newRewardInfos:o,payer:i}=t,s=we[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=he((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder();for(let d of o){let l=d.mint.equals(ee)?new q(oe.address):d.mint,f=et({programId:new q(n.programId),poolId:new q(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:p,newInstruction:g}=await this._getUserRewardInfo({rewardInfo:d,payer:c});g&&u.addInstruction(g),p||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let m=fr({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:a,rewardVault:f,rewardInfo:{...d,mint:l}});u.addInstruction({instructions:[m],instructionTypes:[U.FarmV6CreatorAddReward]})}return u.versionBuild({txVersion:r})}async deposit(t){let{txVersion:r,farmInfo:n,amount:o,feePayer:i,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:u,computeBudgetConfig:d}=t;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:l,programId:f}=n,p=we[f];ar(p)||this.logAndCreateError("invalid farm program:",n.programId);let[g,m]=[new q(n.programId),new q(n.id)],w=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],b=pe({programId:g,poolId:m,owner:this.scope.ownerPubKey,version:p}),x=this.createTxBuilder();x.addCustomComputeBudget(d);let P={};for(let N of this.scope.account.tokenAccounts)if(a){let re=Me(this.scope.ownerPubKey,N.mint,N.programId).publicKey;N.publicKey&&re.equals(N.publicKey)&&(P[N.mint.toString()]=N.publicKey)}else P[N.mint.toString()]=N.publicKey;let k=w.lpMint,F=P[k.address];F||this.logAndCreateError("you don't have any lp","lp zero",P);let S=[];for(let N of l){let re=s&&N.mint.address===Ae.toString(),z=P[N.mint.address];if(!z){let{account:M,instructionParams:hr}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:N.mint.programId,mint:new q(N.mint.address),notUseTokenAccount:re,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!re,associatedOnly:re?!1:a,checkCreateATAOwner:c});z=M,hr&&x.addInstruction(hr)}P[N.mint.address]=z,S.push(z)}let v,O=await this.scope.connection.getAccountInfo(b);if(O&&(v=lr(p).decode(O.data)),n.programId!==Ze.toString()&&!v){let{instruction:N,instructionType:re}=xn({id:m,programId:g,version:p,ledger:b,owner:this.scope.ownerPubKey});x.addInstruction({instructions:[N],instructionTypes:[re]})}let B=ur({version:p,rewardInfos:l,rewardTokenAccountsPublicKeys:S});B&&this.logAndCreateError(B);let D={amount:C(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:w,lpAccount:F,rewardAccounts:S,userAuxiliaryLedgers:u==null?void 0:u.map(N=>new q(N))},H=p===6?Sn(D):p===5?In(D):An(D),X={3:U.FarmV3Deposit,5:U.FarmV5Deposit,6:U.FarmV6Deposit};return x.addInstruction({instructions:[H],instructionTypes:[X[p]]}).versionBuild({txVersion:r})}async withdraw(t){let{txVersion:r,farmInfo:n,amount:o,deposited:i,useSOLBalance:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:d,computeBudgetConfig:l}=t,{rewardInfos:f}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let p=we[n.programId];ar(p)||this.logAndCreateError("invalid farm program:",n.programId);let g=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],m=this.createTxBuilder();m.addCustomComputeBudget(l);let w={};for(let B of this.scope.account.tokenAccounts)if(c){let D=Me(this.scope.ownerPubKey,B.mint).publicKey;B.publicKey&&D.equals(B.publicKey)&&(w[B.mint.toString()]=B.publicKey)}else w[B.mint.toString()]=B.publicKey;if(i)i.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let B=pe({programId:new q(n.programId),poolId:new q(n.id),owner:this.scope.ownerPubKey,version:p}),D=await this.scope.connection.getAccountInfo(B);D||this.logAndCreateError("no lp data",{farmId:n.id,version:p,ledgerData:D}),lr(p).decode(D.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id})}let b=g.lpMint.address,x=s&&b===Ae.toString(),P=w[b.toString()];if(!P){let{account:B,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:g.lpMint.programId,mint:new q(b),notUseTokenAccount:x,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:x?!1:c,checkCreateATAOwner:u});P=B,D&&m.addInstruction(D)}w[b.toString()]=P;let k=[];for(let B of f){let D=s&&B.mint.address===Ae.toString(),H=w[B.mint.address];if(!H){let{account:X,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:B.mint.programId,mint:new q(B.mint.address),notUseTokenAccount:D,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!D,associatedOnly:D?!1:c,checkCreateATAOwner:u});H=X,N&&m.addInstruction(N)}w[B.mint.address]=H,k.push(H)}let F=ur({version:p,rewardInfos:f,rewardTokenAccountsPublicKeys:k});F&&this.logAndCreateError(F);let S={amount:C(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:g,lpAccount:P,rewardAccounts:k,userAuxiliaryLedgers:d==null?void 0:d.map(B=>new q(B))},v=p===6?pr(S):p===5?mr(S):gr(S),O={3:U.FarmV3Withdraw,5:U.FarmV5Withdraw,6:U.FarmV6Withdraw};return m.addInstruction({instructions:[v],instructionTypes:[O[p]]}).versionBuild({txVersion:r})}async withdrawFarmReward({farmInfo:t,withdrawMint:r,txVersion:n}){var p;this.scope.checkOwner();let o=he((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),i=we[t.programId];i!==6&&this.logAndCreateError("invalid farm version",i);let s=t.rewardInfos.findIndex(g=>g.mint.address===ee.toString()?new q(oe.address):r),a=o.rewardInfos[s];a||this.logAndCreateError("withdraw mint error","rewardInfos",t);let c=(p=a==null?void 0:a.vault)!=null?p:ee,u=this.createTxBuilder(),d;if(r.equals(ee)){let g=await $t({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:cr({...a,openTime:a.openTime,endTime:a.endTime,perSecond:new Vt(a.perSecond).mul(10**a.mint.decimals).toString()})});d=g.addresses.newAccount,u.addInstruction(g)}else{let g=await this.scope.account.getCreatedTokenAccount({mint:r});g===null?(d=await this.scope.account.getAssociatedTokenAccount(r),u.addInstruction({instructions:[Di(this.scope.ownerPubKey,d,this.scope.ownerPubKey,r)],instructionTypes:[U.CreateATA]})):d=g}let{instruction:l,instructionType:f}=kn({programId:o.programId,id:o.id,authority:o.authority,lpVault:o.lpVault,rewardVault:c,userRewardToken:d,owner:this.scope.ownerPubKey});return u.addInstruction({instructions:[l],instructionTypes:[f]}).versionBuild({txVersion:n})}async harvestAllRewards(t){let{farmInfoList:r,useSOLBalance:n,feePayer:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:c,computeBudgetConfig:u}=t,d=this.createTxBuilder(),l={};for(let g of this.scope.account.tokenAccounts)if(i){let m=Me(this.scope.ownerPubKey,g.mint).publicKey;g.publicKey&&m.equals(g.publicKey)&&(l[g.mint.toString()]=g.publicKey)}else l[g.mint.toString()]=g.publicKey;let p=(await this.scope.api.fetchFarmKeysById({ids:Object.values(r).map(g=>g.id).join(",")})).reduce((g,m)=>({...g,[m.id]:m}),{});for(let g of Object.values(r)){let{programId:m,lpMint:w,rewardInfos:b,id:x}=g,P=we[m],k=w.address,F=n&&k===Ae.toString(),S=l[k];if(!S){let{account:X,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:w.programId,mint:new q(k),notUseTokenAccount:F,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:F?!1:i,checkCreateATAOwner:s});S=X,N&&d.addInstruction(N)}l[k.toString()]=S;let v=[];for(let X of b){let N=n&&X.mint.address===Ae.toString(),re=l[X.mint.address];if(!re){let{account:z,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:X.mint.programId,mint:new q(X.mint.address),notUseTokenAccount:N,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!N,associatedOnly:N?!1:i,checkCreateATAOwner:s});re=z,M&&d.addInstruction(M)}l[X.mint.address]=re,v.push(re)}let O=p[x],B={amount:Ot,owner:this.scope.ownerPubKey,farmInfo:g,farmKeys:O,lpAccount:S,rewardAccounts:v,userAuxiliaryLedgers:a==null?void 0:a.map(X=>new q(X))},D=P===6?pr(B):P===5?mr(B):gr(B),H={3:U.FarmV3Withdraw,5:U.FarmV5Withdraw,6:U.FarmV6Withdraw};d.addInstruction({instructions:[D],instructionTypes:[H[P]]})}return c===1?d.sizeCheckBuild({computeBudgetConfig:u}):d.sizeCheckBuildV0({computeBudgetConfig:u})}};export{yr as default};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.mjs.map