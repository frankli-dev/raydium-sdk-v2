import H from"bn.js";import{PublicKey as kn}from"@solana/web3.js";import{getTransferFeeConfig as Wa,unpackMint as Ua}from"@solana/spl-token";import{get as dt,set as cr}from"lodash";import pt from"dayjs";import lr from"dayjs/plugin/utc";pt.extend(lr);var qe=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return pt().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let r=t.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},ft={},dr={};function O(e){let t=dt(ft,e);if(!t){let r=dt(dr,e);t=new qe({name:e,logLevel:r}),cr(ft,e,t)}return t}import{PublicKey as Pn}from"@solana/web3.js";import Sn from"bn.js";import bn from"big.js";import Ve from"bn.js";import G from"bn.js";var ue=9e15,ie=1e9,Ge="0123456789abcdef",Le="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ae="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",He={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ue,maxE:ue,crypto:!1},wt,J,b=!0,ke="[DecimalError] ",ne=ke+"Invalid argument: ",yt=ke+"Precision limit exceeded",bt=ke+"crypto unavailable",Tt="[object Decimal]",U=Math.floor,v=Math.pow,fr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,pr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,mr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,xt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,z=1e7,w=7,gr=9007199254740991,hr=Le.length-1,je=Ae.length-1,p={toStringTag:Tt};p.absoluteValue=p.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),h(e)};p.ceil=function(){return h(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(e,t){var r,n=this,i=n.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(ne+t);return r=n.cmp(e),r<0?e:n.cmp(t)>0?t:new i(n)};p.comparedTo=p.cmp=function(e){var t,r,n,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,c=o.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==e.e)return o.e>e.e^c<0?1:-1;for(n=s.length,i=a.length,t=0,r=n<i?n:i;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return n===i?0:n>i^c<0?1:-1};p.cosine=p.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+w,n.rounding=1,r=wr(n,Bt(n,r)),n.precision=e,n.rounding=t,h(J==2||J==3?r.neg():r,e,t,!0)):new n(1):new n(NaN)};p.cubeRoot=p.cbrt=function(){var e,t,r,n,i,o,s,a,c,u,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(b=!1,o=l.s*v(l.s*l,1/3),!o||Math.abs(o)==1/0?(r=K(l.d),e=l.e,(o=(e-r.length+1)%3)&&(r+=o==1||o==-2?"0":"00"),o=v(r,1/3),e=U((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?r="5e"+e:(r=o.toExponential(),r=r.slice(0,r.indexOf("e")+1)+e),n=new d(r),n.s=l.s):n=new d(o.toString()),s=(e=d.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=N(u.plus(l).times(a),u.plus(c),s+2,1),K(a.d).slice(0,s)===(r=K(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!i&&r=="4999"){if(!i&&(h(a,e+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(h(n,e+1,1),t=!n.times(n).times(n).eq(l));break}return b=!0,h(n,e,d.rounding,t)};p.decimalPlaces=p.dp=function(){var e,t=this.d,r=NaN;if(t){if(e=t.length-1,r=(e-U(this.e/w))*w,e=t[e],e)for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r};p.dividedBy=p.div=function(e){return N(this,new this.constructor(e))};p.dividedToIntegerBy=p.divToInt=function(e){var t=this,r=t.constructor;return h(N(t,new r(e),0,1,1),r.precision,r.rounding)};p.equals=p.eq=function(e){return this.cmp(e)===0};p.floor=function(){return h(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(e){return this.cmp(e)>0};p.greaterThanOrEqualTo=p.gte=function(e){var t=this.cmp(e);return t==1||t===0};p.hyperbolicCosine=p.cosh=function(){var e,t,r,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/Re(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=ce(s,1,o.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return h(o,s.precision=r,s.rounding=n,!0)};p.hyperbolicSine=p.sinh=function(){var e,t,r,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,r=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=ce(o,2,i,i,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,i=i.times(1/Re(5,e)),i=ce(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=t,o.rounding=r,h(i,t,r,!0)};p.hyperbolicTangent=p.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,N(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)};p.inverseCosine=p.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),i=r.precision,o=r.rounding;return n!==-1?n===0?t.isNeg()?Y(r,i,o):new r(0):new r(NaN):t.isZero()?Y(r,i+4,o).times(.5):(r.precision=i+6,r.rounding=1,t=t.asin(),e=Y(r,i+4,o).times(.5),r.precision=i,r.rounding=o,e.minus(t))};p.inverseHyperbolicCosine=p.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,b=!1,r=r.times(r).minus(1).sqrt().plus(r),b=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)};p.inverseHyperbolicSine=p.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,b=!1,r=r.times(r).plus(1).sqrt().plus(r),b=!0,n.precision=e,n.rounding=t,r.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var e,t,r,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,n=i.sd(),Math.max(n,e)<2*-i.e-1?h(new o(i),e,t,!0):(o.precision=r=n-i.e,i=N(i.plus(1),new o(1).minus(i),r+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};p.inverseSine=p.asin=function(){var e,t,r,n,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),r=o.precision,n=o.rounding,t!==-1?t===0?(e=Y(o,r+4,n).times(.5),e.s=i.s,e):new o(NaN):(o.precision=r+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=r,o.rounding=n,i.times(2)))};p.inverseTangent=p.atan=function(){var e,t,r,n,i,o,s,a,c,u=this,l=u.constructor,d=l.precision,f=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&d+4<=je)return s=Y(l,d+4,f).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(d+4<=je)return s=Y(l,d+4,f).times(.5),s.s=u.s,s}for(l.precision=a=d+10,l.rounding=1,r=Math.min(28,a/w+2|0),e=r;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(b=!1,t=Math.ceil(a/w),n=1,c=u.times(u),s=new l(u),i=u;e!==-1;)if(i=i.times(c),o=s.minus(i.div(n+=2)),i=i.times(c),s=o.plus(i.div(n+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),b=!0,h(s,l.precision=d,l.rounding=f,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&U(this.e/w)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(e){return this.cmp(e)<0};p.lessThanOrEqualTo=p.lte=function(e){return this.cmp(e)<1};p.logarithm=p.log=function(e){var t,r,n,i,o,s,a,c,u=this,l=u.constructor,d=l.precision,f=l.rounding,m=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),r=e.d,e.s<0||!r||!r[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new l(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(t)if(r.length>1)o=!0;else{for(i=r[0];i%10===0;)i/=10;o=i!==1}if(b=!1,a=d+m,s=re(u,a),n=t?Be(l,a+10):re(e,a),c=N(s,n,a,1),pe(c.d,i=d,f))do if(a+=10,s=re(u,a),n=t?Be(l,a+10):re(e,a),c=N(s,n,a,1),!o){+K(c.d).slice(i+1,i+15)+1==1e14&&(c=h(c,d+1,0));break}while(pe(c.d,i+=10,f));return b=!0,h(c,d,f)};p.minus=p.sub=function(e){var t,r,n,i,o,s,a,c,u,l,d,f,m=this,T=m.constructor;if(e=new T(e),!m.d||!e.d)return!m.s||!e.s?e=new T(NaN):m.d?e.s=-e.s:e=new T(e.d||m.s!==e.s?m:NaN),e;if(m.s!=e.s)return e.s=-e.s,m.plus(e);if(u=m.d,f=e.d,a=T.precision,c=T.rounding,!u[0]||!f[0]){if(f[0])e.s=-e.s;else if(u[0])e=new T(m);else return new T(c===3?-0:0);return b?h(e,a,c):e}if(r=U(e.e/w),l=U(m.e/w),u=u.slice(),o=l-r,o){for(d=o<0,d?(t=u,o=-o,s=f.length):(t=f,r=l,s=u.length),n=Math.max(Math.ceil(a/w),s)+2,o>n&&(o=n,t.length=1),t.reverse(),n=o;n--;)t.push(0);t.reverse()}else{for(n=u.length,s=f.length,d=n<s,d&&(s=n),n=0;n<s;n++)if(u[n]!=f[n]){d=u[n]<f[n];break}o=0}for(d&&(t=u,u=f,f=t,e.s=-e.s),s=u.length,n=f.length-s;n>0;--n)u[s++]=0;for(n=f.length;n>o;){if(u[--n]<f[n]){for(i=n;i&&u[--i]===0;)u[i]=z-1;--u[i],u[n]+=z}u[n]-=f[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=Ne(u,r),b?h(e,a,c):e):new T(c===3?-0:0)};p.modulo=p.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?h(new n(r),n.precision,n.rounding):(b=!1,n.modulo==9?(t=N(r,e.abs(),0,3,1),t.s*=e.s):t=N(r,e,0,n.modulo,1),t=t.times(e),b=!0,r.minus(t))};p.naturalExponential=p.exp=function(){return Ye(this)};p.naturalLogarithm=p.ln=function(){return re(this)};p.negated=p.neg=function(){var e=new this.constructor(this);return e.s=-e.s,h(e)};p.plus=p.add=function(e){var t,r,n,i,o,s,a,c,u,l,d=this,f=d.constructor;if(e=new f(e),!d.d||!e.d)return!d.s||!e.s?e=new f(NaN):d.d||(e=new f(e.d||d.s===e.s?d:NaN)),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(u=d.d,l=e.d,a=f.precision,c=f.rounding,!u[0]||!l[0])return l[0]||(e=new f(d)),b?h(e,a,c):e;if(o=U(d.e/w),n=U(e.e/w),u=u.slice(),i=o-n,i){for(i<0?(r=u,i=-i,s=l.length):(r=l,n=o,s=u.length),o=Math.ceil(a/w),s=o>s?o+1:s+1,i>s&&(i=s,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,r=l,l=u,u=r),t=0;i;)t=(u[--i]=u[i]+l[i]+t)/z|0,u[i]%=z;for(t&&(u.unshift(t),++n),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=Ne(u,n),b?h(e,a,c):e};p.precision=p.sd=function(e){var t,r=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ne+e);return r.d?(t=Pt(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t};p.round=function(){var e=this,t=e.constructor;return h(new t(e),e.e+1,t.rounding)};p.sine=p.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+w,n.rounding=1,r=br(n,Bt(n,r)),n.precision=e,n.rounding=t,h(J>2?r.neg():r,e,t,!0)):new n(NaN)};p.squareRoot=p.sqrt=function(){var e,t,r,n,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(b=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=K(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=U((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),n=new l(t)):n=new l(u.toString()),r=(c=l.precision)+3;;)if(o=n,n=o.plus(N(s,o,r+2,1)).times(.5),K(o.d).slice(0,r)===(t=K(n.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!i&&t=="4999"){if(!i&&(h(o,c+1,0),o.times(o).eq(s))){n=o;break}r+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(h(n,c+1,1),e=!n.times(n).eq(s));break}return b=!0,h(n,c,l.rounding,e)};p.tangent=p.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,r=r.sin(),r.s=1,r=N(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,h(J==2||J==4?r.neg():r,e,t,!0)):new n(NaN)};p.times=p.mul=function(e){var t,r,n,i,o,s,a,c,u,l=this,d=l.constructor,f=l.d,m=(e=new d(e)).d;if(e.s*=l.s,!f||!f[0]||!m||!m[0])return new d(!e.s||f&&!f[0]&&!m||m&&!m[0]&&!f?NaN:!f||!m?e.s/0:e.s*0);for(r=U(l.e/w)+U(e.e/w),c=f.length,u=m.length,c<u&&(o=f,f=m,m=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(t=0,i=c+n;i>n;)a=o[i]+m[n]*f[i-n-1]+t,o[i--]=a%z|0,t=a/z|0;o[i]=(o[i]+t)%z|0}for(;!o[--s];)o.pop();return t?++r:o.shift(),e.d=o,e.e=Ne(o,r),b?h(e,d.precision,d.rounding):e};p.toBinary=function(e,t){return Ze(this,2,e,t)};p.toDecimalPlaces=p.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(q(e,0,ie),t===void 0?t=n.rounding:q(t,0,8),h(r,e+r.e+1,t))};p.toExponential=function(e,t){var r,n=this,i=n.constructor;return e===void 0?r=Z(n,!0):(q(e,0,ie),t===void 0?t=i.rounding:q(t,0,8),n=h(new i(n),e+1,t),r=Z(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r};p.toFixed=function(e,t){var r,n,i=this,o=i.constructor;return e===void 0?r=Z(i):(q(e,0,ie),t===void 0?t=o.rounding:q(t,0,8),n=h(new o(i),e+i.e+1,t),r=Z(n,!1,e+n.e+1)),i.isNeg()&&!i.isZero()?"-"+r:r};p.toFraction=function(e){var t,r,n,i,o,s,a,c,u,l,d,f,m=this,T=m.d,y=m.constructor;if(!T)return new y(m);if(u=r=new y(1),n=c=new y(0),t=new y(n),o=t.e=Pt(T)-m.e-1,s=o%w,t.d[0]=v(10,s<0?w+s:s),e==null)e=o>0?t:u;else{if(a=new y(e),!a.isInt()||a.lt(u))throw Error(ne+a);e=a.gt(t)?o>0?t:u:a}for(b=!1,a=new y(K(T)),l=y.precision,y.precision=o=T.length*w*2;d=N(a,t,0,1,1),i=r.plus(d.times(n)),i.cmp(e)!=1;)r=n,n=i,i=u,u=c.plus(d.times(i)),c=i,i=t,t=a.minus(d.times(i)),a=i;return i=N(e.minus(r),n,0,1,1),c=c.plus(i.times(u)),r=r.plus(i.times(n)),c.s=u.s=m.s,f=N(u,n,o,1).minus(m).abs().cmp(N(c,r,o,1).minus(m).abs())<1?[u,n]:[c,r],y.precision=l,b=!0,f};p.toHexadecimal=p.toHex=function(e,t){return Ze(this,16,e,t)};p.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),e==null){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),t===void 0?t=n.rounding:q(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(b=!1,r=N(r,e,0,t,1).times(e),b=!0,h(r)):(e.s=r.s,r=e),r};p.toNumber=function(){return+this};p.toOctal=function(e,t){return Ze(this,8,e,t)};p.toPower=p.pow=function(e){var t,r,n,i,o,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(v(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,e.eq(1))return h(a,n,o);if(t=U(e.e/w),t>=e.d.length-1&&(r=u<0?-u:u)<=gr)return i=St(c,a,r,n),e.s<0?new c(1).div(i):h(i,n,o);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=v(+a,u),t=r==0||!isFinite(r)?U(u*(Math.log("0."+K(a.d))/Math.LN10+a.e+1)):new c(r+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(b=!1,c.rounding=a.s=1,r=Math.min(12,(t+"").length),i=Ye(e.times(re(a,n+r)),n),i.d&&(i=h(i,n+5,1),pe(i.d,n,o)&&(t=n+10,i=h(Ye(e.times(re(a,t+r)),t),t+5,1),+K(i.d).slice(n+1,n+15)+1==1e14&&(i=h(i,n+1,0)))),i.s=s,b=!0,c.rounding=o,h(i,n,o))};p.toPrecision=function(e,t){var r,n=this,i=n.constructor;return e===void 0?r=Z(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(q(e,1,ie),t===void 0?t=i.rounding:q(t,0,8),n=h(new i(n),e,t),r=Z(n,e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r};p.toSignificantDigits=p.toSD=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(q(e,1,ie),t===void 0?t=n.rounding:q(t,0,8)),h(new n(r),e,t)};p.toString=function(){var e=this,t=e.constructor,r=Z(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r};p.truncated=p.trunc=function(){return h(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var e=this,t=e.constructor,r=Z(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};function K(e){var t,r,n,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)n=e[t]+"",r=w-n.length,r&&(o+=te(r)),o+=n;s=e[t],n=s+"",r=w-n.length,r&&(o+=te(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function q(e,t,r){if(e!==~~e||e<t||e>r)throw Error(ne+e)}function pe(e,t,r,n){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=w,i=0):(i=Math.ceil((t+1)/w),t%=w),o=v(10,w-t),a=e[i]%o|0,n==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==o||r>3&&a+1==o/2)&&(e[i+1]/o/100|0)==v(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==o||!n&&r>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==v(10,t-3)-1,s}function Se(e,t,r){for(var n,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=Ge.indexOf(e.charAt(s++)),n=0;n<i.length;n++)i[n]>r-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/r|0,i[n]%=r)}return i.reverse()}function wr(e,t){var r,n,i;if(t.isZero())return t;n=t.d.length,n<32?(r=Math.ceil(n/3),i=(1/Re(4,r)).toString()):(r=16,i="2.3283064365386962890625e-10"),e.precision+=r,t=ce(e,1,t.times(i),new e(1));for(var o=r;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}var N=function(){function e(n,i,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*i+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function t(n,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=i[a]){c=n[a]>i[a]?1:-1;break}return c}function r(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,c){var u,l,d,f,m,T,y,P,S,M,k,D,be,X,Ke,Te,fe,We,j,xe,Pe=n.constructor,Ue=n.s==i.s?1:-1,W=n.d,R=i.d;if(!W||!W[0]||!R||!R[0])return new Pe(!n.s||!i.s||(W?R&&W[0]==R[0]:!R)?NaN:W&&W[0]==0||!R?Ue*0:Ue/0);for(c?(m=1,l=n.e-i.e):(c=z,m=w,l=U(n.e/m)-U(i.e/m)),j=R.length,fe=W.length,S=new Pe(Ue),M=S.d=[],d=0;R[d]==(W[d]||0);d++);if(R[d]>(W[d]||0)&&l--,o==null?(X=o=Pe.precision,s=Pe.rounding):a?X=o+(n.e-i.e)+1:X=o,X<0)M.push(1),T=!0;else{if(X=X/m+2|0,d=0,j==1){for(f=0,R=R[0],X++;(d<fe||f)&&X--;d++)Ke=f*c+(W[d]||0),M[d]=Ke/R|0,f=Ke%R|0;T=f||d<fe}else{for(f=c/(R[0]+1)|0,f>1&&(R=e(R,f,c),W=e(W,f,c),j=R.length,fe=W.length),Te=j,k=W.slice(0,j),D=k.length;D<j;)k[D++]=0;xe=R.slice(),xe.unshift(0),We=R[0],R[1]>=c/2&&++We;do f=0,u=t(R,k,j,D),u<0?(be=k[0],j!=D&&(be=be*c+(k[1]||0)),f=be/We|0,f>1?(f>=c&&(f=c-1),y=e(R,f,c),P=y.length,D=k.length,u=t(y,k,P,D),u==1&&(f--,r(y,j<P?xe:R,P,c))):(f==0&&(u=f=1),y=R.slice()),P=y.length,P<D&&y.unshift(0),r(k,y,D,c),u==-1&&(D=k.length,u=t(R,k,j,D),u<1&&(f++,r(k,j<D?xe:R,D,c))),D=k.length):u===0&&(f++,k=[0]),M[d++]=f,u&&k[0]?k[D++]=W[Te]||0:(k=[W[Te]],D=1);while((Te++<fe||k[0]!==void 0)&&X--);T=k[0]!==void 0}M[0]||M.shift()}if(m==1)S.e=l,wt=T;else{for(d=1,f=M[0];f>=10;f/=10)d++;S.e=d+l*m-1,h(S,a?o+S.e+1:o,s,T)}return S}}();function h(e,t,r,n){var i,o,s,a,c,u,l,d,f,m=e.constructor;e:if(t!=null){if(d=e.d,!d)return e;for(i=1,a=d[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=w,s=t,l=d[f=0],c=l/v(10,i-s-1)%10|0;else if(f=Math.ceil((o+1)/w),a=d.length,f>=a)if(n){for(;a++<=f;)d.push(0);l=c=0,i=1,o%=w,s=o-w+1}else break e;else{for(l=a=d[f],i=1;a>=10;a/=10)i++;o%=w,s=o-w+i,c=s<0?0:l/v(10,i-s-1)%10|0}if(n=n||t<0||d[f+1]!==void 0||(s<0?l:l%v(10,i-s-1)),u=r<4?(c||n)&&(r==0||r==(e.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(o>0?s>0?l/v(10,i-s):0:d[f-1])%10&1||r==(e.s<0?8:7)),t<1||!d[0])return d.length=0,u?(t-=e.e+1,d[0]=v(10,(w-t%w)%w),e.e=-t||0):d[0]=e.e=0,e;if(o==0?(d.length=f,a=1,f--):(d.length=f+1,a=v(10,w-o),d[f]=s>0?(l/v(10,i-s)%v(10,s)|0)*a:0),u)for(;;)if(f==0){for(o=1,s=d[0];s>=10;s/=10)o++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,d[0]==z&&(d[0]=1));break}else{if(d[f]+=a,d[f]!=z)break;d[f--]=0,a=1}for(o=d.length;d[--o]===0;)d.pop()}return b&&(e.e>m.maxE?(e.d=null,e.e=NaN):e.e<m.minE&&(e.e=0,e.d=[0])),e}function Z(e,t,r){if(!e.isFinite())return At(e);var n,i=e.e,o=K(e.d),s=o.length;return t?(r&&(n=r-s)>0?o=o.charAt(0)+"."+o.slice(1)+te(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+te(-i-1)+o,r&&(n=r-s)>0&&(o+=te(n))):i>=s?(o+=te(i+1-s),r&&(n=r-i-1)>0&&(o=o+"."+te(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-s)>0&&(i+1===s&&(o+="."),o+=te(n))),o}function Ne(e,t){var r=e[0];for(t*=w;r>=10;r/=10)t++;return t}function Be(e,t,r){if(t>hr)throw b=!0,r&&(e.precision=r),Error(yt);return h(new e(Le),t,1,!0)}function Y(e,t,r){if(t>je)throw Error(yt);return h(new e(Ae),t,r,!0)}function Pt(e){var t=e.length-1,r=t*w+1;if(t=e[t],t){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function te(e){for(var t="";e--;)t+="0";return t}function St(e,t,r,n){var i,o=new e(1),s=Math.ceil(n/w+4);for(b=!1;;){if(r%2&&(o=o.times(t),gt(o.d,s)&&(i=!0)),r=U(r/2),r===0){r=o.d.length-1,i&&o.d[r]===0&&++o.d[r];break}t=t.times(t),gt(t.d,s)}return b=!0,o}function mt(e){return e.d[e.d.length-1]&1}function Lt(e,t,r){for(var n,i=new e(t[0]),o=0;++o<t.length;)if(n=new e(t[o]),n.s)i[r](n)&&(i=n);else{i=n;break}return i}function Ye(e,t){var r,n,i,o,s,a,c,u=0,l=0,d=0,f=e.constructor,m=f.rounding,T=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(b=!1,c=T):c=t,a=new f(.03125);e.e>-2;)e=e.times(a),d+=5;for(n=Math.log(v(2,d))/Math.LN10*2+5|0,c+=n,r=o=s=new f(1),f.precision=c;;){if(o=h(o.times(e),c,1),r=r.times(++l),a=s.plus(N(o,r,c,1)),K(a.d).slice(0,c)===K(s.d).slice(0,c)){for(i=d;i--;)s=h(s.times(s),c,1);if(t==null)if(u<3&&pe(s.d,c-n,m,u))f.precision=c+=10,r=o=a=new f(1),l=0,u++;else return h(s,f.precision=T,m,b=!0);else return f.precision=T,s}s=a}}function re(e,t){var r,n,i,o,s,a,c,u,l,d,f,m=1,T=10,y=e,P=y.d,S=y.constructor,M=S.rounding,k=S.precision;if(y.s<0||!P||!P[0]||!y.e&&P[0]==1&&P.length==1)return new S(P&&!P[0]?-1/0:y.s!=1?NaN:P?0:y);if(t==null?(b=!1,l=k):l=t,S.precision=l+=T,r=K(P),n=r.charAt(0),Math.abs(o=y.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)y=y.times(e),r=K(y.d),n=r.charAt(0),m++;o=y.e,n>1?(y=new S("0."+r),o++):y=new S(n+"."+r.slice(1))}else return u=Be(S,l+2,k).times(o+""),y=re(new S(n+"."+r.slice(1)),l-T).plus(u),S.precision=k,t==null?h(y,k,M,b=!0):y;for(d=y,c=s=y=N(y.minus(1),y.plus(1),l,1),f=h(y.times(y),l,1),i=3;;){if(s=h(s.times(f),l,1),u=c.plus(N(s,new S(i),l,1)),K(u.d).slice(0,l)===K(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Be(S,l+2,k).times(o+""))),c=N(c,new S(m),l,1),t==null)if(pe(c.d,l-T,M,a))S.precision=l+=T,u=s=y=N(d.minus(1),d.plus(1),l,1),f=h(y.times(y),l,1),i=a=1;else return h(c,S.precision=k,M,b=!0);else return S.precision=k,c;c=u,i+=2}}function At(e){return String(e.s*e.s/0)}function ze(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;n++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(n,i),t){if(i-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%w,r<0&&(n+=w),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=w;n<i;)e.d.push(+t.slice(n,n+=w));t=t.slice(n),n=w-t.length}else n-=i;for(;n--;)t+="0";e.d.push(+t),b&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function yr(e,t){var r,n,i,o,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),xt.test(t))return ze(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(pr.test(t))r=16,t=t.toLowerCase();else if(fr.test(t))r=2;else if(mr.test(t))r=8;else throw Error(ne+t);for(o=t.search(/p/i),o>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,n=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=St(n,new n(r),o,o*2)),u=Se(t,r,z),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(e.s*0):(e.e=Ne(u,l),e.d=u,b=!1,s&&(e=N(e,i,a*4)),c&&(e=e.times(Math.abs(c)<54?v(2,c):Ie.pow(2,c))),b=!0,e)}function br(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:ce(e,2,t,t);r=1.4*Math.sqrt(n),r=r>16?16:r|0,t=t.times(1/Re(5,r)),t=ce(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);r--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function ce(e,t,r,n,i){var o,s,a,c,u=1,l=e.precision,d=Math.ceil(l/w);for(b=!1,c=r.times(r),a=new e(n);;){if(s=N(a.times(c),new e(t++*t++),l,1),a=i?n.plus(s):n.minus(s),n=N(s.times(c),new e(t++*t++),l,1),s=a.plus(n),s.d[d]!==void 0){for(o=d;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return b=!0,s.d.length=d+1,s}function Re(e,t){for(var r=e;--t;)r*=e;return r}function Bt(e,t){var r,n=t.s<0,i=Y(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return J=n?4:1,t;if(r=t.divToInt(i),r.isZero())J=n?3:2;else{if(t=t.minus(r.times(i)),t.lte(o))return J=mt(r)?n?2:3:n?4:1,t;J=mt(r)?n?1:4:n?3:2}return t.minus(i).abs()}function Ze(e,t,r,n){var i,o,s,a,c,u,l,d,f,m=e.constructor,T=r!==void 0;if(T?(q(r,1,ie),n===void 0?n=m.rounding:q(n,0,8)):(r=m.precision,n=m.rounding),!e.isFinite())l=At(e);else{for(l=Z(e),s=l.indexOf("."),T?(i=2,t==16?r=r*4-3:t==8&&(r=r*3-2)):i=t,s>=0&&(l=l.replace(".",""),f=new m(1),f.e=l.length-s,f.d=Se(Z(f),10,i),f.e=f.d.length),d=Se(l,10,i),o=c=d.length;d[--c]==0;)d.pop();if(!d[0])l=T?"0p+0":"0";else{if(s<0?o--:(e=new m(e),e.d=d,e.e=o,e=N(e,f,r,n,0,i),d=e.d,o=e.e,u=wt),s=d[r],a=i/2,u=u||d[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(e.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&d[r-1]&1||n===(e.s<0?8:7)),d.length=r,u)for(;++d[--r]>i-1;)d[r]=0,r||(++o,d.unshift(1));for(c=d.length;!d[c-1];--c);for(s=0,l="";s<c;s++)l+=Ge.charAt(d[s]);if(T){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(d=Se(l,i,t),c=d.length;!d[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Ge.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function gt(e,t){if(e.length>t)return e.length=t,!0}function Tr(e){return new this(e).abs()}function xr(e){return new this(e).acos()}function Pr(e){return new this(e).acosh()}function Sr(e,t){return new this(e).plus(t)}function Lr(e){return new this(e).asin()}function Ar(e){return new this(e).asinh()}function Br(e){return new this(e).atan()}function kr(e){return new this(e).atanh()}function Nr(e,t){e=new this(e),t=new this(t);var r,n=this.precision,i=this.rounding,o=n+4;return!e.s||!t.s?r=new this(NaN):!e.d&&!t.d?(r=Y(this,o,1).times(t.s>0?.25:.75),r.s=e.s):!t.d||e.isZero()?(r=t.s<0?Y(this,n,i):new this(0),r.s=e.s):!e.d||t.isZero()?(r=Y(this,o,1).times(.5),r.s=e.s):t.s<0?(this.precision=o,this.rounding=1,r=this.atan(N(e,t,o,1)),t=Y(this,o,1),this.precision=n,this.rounding=i,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(N(e,t,o,1)),r}function Rr(e){return new this(e).cbrt()}function Ir(e){return h(e=new this(e),e.e+1,2)}function Cr(e,t,r){return new this(e).clamp(t,r)}function Fr(e){if(!e||typeof e!="object")throw Error(ke+"Object expected");var t,r,n,i=e.defaults===!0,o=["precision",1,ie,"rounding",0,8,"toExpNeg",-ue,0,"toExpPos",0,ue,"maxE",0,ue,"minE",-ue,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(r=o[t],i&&(this[r]=He[r]),(n=e[r])!==void 0)if(U(n)===n&&n>=o[t+1]&&n<=o[t+2])this[r]=n;else throw Error(ne+r+": "+n);if(r="crypto",i&&(this[r]=He[r]),(n=e[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(bt);else this[r]=!1;else throw Error(ne+r+": "+n);return this}function _r(e){return new this(e).cos()}function Vr(e){return new this(e).cosh()}function kt(e){var t,r,n;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,ht(o)){u.s=o.s,b?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;b?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return ze(u,o.toString())}else if(c!=="string")throw Error(ne+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),xt.test(o)?ze(u,o):yr(u,o)}if(i.prototype=p,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Fr,i.clone=kt,i.isDecimal=ht,i.abs=Tr,i.acos=xr,i.acosh=Pr,i.add=Sr,i.asin=Lr,i.asinh=Ar,i.atan=Br,i.atanh=kr,i.atan2=Nr,i.cbrt=Rr,i.ceil=Ir,i.clamp=Cr,i.cos=_r,i.cosh=Vr,i.div=Er,i.exp=Mr,i.floor=vr,i.hypot=Dr,i.ln=Or,i.log=Kr,i.log10=Ur,i.log2=Wr,i.max=qr,i.min=Gr,i.mod=Hr,i.mul=jr,i.pow=Yr,i.random=zr,i.round=Zr,i.sign=Xr,i.sin=Jr,i.sinh=Qr,i.sqrt=$r,i.sub=en,i.sum=tn,i.tan=rn,i.tanh=nn,i.trunc=on,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return i.config(e),i}function Er(e,t){return new this(e).div(t)}function Mr(e){return new this(e).exp()}function vr(e){return h(e=new this(e),e.e+1,3)}function Dr(){var e,t,r=new this(0);for(b=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return b=!0,new this(1/0);r=t}return b=!0,r.sqrt()}function ht(e){return e instanceof Ie||e&&e.toStringTag===Tt||!1}function Or(e){return new this(e).ln()}function Kr(e,t){return new this(e).log(t)}function Wr(e){return new this(e).log(2)}function Ur(e){return new this(e).log(10)}function qr(){return Lt(this,arguments,"lt")}function Gr(){return Lt(this,arguments,"gt")}function Hr(e,t){return new this(e).mod(t)}function jr(e,t){return new this(e).mul(t)}function Yr(e,t){return new this(e).pow(t)}function zr(e){var t,r,n,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:q(e,1,ie),n=Math.ceil(e/w),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));o<n;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);o<n;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(bt);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],e%=w,n&&e&&(i=v(10,w-e),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=w)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<w&&(r-=w-n)}return s.e=r,s.d=a,s}function Zr(e){return h(e=new this(e),e.e+1,this.rounding)}function Xr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Jr(e){return new this(e).sin()}function Qr(e){return new this(e).sinh()}function $r(e){return new this(e).sqrt()}function en(e,t){return new this(e).sub(t)}function tn(){var e=0,t=arguments,r=new this(t[e]);for(b=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return b=!0,h(r,this.precision,this.rounding)}function rn(e){return new this(e).tan()}function nn(e){return new this(e).tanh()}function on(e){return h(e=new this(e),e.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var Ie=p.constructor=kt(He);Le=new Ie(Le);Ae=new Ie(Ae);import{PublicKey as Qe}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as sn}from"@solana/spl-token";import{PublicKey as I,SystemProgram as Rt,SYSVAR_RENT_PUBKEY as an}from"@solana/web3.js";function Xe({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var ni=[Xe({pubkey:sn,isWritable:!1}),Xe({pubkey:Rt.programId,isWritable:!1}),Xe({pubkey:an,isWritable:!1})];function It({publicKey:e,transformSol:t}){let r=Je(e.toString());if(r instanceof I)return t&&r.equals(me)?Nt:r;if(t&&r.toString()===me.toBase58())return Nt;if(typeof r=="string"){if(r===I.default.toBase58())return I.default;try{return new I(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Je(e){try{return new I(e)}catch{return e}}var ii=new I("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),oi=new I("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),si=new I("SysvarRent111111111111111111111111111111111"),ai=new I("SysvarC1ock11111111111111111111111111111111"),ui=new I("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ci=new I("Sysvar1nstructions1111111111111111111111111"),li=Rt.programId,di=new I("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),fi=new I("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),pi=new I("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),mi=new I("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),gi=new I("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),hi=new I("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),wi=new I("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),yi=new I("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),bi=new I("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ti=new I("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),xi=new I("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Nt=new I("So11111111111111111111111111111111111111112"),me=I.default;import{PublicKey as un}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ct}from"@solana/spl-token";var Ft={chainId:101,address:un.default.toBase58(),programId:Ct.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},oe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ct.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var $e=class{constructor({mint:t,decimals:r,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===me.toBase58()||t instanceof Qe&&me.equals(t)){this.decimals=oe.decimals,this.symbol=oe.symbol,this.name=oe.name,this.mint=new Qe(oe.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?Qe.default:It({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},se=$e;se.WSOL=new $e({...oe,mint:oe.address});import Fe from"big.js";import dn from"bn.js";import fn from"decimal.js-light";import cn from"toformat";var ln=cn,ge=ln;var Ce=O("module/fraction"),et=ge(Fe),he=ge(fn),pn={[0]:he.ROUND_DOWN,[1]:he.ROUND_HALF_UP,[2]:he.ROUND_UP},mn={[0]:Fe.roundDown,[1]:Fe.roundHalfUp,[2]:Fe.roundUp},B=class{constructor(t,r=new dn(1)){this.numerator=V(t),this.denominator=V(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new B(this.denominator,this.numerator)}add(t){let r=t instanceof B?t:new B(V(t));return this.denominator.eq(r.denominator)?new B(this.numerator.add(r.numerator),this.denominator):new B(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof B?t:new B(V(t));return this.denominator.eq(r.denominator)?new B(this.numerator.sub(r.numerator),this.denominator):new B(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof B?t:new B(V(t));return new B(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof B?t:new B(V(t));return new B(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||Ce.logWithError(`${t} is not an integer.`),t<=0&&Ce.logWithError(`${t} is not positive.`),he.set({precision:t+1,rounding:pn[n]});let i=new he(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||Ce.logWithError(`${t} is not an integer.`),t<0&&Ce.logWithError(`${t} is negative.`),et.DP=t,et.RM=mn[n]||1,new et(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var hn=O("Raydium_price"),Q=class extends B{constructor(r){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=r;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new B(tt(n.decimals),tt(i.decimals))}get raw(){return new B(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Q({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&hn.logWithError("mul token not equals");let n=super.mul(r);return new Q({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(r,n,i)}toFixed(r=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(r,n,i)}};var rt=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},_e=rt;_e.SOL=new rt(Ft);import wn from"bn.js";var _t=new B(new wn(100)),le=class extends B{toSignificant(t=5,r,n){return this.mul(_t).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(_t).toFixed(t,r,n)}};var yn=new G(0),bo=new G(1),To=new G(2),xo=new G(3),Po=new G(5),nt=new G(10),So=new G(100),Lo=new G(1e3),Ao=new G(1e4),Vt=9007199254740991;function V(e){let t=O("Raydium_parseBigNumberish");if(e instanceof G)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new G(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Vt||e<=-Vt)&&t.logWithError(`BigNumberish number overflow: ${e}`),new G(String(e))):typeof e=="bigint"?new G(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new G(0))}function tt(e){return nt.pow(V(e))}var Tn=O("Raydium_amount"),Mt=ge(bn);function xn(e,t){let r="0",n="0";if(e.includes(".")){let i=e.split(".");i.length===2?([r,n]=i,n=n.padEnd(t,"0")):Tn.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var $=class extends B{constructor(r,n,i=!0,o){let s=new Ve(0),a=nt.pow(new Ve(r.decimals));if(i)s=V(n);else{let c=new Ve(0),u=new Ve(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=xn(n.toString(),r.decimals);c=V(l),u=V(d)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=O(o||"TokenAmount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new $(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new $(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,i=0){return super.toSignificant(r,n,i)}toFixed(r=this.token.decimals,n,i=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,i)}toExact(r={groupSeparator:""}){return Mt.DP=this.token.decimals,new Mt(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};function Et(e){return typeof e=="object"&&e!==null&&![se,$,Pn,B,Sn,Q,le].some(t=>typeof t=="object"&&e instanceof t)}function Ee(e){return typeof e=="string"?Je(e):Array.isArray(e)?e.map(t=>Ee(t)):Et(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Ee(r)])):e}import{PublicKey as Ns,sendAndConfirmTransaction as Rs,Transaction as Cs,TransactionMessage as _s,VersionedTransaction as Vs}from"@solana/web3.js";import Ms from"axios";import{PublicKey as Ln,ComputeBudgetProgram as ts,Transaction as ns,TransactionMessage as os,Keypair as ss,VersionedTransaction as us}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ls}from"@solana/spl-token";var ps=O("Raydium_txUtil");function we(e,t){let[r,n]=Ln.findProgramAddressSync(e,t);return{publicKey:r,nonce:n}}import{PublicKey as An,AddressLookupTableAccount as vt}from"@solana/web3.js";var Bn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new vt({key:new An("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:vt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function it(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}var Ot=e=>typeof e=="number";function Kt(e,t,r){let n=Ot(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()<=+n}function Wt(e,t,r){let n=Ot(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()>+n}import{PublicKey as E}from"@solana/web3.js";var Ut=new E("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),qt=new E("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Gt=new E("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),js=new E("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ys=new E("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),zs=new E("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Zs=new E("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Xs=new E("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Js=new E("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Qs=new E("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$s=new E("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ea=new E("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ta=new E("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ra=new E("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),na=new E("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ia=new E("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),oa=new E("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),sa=new E("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),aa=new E("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),ua=new E("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as da}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ma}from"@solana/spl-token";import wa from"bn.js";var ot=O("Raydium_accountInfo_util");async function Dt(e,t,r){let{batchRequest:n,commitment:i="confirmed"}={batchRequest:!1,...r},o=it(t,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let d=e._buildArgs([l.map(f=>f.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=it(a,10);s=(await(await Promise.all(c.map(async l=>await e._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&ot.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:f,executable:m,lamports:T,owner:y,rentEpoch:P}=d;return f.length!==2&&f[1]!=="base64"&&ot.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:m,lamports:T,owner:new kn(y),rentEpoch:P}}return null})))}else try{s=await Promise.all(o.map(a=>e.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&ot.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function Ht(e,t,r){let n=await Dt(e,t.map(i=>i.pubkey),r);return t.map((i,o)=>({...i,accountInfo:n[o]}))}import{PublicKey as Vn}from"@solana/web3.js";import Zt,{isBN as Xt}from"bn.js";import{bits as Ya,BitStructure as za,blob as Nn,Blob as Za,cstr as Xa,f32 as Ja,f32be as Qa,f64 as $a,f64be as eu,greedy as tu,Layout as Rn,ns64 as ru,ns64be as nu,nu64 as iu,nu64be as ou,offset as su,s16 as au,s16be as uu,s24 as cu,s24be as lu,s32 as du,s32be as fu,s40 as pu,s40be as mu,s48 as gu,s48be as hu,s8 as wu,seq as In,struct as yu,Structure as Cn,u16 as bu,u16be as Tu,u24 as xu,u24be as Pu,u32 as Su,u32be as Lu,u40 as Au,u40be as Bu,u48 as ku,u48be as Nu,u8 as Fn,UInt as _n,union as Ru,Union as Iu,unionLayoutDiscriminator as Cu,utf8 as Fu}from"@solana/buffer-layout";var st=Rn,jt=Cn;var at=_n;var Yt=Fn;var zt=In;var ae=Nn;var de=class extends st{constructor(r,n,i){super(r,i);this.blob=ae(r),this.signed=n}decode(r,n=0){let i=new Zt(this.blob.decode(r,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(r,n,i=0){return typeof r=="number"&&(r=new Zt(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,i)}};function _(e){return new at(1,e)}function ve(e){return new at(4,e)}function g(e){return new de(8,!1,e)}function ee(e){return new de(16,!1,e)}function Jt(e){return new de(1,!0,e)}function De(e){return new de(8,!0,e)}var Me=class extends st{constructor(r,n,i,o){super(r.span,o);this.layout=r,this.decoder=n,this.encoder=i}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,i){return this.layout.encode(this.encoder(r),n,i)}getSpan(r,n){return this.layout.getSpan(r,n)}};function x(e){return new Me(ae(32),t=>new Vn(t),t=>t.toBuffer(),e)}function ct(e){return new Me(Yt(),En,Mn,e)}function En(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function Mn(e){return e?1:0}var ut=class extends jt{decode(t,r){return super.decode(t,r)}};function C(e,t,r){return new ut(e,t,r)}function F(e,t,r){let n,i=typeof t=="number"?t:Xt(t)?t.toNumber():new Proxy(t,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Xt(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return zt(e,i,r)}var lt=C([x("mint"),x("owner"),g("amount"),ve("delegateOption"),x("delegate"),_("state"),ve("isNativeOption"),g("isNative"),g("delegatedAmount"),ve("closeAuthorityOption"),x("closeAuthority")]);import{PublicKey as sr}from"@solana/web3.js";var Qu=C([_("instruction")]),$u=C([_("instruction")]),vn=C([g("rewardState"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardLastUpdateTime"),g("totalReward"),g("totalRewardEmissioned"),g("rewardClaimed"),g("rewardPerSecond"),ee("accRewardPerShare"),x("rewardVault"),x("rewardMint"),x("rewardSender"),g("rewardType"),F(g(),15,"padding")]),Dn=C([g("state"),g("nonce"),x("lpVault"),x("rewardVault"),x(),x(),g(),g(),g("totalReward"),ee("perShareReward"),g("lastSlot"),g("perSlotReward")]),On=C([g("state"),g("nonce"),x("lpVault"),x("rewardVaultA"),g("totalRewardA"),ee("perShareRewardA"),g("perSlotRewardA"),_("option"),x("rewardVaultB"),ae(7),g("totalRewardB"),ee("perShareRewardB"),g("perSlotRewardB"),g("lastSlot"),x()]),Kn=C([g(),g("state"),g("nonce"),g("validRewardTokenNum"),ee("rewardMultiplier"),g("rewardPeriodMax"),g("rewardPeriodMin"),g("rewardPeriodExtend"),x("lpMint"),x("lpVault"),F(vn,5,"rewardInfos"),x("creator"),x(),F(g(),32,"padding")]),Qt=new Proxy(Dn,{get(e,t,r){return t==="decode"?(...n)=>{let i=e.decode(...n);return{...i,version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]}}:Reflect.get(e,t,r)}}),$t=new Proxy(On,{get(e,t,r){return t==="decode"?(...n)=>{let i=e.decode(...n);return{...i,version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]}}:Reflect.get(e,t,r)}}),er=new Proxy(Kn,{get(e,t,r){return t==="decode"?(...n)=>{let i=e.decode(...n);return{...i,version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return{...o,rewardType:((s=Object.entries(Oe).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]}})}}:Reflect.get(e,t,r)}}),Wn=C([g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),ec=C([_("instruction"),g("nonce"),F(Wn,5,"rewardTimeInfo")]),tc=C([_("instruction"),g("rewardReopenTime"),g("rewardEndTime"),g("rewardPerSecond")]),rc=C([_("instruction"),g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),nc=C([g("state"),x("id"),x("owner"),g("deposited"),F(g(),1,"rewardDebts")]),tr=C([g("state"),x("id"),x("owner"),g("deposited"),F(ee(),1,"rewardDebts"),g(""),g("voteLockedBalance"),F(g(),15)]),ic=C([g("state"),x("id"),x("owner"),g("deposited"),F(g(),2,"rewardDebts")]),rr=C([g("state"),x("id"),x("owner"),g("deposited"),F(ee(),2,"rewardDebts"),F(g(),17)]),nr=C([g(),g("state"),x("id"),x("owner"),g("deposited"),F(ee(),5,"rewardDebts"),F(g(),16)]),oc=C([_("instruction"),g("amount")]),Un=C([x("mint"),x("grantAuthority"),g("baselineVoteWeightScaledFactor"),g("maxExtraLockupVoteWeightScaledFactor"),g("lockupSaturationSecs"),Jt("digitShift"),F(_(),7,"reserved1"),F(g(),7,"reserved2")]),ir=C([ae(8),x("governanceProgramId"),x("realm"),x("realmGoverningTokenMint"),x("realmAuthority"),F(_(),32,"reserved1"),F(Un,4,"votingMints"),De("timeOffset"),_("bump"),F(_(),7,"reserved2"),F(g(),11,"reserved3")]),qn=C([De("startTime"),De("endTime"),_("kind"),F(_(),15,"reserved")]),Gn=C([F(qn,1,"lockup"),g("amountDeposited_native"),g("amountInitiallyLockedNative"),ct("isUsed"),ct("allowClawback"),_("votingMintConfigIdx"),F(_(),29,"reserved")]),or=C([ae(8),x("voterAuthority"),x("registrar"),F(Gn,32,"deposits"),_("voterBump"),_("voterWweightRecordBump"),F(_(),94,"reserved")]);var pc=O("Raydium_farm_config"),mc=new sr("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),gc=new sr("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),ar={3:Qt,5:$t,6:er},ur={3:tr,5:rr,6:nr};var Oe={"Standard SPL":0,"Option tokens":1},hc={[Ut.toString()]:3,[qt.toString()]:5,[Gt.toString()]:6};var ye=O("Raydium.farm.util");function Cc({programId:e,poolId:t,mint:r,type:n}){let{publicKey:i}=we([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return i}function Hn({programId:e,poolId:t,owner:r,version:n}){let{publicKey:i}=we([t.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return i}var Fc=({programId:e,poolId:t})=>we([t.toBuffer()],e);function _c(e){return{isSet:new H(1),rewardPerSecond:V(e.perSecond),rewardOpenTime:V(e.openTime),rewardEndTime:V(e.endTime),rewardType:V(Oe[e.rewardType])}}function Vc(e){return V(e.endTime).sub(V(e.openTime)).mul(V(e.perSecond))}function jn(e){let t=ur[e];return t||ye.logWithError("invalid version",e),t}function Yn(e){let t=ar[e];return t||ye.logWithError("invalid version",e),t}function zn(e,t,r,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new H(r)))return e;let i=new H(r).sub(e.lastSlot);e.lastSlot=new H(r);for(let o of e.rewardInfos){if(t.amount.eq(new H(0)))continue;let s=o.perSlotReward.mul(i);o.perShareReward=o.perShareReward.add(s.mul(new H(10).pow(new H(e.version===3?9:15))).div(t.amount)),o.totalReward=o.totalReward.add(s)}}else if(e.version===6)for(let i of e.rewardInfos){if(i.rewardState.eq(new H(0)))continue;let o=H.min(new H(n),i.rewardEndTime);if(i.rewardOpenTime.gte(o))continue;let a=o.sub(i.rewardLastUpdateTime).mul(i.rewardPerSecond),c=i.totalReward.sub(i.totalRewardEmissioned);c.lt(a)?(a=c,i.rewardLastUpdateTime=i.rewardLastUpdateTime.add(c.div(i.rewardPerSecond))):i.rewardLastUpdateTime=o,!t.amount.eq(new H(0))&&(i.accRewardPerShare=i.accRewardPerShare.add(a.mul(e.rewardMultiplier).div(t.amount)),i.totalRewardEmissioned=i.totalRewardEmissioned.add(a))}return e}async function Ec({connection:e,farmPools:t,owner:r,config:n,chainTime:i}){let o=!1,s=!1,a=new H(10),c=[];for(let f of t){let m=Ee(f);m.version===6?s=!0:o=!0,c.push({pubkey:m.id,version:m.version,key:"state",poolId:m.id},{pubkey:m.lpVault,version:m.version,key:"lpVault",poolId:m.id}),r&&c.push({pubkey:Hn({programId:m.programId,poolId:m.id,owner:r,version:f.version}),version:m.version,key:"ledger",poolId:m.id})}let u={},l=await Ht(e,c,n);for(let{pubkey:f,version:m,key:T,poolId:y,accountInfo:P}of l){let S=y.toBase58();if(u[S]={...u[S]},T==="state"){let M=Yn(m);(!P||!P.data||P.data.length!==M.span)&&ye.logWithError(`invalid farm state account info, pools.id, ${f}`),u[S].state=M.decode(P.data)}else if(T==="lpVault")(!P||!P.data||P.data.length!==lt.span)&&ye.logWithError(`invalid farm lp vault account info, pools.lpVault, ${f}`),u[S].lpVault=lt.decode(P.data);else if(T==="ledger"){let M=jn(m);P&&P.data&&(P.data.length!==M.span&&ye.logWithError(`invalid farm ledger account info, ledger, ${f}`),u[S].ledger=M.decode(P.data))}}let d=s||o?await e.getSlot():0;for(let f of Object.keys(u))u[f]!==void 0&&(u[f].state=zn(u[f].state,u[f].lpVault,d,i));for(let[f,{state:m,ledger:T}]of Object.entries(u))if(T){let y=m.version===6?m.rewardMultiplier:m.rewardInfos.length===1?a.pow(new H(9)):a.pow(new H(15)),P=m.rewardInfos.map((S,M)=>{let k=T.rewardDebts[M];return T.deposited.mul(m.version===6?S.accRewardPerShare:S.perShareReward).div(y).sub(k)});u[f].wrapped={...u[f].wrapped,pendingRewards:P}}return u}function Mc(e,t=Date.now()){if(e.version===6){let r=e.state.rewardInfos;if(r.every(({rewardOpenTime:n})=>Kt(t,n.toNumber(),{unit:"s"})))return"upcoming pool";if(r.every(({rewardEndTime:n})=>Wt(t,n.toNumber(),{unit:"s"})))return"closed pool"}else{let r=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(r.length===2){if(String(r[0])==="0"&&String(r[1])!=="0")return"normal fusion pool";if(String(r[0])!=="0"&&String(r[1])!=="0")return"dual fusion pool";if(String(r[0])==="0"&&String(r[1])==="0")return"closed pool"}else if(r.length===1&&String(r[0])==="0")return"closed pool"}}async function vc(e,t,r,n){let i=await e.getAccountInfo(t);if(i===null)throw Error("registrar info check error");let s=ir.decode(i.data).votingMints.findIndex(l=>l.mint.equals(n));if(s===-1)throw Error("find voter mint error");let a=await e.getAccountInfo(r);if(a===null)return{index:s,isInit:!1};let u=or.decode(a.data).deposits.findIndex(l=>l.isUsed&&l.votingMintConfigIdx===s);return u===-1?{index:s,isInit:!1}:{index:u,isInit:!0}}export{Vc as calFarmRewardAmount,_c as farmRewardInfoToConfig,Ec as fetchMultipleFarmInfoAndUpdate,Fc as getAssociatedAuthority,Hn as getAssociatedLedgerAccount,Cc as getAssociatedLedgerPoolAccount,vc as getDepositEntryIndex,jn as getFarmLedgerLayout,Yn as getFarmStateLayout,Mc as judgeFarmType,zn as updateFarmPoolInfo};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
//# sourceMappingURL=util.mjs.map