import{PublicKey as Le}from"@solana/web3.js";import{NATIVE_MINT as yo,TOKEN_PROGRAM_ID as En}from"@solana/spl-token";import Ns from"big.js";import fn from"bn.js";import Se from"bn.js";var Tt=9e15,nt=1e9,vn="0123456789abcdef",nn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Fn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Tt,maxE:Tt,crypto:!1},_r,je,q=!0,sn="[DecimalError] ",tt=sn+"Invalid argument: ",vr=sn+"Precision limit exceeded",Fr=sn+"crypto unavailable",Or="[object Decimal]",he=Math.floor,de=Math.pow,wo=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ho=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ko=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Vr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ve=1e7,O=7,Ao=9007199254740991,To=nn.length-1,On=rn.length-1,x={toStringTag:Or};x.absoluteValue=x.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),_(r)};x.ceil=function(){return _(new this.constructor(this),this.e+1,2)};x.clampedTo=x.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(tt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};x.comparedTo=x.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};x.cosine=x.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+O,n.rounding=1,t=Po(n,Ur(n,t)),n.precision=r,n.rounding=e,_(je==2||je==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};x.cubeRoot=x.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(q=!1,o=l.s*de(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ye(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=de(t,1/3),r=he((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=re(c.plus(l).times(a),c.plus(u),s+2,1),ye(a.d).slice(0,s)===(t=ye(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(_(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(_(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return q=!0,_(n,r,m.rounding,e)};x.decimalPlaces=x.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-he(this.e/O))*O,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};x.dividedBy=x.div=function(r){return re(this,new this.constructor(r))};x.dividedToIntegerBy=x.divToInt=function(r){var e=this,t=e.constructor;return _(re(e,new t(r),0,1,1),t.precision,t.rounding)};x.equals=x.eq=function(r){return this.cmp(r)===0};x.floor=function(){return _(new this.constructor(this),this.e+1,3)};x.greaterThan=x.gt=function(r){return this.cmp(r)>0};x.greaterThanOrEqualTo=x.gte=function(r){var e=this.cmp(r);return e==1||e===0};x.hyperbolicCosine=x.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/un(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=Pt(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return _(o,s.precision=t,s.rounding=n,!0)};x.hyperbolicSine=x.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=Pt(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/un(5,r)),i=Pt(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,_(i,e,t,!0)};x.hyperbolicTangent=x.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,re(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};x.inverseCosine=x.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?_e(t,i,o):new t(0):new t(NaN):e.isZero()?_e(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=_e(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};x.inverseHyperbolicCosine=x.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,q=!1,t=t.times(t).minus(1).sqrt().plus(t),q=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};x.inverseHyperbolicSine=x.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,q=!1,t=t.times(t).plus(1).sqrt().plus(t),q=!0,n.precision=r,n.rounding=e,t.ln())};x.inverseHyperbolicTangent=x.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?_(new o(i),r,e,!0):(o.precision=t=n-i.e,i=re(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};x.inverseSine=x.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=_e(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};x.inverseTangent=x.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=On)return s=_e(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=On)return s=_e(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/O+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(q=!1,e=Math.ceil(a/O),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),q=!0,_(s,l.precision=m,l.rounding=d,!0)};x.isFinite=function(){return!!this.d};x.isInteger=x.isInt=function(){return!!this.d&&he(this.e/O)>this.d.length-2};x.isNaN=function(){return!this.s};x.isNegative=x.isNeg=function(){return this.s<0};x.isPositive=x.isPos=function(){return this.s>0};x.isZero=function(){return!!this.d&&this.d[0]===0};x.lessThan=x.lt=function(r){return this.cmp(r)<0};x.lessThanOrEqualTo=x.lte=function(r){return this.cmp(r)<1};x.logarithm=x.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(q=!1,a=m+p,s=et(c,a),n=e?on(l,a+10):et(r,a),u=re(s,n,a,1),_t(u.d,i=m,d))do if(a+=10,s=et(c,a),n=e?on(l,a+10):et(r,a),u=re(s,n,a,1),!o){+ye(u.d).slice(i+1,i+15)+1==1e14&&(u=_(u,m+1,0));break}while(_t(u.d,i+=10,d));return q=!0,_(u,m,d)};x.minus=x.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,g=p.constructor;if(r=new g(r),!p.d||!r.d)return!p.s||!r.s?r=new g(NaN):p.d?r.s=-r.s:r=new g(r.d||p.s!==r.s?p:NaN),r;if(p.s!=r.s)return r.s=-r.s,p.plus(r);if(c=p.d,d=r.d,a=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new g(p);else return new g(u===3?-0:0);return q?_(r,a,u):r}if(t=he(r.e/O),l=he(p.e/O),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/O),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=ve-1;--c[i],c[n]+=ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=an(c,t),q?_(r,a,u):r):new g(u===3?-0:0)};x.modulo=x.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?_(new n(t),n.precision,n.rounding):(q=!1,n.modulo==9?(e=re(t,r.abs(),0,3,1),e.s*=r.s):e=re(t,r,0,n.modulo,1),e=e.times(r),q=!0,t.minus(e))};x.naturalExponential=x.exp=function(){return Vn(this)};x.naturalLogarithm=x.ln=function(){return et(this)};x.negated=x.neg=function(){var r=new this.constructor(this);return r.s=-r.s,_(r)};x.plus=x.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(r=new d(m)),q?_(r,a,u):r;if(o=he(m.e/O),n=he(r.e/O),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/O),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/ve|0,c[i]%=ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=an(c,n),q?_(r,a,u):r};x.precision=x.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(tt+r);return t.d?(e=Wr(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};x.round=function(){var r=this,e=r.constructor;return _(new e(r),r.e+1,e.rounding)};x.sine=x.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+O,n.rounding=1,t=Bo(n,Ur(n,t)),n.precision=r,n.rounding=e,_(je>2?t.neg():t,r,e,!0)):new n(NaN)};x.squareRoot=x.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(q=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ye(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=he((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(re(s,o,t+2,1)).times(.5),ye(o.d).slice(0,t)===(e=ye(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(_(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(_(n,u+1,1),r=!n.times(n).eq(s));break}return q=!0,_(n,u,l.rounding,r)};x.tangent=x.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=re(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,_(je==2||je==4?t.neg():t,r,e,!0)):new n(NaN)};x.times=x.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!r.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?r.s/0:r.s*0);for(t=he(l.e/O)+he(r.e/O),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+p[n]*d[i-n-1]+e,o[i--]=a%ve|0,e=a/ve|0;o[i]=(o[i]+e)%ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=an(o,t),q?_(r,m.precision,m.rounding):r};x.toBinary=function(r,e){return Dn(this,2,r,e)};x.toDecimalPlaces=x.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Ie(r,0,nt),e===void 0?e=n.rounding:Ie(e,0,8),_(t,r+t.e+1,e))};x.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=De(n,!0):(Ie(r,0,nt),e===void 0?e=i.rounding:Ie(e,0,8),n=_(new i(n),r+1,e),t=De(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=De(i):(Ie(r,0,nt),e===void 0?e=o.rounding:Ie(e,0,8),n=_(new o(i),r+i.e+1,e),t=De(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};x.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=Wr(g)-p.e-1,s=o%O,e.d[0]=de(10,s<0?O+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(tt+a);r=a.gt(e)?o>0?e:c:a}for(q=!1,a=new f(ye(g)),l=f.precision,f.precision=o=g.length*O*2;m=re(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=re(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=p.s,d=re(c,n,o,1).minus(p).abs().cmp(re(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,q=!0,d};x.toHexadecimal=x.toHex=function(r,e){return Dn(this,16,r,e)};x.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(q=!1,t=re(t,r,0,e,1).times(r),q=!0,_(t)):(r.s=t.s,t=r),t};x.toNumber=function(){return+this};x.toOctal=function(r,e){return Dn(this,8,r,e)};x.toPower=x.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(de(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return _(a,n,o);if(e=he(r.e/O),e>=r.d.length-1&&(t=c<0?-c:c)<=Ao)return i=Dr(u,a,t,n),r.s<0?new u(1).div(i):_(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=de(+a,c),e=t==0||!isFinite(t)?he(c*(Math.log("0."+ye(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(q=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=Vn(r.times(et(a,n+t)),n),i.d&&(i=_(i,n+5,1),_t(i.d,n,o)&&(e=n+10,i=_(Vn(r.times(et(a,e+t)),e),e+5,1),+ye(i.d).slice(n+1,n+15)+1==1e14&&(i=_(i,n+1,0)))),i.s=s,q=!0,u.rounding=o,_(i,n,o))};x.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=De(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Ie(r,1,nt),e===void 0?e=i.rounding:Ie(e,0,8),n=_(new i(n),r,e),t=De(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toSignificantDigits=x.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Ie(r,1,nt),e===void 0?e=n.rounding:Ie(e,0,8)),_(new n(t),r,e)};x.toString=function(){var r=this,e=r.constructor,t=De(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};x.truncated=x.trunc=function(){return _(new this.constructor(this),this.e+1,1)};x.valueOf=x.toJSON=function(){var r=this,e=r.constructor,t=De(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function ye(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=O-n.length,t&&(o+=Je(t)),o+=n;s=r[e],n=s+"",t=O-n.length,t&&(o+=Je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(r,e,t){if(r!==~~r||r<e||r>t)throw Error(tt+r)}function _t(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=O,i=0):(i=Math.ceil((e+1)/O),e%=O),o=de(10,O-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==de(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==de(10,e-3)-1,s}function tn(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=vn.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Po(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/un(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=Pt(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var re=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,d,p,g,f,b,w,h,k,P,A,I,K,B,W,D,z,se,ne=n.constructor,ie=n.s==i.s?1:-1,H=n.d,j=i.d;if(!H||!H[0]||!j||!j[0])return new ne(!n.s||!i.s||(H?j&&H[0]==j[0]:!j)?NaN:H&&H[0]==0||!j?ie*0:ie/0);for(u?(p=1,l=n.e-i.e):(u=ve,p=O,l=he(n.e/p)-he(i.e/p)),z=j.length,W=H.length,w=new ne(ie),h=w.d=[],m=0;j[m]==(H[m]||0);m++);if(j[m]>(H[m]||0)&&l--,o==null?(I=o=ne.precision,s=ne.rounding):a?I=o+(n.e-i.e)+1:I=o,I<0)h.push(1),g=!0;else{if(I=I/p+2|0,m=0,z==1){for(d=0,j=j[0],I++;(m<W||d)&&I--;m++)K=d*u+(H[m]||0),h[m]=K/j|0,d=K%j|0;g=d||m<W}else{for(d=u/(j[0]+1)|0,d>1&&(j=r(j,d,u),H=r(H,d,u),z=j.length,W=H.length),B=z,k=H.slice(0,z),P=k.length;P<z;)k[P++]=0;se=j.slice(),se.unshift(0),D=j[0],j[1]>=u/2&&++D;do d=0,c=e(j,k,z,P),c<0?(A=k[0],z!=P&&(A=A*u+(k[1]||0)),d=A/D|0,d>1?(d>=u&&(d=u-1),f=r(j,d,u),b=f.length,P=k.length,c=e(f,k,b,P),c==1&&(d--,t(f,z<b?se:j,b,u))):(d==0&&(c=d=1),f=j.slice()),b=f.length,b<P&&f.unshift(0),t(k,f,P,u),c==-1&&(P=k.length,c=e(j,k,z,P),c<1&&(d++,t(k,z<P?se:j,P,u))),P=k.length):c===0&&(d++,k=[0]),h[m++]=d,c&&k[0]?k[P++]=H[B]||0:(k=[H[B]],P=1);while((B++<W||k[0]!==void 0)&&I--);g=k[0]!==void 0}h[0]||h.shift()}if(p==1)w.e=l,_r=g;else{for(m=1,d=h[0];d>=10;d/=10)m++;w.e=m+l*p-1,_(w,a?o+w.e+1:o,s,g)}return w}}();function _(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=O,s=e,l=m[d=0],u=l/de(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/O),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,i=1,o%=O,s=o-O+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=O,s=o-O+i,u=s<0?0:l/de(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%de(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/de(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=de(10,(O-e%O)%O),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=de(10,O-o),m[d]=s>0?(l/de(10,i-s)%de(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==ve&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=ve)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return q&&(r.e>p.maxE?(r.d=null,r.e=NaN):r.e<p.minE&&(r.e=0,r.d=[0])),r}function De(r,e,t){if(!r.isFinite())return Gr(r);var n,i=r.e,o=ye(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+Je(-i-1)+o,t&&(n=t-s)>0&&(o+=Je(n))):i>=s?(o+=Je(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+Je(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=Je(n))),o}function an(r,e){var t=r[0];for(e*=O;t>=10;t/=10)e++;return e}function on(r,e,t){if(e>To)throw q=!0,t&&(r.precision=t),Error(vr);return _(new r(nn),e,1,!0)}function _e(r,e,t){if(e>On)throw Error(vr);return _(new r(rn),e,t,!0)}function Wr(r){var e=r.length-1,t=e*O+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function Je(r){for(var e="";r--;)e+="0";return e}function Dr(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/O+4);for(q=!1;;){if(t%2&&(o=o.times(e),Er(o.d,s)&&(i=!0)),t=he(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Er(e.d,s)}return q=!0,o}function Cr(r){return r.d[r.d.length-1]&1}function qr(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function Vn(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,d=r.constructor,p=d.rounding,g=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(q=!1,u=g):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(de(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=_(o.times(r),u,1),t=t.times(++l),a=s.plus(re(o,t,u,1)),ye(a.d).slice(0,u)===ye(s.d).slice(0,u)){for(i=m;i--;)s=_(s.times(s),u,1);if(e==null)if(c<3&&_t(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return _(s,d.precision=g,p,q=!0);else return d.precision=g,s}s=a}}function et(r,e){var t,n,i,o,s,a,u,c,l,m,d,p=1,g=10,f=r,b=f.d,w=f.constructor,h=w.rounding,k=w.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new w(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(q=!1,l=k):l=e,w.precision=l+=g,t=ye(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=ye(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new w("0."+t),o++):f=new w(n+"."+t.slice(1))}else return c=on(w,l+2,k).times(o+""),f=et(new w(n+"."+t.slice(1)),l-g).plus(c),w.precision=k,e==null?_(f,k,h,q=!0):f;for(m=f,u=s=f=re(f.minus(1),f.plus(1),l,1),d=_(f.times(f),l,1),i=3;;){if(s=_(s.times(d),l,1),c=u.plus(re(s,new w(i),l,1)),ye(c.d).slice(0,l)===ye(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(on(w,l+2,k).times(o+""))),u=re(u,new w(p),l,1),e==null)if(_t(u.d,l-g,h,a))w.precision=l+=g,c=s=f=re(m.minus(1),m.plus(1),l,1),d=_(f.times(f),l,1),i=a=1;else return _(u,w.precision=k,h,q=!0);else return w.precision=k,u;u=c,i+=2}}function Gr(r){return String(r.s*r.s/0)}function Wn(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%O,t<0&&(n+=O),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=O;n<i;)r.d.push(+e.slice(n,n+=O));e=e.slice(n),n=O-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),q&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function xo(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Vr.test(e))return Wn(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(ho.test(e))t=16,e=e.toLowerCase();else if(wo.test(e))t=2;else if(ko.test(e))t=8;else throw Error(tt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Dr(n,new n(t),o,o*2)),c=tn(e,t,ve),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=an(c,l),r.d=c,q=!1,s&&(r=re(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?de(2,u):vt.pow(2,u))),q=!0,r)}function Bo(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Pt(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/un(5,t)),e=Pt(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function Pt(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/O);for(q=!1,u=t.times(t),a=new r(n);;){if(s=re(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=re(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return q=!0,s.d.length=m+1,s}function un(r,e){for(var t=r;--e;)t*=r;return t}function Ur(r,e){var t,n=e.s<0,i=_e(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return je=n?4:1,e;if(t=e.divToInt(i),t.isZero())je=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return je=Cr(t)?n?2:3:n?4:1,e;je=Cr(t)?n?1:4:n?3:2}return e.minus(i).abs()}function Dn(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor,g=t!==void 0;if(g?(Ie(t,1,nt),n===void 0?n=p.rounding:Ie(n,0,8)):(t=p.precision,n=p.rounding),!r.isFinite())l=Gr(r);else{for(l=De(r),s=l.indexOf("."),g?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=tn(De(d),10,i),d.e=d.d.length),m=tn(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(r=new p(r),r.d=m,r.e=o,r=re(r,d,t,n,0,i),m=r.d,o=r.e,c=_r),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=vn.charAt(m[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=tn(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=vn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function Er(r,e){if(r.length>e)return r.length=e,!0}function Io(r){return new this(r).abs()}function So(r){return new this(r).acos()}function Ko(r){return new this(r).acosh()}function Lo(r,e){return new this(r).plus(e)}function No(r){return new this(r).asin()}function Ro(r){return new this(r).asinh()}function Co(r){return new this(r).atan()}function Eo(r){return new this(r).atanh()}function Mo(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=_e(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?_e(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=_e(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(re(r,e,o,1)),e=_e(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(re(r,e,o,1)),t}function _o(r){return new this(r).cbrt()}function vo(r){return _(r=new this(r),r.e+1,2)}function Fo(r,e,t){return new this(r).clamp(e,t)}function Oo(r){if(!r||typeof r!="object")throw Error(sn+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,nt,"rounding",0,8,"toExpNeg",-Tt,0,"toExpPos",0,Tt,"maxE",0,Tt,"minE",-Tt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=Fn[t]),(n=r[t])!==void 0)if(he(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(tt+t+": "+n);if(t="crypto",i&&(this[t]=Fn[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Fr);else this[t]=!1;else throw Error(tt+t+": "+n);return this}function Vo(r){return new this(r).cos()}function Wo(r){return new this(r).cosh()}function Xr(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,Mr(o)){c.s=o.s,q?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;q?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Wn(c,o.toString())}else if(u!=="string")throw Error(tt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Vr.test(o)?Wn(c,o):xo(c,o)}if(i.prototype=x,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Oo,i.clone=Xr,i.isDecimal=Mr,i.abs=Io,i.acos=So,i.acosh=Ko,i.add=Lo,i.asin=No,i.asinh=Ro,i.atan=Co,i.atanh=Eo,i.atan2=Mo,i.cbrt=_o,i.ceil=vo,i.clamp=Fo,i.cos=Vo,i.cosh=Wo,i.div=Do,i.exp=qo,i.floor=Go,i.hypot=Uo,i.ln=Xo,i.log=zo,i.log10=Yo,i.log2=Ho,i.max=jo,i.min=Qo,i.mod=Zo,i.mul=$o,i.pow=Jo,i.random=es,i.round=ts,i.sign=ns,i.sin=rs,i.sinh=is,i.sqrt=os,i.sub=ss,i.sum=as,i.tan=us,i.tanh=cs,i.trunc=ls,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Do(r,e){return new this(r).div(e)}function qo(r){return new this(r).exp()}function Go(r){return _(r=new this(r),r.e+1,3)}function Uo(){var r,e,t=new this(0);for(q=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return q=!0,new this(1/0);t=e}return q=!0,t.sqrt()}function Mr(r){return r instanceof vt||r&&r.toStringTag===Or||!1}function Xo(r){return new this(r).ln()}function zo(r,e){return new this(r).log(e)}function Ho(r){return new this(r).log(2)}function Yo(r){return new this(r).log(10)}function jo(){return qr(this,arguments,"lt")}function Qo(){return qr(this,arguments,"gt")}function Zo(r,e){return new this(r).mod(e)}function $o(r,e){return new this(r).mul(e)}function Jo(r,e){return new this(r).pow(e)}function es(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Ie(r,1,nt),n=Math.ceil(r/O),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Fr);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=O,n&&r&&(i=de(10,O-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=O)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<O&&(t-=O-n)}return s.e=t,s.d=a,s}function ts(r){return _(r=new this(r),r.e+1,this.rounding)}function ns(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function rs(r){return new this(r).sin()}function is(r){return new this(r).sinh()}function os(r){return new this(r).sqrt()}function ss(r,e){return new this(r).sub(e)}function as(){var r=0,e=arguments,t=new this(e[r]);for(q=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return q=!0,_(t,this.precision,this.rounding)}function us(r){return new this(r).tan()}function cs(r){return new this(r).tanh()}function ls(r){return _(r=new this(r),r.e+1,1)}x[Symbol.for("nodejs.util.inspect.custom")]=x.toString;x[Symbol.toStringTag]="Decimal";var vt=x.constructor=Xr(Fn);nn=new vt(nn);rn=new vt(rn);var E=vt;import{PublicKey as zn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ms}from"@solana/spl-token";import{PublicKey as oe,SystemProgram as Hr,SYSVAR_RENT_PUBKEY as ds}from"@solana/web3.js";function T({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var ps=[T({pubkey:ms,isWritable:!1}),T({pubkey:Hr.programId,isWritable:!1}),T({pubkey:ds,isWritable:!1})];function qn({publicKey:r,transformSol:e}){let t=Gn(r.toString());if(t instanceof oe)return e&&t.equals(xt)?zr:t;if(e&&t.toString()===xt.toBase58())return zr;if(typeof t=="string"){if(t===oe.default.toBase58())return oe.default;try{return new oe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Gn(r){try{return new oe(r)}catch{return r}}var cn=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),du=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),rt=new oe("SysvarRent111111111111111111111111111111111"),pu=new oe("SysvarC1ock11111111111111111111111111111111"),Bt=new oe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),fs=new oe("Sysvar1nstructions1111111111111111111111111"),fu=Hr.programId,bu=new oe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),yu=new oe("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),gu=new oe("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),wu=new oe("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),hu=new oe("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ku=new oe("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Au=new oe("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Tu=new oe("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Pu=new oe("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),xu=new oe("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Bu=new oe("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),zr=new oe("So11111111111111111111111111111111111111112"),xt=oe.default;function Un(r){return qn({publicKey:r,transformSol:!0})}import{PublicKey as bs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yr}from"@solana/spl-token";var Xn={chainId:101,address:bs.default.toBase58(),programId:Yr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},it={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Yr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Hn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===xt.toBase58()||e instanceof zn&&xt.equals(e)){this.decimals=it.decimals,this.symbol=it.symbol,this.name=it.name,this.mint=new zn(it.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?zn.default:qn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ke=Hn;ke.WSOL=new Hn({...it,mint:it.address});import{get as jr,set as ys}from"lodash";import Zr from"dayjs";import gs from"dayjs/plugin/utc";Zr.extend(gs);var Yn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Zr().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Qr={},ws={};function ee(r){let e=jr(Qr,r);if(!e){let t=jr(ws,r);e=new Yn({name:r,logLevel:t}),ys(Qr,r,e)}return e}import mn from"big.js";import As from"bn.js";import Ts from"decimal.js-light";import hs from"toformat";var ks=hs,Ft=ks;var ln=ee("module/fraction"),jn=Ft(mn),Ot=Ft(Ts),Ps={[0]:Ot.ROUND_DOWN,[1]:Ot.ROUND_HALF_UP,[2]:Ot.ROUND_UP},xs={[0]:mn.roundDown,[1]:mn.roundHalfUp,[2]:mn.roundUp},$=class{constructor(e,t=new As(1)){this.numerator=J(e),this.denominator=J(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new $(this.denominator,this.numerator)}add(e){let t=e instanceof $?e:new $(J(e));return this.denominator.eq(t.denominator)?new $(this.numerator.add(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof $?e:new $(J(e));return this.denominator.eq(t.denominator)?new $(this.numerator.sub(t.numerator),this.denominator):new $(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof $?e:new $(J(e));return new $(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof $?e:new $(J(e));return new $(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||ln.logWithError(`${e} is not an integer.`),e<=0&&ln.logWithError(`${e} is not positive.`),Ot.set({precision:e+1,rounding:Ps[n]});let i=new Ot(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||ln.logWithError(`${e} is not an integer.`),e<0&&ln.logWithError(`${e} is negative.`),jn.DP=e,jn.RM=xs[n]||1,new jn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Is=ee("Raydium_price"),Me=class extends ${constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new $(Qn(n.decimals),Qn(i.decimals))}get raw(){return new $(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Is.logWithError("mul token not equals");let n=super.mul(t);return new Me({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};var Zn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},dn=Zn;dn.SOL=new Zn(Xn);import Ss from"bn.js";var $r=new $(new Ss(100)),qe=class extends ${toSignificant(e=5,t,n){return this.mul($r).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul($r).toFixed(e,t,n)}};import{PublicKey as Ks}from"@solana/web3.js";import Ls from"bn.js";function Jr(r){return typeof r=="object"&&r!==null&&![ke,ae,Ks,$,Ls,Me,qe].some(e=>typeof e=="object"&&r instanceof e)}function lt(r){return typeof r=="string"?Gn(r):Array.isArray(r)?r.map(e=>lt(e)):Jr(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,lt(t)])):r}var Vt=new Se(0),ti=new Se(1),Nc=new Se(2),Rc=new Se(3),Cc=new Se(5),$n=new Se(10),Ec=new Se(100),Mc=new Se(1e3),_c=new Se(1e4),ei=9007199254740991;function J(r){let e=ee("Raydium_parseBigNumberish");if(r instanceof Se)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Se(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=ei||r<=-ei)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Se(String(r))):typeof r=="bigint"?new Se(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Se(0))}function Qn(r){return $n.pow(J(r))}function pn(r,e){let t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}var Rs=ee("Raydium_amount"),ni=Ft(Ns);function Cs(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Rs.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var ae=class extends ${constructor(t,n,i=!0,o){let s=new fn(0),a=$n.pow(new fn(t.decimals));if(i)s=J(n);else{let u=new fn(0),c=new fn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Cs(n.toString(),t.decimals);u=J(l),c=J(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ee(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ae(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ae(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return ni.DP=this.token.decimals,new ni(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ds}from"@solana/web3.js";import si,{isBN as ai}from"bn.js";import{bits as rl,BitStructure as il,blob as Es,Blob as ol,cstr as sl,f32 as al,f32be as ul,f64 as cl,f64be as ll,greedy as ml,Layout as Ms,ns64 as dl,ns64be as pl,nu64 as fl,nu64be as bl,offset as yl,s16 as gl,s16be as wl,s24 as hl,s24be as kl,s32 as _s,s32be as Al,s40 as Tl,s40be as Pl,s48 as xl,s48be as Bl,s8 as Il,seq as vs,struct as Sl,Structure as Fs,u16 as Os,u16be as Kl,u24 as Ll,u24be as Nl,u32 as Rl,u32be as Cl,u40 as El,u40be as Ml,u48 as _l,u48be as vl,u8 as Vs,UInt as Ws,union as Fl,Union as Ol,unionLayoutDiscriminator as Vl,utf8 as Wl}from"@solana/buffer-layout";var Jn=Ms,ri=Fs;var er=Ws;var ii=Vs,It=Os;var ge=_s;var oi=vs;var Ae=Es;var mt=class extends Jn{constructor(t,n,i){super(t,i);this.blob=Ae(t),this.signed=n}decode(t,n=0){let i=new si(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new si(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function v(r){return new er(1,r)}function Ne(r){return new er(4,r)}function y(r){return new mt(8,!1,r)}function F(r){return new mt(16,!1,r)}function ui(r){return new mt(1,!0,r)}function yn(r){return new mt(8,!0,r)}function ci(r){return new mt(16,!0,r)}var bn=class extends Jn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(r){return new bn(Ae(32),e=>new Ds(e),e=>e.toBuffer(),r)}function Ke(r){return new bn(ii(),qs,Gs,r)}function qs(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Gs(r){return r?1:0}var tr=class extends ri{decode(e,t){return super.decode(e,t)}};function N(r,e,t){return new tr(r,e,t)}function V(r,e,t){let n,i=typeof e=="number"?e:ai(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ai(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return oi(r,i,t)}var em=N([Ne("mintAuthorityOption"),S("mintAuthority"),y("supply"),v("decimals"),v("isInitialized"),Ne("freezeAuthorityOption"),S("freezeAuthority")]);import{PublicKey as im}from"@solana/web3.js";import{MintLayout as sm,TOKEN_PROGRAM_ID as um}from"@solana/spl-token";var li=r=>new ke({mint:r.address,decimals:r.decimals,symbol:r.symbol,name:r.name});import{PublicKey as ce}from"@solana/web3.js";var mi=new ce("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),di=new ce("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),pi=new ce("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),wm=new ce("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),hm=new ce("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),km=new ce("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),fi=new ce("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Am=new ce("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Tm=new ce("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Pm=new ce("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),xm=new ce("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Bm=new ce("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Im=new ce("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Sm=new ce("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Km=new ce("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Lm=new ce("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Nm=new ce("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Rm=new ce("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Cm=new ce("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Em=new ce("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as js}from"@solana/web3.js";import{PublicKey as Us,ComputeBudgetProgram as bi,Transaction as gi,TransactionMessage as Xs,Keypair as wi,VersionedTransaction as hi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zs}from"@solana/spl-token";var Q={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};var yi=ee("Raydium_txUtil"),ki=1644;function gn(r){let e=[],t=[];return r.microLamports&&(e.push(bi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(Q.SetComputeUnitPrice)),r.units&&(e.push(bi.setComputeUnitLimit({units:r.units})),t.push(Q.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function St(r){var e,t;try{return((t=await((e=r.getLatestBlockhash)==null?void 0:e.call(r)))==null?void 0:t.blockhash)||(await r.getRecentBlockhash()).blockhash}catch{return(await r.getRecentBlockhash()).blockhash}}function Hs(r,e){r.length<1&&yi.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&yi.logWithError(`no signers provided:, ${e.toString()}`);let t=new gi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ki}catch{return!1}}function le(r,e){let[t,n]=Us.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Wt({instructions:r,payer:e,signers:t}){return Hs(r,[e,...t])}function Dt({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=wi.generate().publicKey.toString()}){let o=new Xs({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new hi(o).serialize()).toString("base64").length<ki}catch{return!1}}var Ys=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r);function dt(r){let e=[];return r.forEach(t=>{t instanceof gi&&(t.recentBlockhash||(t.recentBlockhash=zs.toBase58()),t.feePayer||(t.feePayer=wi.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof hi&&(n=Ys(n));let i=n.toString("base64");e.push(i)}),console.log("simulate tx string:",e),e}import{TOKEN_PROGRAM_ID as Qs}from"@solana/spl-token";function Re(r,e,t){return le([r.toBuffer(),(t!=null?t:Qs).toBuffer(),e.toBuffer()],new js("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Fe from"bn.js";var qt=1e4;function pe(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new Fe(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===qt){let u=new Fe(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=Gt(r.mul(new Fe(qt)),new Fe(qt-o.transferFeeBasisPoints)),c=new Fe(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=Gt(l.mul(new Fe(o.transferFeeBasisPoints)),new Fe(qt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Gt(r.mul(new Fe(o.transferFeeBasisPoints)),new Fe(qt)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function pt(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function Gt(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new Fe(0))?t.add(new Fe(1)):t}import{PublicKey as Ut,sendAndConfirmTransaction as or,Transaction as Xt,TransactionMessage as zt,VersionedTransaction as Ht}from"@solana/web3.js";import Js from"axios";import{PublicKey as Ai,AddressLookupTableAccount as hn}from"@solana/web3.js";import{PublicKey as Zs}from"@solana/web3.js";import{getTransferFeeConfig as Td,unpackMint as Pd}from"@solana/spl-token";function nr(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}var rr=ee("Raydium_accountInfo_util");async function ot(r,e,t){let{batchRequest:n,commitment:i="confirmed"}={batchRequest:!1,...t},o=nr(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=r._buildArgs([l.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=nr(a,10);s=(await(await Promise.all(u.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&rr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:d,executable:p,lamports:g,owner:f,rentEpoch:b}=m;return d.length!==2&&d[1]!=="base64"&&rr.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:p,lamports:g,owner:new Zs(f),rentEpoch:b}}return null})))}else try{s=await Promise.all(o.map(a=>r.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&rr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function wn(r,e,t){let n=await ot(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>({...i,accountInfo:n[o]}))}async function ir({connection:r,address:e}){let t=await ot(r,[...new Set(e.map(i=>i.toString()))].map(i=>new Ai(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new hn({key:s,state:hn.deserialize(o.data)});n[s.toString()]=a,kn[s.toString()]=a}return n}var kn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new hn({key:new Ai("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:hn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var An=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Js.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=gn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ut.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0({...t||{}}):this.build(t)}build(e){let t=new Xt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async n=>{var a;let{recentBlockHash:i,skipPreflight:o=!0}=n||{},s=i!=null?i:await St(this.connection);if(t.recentBlockhash=s,this.signers.length&&t.sign(...this.signers),dt([t]),(a=this.owner)!=null&&a.isKeyPair)return{txId:await or(this.connection,t,this.signers.find(u=>u.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:o}),signedTx:t};if(this.signAllTransactions){let u=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(u[0].serialize(),{skipPreflight:o}),signedTx:u[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(c=>c.transaction.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async c=>{var f;let{sequentially:l,onTxUpdate:m,recentBlockHash:d,skipPreflight:p=!0}=c||{},g=d!=null?d:await St(this.connection);if((f=this.owner)!=null&&f.isKeyPair)return{txIds:await await Promise.all(s.map(async(b,w)=>(b.recentBlockhash=g,await or(this.connection,b,a[w].find(h=>h.publicKey.equals(this.owner.publicKey))?a[w]:[...a[w],this.owner.signer],{skipPreflight:p})))),signedTxs:s};if(this.signAllTransactions){let b=s.map((h,k)=>(h.recentBlockhash=g,a[k].length&&h.sign(...a[k]),h));dt(b);let w=await this.signAllTransactions(b);if(l){let h=0,k=[],P=async()=>{if(!w[h])return;let A=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:p});k.push({txId:A,status:"sent",signedTx:w[h]}),m==null||m([...k]),h++,this.connection.onSignature(A,I=>{let K=k.findIndex(B=>B.txId===A);K>-1&&(k[K].status=I.err?"error":"success"),m==null||m([...k]),I.err||P()},"processed"),this.connection.getSignatureStatus(A)};return await P(),{txIds:k.map(A=>A.txId),signedTxs:w}}else{let h=[];for(let k=0;k<w.length;k+=1){let P=await this.connection.sendRawTransaction(w[k].serialize(),{skipPreflight:p});h.push(P)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){let{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,...o}=e||{},s={...this.cluster==="devnet"?{}:kn,...t},a=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let d of a)s[d]===void 0&&u.push(new Ut(d));let c=await ir({connection:this.connection,address:u});for(let[d,p]of Object.entries(c))s[d]=p;let l=new zt({payerKey:this.feePayer,recentBlockhash:i?Ut.default.toBase58():await St(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),m=new Ht(l);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async d=>{var f;let{recentBlockHash:p,skipPreflight:g=!0}=d||{};if(p&&(m.message.recentBlockhash=p),dt([m]),(f=this.owner)!=null&&f.isKeyPair){this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))||m.sign([this.owner.signer]);let b=await this.connection.sendTransaction(m,{skipPreflight:g}),{lastValidBlockHeight:w,blockhash:h}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:h,lastValidBlockHeight:w,signature:b},"confirmed"),{txId:b,signedTx:m}}if(this.signAllTransactions){let b=await this.signAllTransactions([m]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:g}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(c=>c.builder.instructions.length>0),s=[i,...o.map(c=>c.transaction)],a=[this.signers,...o.map(c=>c.signers)],u=[...this.instructionTypes,...o.map(c=>c.instructionTypes).flat()];return s.forEach(async(c,l)=>{c.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async c=>{var g;let{sequentially:l,onTxUpdate:m,recentBlockHash:d,skipPreflight:p=!0}=c||{};if(d&&s.forEach(f=>f.message.recentBlockhash=d),dt(s),(g=this.owner)!=null&&g.isKeyPair){let{lastValidBlockHeight:f,blockhash:b}=await this.connection.getLatestBlockhash();return s.forEach((w,h)=>{a[h].find(k=>k.publicKey.equals(this.owner.publicKey))||w.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async w=>{let h=await this.connection.sendTransaction(w,{skipPreflight:p});return await this.connection.confirmTransaction({blockhash:b,lastValidBlockHeight:f,signature:h},"confirmed"),h})),signedTxs:s}}if(this.signAllTransactions){let f=await this.signAllTransactions(s);if(l){let b=0,w=[],h=async()=>{if(!f[b])return;let k=await this.connection.sendTransaction(f[b],{skipPreflight:p});w.push({txId:k,status:"sent",signedTx:f[b]}),m==null||m([...w]),b++,this.connection.onSignature(k,P=>{let A=w.findIndex(I=>I.txId===k);A>-1&&(w[A].status=P.err?"error":"success"),m==null||m([...w]),P.err||h()},"processed"),this.connection.getSignatureStatus(k)};return h(),{txIds:[],signedTxs:f}}else{let b=[];for(let w=0;w<f.length;w+=1){let h=await this.connection.sendTransaction(f[w],{skipPreflight:p});b.push(h)}return{txIds:b,signedTxs:f}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){let{computeBudgetConfig:t,...n}=e||{},i=t?gn(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((c,l)=>({...c,[l.publicKey.toBase58()]:l}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(c=>{let l=[...u,c],m=t?[...i.instructions,...l]:l,p=[...new Set(l.map(g=>g.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(g=>new Ut(g));if(u.length<12&&Wt({instructions:m,payer:this.feePayer,signers:p})||Wt({instructions:l,payer:this.feePayer,signers:p}))u.push(c);else{if(u.length===0)throw Error("item ins too big");Wt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:p})?s.push(new Xt().add(...i.instructions,...u)):s.push(new Xt().add(...u)),a.push(Array.from(new Set(u.map(g=>g.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat())).map(g=>o[g]).filter(g=>g!==void 0)),u=[c]}}),u.length>0){let l=[...new Set(u.map(m=>m.keys.filter(d=>d.isSigner).map(d=>d.pubkey.toString())).flat()).values()].map(m=>o[m]).filter(m=>m!==void 0);Wt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:l.map(m=>m.publicKey)})?s.push(new Xt().add(...i.instructions,...u)):s.push(new Xt().add(...u)),a.push(l)}return s.forEach(c=>c.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async c=>{var f;let{sequentially:l,onTxUpdate:m,recentBlockHash:d,skipPreflight:p=!0}=c||{},g=d!=null?d:await St(this.connection);if(s.forEach(async(b,w)=>{b.recentBlockhash=g,a[w].length&&b.sign(...a[w])}),dt(s),(f=this.owner)!=null&&f.isKeyPair)return{txIds:await Promise.all(s.map(async(b,w)=>await or(this.connection,b,a[w].find(h=>h.publicKey.equals(this.owner.publicKey))?a[w]:[...a[w],this.owner.signer],{skipPreflight:p}))),signedTxs:s};if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(l){let w=0,h=[],k=async()=>{if(!b[w])return;let P=await this.connection.sendRawTransaction(b[w].serialize(),{skipPreflight:p});h.push({txId:P,status:"sent",signedTx:b[w]}),m==null||m([...h]),w++,this.connection.onSignature(P,A=>{let I=h.findIndex(K=>K.txId===P);I>-1&&(h[I].status=A.err?"error":"success"),m==null||m([...h]),A.err||k()},"processed"),this.connection.getSignatureStatus(P)};return await k(),{txIds:h.map(P=>P.txId),signedTxs:b}}else{let w=[];for(let h=0;h<b.length;h+=1){let k=await this.connection.sendRawTransaction(b[h].serialize(),{skipPreflight:p});w.push(k)}return{txIds:w,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:i=[],...o}=e||{},s={...this.cluster==="devnet"?{}:kn,...n},a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let b of a)s[b]===void 0&&u.push(new Ut(b));let c=await ir({connection:this.connection,address:u});for(let[b,w]of Object.entries(c))s[b]=w;let l=t?gn(t):{instructions:[],instructionTypes:[]},m=await St(this.connection),d=this.signers.reduce((b,w)=>({...b,[w.publicKey.toBase58()]:w}),{}),p=[],g=[],f=[];if(this.allInstructions.forEach(b=>{let w=[...f,b],h=t?[...l.instructions,...w]:w;if(f.length<12&&Dt({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s})||Dt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(b);else{if(f.length===0)throw Error("item ins too big");let k={};for(let P of[...new Set(a)])s[P]!==void 0&&(k[P]=s[P]);if(t&&Dt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let P=new zt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Ht(P))}else{let P=new zt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Ht(P))}g.push(Array.from(new Set(f.map(P=>P.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat())).map(P=>d[P]).filter(P=>P!==void 0)),f=[b]}}),f.length>0){let w=[...new Set(f.map(h=>h.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(h=>d[h]).filter(h=>h!==void 0);if(t&&Dt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new zt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Ht(h))}else{let h=new zt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Ht(h))}g.push(w)}return{builder:this,transactions:p,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async b=>{var A;let{sequentially:w,onTxUpdate:h,recentBlockHash:k,skipPreflight:P=!0}=b||{};if(p.map(async(I,K)=>{g[K].length&&I.sign(g[K]),k&&(I.message.recentBlockhash=k)}),dt(p),(A=this.owner)!=null&&A.isKeyPair){let{lastValidBlockHeight:I,blockhash:K}=await this.connection.getLatestBlockhash();return p.forEach((B,W)=>{g[W].find(D=>D.publicKey.equals(this.owner.publicKey))||B.sign([this.owner.signer])}),{txIds:await Promise.all(p.map(async B=>{let W=await this.connection.sendTransaction(B,{skipPreflight:P});return await this.connection.confirmTransaction({blockhash:K,lastValidBlockHeight:I,signature:W},"confirmed"),W})),signedTxs:p}}if(this.signAllTransactions){let I=await this.signAllTransactions(p);if(w){let K=0,B=[],W=async()=>{if(!I[K])return;let D=await this.connection.sendTransaction(I[K],{skipPreflight:P});B.push({txId:D,status:"sent",signedTx:I[K]}),h==null||h([...B]),K++,this.connection.onSignature(D,z=>{let se=B.findIndex(ne=>ne.txId===D);se>-1&&(B[se].status=z.err?"error":"success"),h==null||h([...B]),z.err||W()},"processed"),this.connection.getSignatureStatus(D)};return W(),{txIds:[],signedTxs:I}}else{let K=[];for(let B=0;B<I.length;B+=1){let W=await this.connection.sendTransaction(I[B],{skipPreflight:P});K.push(W)}return{txIds:K,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};var sr=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Yt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ee(t)}createTxBuilder(e){return this.scope.checkOwner(),new An({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(sr(e))}logInfo(...e){this.logger.info(sr(e))}logAndCreateError(...e){let t=sr(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{TOKEN_PROGRAM_ID as Tn,ASSOCIATED_TOKEN_PROGRAM_ID as pa}from"@solana/spl-token";import{PublicKey as Ge,TransactionInstruction as Lt,SystemProgram as Li,SYSVAR_RENT_PUBKEY as sp}from"@solana/web3.js";var ar=N([v("instruction"),y("amountIn"),y("minAmountOut")]),ur=N([v("instruction"),y("maxAmountIn"),y("amountOut")]),Qd=N([v("instruction"),v("nonce")]),ea=N([v("instruction"),v("nonce"),y("startTime")]),Zd=N([y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalValue"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),y("swapBase2QuoteFee"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),y("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),y("lpReserve"),V(y(),3,"padding")]),$d=N([y("accountType"),y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalsValue"),y("abortTradeFactor"),y("priceTickMultiplier"),y("priceTick"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),F("swapBaseInAmount"),F("swapQuoteOutAmount"),F("swapQuoteInAmount"),F("swapBaseOutAmount"),y("swapQuote2BaseFee"),y("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),V(y(),64,"padding")]),cr=N([v("instruction"),y("baseAmountIn"),y("quoteAmountIn"),y("fixedSide")]),lr=N([v("instruction"),y("amountIn")]);var Ti=N([y("fee")]);import{PublicKey as ta}from"@solana/web3.js";var Kt=new ta("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),bt=5e4,na=N([y("x"),y("y"),y("price")]),ra=N([y("accountType"),y("status"),y("multiplier"),y("validDataCount"),V(na,bt,"DataElement")]);function ia(r,e){return[0,bt-2]}function oa(r){return[0,bt-2]}function sa(r){return[0,bt-2]}function aa(r,e,t){let[n,i]=ia(e,t),o=n,s=i,a=0,u=e*r.multiplier/t;for(;o<=s;){if(a=Math.floor((s+o)/2),a===0||a>=bt-2)return[a,a,!1];let c=r.DataElement[a].x*r.multiplier/r.DataElement[a].y,l=r.DataElement[a-1].x*r.multiplier/r.DataElement[a-1].y,m=r.DataElement[a+1].x*r.multiplier/r.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===l)return[a-1,a-1,!0];if(u===m)return[a+1,a+1,!0];if(u<l)s=a-1;else{if(u>l&&u<c)return[a-1,a,!0];if(u>c&&u<m)return[a,a+1,!0];o=a+1}}return[a,a,!1]}function mr(r,e,t){let[n,i,o]=aa(r,e,t);if(!o)return 0;if(n===i){let s=r.DataElement[n].x;return e*r.multiplier/s}else{let s=r.DataElement[n].x,a=r.DataElement[n].y,u=r.DataElement[i].x,c=r.DataElement[i].y,l=t*(u*a-s*c),m=s*l,d=(u-s)*(e*a-s*t)*c,p=m+d;return e*r.multiplier*l/p}}function ft(r,e,t){return e*r.multiplier/t}function Pi(r,e,t){return e*t/r.multiplier}function ua(r,e){let[t,n]=oa(e),i=t,o=n,s=0,a=e;for(;i<o;){if(s=Math.floor((o+i)/2),s<=0||s>bt-2)return[s,s,!1];let u=r.DataElement[s].x,c=r.DataElement[s-1].x,l=r.DataElement[s+1].x;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<c)o=s-1;else{if(a>c&&a<u)return[s-1,s,!0];if(a>u&&a<l)return[s,s+1,!0];i=s+1}}return[s,s,!1]}function ca(r,e){let[t,n]=sa(e),i=t,o=n,s=0,a=e;for(;i<=o;){if(s=Math.floor((o+i)/2),s<=0||s>=bt-2)return[s,s,!1];let u=r.DataElement[s].y,c=r.DataElement[s-1].y,l=r.DataElement[s+1].y;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<l)i=s+1;else{if(a<c&&a>u)return[s-1,s,!0];if(a<u&&a>l)return[s,s+1,!0];o=s-1}}return[s,s,!1]}function xi(r,e,t,n){let i=n?e+t:e-t,[o,s,a]=ua(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].y,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=u&&e<=c)return n?[m,p,!0,a]:[l,d,!0,a];{let g,f;return n?(g=l+(m-l)*(e-u)/(c-u),f=d-(i-u)*r.multiplier/m):(g=l+(m-l)*(e-u)/(c-u),f=p+(c-i)*r.multiplier/l),[g,f,!1,a]}}}function la(r,e,t,n){let i=n?e-t:e+t,[o,s,a]=ca(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].x,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=p&&e<=d)return n?[m,c,!0,a]:[l,u,!0,a];{let g,f;return n?(g=l+(m-l)*(d-e)/(d-p),f=u+m*(d-i)/r.multiplier):(g=l+(m-l)*(d-e)/(d-p),f=c-l*(i-p)/r.multiplier),[g,f,!1,a]}}}function ma(r,e){let t=xi(r,e,0,!1);return t[3]?t[0]:0}function Bi(r,e,t,n){let i=mr(r,e,t),o=ft(r,e,i),s=ft(r,t,i),a=ft(r,n,i),u=!0,[c,l,m,d]=xi(r,o,a,u);if(!d)return 0;if(m)return n*r.multiplier/c;{let p=s-l;return Pi(r,p,i)}}function Ii(r,e,t,n){let i=mr(r,e,t),o=ft(r,e,i),s=ft(r,t,i),a=ft(r,n,i),u=!1,[c,l,m,d]=la(r,s,a,u);if(!d)return 0;if(m)return n*c/r.multiplier;{let p=o-l;return Pi(r,p,i)}}function da(r){let e=ra.decode(r);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function Si(r,e,t,n){let i=ma(r,ft(r,e,mr(r,e,t)))/r.multiplier;return n?i:1/i}var jt=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(Kt);e&&(this._layoutData=da(e==null?void 0:e.data))}}};var Ki=ee("Raydium_liquidity_instruction");function Ni(r){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:o,fixedSide:s}=r,a=Buffer.alloc(cr.span);cr.encode({instruction:3,baseAmountIn:J(i),quoteAmountIn:J(o),fixedSide:s==="base"?Vt:ti},a);let u=[T({pubkey:Tn,isWritable:!1}),T({pubkey:new Ge(e.id)}),T({pubkey:new Ge(t.authority),isWritable:!1}),T({pubkey:new Ge(t.openOrders),isWritable:!1}),T({pubkey:new Ge(t.targetOrders)}),T({pubkey:new Ge(e.lpMint.address)}),T({pubkey:new Ge(t.vault.A)}),T({pubkey:new Ge(t.vault.B)})];return e.pooltype.includes("StablePool")&&u.push(T({pubkey:Kt})),u.push(T({pubkey:new Ge(e.marketId),isWritable:!1}),T({pubkey:n.baseTokenAccount}),T({pubkey:n.quoteTokenAccount}),T({pubkey:n.lpTokenAccount}),T({pubkey:n.owner,isWritable:!1,isSigner:!0}),T({pubkey:new Ge(t.marketEventQueue),isWritable:!1})),new Lt({programId:new Ge(e.programId),keys:u,data:a})}function dr(r){let{poolInfo:e,poolKeys:t,userKeys:n,amountIn:i}=r,o=lt(t),s=4;if(e.pooltype.includes("StablePool")&&(s=5),s===4||s===5){let a=Buffer.alloc(lr.span);lr.encode({instruction:4,amountIn:J(i)},a);let u=[T({pubkey:Tn,isWritable:!1}),T({pubkey:o.id}),T({pubkey:o.authority,isWritable:!1}),T({pubkey:o.openOrders}),T({pubkey:o.targetOrders}),T({pubkey:o.mintLp.address}),T({pubkey:o.vault.A}),T({pubkey:o.vault.B})];return s===5?u.push(T({pubkey:Kt})):(u.push(T({pubkey:o.id})),u.push(T({pubkey:o.id}))),u.push(T({pubkey:o.marketProgramId,isWritable:!1}),T({pubkey:o.marketId}),T({pubkey:o.marketBaseVault}),T({pubkey:o.marketQuoteVault}),T({pubkey:o.marketAuthority,isWritable:!1}),T({pubkey:n.lpTokenAccount}),T({pubkey:n.baseTokenAccount}),T({pubkey:n.quoteTokenAccount}),T({pubkey:n.owner,isWritable:!1,isSigner:!0}),T({pubkey:o.marketEventQueue}),T({pubkey:o.marketBids}),T({pubkey:o.marketAsks})),new Lt({programId:o.programId,keys:u,data:a})}return new Lt({programId:o.programId,keys:[]})}function Ri({programId:r,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:i,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:d,marketId:p,userWallet:g,userCoinVault:f,userPcVault:b,userLpVault:w,nonce:h,openTime:k,coinAmount:P,pcAmount:A,ammConfigId:I,feeDestinationId:K}){let B=N([v("instruction"),v("nonce"),y("openTime"),y("pcAmount"),y("coinAmount")]),W=[{pubkey:Tn,isSigner:!1,isWritable:!1},{pubkey:pa,isSigner:!1,isWritable:!1},{pubkey:Li.programId,isSigner:!1,isWritable:!1},{pubkey:rt,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!1},{pubkey:K,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0}],D=Buffer.alloc(B.span);return B.encode({instruction:1,nonce:h,openTime:k,coinAmount:P,pcAmount:A},D),{instruction:new Lt({keys:W,programId:r,data:D}),instructionType:Q.AmmV4CreatePool}}function fa({poolKeys:r,userKeys:e,amountIn:t,minAmountOut:n},i){let o=lt(r),s=Buffer.alloc(ar.span);ar.encode({instruction:9,amountIn:J(t),minAmountOut:J(n)},s);let a=[T({pubkey:Tn,isWritable:!1}),T({pubkey:o.id}),T({pubkey:o.authority,isWritable:!1}),T({pubkey:o.openOrders})];return i===4&&a.push(T({pubkey:o.targetOrders})),a.push(T({pubkey:o.vault.A}),T({pubkey:o.vault.B})),i===5&&a.push(T({pubkey:Kt})),a.push(T({pubkey:o.marketProgramId,isWritable:!1}),T({pubkey:o.marketId}),T({pubkey:o.marketBids}),T({pubkey:o.marketAsks}),T({pubkey:o.marketEventQueue}),T({pubkey:o.marketBaseVault}),T({pubkey:o.marketQuoteVault}),T({pubkey:o.marketAuthority,isWritable:!1}),T({pubkey:e.tokenAccountIn}),T({pubkey:e.tokenAccountOut}),T({pubkey:e.owner,isWritable:!1})),new Lt({programId:o.programId,keys:a,data:s})}function ba({poolKeys:r,userKeys:e,maxAmountIn:t,amountOut:n},i){let o=lt(r),s=Buffer.alloc(ur.span);ur.encode({instruction:11,maxAmountIn:J(t),amountOut:J(n)},s);let a=[T({pubkey:Li.programId,isWritable:!1}),T({pubkey:o.id}),T({pubkey:o.authority,isWritable:!1}),T({pubkey:o.openOrders}),T({pubkey:o.targetOrders}),T({pubkey:o.vault.A}),T({pubkey:o.vault.B})];return i===5&&a.push(T({pubkey:Kt})),a.push(T({pubkey:o.marketProgramId,isWritable:!1}),T({pubkey:o.marketId}),T({pubkey:o.marketBids}),T({pubkey:o.marketAsks}),T({pubkey:o.marketEventQueue}),T({pubkey:o.marketBaseVault}),T({pubkey:o.marketQuoteVault}),T({pubkey:o.marketAuthority,isWritable:!1}),T({pubkey:e.tokenAccountIn}),T({pubkey:e.tokenAccountOut}),T({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Lt({programId:o.programId,keys:a,data:s})}function Ci(r){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:o,fixedSide:s}=r;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return fa({...a,amountIn:i,minAmountOut:o},t);if(s==="out")return ba({...a,maxAmountIn:i,amountOut:o},t);Ki.logWithError("invalid params","params",r)}throw Ki.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{TOKEN_PROGRAM_ID as we,TOKEN_2022_PROGRAM_ID as ct,ASSOCIATED_TOKEN_PROGRAM_ID as eo}from"@solana/spl-token";import{PublicKey as L,TransactionInstruction as Ve,SystemProgram as Ct,Keypair as Br}from"@solana/web3.js";import to from"bn.js";import xa from"bn.js";function Pn(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function pr(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function fr(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function Qt(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function Ei(r,e){return Qt(r,e)?null:pr(r,e)}function Mi(r,e){return Qt(r,e)?null:fr(r,e)}var kp=Buffer.from("amm_config","utf8"),ya=Buffer.from("pool","utf8"),ga=Buffer.from("pool_vault","utf8"),wa=Buffer.from("pool_reward_vault","utf8"),_i=Buffer.from("position","utf8"),ha=Buffer.from("tick_array","utf8"),ka=Buffer.from("operation","utf8"),Aa=Buffer.from("pool_tick_array_bitmap_extension","utf8");function vi(r,e,t,n){return le([ya,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function br(r,e,t){return le([ga,e.toBuffer(),t.toBuffer()],r)}function Fi(r,e,t){return le([wa,e.toBuffer(),t.toBuffer()],r)}function te(r,e,t){return le([ha,e.toBuffer(),Pn(t)],r)}function yt(r,e,t,n){return le([_i,e.toBuffer(),Pn(t),Pn(n)],r)}function Ue(r,e){return le([_i,e.toBuffer()],r)}function xn(r){return le([Buffer.from("metadata","utf8"),Bt.toBuffer(),r.toBuffer()],Bt)}function yr(r){return le([ka],r)}function Xe(r,e){return le([Aa,e.toBuffer()],r)}import ze from"bn.js";var me=new ze(0),He=new ze(1),Qe=new ze(-1),Ce=new ze(1).shln(64),Bn=new ze(1).shln(128),gr=Ce.sub(He),Zt=64,Oi=Bn.subn(1),Te=-443636,Be=-Te,Nt=new ze("4295048016"),Rt=new ze("79226673521066979257578248091"),Vi=16,Wi="59543866431248",Di="184467440737095516",qi="15793534762490258745",In=new ze(10).pow(new ze(6));var Pp=new ze("18446744073700000000");var Ta=15,Y=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=M.getTickArrayStartIndexByTick(i,o),l=M.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Ta/2));for(let p=0;p<l.length;p++){let{publicKey:g}=te(t,n,l[p]);u.push(g)}let m=(await ot(e,u)).map(p=>p!==null?$t.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let g=m[p];g!==null&&(d[g.startTickIndex]={...g,address:u[p]})}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=M.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/Y.tickCount(t)),a=n?M.searchLowBitFromStart(i,o,s-1,1,t):M.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=fe-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<fe;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=te(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=M.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<fe;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=te(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(M.checkIsOutOfBoundary(e)){if(e>Be)return!1;let n=M.getTickArrayStartIndexByTick(Te,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return fe*e}};import X from"bn.js";import{PublicKey as st}from"@solana/web3.js";import ue from"bn.js";var wr=14,Ze=class{static maxTickInTickarrayBitmap(e){return e*fe*gt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!Y.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-Y.tickCount(n):t+Y.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*fe,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=Ei(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Mi(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Y.tickCount(n)}}}},Jt=class{static getBitmapOffset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Ze.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;if(Be<=t)throw Error(`extensionTickBoundary check error: ${Be}, ${t}`);if(n<=Te)throw Error(`extensionTickBoundary check error: ${n}, ${Te}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:M.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=Y.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=Ze.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=M.mergeTickArrayBitmap(e).shln(gt-1-a),c=Qt(512,u)?null:pr(512,u);if(c!==null){let l=t-c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=M.mergeTickArrayBitmap(e).shrn(a),c=Qt(512,u)?null:fr(512,u);if(c!==null){let l=t+c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-Y.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Ze.maxTickInTickarrayBitmap(t),i=Math.floor(n/Y.tickCount(t));return e<0&&n!=0&&(i=gt-i),i}};import Ye from"bn.js";var en=class{static getfeeGrowthInside(e,t,n){let i=new Ye(0),o=new Ye(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ye(0),a=new Ye(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ce),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ce),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=G.wrappingSubU128(u,c.growthInsideLastX64),m=G.mulDivFloor(l,t.liquidity,Ce),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=G.wrappingSubU128(u,c.growthInsideLastX64),m=G.mulDivFloor(l,t.liquidity,Ce),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var b,w,h,k;let a=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),u=U.getSqrtPriceX64FromTick(t.tickLower),c=U.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=Z.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[pe(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),pe(m.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)],[g,f]=[pe(new Ye(new E(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),pe(new Ye(new E(m.amountB.toString()).mul(l).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:pt(d.expirationTime,p.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as Gi}from"@solana/spl-token";var Pe=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintA.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=wt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o);return a.push(...d),{expectedAmountOut:m.mul(Qe),remainingAccounts:a,executionPrice:p,feeAmount:g}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=te(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=wt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Qe),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=Pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Jt.checkTickArrayIsInit(Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):M.checkTickArrayIsInitialized(M.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=te(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=te(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Y.tickCount(e.tickSpacing)),i=t?M.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):M.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=Ze.nextInitializedTickArrayStartIndex(M.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Jt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Te||t>Be)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p={...m,perSecond:G.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new st(d)};if(p.tokenMint.equals(st.default))continue;if(n<=p.openTime.toNumber()||i.eq(me)){s.push(p);continue}let g=new ue(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),b=G.mulDivFloor(f,p.emissionsPerSecondX64,i),w=p.rewardGrowthGlobalX64.add(b),h=G.mulDivFloor(f,p.emissionsPerSecondX64,Ce),k=p.rewardTotalEmissioned.add(h);s.push({...p,rewardGrowthGlobalX64:w,rewardTotalEmissioned:k,lastUpdateTime:g})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=M.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;return t>Be&&(t=Y.getArrayStartIndex(Be,e)+Y.tickCount(e)),n<Te&&(n=Y.getArrayStartIndex(Te,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Y.tickCount(t)*gt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await wn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=zi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=M.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=M.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=te(u.programId,u.id,m);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await wn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=$t.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Ue(p,d).publicKey);let l=await ot(t,c,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let p=Xi.decode(d.data),g=p.poolId.toString(),f=e.find(B=>B.state.id.toBase58()===g);if(f===void 0)continue;let b=f.state,w=M._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),h=M._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:k,amountB:P}=Z.getAmountsFromLiquidity(b.sqrtPriceX64,w.tickSqrtPriceX64,h.tickSqrtPriceX64,p.liquidity,!1),A=1/(1-Math.sqrt(Math.sqrt(w.price.div(h.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:w.price,priceUpper:h.price,amountA:k,amountB:P,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(B=>({...B,pendingReward:new ue(0)})),leverage:A,tokenFeeAmountA:new ue(0),tokenFeeAmountB:new ue(0)}];let I=await M.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),K=await M.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=I,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=K}if(o){let d=Object.values(m),p=await ot(t,d,{batchRequest:i}),g={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let w=d[f].toString();g[w]=$t.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let w of b){let h=`${f.programId.toString()}-${f.id.toString()}-${w.tickLower}`,k=`${f.programId.toString()}-${f.id.toString()}-${w.tickUpper}`,P=g[m[h].toString()],A=g[m[k].toString()],I=P.ticks[M.getTickOffsetInArray(w.tickLower,f.tickSpacing)],K=A.ticks[M.getTickOffsetInArray(w.tickUpper,f.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:W}=await en.GetPositionFees(f,w,I,K),D=await en.GetPositionRewards(f,w,I,K);w.tokenFeeAmountA=B.gte(new ue(0))?B:new ue(0),w.tokenFeeAmountB=W.gte(new ue(0))?W:new ue(0);for(let z=0;z<D.length;z++)w.rewardInfos[z].pendingReward=D[z].gte(new ue(0))?D[z]:new ue(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new E(0)}){var D;let u,c=n.toBase58()===e.mintA.address,[l,m]=c?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new E(0))?u=c?Nt.add(new ue(1)):Rt.sub(new ue(1)):u=U.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=pe(o,l,i,!1),{expectedAmountOut:p,remainingAccounts:g,executionPrice:f,feeAmount:b}=Pe.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((D=d.fee)!=null?D:me),u),w=pe(p,m,i,!1),h=U.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),k=c?h:new E(1).div(h),P=p.mul(new ue(Math.floor((1-s)*1e10))).div(new ue(1e10)),A=pe(P,m,i,!1),I=c?e.currentPrice:new E(1).div(e.currentPrice),K=new E(k).sub(I).abs(),B=I,W=new qe(new E(K).mul(10**15).toFixed(0),new E(B).mul(10**15).toFixed(0));return{realAmountIn:d,amountOut:w,minAmountOut:A,expirationTime:pt(d.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:k,priceImpact:W,fee:b,remainingAccounts:g}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s}){let a=i.address===e.mintB.address,[u,c]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,m]=[new ke({...u,mint:u.address,isToken2022:u.programId===Gi.toBase58()}),new ke({...c,mint:c.address,isToken2022:c.programId===Gi.toBase58()})],{realAmountIn:d,amountOut:p,minAmountOut:g,expirationTime:f,currentPrice:b,executionPrice:w,priceImpact:h,fee:k,remainingAccounts:P}=await Pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new st(u.address),amountIn:n,slippage:o,epochInfo:s}),A={...d,amount:new ae(l,d.amount),fee:d.fee===void 0?void 0:new ae(l,d.fee)},I={...p,amount:new ae(m,p.amount),fee:p.fee===void 0?void 0:new ae(m,p.fee)},K={...g,amount:new ae(m,g.amount),fee:g.fee===void 0?void 0:new ae(m,g.fee)},B=new Me({baseToken:l,denominator:new ue(10).pow(new ue(20+l.decimals)),quoteToken:m,numerator:b.mul(new E(10**(20+m.decimals))).toFixed(0)}),W=new Me({baseToken:l,denominator:new ue(10).pow(new ue(20+l.decimals)),quoteToken:m,numerator:w.mul(new E(10**(20+m.decimals))).toFixed(0)}),D=new ae(l,k);return{realAmountIn:A,amountOut:I,minAmountOut:K,expirationTime:f,currentPrice:B,executionPrice:W,priceImpact:h,fee:D,remainingAccounts:P}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var g,f,b;let o=e[t],s=M.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=M.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[(g=o.rewardApr[0])!=null?g:0*p,(f=o.rewardApr[1])!=null?f:0*p,(b=o.rewardApr[2])!=null?b:0*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[Un(e.mintA.address).toString()],d=i[Un(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),b=U.getSqrtPriceX64FromTick(s),w=U.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:k}=Z.getAmountsFromLiquidityWithSlippage(f,b,w,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:A}=Z.getAmountsFromLiquidityWithSlippage(f,b,w,o,!1,!1,0),I=new E(h.toString()).div(new E(10).pow(p)).mul(m.value).add(new E(k.toString()).div(new E(10).pow(g)).mul(d.value)),K=new E(P.toString()).div(new E(10).pow(p)).mul(m.value).add(new E(A.toString()).div(new E(10).pow(g)).mul(d.value)),B=K.div(I.add(K)).div(K),D=new E(l.volumeFee).mul(365).div(c).mul(B).mul(100).toNumber(),z=3600*24*365,se=e.rewardDefaultInfos.map(ne=>{var j,$e;let ie=ne.mint.decimals,H=i[ne.mint.address];return u<((j=ne.startTime)!=null?j:0)||u>(($e=ne.endTime)!=null?$e:0)||!ne.perSecond||!H||ie===void 0?0:new E(H.value).mul(new E(ne.perSecond).mul(z)).div(new E(10).pow(ie)).mul(B).mul(100).toNumber()});return{feeApr:D,rewardsApr:se,apr:D+se.reduce((ne,ie)=>ne+ie,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var w,h;let l=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),m=U.getSqrtPriceX64FromTick(n),d=U.getSqrtPriceX64FromTick(i),p=a?1-s:1+s,g=pe(o,(w=e[t?"mintA":"mintB"].extensions)==null?void 0:w.feeConfig,u,!c),f=new ue(new E(g.amount.sub((h=g.fee)!=null?h:me).toString()).mul(p).toFixed(0)),b;if(l.lte(m))b=t?Z.getLiquidityFromTokenAmountA(m,d,f,!a):new ue(0);else if(l.lte(d)){let k=Z.getLiquidityFromTokenAmountA(l,d,f,!a),P=Z.getLiquidityFromTokenAmountB(m,l,f);b=t?k:P}else b=t?new ue(0):Z.getLiquidityFromTokenAmountB(m,d,f);return Pe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var b,w,h,k;let u=U.getSqrtPriceX64FromTick(n),c=U.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=Z.getAmountsFromLiquidity(U.priceToSqrtPriceX64(new E(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[pe(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),pe(m.amountB,(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)],[g,f]=[pe(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),pe(m.amountB.muln(l),(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:pt(d.expirationTime,p.expirationTime)}}static async fetchComputeClmmInfo({owner:e,connection:t,poolInfo:n}){let i=await t.getAccountInfo(new st(n.id));if(!i)throw new Error(`pool not found ${n.id}`);let o=Ui.decode(i.data),s=Xe(e,new st(n.id)).publicKey,a=await Pe.fetchExBitmaps({connection:t,exBitmapAddress:[s],batchRequest:!1});return{...o,id:new st(n.id),programId:new st(n.programId),mintA:n.mintA,mintB:n.mintB,ammConfig:{...n.config,id:new st(n.config.id),fundOwner:""},currentPrice:new E(n.price),exBitmapInfo:a[s.toBase58()],startTime:o.startTime.toNumber()}}};var G=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(me)||(o=o.add(He)),o}static mulDivFloor(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).add(n.sub(He)).div(n)}static x64ToDecimal(e,t){return new E(e.toString()).div(E.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new X(e.mul(E.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Bn).sub(t).mod(Bn)}};function be(r,e){return hr(r.mul(e),64,256)}function Pa(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function hr(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var U=class{static sqrtPriceX64ToPrice(e,t,n){return G.x64ToDecimal(e).pow(2).mul(E.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return G.decimalToX64(e.mul(E.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(me))return e;let o=t.shln(Zt);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?G.mulDivCeil(s,e,a):G.mulDivRoundingUp(s,He,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return G.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(Zt);if(i)return e.add(o.div(t));{let s=G.mulDivRoundingUp(o,He,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Te||e>Be)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new X("18445821805675395072"):new X("18446744073709551616");return(t&2)!=0&&(n=be(n,new X("18444899583751176192"))),(t&4)!=0&&(n=be(n,new X("18443055278223355904"))),(t&8)!=0&&(n=be(n,new X("18439367220385607680"))),(t&16)!=0&&(n=be(n,new X("18431993317065453568"))),(t&32)!=0&&(n=be(n,new X("18417254355718170624"))),(t&64)!=0&&(n=be(n,new X("18387811781193609216"))),(t&128)!=0&&(n=be(n,new X("18329067761203558400"))),(t&256)!=0&&(n=be(n,new X("18212142134806163456"))),(t&512)!=0&&(n=be(n,new X("17980523815641700352"))),(t&1024)!=0&&(n=be(n,new X("17526086738831433728"))),(t&2048)!=0&&(n=be(n,new X("16651378430235570176"))),(t&4096)!=0&&(n=be(n,new X("15030750278694412288"))),(t&8192)!=0&&(n=be(n,new X("12247334978884435968"))),(t&16384)!=0&&(n=be(n,new X("8131365268886854656"))),(t&32768)!=0&&(n=be(n,new X("3584323654725218816"))),(t&65536)!=0&&(n=be(n,new X("696457651848324352"))),(t&131072)!=0&&(n=be(n,new X("26294789957507116"))),(t&262144)!=0&&(n=be(n,new X("37481735321082"))),e>0&&(n=Oi.div(n)),n}static getTickFromPrice(e,t,n){return U.getTickFromSqrtPriceX64(U.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Rt)||e.lt(Nt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new X(t-64),i=Pa(n,32,128),o=new X("8000000000000000","hex"),s=0,a=new X(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new X(0))&&s<Vi;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new X(Wi)),d=hr(m.sub(new X(Di)),64,128).toNumber(),p=hr(m.add(new X(qi)),64,128).toNumber();return d==p?d:U.getSqrtPriceX64FromTick(p).lte(e)?p:d}},ht=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=U.getTickFromSqrtPriceX64(U.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=ht.getTickWithPriceAndTickspacing(e,t,n,i),s=U.getSqrtPriceX64FromTick(o);return U.sqrtPriceX64ToPrice(s,n,i)}},Z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Zt),s=t.sub(e);return i?G.mulDivRoundingUp(G.mulDivCeil(o,s,t),He,e):G.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");return i?G.mulDivCeil(n,t.sub(e),Ce):G.mulDivFloor(n,t.sub(e),Ce)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?G.mulDivRoundingUp(a,He,gr):a.shrn(Zt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),G.mulDivFloor(n,gr,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Z.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=Z.getLiquidityFromTokenAmountA(e,n,i,!1),a=Z.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Z.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Z.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new X(0)};if(e.lt(n)){let s=Z.getTokenAmountAFromLiquidity(e,n,i,o),a=Z.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new X(0),amountB:Z.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=Z.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new X(new E(u.toString()).mul(l).toFixed(0)),d=new X(new E(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var h,k,P,A;let c=U.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),l=U.getSqrtPriceX64FromTick(t),m=U.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Z.getAmountsFromLiquidity(c,l,m,i,s),[g,f]=[pe(p.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),pe(p.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,u)],[b,w]=[pe(new X(new E(p.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),pe(new X(new E(p.amountB.toString()).mul(d).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,u)];return{liquidity:i,amountA:g,amountB:f,amountSlippageA:b,amountSlippageB:w,expirationTime:pt(g.expirationTime,f.expirationTime)}}},wt=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,d,p,g){if(d.eq(me))throw new Error("amountSpecified must not be 0");if(g||(g=s?Nt.add(He):Rt.sub(He)),s){if(g.lt(Nt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(Rt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=d.gt(me),b={amountSpecifiedRemaining:d,amountCalculated:me,sqrtPriceX64:m,tick:c>p?Math.min(p+Y.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new X(0)},w=p,h=n[p],k=0,P=!s&&h.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(me)&&!b.sqrtPriceX64.eq(g);){if(k>10)throw Error("liquidity limit");let A={};A.sqrtPriceStartX64=b.sqrtPriceX64;let I=M.nextInitTick(h,b.tick,l,s,P),K=I||null,B=null;if(!(K!=null&&K.liquidityGross.gtn(0))){let D=Pe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},w,s);if(!D.isExist)throw Error("swapCompute LiquidityInsufficient");w=D.nextStartIndex;let{publicKey:z}=te(e,t,w);B=z,h=n[w],K=M.firstInitializedTick(h,s)}A.tickNext=K.tick,A.initialized=K.liquidityGross.gtn(0),p!==w&&B&&(b.accounts.push(B),p=w),A.tickNext<Te?A.tickNext=Te:A.tickNext>Be&&(A.tickNext=Be),A.sqrtPriceNextX64=U.getSqrtPriceX64FromTick(A.tickNext);let W;if(s&&A.sqrtPriceNextX64.lt(g)||!s&&A.sqrtPriceNextX64.gt(g)?W=g:W=A.sqrtPriceNextX64,[b.sqrtPriceX64,A.amountIn,A.amountOut,A.feeAmount]=wt.swapStepCompute(b.sqrtPriceX64,W,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(A.feeAmount),f?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(A.amountIn.add(A.feeAmount)),b.amountCalculated=b.amountCalculated.sub(A.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(A.amountOut),b.amountCalculated=b.amountCalculated.add(A.amountIn.add(A.feeAmount))),b.sqrtPriceX64.eq(A.sqrtPriceNextX64)){if(A.initialized){let D=K.liquidityNet;s&&(D=D.mul(Qe)),b.liquidity=Z.addDelta(b.liquidity,D)}P=A.tickNext!=b.tick&&!s&&h.startTickIndex===A.tickNext,b.tick=s?A.tickNext-1:A.tickNext}else if(b.sqrtPriceX64!=A.sqrtPriceStartX64){let D=U.getTickFromSqrtPriceX64(b.sqrtPriceX64);P=D!=b.tick&&!s&&h.startTickIndex===D,b.tick=D}++k}try{let{nextStartIndex:A,isExist:I}=Y.nextInitializedTickArray(b.tick,l,s,i,o);I&&p!==A&&(b.accounts.push(te(e,t,A).publicKey),p=A)}catch{}return{amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new X(0),amountIn:new X(0),amountOut:new X(0),feeAmount:new X(0)},a=e.gte(t),u=i.gte(me);if(u){let l=G.mulDivFloor(i,In.sub(new X(o.toString())),In);s.amountIn=a?Z.getTokenAmountAFromLiquidity(t,e,n,!0):Z.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=U.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Z.getTokenAmountBFromLiquidity(t,e,n,!1):Z.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Qe).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=U.getNextSqrtPriceX64FromOutput(e,n,i.mul(Qe),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Z.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Z.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Z.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Z.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(Qe))&&(s.amountOut=i.mul(Qe)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=G.mulDivCeil(s.amountIn,new X(o),In.sub(new X(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var fe=60,gt=512,M=class{static getTickArrayAddressByTick(e,t,n,i){let o=M.getTickArrayStartIndexByTick(n,i),{publicKey:s}=te(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=M.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=fe)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=Y.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Y.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*fe,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*fe,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*fe:e+t*fe}static mergeTickArrayBitmap(e){let t=new xa(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*fe));return[...M.searchLowBitFromStart(e,t,s-1,o,n),...M.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return M.searchHightBitFromStart(e,t,0,gt,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=M.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=te(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>M.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>M.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Te||e>Be}static nextInitTick(e,t,n,i,o){if(Y.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<fe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=fe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<fe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=U.getSqrtPriceX64FromTick(t),o=U.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new E(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new E(1).div(t),o=ht.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=U.getSqrtPriceX64FromTick(o),a=U.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new E(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=U.getSqrtPriceX64FromTick(t),o=U.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new E(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new E(1).div(t),o=ht.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=U.getSqrtPriceX64FromTick(o),a=U.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new E(1).div(a)}}};var Cf=N([Ae(8),v("bump"),It("index"),S(""),Ne("protocolFeeRate"),Ne("tradeFeeRate"),It("tickSpacing"),V(y(),8,"")]),Ba=N([Ne("blockTimestamp"),F("sqrtPriceX64"),F("cumulativeTimePriceX64"),V(F(),1,"")]),kr=N([Ae(8),Ke("initialized"),S("poolId"),V(Ba,1e3,"observations"),V(F(),5,"")]),Ia=N([v("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),F("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),F("rewardGrowthGlobalX64")]),Ui=N([Ae(8),v("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),v("mintDecimalsA"),v("mintDecimalsB"),It("tickSpacing"),F("liquidity"),F("sqrtPriceX64"),ge("tickCurrent"),It("observationIndex"),It("observationUpdateDuration"),F("feeGrowthGlobalX64A"),F("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),F("swapInAmountTokenA"),F("swapOutAmountTokenB"),F("swapInAmountTokenB"),F("swapOutAmountTokenA"),v("status"),V(v(),7,""),V(Ia,3,"rewardInfos"),V(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),V(y(),15*4-3,"padding")]),Sa=N([F("growthInsideLastX64"),y("rewardAmountOwed")]),Xi=N([Ae(8),v("bump"),S("nftMint"),S("poolId"),ge("tickLower"),ge("tickUpper"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),V(Sa,3,"rewardInfos"),V(y(),8,"")]),Ef=N([Ae(8),v("bump"),S("poolId"),ge("tickLowerIndex"),ge("tickUpperIndex"),F("liquidity"),F("feeGrowthInsideLastX64A"),F("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),V(F(),3,"rewardGrowthInside"),V(y(),8,"")]),Ka=N([ge("tick"),ci("liquidityNet"),F("liquidityGross"),F("feeGrowthOutsideX64A"),F("feeGrowthOutsideX64B"),V(F(),3,"rewardGrowthsOutsideX64"),V(Ne(),13,"")]),$t=N([Ae(8),S("poolId"),ge("startTickIndex"),V(Ka,fe,"ticks"),v("initializedTickCount"),V(v(),115,"")]),Mf=N([Ae(329),V(S(),100,"whitelistMints")]),zi=N([Ae(8),S("poolId"),V(V(y(),8),wr,"positiveTickArrayBitmap"),V(V(y(),8),wr,"negativeTickArrayBitmap")]);import{PublicKey as Ea,Keypair as Ma}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _a}from"@solana/spl-token";import tb from"bn.js";var Hi=N([S("mint"),S("owner"),y("amount"),Ne("delegateOption"),S("delegate"),v("state"),Ne("isNativeOption"),y("isNative"),y("delegatedAmount"),Ne("closeAuthorityOption"),S("closeAuthority")]);function La(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Ar(r,...e){if(!La(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function Tr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Yi(r,e){Ar(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Kn=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Oe=(r,e)=>r<<32-e|r>>>e;var Wf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Na(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Pr(r){return typeof r=="string"&&(r=Na(r)),Ar(r),r}var Sn=class{clone(){return this._cloneInto()}},Df={}.toString;function ji(r){let e=n=>r().update(Pr(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Ra(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var Qi=(r,e,t)=>r&e^~r&t,Zi=(r,e,t)=>r&e^r&t^e&t,Ln=class extends Sn{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Kn(this.buffer)}update(e){Tr(this);let{view:t,buffer:n,blockLen:i}=this;e=Pr(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=Kn(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Tr(this),Yi(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;Ra(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=Kn(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var Ca=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),at=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64),xr=class extends Ln{constructor(){super(64,32,8,!1),this.A=at[0]|0,this.B=at[1]|0,this.C=at[2]|0,this.D=at[3]|0,this.E=at[4]|0,this.F=at[5]|0,this.G=at[6]|0,this.H=at[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)ut[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=ut[m-15],p=ut[m-2],g=Oe(d,7)^Oe(d,18)^d>>>3,f=Oe(p,17)^Oe(p,19)^p>>>10;ut[m]=f+ut[m-7]+g+ut[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=Oe(a,6)^Oe(a,11)^Oe(a,25),p=l+d+Qi(a,u,c)+Ca[m]+ut[m]|0,f=(Oe(n,2)^Oe(n,13)^Oe(n,22))+Zi(n,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=n,n=p+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var $i=ji(()=>new xr);var ob=ee("Raydium_Util");function Ji({fromPublicKey:r,programId:e=_a}){let t=Ma.generate().publicKey.toBase58().slice(0,32);return{publicKey:va(r,t,e),seed:t}}function va(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=$i(n);return new Ea(i)}var no=ee("Raydium_Clmm"),We={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Nn=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,g){let f=N([F("sqrtPriceX64"),y("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Ct.programId,isSigner:!1,isWritable:!1},{pubkey:rt,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:g},w);let h=Buffer.from([...We.createPool,...w]);return new Ve({keys:b,programId:e,data:h})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:i,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Ji({fromPublicKey:i,programId:n}),[d,p]=[new L(o.address),new L(s.address)],g=[Ct.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(kr.span),space:kr.span,programId:n})],{publicKey:f}=vi(n,a,d,p),{publicKey:b}=br(n,f,d),{publicKey:w}=br(n,f,p);return g.push(this.createPoolInstruction(n,f,i,a,m.publicKey,d,b,new L(o.programId||we),p,w,new L(s.programId||we),Xe(n,f).publicKey,u,c)),{signers:[],instructions:g,instructionTypes:[Q.CreateAccount,Q.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:b,mintBVault:w},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,g,f,b,w,h,k,P,A,I,K,B,W,D){let z=N([ge("tickLowerIndex"),ge("tickUpperIndex"),ge("tickArrayLowerStartIndex"),ge("tickArrayUpperStartIndex"),F("liquidity"),y("amountMaxA"),y("amountMaxB"),Ke("withMetadata"),v("optionBaseFlag"),Ke("baseFlag")]),se=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],ne=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:rt,isSigner:!1,isWritable:!1},{pubkey:Ct.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:eo,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...se],ie=Buffer.alloc(z.span);z.encode({tickLowerIndex:h,tickUpperIndex:k,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:A,liquidity:I,amountMaxA:K,amountMaxB:B,withMetadata:W==="create",baseFlag:!1,optionBaseFlag:0},ie);let H=Buffer.from([...We.openPosition,...ie]);return new Ve({keys:ne,programId:e,data:H})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new L(e.programId),new L(e.id)],g;if(l)g=new L((await l(1))[0]);else{let B=Br.generate();m.push(B),g=B.publicKey}let f=M.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=M.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=te(d,p,f),{publicKey:h}=te(d,p,b),{publicKey:k}=Re(n.wallet,g,we),{publicKey:P}=xn(g),{publicKey:A}=Ue(d,g),{publicKey:I}=yt(d,p,i,o),K=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,g,k,P,I,w,h,A,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,f,b,s,a,u,c);return{signers:m,instructions:[K],instructionTypes:[Q.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:k,metadataAccount:P,personalPosition:A,protocolPosition:I}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new L(e.programId),new L(e.id)],g;if(l)g=new L((await l(1))[0]);else{let B=Br.generate();m.push(B),g=B.publicKey}let f=M.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=M.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=te(d,p,f),{publicKey:h}=te(d,p,b),{publicKey:k}=Re(n.wallet,g,we),{publicKey:P}=xn(g),{publicKey:A}=Ue(d,g),{publicKey:I}=yt(d,p,i,o),K=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,g,k,P,I,w,h,A,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,f,b,c,s,a,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Xe(d,p).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:k,metadataAccount:P,personalPosition:A,protocolPosition:I},instructions:[K],signers:m,instructionTypes:[Q.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,g,f,b,w,h,k,P,A,I,K,B,W,D){let z=N([ge("tickLowerIndex"),ge("tickUpperIndex"),ge("tickArrayLowerStartIndex"),ge("tickArrayUpperStartIndex"),F("liquidity"),y("amountMaxA"),y("amountMaxB"),Ke("withMetadata"),v("optionBaseFlag"),Ke("baseFlag")]),se=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],ne=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:rt,isSigner:!1,isWritable:!1},{pubkey:Ct.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:eo,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...se],ie=Buffer.alloc(z.span);z.encode({tickLowerIndex:h,tickUpperIndex:k,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:A,liquidity:new to(0),amountMaxA:K==="MintA"?B:W,amountMaxB:K==="MintA"?W:B,withMetadata:I==="create",baseFlag:K==="MintA",optionBaseFlag:1},ie);let H=Buffer.from([...We.openPosition,...ie]);return new Ve({keys:ne,programId:e,data:H})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new L((await l(1))[0]);else{let B=Br.generate();d.push(B),m=B.publicKey}let[p,g]=[new L(e.programId),new L(e.id)],f=M.getTickArrayStartIndexByTick(i,e.config.tickSpacing),b=M.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=te(p,g,f),{publicKey:h}=te(p,g,b),{publicKey:k}=Re(n.wallet,m,we),{publicKey:P}=xn(m),{publicKey:A}=Ue(p,m),{publicKey:I}=yt(p,g,i,o),K=this.openPositionFromLiquidityInstruction(p,n.wallet,g,n.wallet,m,k,P,I,w,h,A,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(t.mintA.address),new L(t.mintB.address),i,o,f,b,s,a,u,c,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Xe(p,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:w,tickArrayUpper:h,positionNftAccount:k,metadataAccount:P,personalPosition:A,protocolPosition:I},instructions:[K],signers:d,instructionTypes:[Q.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=N([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Ct.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...We.closePosition,...u]);return new Ve({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new L(e.programId),{publicKey:s}=Re(n.wallet,i.nftMint,we),{publicKey:a}=Ue(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[Q.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,g,f,b,w,h){let k=N([F("liquidity"),y("amountMaxA"),y("amountMaxB"),v("optionBaseFlag"),Ke("baseFlag")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(k.span);k.encode({liquidity:f,amountMaxA:b,amountMaxB:w,optionBaseFlag:0,baseFlag:!1},I);let K=Buffer.from([...We.increaseLiquidity,...I]);return new Ve({keys:A,programId:e,data:K})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new L(e.programId),new L(e.id)],l=M.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=M.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,l),{publicKey:p}=te(u,c,m),{publicKey:g}=Re(i.wallet,n.nftMint,we),{publicKey:f}=Ue(u,n.nftMint),{publicKey:b}=yt(u,c,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,i.wallet,g,f,c,b,d,p,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Xe(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:b},signers:[],instructions:[w],instructionTypes:[Q.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new L(e.programId),new L(e.id)],l=M.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=M.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,l),{publicKey:p}=te(u,c,m),{publicKey:g}=Re(i.wallet,n.nftMint,we),{publicKey:f}=Ue(u,n.nftMint),{publicKey:b}=yt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,g,f,c,b,d,p,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Xe(u,c).publicKey:void 0)],signers:[],instructionTypes:[Q.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,g,f,b,w,h){let k=N([F("liquidity"),y("amountMaxA"),y("amountMaxB"),v("optionBaseFlag"),Ke("baseFlag")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],I=Buffer.alloc(k.span);k.encode({liquidity:new to(0),amountMaxA:f==="MintA"?b:w,amountMaxB:f==="MintA"?w:b,baseFlag:f==="MintA",optionBaseFlag:1},I);let K=Buffer.from([...We.increaseLiquidity,...I]);return new Ve({keys:A,programId:e,data:K})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,g,f,b,w,h,k){let P=N([F("liquidity"),y("amountMinA"),y("amountMinB")]),A=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...f.map(W=>[{pubkey:W.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:W.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:W.rewardMint,isSigner:!1,isWritable:!1}]).flat()],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:cn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],K=Buffer.alloc(P.span);P.encode({liquidity:b,amountMinA:w,amountMinB:h},K);let B=Buffer.from([...We.decreaseLiquidity,...K]);return new Ve({keys:I,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new L(e.programId),new L(e.id)],m=M.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=M.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=te(c,l,m),{publicKey:g}=te(c,l,d),{publicKey:f}=Re(i.wallet,n.nftMint,u),{publicKey:b}=Ue(c,n.nftMint),{publicKey:w}=yt(c,l,n.tickLower,n.tickUpper),h=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)h.push({poolRewardVault:new L(t.rewardInfos[P].vault),ownerRewardVault:i.rewardAccounts[P],rewardMint:new L(e.rewardDefaultInfos[P].mint.address)});let k=[];return k.push(this.decreaseLiquidityInstruction(c,i.wallet,f,b,l,w,p,g,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),h,o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Xe(c,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:b,protocolPosition:w},signers:[],instructions:k,instructionTypes:[Q.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,g,f,b,w){let h=N([y("amount"),y("otherAmountThreshold"),F("sqrtPriceLimitX64"),Ke("isBaseInput")]),k=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...m.map(K=>({pubkey:K,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:cn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...k],A=Buffer.alloc(h.span);h.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:b},A);let I=Buffer.from([...We.swap,...A]);return new Ve({keys:P,programId:e,data:I})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:i,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new L(e.programId),new L(e.id)],[m,d]=[new L(t.vault.A),new L(t.vault.B)],[p,g]=[new L(e.mintA.address),new L(e.mintB.address)],f=e.mintA.address===i.toString(),b=[this.swapInstruction(c,n.wallet,l,new L(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:d,f?d:m,f?p:g,f?g:p,u,m,o,s,a,!0,Xe(c,l).publicKey)];return{signers:[],instructions:b,instructionTypes:[Q.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=N([y("openTime"),y("endTime"),F("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Ct.programId,isSigner:!1,isWritable:!1},{pubkey:rt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:J(l),endTime:J(m),emissionsPerSecondX64:d},f);let b=Buffer.from([...We.initReward,...f]);return new Ve({keys:g,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new L(e.programId),new L(e.id)],a=Fi(o,s,i.mint).publicKey,u=yr(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new L(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[Q.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=N([v("rewardIndex"),F("emissionsPerSecondX64"),y("openTime"),y("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:J(l),endTime:J(m)},f);let b=Buffer.from([...We.setRewardEmissions,...f]);return new Ve({keys:g,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new L(e.programId),new L(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,u=new L(t.rewardInfos[d].vault),c=new L(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&no.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=yr(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new L(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[Q.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=N([v("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:cn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...We.collectReward,...l]);return new Ve({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new L(e.programId),new L(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new L(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&no.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[Q.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:i,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new L(e.programId),new L(e.id)],[m,d]=[new L(t.vault.A),new L(t.vault.B)],[p,g]=[new L(e.mintA.address),new L(e.mintB.address)],f=e.mintA.address===i.toString(),b=[this.swapInstruction(c,n.wallet,l,new L(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?d:m,f?m:d,f?p:g,f?g:p,u,m,o,s,a,!1)];return{signers:[],instructions:b,instructionTypes:[Q.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import{PublicKey as Va}from"@solana/web3.js";import{PublicKey as Fa}from"@solana/web3.js";import ro from"bn.js";var io=new ro(25),oo=new ro(1e4);var Oa=ee("Raydium_liquidity_serum");function so({programId:r,marketId:e}){let t=[e.toBuffer()],n=0,i;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));i=Fa.createProgramAddressSync(o,r)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:i,nonce:n}}throw Oa.logWithError("unable to find a viable program address nonce","params",{programId:r,marketId:e}),new Error("unable to find a viable program address nonce")}import Wb from"bn.js";function Ir({programId:r}){let{publicKey:e}=le([Buffer.from("amm_config_account_seed","utf-8")],r);return e}function kt({name:r,programId:e,marketId:t}){let{publicKey:n}=le([e.toBuffer(),t.toBuffer(),Buffer.from(r,"utf-8")],e);return n}function Wa({programId:r,marketId:e}){let{publicKey:t}=le([r.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],r);return t}function Da({programId:r}){return le([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],r)}function ao({version:r,marketVersion:e,marketId:t,baseMint:n,quoteMint:i,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=kt({name:"amm_associated_seed",programId:a,marketId:t}),l=kt({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:d}=Da({programId:a}),p=kt({name:"coin_vault_associated_seed",programId:a,marketId:t}),g=kt({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=kt({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),b=Wa({programId:a,marketId:t}),w=kt({name:"target_associated_seed",programId:a,marketId:t}),h=kt({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:k}=so({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:i,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:r,programId:a,authority:m,nonce:d,baseVault:p,quoteVault:g,lpVault:f,openOrders:b,targetOrders:w,withdrawQueue:h,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:k,lookupTableAccount:Va.default,configId:Ir({programId:a})}}import{PublicKey as uo}from"@solana/web3.js";var Yb=ee("Raydium_farm_config"),jb=new uo("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Qb=new uo("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Rn={"Standard SPL":0,"Option tokens":1},co={[mi.toString()]:3,[di.toString()]:5,[pi.toString()]:6};var Ha=N([v("instruction")]),Ya=N([v("instruction")]),ja=N([y("rewardState"),y("rewardOpenTime"),y("rewardEndTime"),y("rewardLastUpdateTime"),y("totalReward"),y("totalRewardEmissioned"),y("rewardClaimed"),y("rewardPerSecond"),F("accRewardPerShare"),S("rewardVault"),S("rewardMint"),S("rewardSender"),y("rewardType"),V(y(),15,"padding")]),Qa=N([y("state"),y("nonce"),S("lpVault"),S("rewardVault"),S(),S(),y(),y(),y("totalReward"),F("perShareReward"),y("lastSlot"),y("perSlotReward")]),Za=N([y("state"),y("nonce"),S("lpVault"),S("rewardVaultA"),y("totalRewardA"),F("perShareRewardA"),y("perSlotRewardA"),v("option"),S("rewardVaultB"),Ae(7),y("totalRewardB"),F("perShareRewardB"),y("perSlotRewardB"),y("lastSlot"),S()]),$a=N([y(),y("state"),y("nonce"),y("validRewardTokenNum"),F("rewardMultiplier"),y("rewardPeriodMax"),y("rewardPeriodMin"),y("rewardPeriodExtend"),S("lpMint"),S("lpVault"),V(ja,5,"rewardInfos"),S("creator"),S(),V(y(),32,"padding")]),qa=new Proxy(Qa,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return{...i,version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]}}:Reflect.get(r,e,t)}}),Ga=new Proxy(Za,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return{...i,version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]}}:Reflect.get(r,e,t)}}),Ua=new Proxy($a,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return{...i,version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return{...o,rewardType:((s=Object.entries(Rn).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]}})}}:Reflect.get(r,e,t)}}),Ja=N([y("isSet"),y("rewardPerSecond"),y("rewardOpenTime"),y("rewardEndTime"),y("rewardType")]),eu=N([v("instruction"),y("nonce"),V(Ja,5,"rewardTimeInfo")]),tu=N([v("instruction"),y("rewardReopenTime"),y("rewardEndTime"),y("rewardPerSecond")]),nu=N([v("instruction"),y("isSet"),y("rewardPerSecond"),y("rewardOpenTime"),y("rewardEndTime"),y("rewardType")]),ry=N([y("state"),S("id"),S("owner"),y("deposited"),V(y(),1,"rewardDebts")]),lo=N([y("state"),S("id"),S("owner"),y("deposited"),V(F(),1,"rewardDebts"),y(""),y("voteLockedBalance"),V(y(),15)]),iy=N([y("state"),S("id"),S("owner"),y("deposited"),V(y(),2,"rewardDebts")]),Xa=N([y("state"),S("id"),S("owner"),y("deposited"),V(F(),2,"rewardDebts"),V(y(),17)]),za=N([y(),y("state"),S("id"),S("owner"),y("deposited"),V(F(),5,"rewardDebts"),V(y(),16)]),At=N([v("instruction"),y("amount")]),ru=N([S("mint"),S("grantAuthority"),y("baselineVoteWeightScaledFactor"),y("maxExtraLockupVoteWeightScaledFactor"),y("lockupSaturationSecs"),ui("digitShift"),V(v(),7,"reserved1"),V(y(),7,"reserved2")]),iu=N([Ae(8),S("governanceProgramId"),S("realm"),S("realmGoverningTokenMint"),S("realmAuthority"),V(v(),32,"reserved1"),V(ru,4,"votingMints"),yn("timeOffset"),v("bump"),V(v(),7,"reserved2"),V(y(),11,"reserved3")]),ou=N([yn("startTime"),yn("endTime"),v("kind"),V(v(),15,"reserved")]),su=N([V(ou,1,"lockup"),y("amountDeposited_native"),y("amountInitiallyLockedNative"),Ke("isUsed"),Ke("allowClawback"),v("votingMintConfigIdx"),V(v(),29,"reserved")]),au=N([Ae(8),S("voterAuthority"),S("registrar"),V(su,32,"deposits"),v("voterBump"),v("voterWweightRecordBump"),V(v(),94,"reserved")]);import my from"bn.js";var xy=ee("Raydium.farm.util");function Cn({programId:r,poolId:e,owner:t,version:n}){let{publicKey:i}=le([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return i}import{PublicKey as xe,SystemProgram as vy,SYSVAR_RENT_PUBKEY as Fy,SYSVAR_CLOCK_PUBKEY as mo,TransactionInstruction as Sr}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as Wy,TOKEN_PROGRAM_ID as Kr,ASSOCIATED_TOKEN_PROGRAM_ID as Dy}from"@solana/spl-token";import Gy from"bn.js";var tg=ee("Raydium_farm_instruction"),ng={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function po(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new xe(e.programId),new xe(e.id)],c=Cn({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(At.span);At.encode({instruction:2,amount:J(s)},l);let m=[T({pubkey:Kr,isWritable:!1}),T({pubkey:u}),T({pubkey:new xe(t.authority),isWritable:!1}),T({pubkey:new xe(t.lpVault)}),T({pubkey:c}),T({pubkey:o,isWritable:!1,isSigner:!0}),T({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(T({pubkey:new xe(t.rewardInfos[d].vault)})),m.push(T({pubkey:i[d]}));return new Sr({programId:a,keys:m,data:l})}function fo(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new xe(e.programId),new xe(e.id)],l=Cn({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(At.span);At.encode({instruction:12,amount:J(s)},m);let d=[T({pubkey:c}),T({pubkey:new xe(t.authority),isWritable:!1}),T({pubkey:l}),T({pubkey:o,isWritable:!1,isSigner:!0}),T({pubkey:n}),T({pubkey:new xe(t.lpVault)}),T({pubkey:i[0]}),T({pubkey:new xe(t.rewardInfos[0].vault)}),T({pubkey:mo,isWritable:!1}),T({pubkey:Kr,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(T({pubkey:i[p]})),d.push(T({pubkey:new xe(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(T({pubkey:p}));return new Sr({programId:u,keys:d,data:m})}function bo(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new xe(e.programId),new xe(e.id)],l=Cn({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(At.span);At.encode({instruction:11,amount:J(s)},m);let d=[T({pubkey:c}),T({pubkey:new xe(t.authority),isWritable:!1}),T({pubkey:l}),T({pubkey:o,isWritable:!1,isSigner:!0}),T({pubkey:n}),T({pubkey:new xe(t.lpVault)}),T({pubkey:i[0]}),T({pubkey:new xe(t.rewardInfos[0].vault)}),T({pubkey:mo,isWritable:!1}),T({pubkey:Kr,isWritable:!1})];if(a)for(let p of a)d.push(T({pubkey:p}));return new Sr({programId:u,keys:d,data:m})}import Ee from"bn.js";var Lr=class extends Yt{constructor(t){super(t);this.stableLayout=new jt({connection:this.scope.connection})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:i,baseIn:o}){let s=new Ee(new E(n).mul(10**t[o?"mintA":"mintB"].decimals).toFixed(0)),a=li(t[o?"mintB":"mintA"]),[u,c]=[new Ee(new E(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new Ee(new E(t.mintAmountB).mul(10**t.mintB.decimals).toString())],l=new Ee(new E(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,E.ROUND_DOWN));this.logDebug("baseReserve:",u.toString(),"quoteReserve:",c.toString()),this.logDebug("tokenIn:",o?t.mintA.symbol:t.mintB.symbol,"amountIn:",s.toString(),"anotherToken:",o?t.mintB.symbol:t.mintA.symbol,"slippage:",`${i.toSignificant()}%`,"baseReserve",u.toString(),"quoteReserve",c.toString());let m=o?"base":"quote";this.logDebug("input side:",m);let d=Vt;s.isZero()||(d=m==="base"?pn(s.mul(c),u):pn(s.mul(u),c)),this.logDebug("amountRaw:",d.toString(),"lpAmount:",l.toString());let p=pn(s.mul(l),m==="base"?u:c);this.logDebug("liquidity:",p.toString());let f=new qe(new Ee(1)).add(i).mul(d).quotient,b=new ae(a,d),w=new ae(a,f);return this.logDebug("anotherAmount:",b.toFixed(),"maxAnotherAmount:",w.toFixed()),{anotherAmount:b,maxAnotherAmount:w,liquidity:p}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,amountInA:i,amountInB:o,fixedSide:s,config:a,txVersion:u,computeBudgetConfig:c}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",i,"amountInB:",o),(i.isZero()||o.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:i.toFixed(),amountInB:o.toFixed()});let{account:l}=this.scope,{bypassAssociatedCheck:m,checkCreateATAOwner:d}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...a},[p,g]=[i.token,o.token],f=await l.getCreatedTokenAccount({mint:p.mint,associatedOnly:!1}),b=await l.getCreatedTokenAccount({mint:g.mint,associatedOnly:!1});!f&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let w=await l.getCreatedTokenAccount({mint:new Le(n.lpMint.address)}),h=[p,g],k=[f,b],P=[i.raw,o.raw],A=i.token.mint.toBase58()===n.mintA.address?"base":"quote",I="base";["quote","base"].includes(A)||this.logAndCreateError("invalid fixedSide","fixedSide",s),A==="quote"?(h.reverse(),k.reverse(),P.reverse(),I=s==="a"?"quote":"base"):A==="base"&&(I=s==="a"?"base":"quote");let[K,B]=h,[W,D]=k,[z,se]=P,ne=await this.getAmmPoolKeys(n.id),ie=this.createTxBuilder(),{tokenAccount:H,...j}=await l.handleTokenAccount({side:"in",amount:z,mint:K.mint,tokenAccount:W,bypassAssociatedCheck:m,checkCreateATAOwner:d});ie.addInstruction(j);let{tokenAccount:$e,...Et}=await l.handleTokenAccount({side:"in",amount:se,mint:B.mint,tokenAccount:D,bypassAssociatedCheck:m,checkCreateATAOwner:d});ie.addInstruction(Et);let{tokenAccount:Mn,..._n}=await l.handleTokenAccount({side:"out",amount:0,mint:new Le(n.lpMint.address),tokenAccount:w,bypassAssociatedCheck:m,checkCreateATAOwner:d});return ie.addInstruction(_n),ie.addInstruction({instructions:[Ni({poolInfo:n,poolKeys:ne,userKeys:{baseTokenAccount:H,quoteTokenAccount:$e,lpTokenAccount:Mn,owner:this.scope.ownerPubKey},baseAmountIn:z,quoteAmountIn:se,fixedSide:I})],instructionTypes:[n.pooltype.includes("StablePool")?Q.AmmV5AddLiquidity:Q.AmmV4AddLiquidity],lookupTableAddress:ne.lookupTableAccount?[ne.lookupTableAccount]:[]}),ie.addCustomComputeBudget(c),u===0&&await ie.buildV0(),ie.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,amountIn:i,config:o,txVersion:s,computeBudgetConfig:a}=t,u=await this.getAmmPoolKeys(n.id),[c,l,m]=[new Le(n.mintA.address),new Le(n.mintB.address),new Le(n.lpMint.address)];this.logDebug("amountIn:",i),i.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",i.toString());let{account:d}=this.scope,p=await d.getCreatedTokenAccount({mint:m,associatedOnly:!1});p||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",d.tokenAccounts);let g=await d.getCreatedTokenAccount({mint:c}),f=await d.getCreatedTokenAccount({mint:l}),b=this.createTxBuilder(),{bypassAssociatedCheck:w,checkCreateATAOwner:h}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...o},{tokenAccount:k,...P}=await d.handleTokenAccount({side:"out",amount:0,mint:c,tokenAccount:g,bypassAssociatedCheck:w,checkCreateATAOwner:h});b.addInstruction(P);let{tokenAccount:A,...I}=await d.handleTokenAccount({side:"out",amount:0,mint:l,tokenAccount:f,bypassAssociatedCheck:w,checkCreateATAOwner:h});return b.addInstruction(I),b.addInstruction({instructions:[dr({poolInfo:n,poolKeys:u,userKeys:{lpTokenAccount:p,baseTokenAccount:k,quoteTokenAccount:A,owner:this.scope.ownerPubKey},amountIn:i})],lookupTableAddress:u.lookupTableAccount?[u.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?Q.AmmV5RemoveLiquidity:Q.AmmV4RemoveLiquidity]}),b.addCustomComputeBudget(a),s===0?await b.buildV0():b.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:i,createPositionInfo:o,farmInfo:s,userFarmLpAmount:a,base:u,computeBudgetConfig:c,payer:l,tokenProgram:m=En,checkCreateATAOwner:d=!0,getEphemeralSigners:p,txVersion:g}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let f=this.createTxBuilder();f.addCustomComputeBudget(c);let b={};for(let H of this.scope.account.tokenAccountRawInfos)(b[H.accountInfo.mint.toString()]===void 0||Re(this.scope.ownerPubKey,H.accountInfo.mint,En).publicKey.equals(H.pubkey))&&(b[H.accountInfo.mint.toString()]=H.pubkey);let w=b[t.lpMint.address];if(w===void 0)throw Error("find lp account error in trade accounts");let h=i.add(a!=null?a:new Ee(0)),k=t.mintA.address===ke.WSOL.mint.toString(),P=t.mintB.address===ke.WSOL.mint.toString(),{account:A,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:En,mint:new Le(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:k?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!0,checkCreateATAOwner:d});if(f.addInstruction(I||{}),A===void 0)throw new Error("base token account not found");let{account:K,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:En,mint:new Le(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:P?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!P,notUseTokenAccount:P,associatedOnly:!0,checkCreateATAOwner:d});if(f.addInstruction(B||{}),K===void 0)throw new Error("quote token account not found");if(b[t.mintA.address]=A,b[t.mintB.address]=K,s!==void 0&&!(a!=null&&a.isZero())){let H=[];for(let Mt of s.rewardInfos){let go=Mt.mint.address===ke.WSOL.mint.toString();if(b[Mt.mint.address])H.push(b[Mt.mint.address]);else{let{account:Nr,instructionParams:Rr}=await this.scope.account.getOrCreateTokenAccount({mint:new Le(Mt.mint.address),tokenProgram:m,owner:this.scope.ownerPubKey,skipCloseAccount:!go,createInfo:{payer:l||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:d});Nr||this.logAndCreateError("farm reward account not found:",Mt.mint.address),Rr&&f.addInstruction(Rr),H.push(Nr)}}let j=(await this.scope.api.fetchFarmKeysById({ids:s.id}))[0],$e={amount:a,owner:this.scope.ownerPubKey,farmInfo:s,farmKeys:j,lpAccount:w,rewardAccounts:H},Et=co[s.programId],Mn=Et===6?po($e):Et===5?fo($e):bo($e),_n={3:Q.FarmV3Withdraw,5:Q.FarmV5Withdraw,6:Q.FarmV6Withdraw};f.addInstruction({instructions:[Mn],instructionTypes:[_n[Et]]})}let W=await this.getAmmPoolKeys(t.id),D=dr({poolInfo:t,poolKeys:W,userKeys:{lpTokenAccount:w,baseTokenAccount:A,quoteTokenAccount:K,owner:this.scope.ownerPubKey},amountIn:h});f.addInstruction({instructions:[D],instructionTypes:[t.pooltype.includes("StablePool")?Q.AmmV5RemoveLiquidity:Q.AmmV4RemoveLiquidity],lookupTableAddress:W.lookupTableAccount?[W.lookupTableAccount]:[]});let[z,se]=t.mintA.address===n.mintA.address?[A,K]:[K,A],ne=await this.scope.clmm.getClmmPoolKeys(t.id),ie=await Nn.openPositionFromBaseInstructions({poolInfo:n,poolKeys:ne,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:z,tokenAccountB:se},withMetadata:"create",...o,base:u,getEphemeralSigners:p});return f.addInstruction({instructions:[...ie.instructions],signers:ie.signers,instructionTypes:[...ie.instructionTypes],lookupTableAddress:ne.lookupTableAccount?[ne.lookupTableAccount]:[]}),g===0?f.sizeCheckBuildV0():f.sizeCheckBuild()}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:i,quoteMintInfo:o,baseAmount:s,quoteAmount:a,startTime:u,ownerInfo:c,associatedOnly:l=!1,checkCreateATAOwner:m=!1,tokenProgram:d,txVersion:p,feeDestinationId:g,computeBudgetConfig:f}){var se;let b=c.feePayer||((se=this.scope.owner)==null?void 0:se.publicKey),w=c.useSOLBalance&&i.mint.equals(yo),h=c.useSOLBalance&&o.mint.equals(yo),k=this.createTxBuilder(),{account:P,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:w?{payer:b,amount:s}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:l,checkCreateATAOwner:m});k.addInstruction(A||{});let{account:I,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({mint:o.mint,owner:this.scope.ownerPubKey,createInfo:h?{payer:b,amount:a}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:l,checkCreateATAOwner:m});if(k.addInstruction(K||{}),P===void 0||I===void 0)throw Error("you don't has some token account");let B=ao({version:4,marketVersion:3,marketId:n.marketId,baseMint:i.mint,quoteMint:o.mint,baseDecimals:i.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n.programId}),W={programId:t,ammId:B.id,ammAuthority:B.authority,ammOpenOrders:B.openOrders,lpMint:B.lpMint,coinMint:B.baseMint,pcMint:B.quoteMint,coinVault:B.baseVault,pcVault:B.quoteVault,withdrawQueue:B.withdrawQueue,ammTargetOrders:B.targetOrders,poolTempLp:B.lpVault,marketProgramId:B.marketProgramId,marketId:B.marketId,ammConfigId:B.configId,feeDestinationId:g},{instruction:D,instructionType:z}=Ri({...W,userWallet:this.scope.ownerPubKey,userCoinVault:P,userPcVault:I,userLpVault:Re(this.scope.ownerPubKey,B.lpMint,d).publicKey,nonce:B.nonce,openTime:u,coinAmount:s,pcAmount:a});return k.addInstruction({instructions:[D],instructionTypes:[z]}),k.addCustomComputeBudget(f),k.versionBuild({txVersion:p,extInfo:{address:W}})}async getCreatePoolFee({programId:t}){let n=Ir({programId:t}),i=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(i===null)throw Error("get config account error");return Ti.decode(i.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:i,mintOut:o,slippage:s}){if(i!==t.mintA.address&&i!==t.mintA.address)throw new Error("toke not match");if(o!==t.mintB.address&&o!==t.mintB.address)throw new Error("toke not match");let{baseReserve:a,quoteReserve:u}=t,c=[a,u],l=i==t.mintA.address?"base":"quote";l==="quote"&&c.reverse();let[m,d]=c,p=t.programId===fi.toBase58(),g;if(p)g=new E(d.toString()).div(m.toString());else{let B=Si(this.stableLayout.stableModelData,a.toNumber(),u.toNumber(),!1);l==="quote"?g=new E(1e6).div(B*1e6):g=new E(B*1e6).div(1e6)}let f=n,b=new Ee(0),w=new Ee(0);if(!f.isZero())if(p){w=Gt(f.mul(io),oo);let B=f.sub(w),W=m.add(B);b=d.mul(B).div(W)}else{w=f.mul(new Ee(2)).div(new Ee(1e4));let B=f.sub(w);l==="quote"?b=new Ee(Bi(this.stableLayout.stableModelData,u.toNumber(),a.toNumber(),B.toNumber())):b=new Ee(Ii(this.stableLayout.stableModelData,u.toNumber(),a.toNumber(),B.toNumber()))}let h=new Ee(new E(b.toString()).mul(1-s).toFixed(0)),k=b,P=h,A=new E(b.toString()).div(new E(f.sub(w).toString()).toFixed(0));!f.isZero()&&!b.isZero()&&(A=new E(b.toString()).div(f.sub(w).toString()));let I=g.sub(A).div(g).mul(100);return{amountOut:k,minAmountOut:P,currentPrice:g,executionPrice:A,priceImpact:I,fee:w}}async swap({poolInfo:t,amountIn:n,amountOut:i,inputMint:o,fixedSide:s,txVersion:a,computeBudgetConfig:u}){let c=this.createTxBuilder(),[l,m]=o===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],d=await this.scope.account.getCreatedTokenAccount({mint:new Le(l.address),programId:new Le(l.programId),associatedOnly:!1}),p=await this.scope.account.getCreatedTokenAccount({mint:new Le(m.address),programId:new Le(m.programId),associatedOnly:!1}),{tokenAccount:g,...f}=await this.scope.account.handleTokenAccount({side:"in",amount:n,mint:new Le(l.address),tokenAccount:d,bypassAssociatedCheck:!1,checkCreateATAOwner:!1});c.addInstruction(f);let{tokenAccount:b,...w}=await this.scope.account.handleTokenAccount({side:"out",amount:0,mint:new Le(m.address),tokenAccount:p,bypassAssociatedCheck:!1,checkCreateATAOwner:!1});c.addInstruction(w);let h=await this.getAmmPoolKeys(t.id),k=4;return t.pooltype.includes("StablePool")&&(k=5),c.addInstruction({instructions:[Ci({version:k,poolKeys:h,userKeys:{tokenAccountIn:g,tokenAccountOut:b,owner:this.scope.ownerPubKey},amountIn:n,amountOut:i,fixedSide:s})],instructionTypes:[k===4?Q.AmmV4SwapBaseIn:Q.AmmV5SwapBaseIn]}),c.addCustomComputeBudget(u),c.versionBuild({txVersion:a})}};export{Lr as default};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=liquidity.mjs.map