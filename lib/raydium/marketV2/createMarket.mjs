import{PublicKey as Ct}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Sn}from"@solana/spl-token";import Me from"bn.js";import{get as Mt,set as Ln}from"lodash";import Dt from"dayjs";import kn from"dayjs/plugin/utc";Dt.extend(kn);var tt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Dt().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let n=e.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Rt={},Nn={};function U(t){let e=Mt(Rt,t);if(!e){let n=Mt(Nn,t);e=new tt({name:t,logLevel:n}),Ln(Rt,t,e)}return e}import{PublicKey as Le,sendAndConfirmTransaction as ht,Transaction as ke,TransactionMessage as Ne,VersionedTransaction as Ce}from"@solana/web3.js";import Vr from"axios";var z={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as gi,ComputeBudgetProgram as Kt,Transaction as vt,TransactionMessage as Cn,Keypair as _t,VersionedTransaction as Ft}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as En}from"@solana/spl-token";var It=U("Raydium_txUtil"),Ot=1644;function Re(t){let e=[],n=[];return t.microLamports&&(e.push(Kt.setComputeUnitPrice({microLamports:t.microLamports})),n.push(z.SetComputeUnitPrice)),t.units&&(e.push(Kt.setComputeUnitLimit({units:t.units})),n.push(z.SetComputeUnitLimit)),{instructions:e,instructionTypes:n}}async function de(t){var e,n;try{return((n=await((e=t.getLatestBlockhash)==null?void 0:e.call(t)))==null?void 0:n.blockhash)||(await t.getRecentBlockhash()).blockhash}catch{return(await t.getRecentBlockhash()).blockhash}}function Mn(t,e){t.length<1&&It.logWithError(`no instructions provided: ${t.toString()}`),e.length<1&&It.logWithError(`no signers provided:, ${e.toString()}`);let n=new vt;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=e[0],n.add(...t);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<Ot}catch{return!1}}function xe({instructions:t,payer:e,signers:n}){return Mn(t,[e,...n])}function Te({instructions:t,payer:e,lookupTableAddressAccount:n,recentBlockhash:r=_t.generate().publicKey.toString()}){let o=new Cn({payerKey:e,recentBlockhash:r,instructions:t}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new Ft(o).serialize()).toString("base64").length<Ot}catch{return!1}}var Rn=t=>Buffer.isBuffer(t)?t:t instanceof Uint8Array?Buffer.from(t.buffer,t.byteOffset,t.byteLength):Buffer.from(t);function ce(t){let e=[];return t.forEach(n=>{n instanceof vt&&(n.recentBlockhash||(n.recentBlockhash=En.toBase58()),n.feePayer||(n.feePayer=_t.generate().publicKey));let r=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Ft&&(r=Rn(r));let i=r.toString("base64");e.push(i)}),console.log("simulate tx string:",e),e}import{PublicKey as pn,AddressLookupTableAccount as He}from"@solana/web3.js";import{PublicKey as Or}from"@solana/web3.js";import{getTransferFeeConfig as Du,unpackMint as Ku}from"@solana/spl-token";import{PublicKey as Bs}from"@solana/web3.js";import Ls from"bn.js";import Fr from"big.js";import is from"bn.js";import Q from"bn.js";var me=9e15,ie=1e9,nt="0123456789abcdef",Ke="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ie="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",rt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-me,maxE:me,crypto:!1},Ut,ee,B=!0,_e="[DecimalError] ",re=_e+"Invalid argument: ",Gt=_e+"Precision limit exceeded",Ht=_e+"crypto unavailable",zt="[object Decimal]",G=Math.floor,O=Math.pow,Dn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Kn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,In=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,jt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Z=1e7,A=7,vn=9007199254740991,_n=Ke.length-1,it=Ie.length-1,d={toStringTag:zt};d.absoluteValue=d.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),T(t)};d.ceil=function(){return T(new this.constructor(this),this.e+1,2)};d.clampedTo=d.clamp=function(t,e){var n,r=this,i=r.constructor;if(t=new i(t),e=new i(e),!t.s||!e.s)return new i(NaN);if(t.gt(e))throw Error(re+e);return n=r.cmp(t),n<0?t:r.cmp(e)>0?e:new i(r)};d.comparedTo=d.cmp=function(t){var e,n,r,i,o=this,s=o.d,u=(t=new o.constructor(t)).d,c=o.s,a=t.s;if(!s||!u)return!c||!a?NaN:c!==a?c:s===u?0:!s^c<0?1:-1;if(!s[0]||!u[0])return s[0]?c:u[0]?-a:0;if(c!==a)return c;if(o.e!==t.e)return o.e>t.e^c<0?1:-1;for(r=s.length,i=u.length,e=0,n=r<i?r:i;e<n;++e)if(s[e]!==u[e])return s[e]>u[e]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};d.cosine=d.cos=function(){var t,e,n=this,r=n.constructor;return n.d?n.d[0]?(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=Fn(r,Jt(r,n)),r.precision=t,r.rounding=e,T(ee==2||ee==3?n.neg():n,t,e,!0)):new r(1):new r(NaN)};d.cubeRoot=d.cbrt=function(){var t,e,n,r,i,o,s,u,c,a,f=this,l=f.constructor;if(!f.isFinite()||f.isZero())return new l(f);for(B=!1,o=f.s*O(f.s*f,1/3),!o||Math.abs(o)==1/0?(n=q(f.d),t=f.e,(o=(t-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=O(n,1/3),t=G((t+1)/3)-(t%3==(t<0?-1:2)),o==1/0?n="5e"+t:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+t),r=new l(n),r.s=f.s):r=new l(o.toString()),s=(t=l.precision)+3;;)if(u=r,c=u.times(u).times(u),a=c.plus(f),r=C(a.plus(f).times(u),a.plus(c),s+2,1),q(u.d).slice(0,s)===(n=q(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(T(u,t+1,0),u.times(u).times(u).eq(f))){r=u;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(T(r,t+1,1),e=!r.times(r).times(r).eq(f));break}return B=!0,T(r,t,l.rounding,e)};d.decimalPlaces=d.dp=function(){var t,e=this.d,n=NaN;if(e){if(t=e.length-1,n=(t-G(this.e/A))*A,t=e[t],t)for(;t%10==0;t/=10)n--;n<0&&(n=0)}return n};d.dividedBy=d.div=function(t){return C(this,new this.constructor(t))};d.dividedToIntegerBy=d.divToInt=function(t){var e=this,n=e.constructor;return T(C(e,new n(t),0,1,1),n.precision,n.rounding)};d.equals=d.eq=function(t){return this.cmp(t)===0};d.floor=function(){return T(new this.constructor(this),this.e+1,3)};d.greaterThan=d.gt=function(t){return this.cmp(t)>0};d.greaterThanOrEqualTo=d.gte=function(t){var e=this.cmp(t);return e==1||e===0};d.hyperbolicCosine=d.cosh=function(){var t,e,n,r,i,o=this,s=o.constructor,u=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return u;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(t=Math.ceil(i/3),e=(1/Oe(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),o=ge(s,1,o.times(e),new s(1),!0);for(var c,a=t,f=new s(8);a--;)c=o.times(o),o=u.minus(c.times(f.minus(c.times(f))));return T(o,s.precision=n,s.rounding=r,!0)};d.hyperbolicSine=d.sinh=function(){var t,e,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,n=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=ge(o,2,i,i,!0);else{t=1.4*Math.sqrt(r),t=t>16?16:t|0,i=i.times(1/Oe(5,t)),i=ge(o,2,i,i,!0);for(var s,u=new o(5),c=new o(16),a=new o(20);t--;)s=i.times(i),i=i.times(u.plus(s.times(c.times(s).plus(a))))}return o.precision=e,o.rounding=n,T(i,e,n,!0)};d.hyperbolicTangent=d.tanh=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+7,r.rounding=1,C(n.sinh(),n.cosh(),r.precision=t,r.rounding=e)):new r(n.s)};d.inverseCosine=d.acos=function(){var t,e=this,n=e.constructor,r=e.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?e.isNeg()?Y(n,i,o):new n(0):new n(NaN):e.isZero()?Y(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,e=e.asin(),t=Y(n,i+4,o).times(.5),n.precision=i,n.rounding=o,t.minus(e))};d.inverseHyperbolicCosine=d.acosh=function(){var t,e,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(t=r.precision,e=r.rounding,r.precision=t+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,B=!1,n=n.times(n).minus(1).sqrt().plus(n),B=!0,r.precision=t,r.rounding=e,n.ln()):new r(n)};d.inverseHyperbolicSine=d.asinh=function(){var t,e,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,B=!1,n=n.times(n).plus(1).sqrt().plus(n),B=!0,r.precision=t,r.rounding=e,n.ln())};d.inverseHyperbolicTangent=d.atanh=function(){var t,e,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(t=o.precision,e=o.rounding,r=i.sd(),Math.max(r,t)<2*-i.e-1?T(new o(i),t,e,!0):(o.precision=n=r-i.e,i=C(i.plus(1),new o(1).minus(i),n+t,1),o.precision=t+4,o.rounding=1,i=i.ln(),o.precision=t,o.rounding=e,i.times(.5))):new o(NaN)};d.inverseSine=d.asin=function(){var t,e,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),n=o.precision,r=o.rounding,e!==-1?e===0?(t=Y(o,n+4,r).times(.5),t.s=i.s,t):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};d.inverseTangent=d.atan=function(){var t,e,n,r,i,o,s,u,c,a=this,f=a.constructor,l=f.precision,p=f.rounding;if(a.isFinite()){if(a.isZero())return new f(a);if(a.abs().eq(1)&&l+4<=it)return s=Y(f,l+4,p).times(.25),s.s=a.s,s}else{if(!a.s)return new f(NaN);if(l+4<=it)return s=Y(f,l+4,p).times(.5),s.s=a.s,s}for(f.precision=u=l+10,f.rounding=1,n=Math.min(28,u/A+2|0),t=n;t;--t)a=a.div(a.times(a).plus(1).sqrt().plus(1));for(B=!1,e=Math.ceil(u/A),r=1,c=a.times(a),s=new f(a),i=a;t!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===o.d[t]&&t--;);return n&&(s=s.times(2<<n-1)),B=!0,T(s,f.precision=l,f.rounding=p,!0)};d.isFinite=function(){return!!this.d};d.isInteger=d.isInt=function(){return!!this.d&&G(this.e/A)>this.d.length-2};d.isNaN=function(){return!this.s};d.isNegative=d.isNeg=function(){return this.s<0};d.isPositive=d.isPos=function(){return this.s>0};d.isZero=function(){return!!this.d&&this.d[0]===0};d.lessThan=d.lt=function(t){return this.cmp(t)<0};d.lessThanOrEqualTo=d.lte=function(t){return this.cmp(t)<1};d.logarithm=d.log=function(t){var e,n,r,i,o,s,u,c,a=this,f=a.constructor,l=f.precision,p=f.rounding,m=5;if(t==null)t=new f(10),e=!0;else{if(t=new f(t),n=t.d,t.s<0||!n||!n[0]||t.eq(1))return new f(NaN);e=t.eq(10)}if(n=a.d,a.s<0||!n||!n[0]||a.eq(1))return new f(n&&!n[0]?-1/0:a.s!=1?NaN:n?0:1/0);if(e)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(B=!1,u=l+m,s=ne(a,u),r=e?ve(f,u+10):ne(t,u),c=C(s,r,u,1),Pe(c.d,i=l,p))do if(u+=10,s=ne(a,u),r=e?ve(f,u+10):ne(t,u),c=C(s,r,u,1),!o){+q(c.d).slice(i+1,i+15)+1==1e14&&(c=T(c,l+1,0));break}while(Pe(c.d,i+=10,p));return B=!0,T(c,l,p)};d.minus=d.sub=function(t){var e,n,r,i,o,s,u,c,a,f,l,p,m=this,y=m.constructor;if(t=new y(t),!m.d||!t.d)return!m.s||!t.s?t=new y(NaN):m.d?t.s=-t.s:t=new y(t.d||m.s!==t.s?m:NaN),t;if(m.s!=t.s)return t.s=-t.s,m.plus(t);if(a=m.d,p=t.d,u=y.precision,c=y.rounding,!a[0]||!p[0]){if(p[0])t.s=-t.s;else if(a[0])t=new y(m);else return new y(c===3?-0:0);return B?T(t,u,c):t}if(n=G(t.e/A),f=G(m.e/A),a=a.slice(),o=f-n,o){for(l=o<0,l?(e=a,o=-o,s=p.length):(e=p,n=f,s=a.length),r=Math.max(Math.ceil(u/A),s)+2,o>r&&(o=r,e.length=1),e.reverse(),r=o;r--;)e.push(0);e.reverse()}else{for(r=a.length,s=p.length,l=r<s,l&&(s=r),r=0;r<s;r++)if(a[r]!=p[r]){l=a[r]<p[r];break}o=0}for(l&&(e=a,a=p,p=e,t.s=-t.s),s=a.length,r=p.length-s;r>0;--r)a[s++]=0;for(r=p.length;r>o;){if(a[--r]<p[r]){for(i=r;i&&a[--i]===0;)a[i]=Z-1;--a[i],a[r]+=Z}a[r]-=p[r]}for(;a[--s]===0;)a.pop();for(;a[0]===0;a.shift())--n;return a[0]?(t.d=a,t.e=Fe(a,n),B?T(t,u,c):t):new y(c===3?-0:0)};d.modulo=d.mod=function(t){var e,n=this,r=n.constructor;return t=new r(t),!n.d||!t.s||t.d&&!t.d[0]?new r(NaN):!t.d||n.d&&!n.d[0]?T(new r(n),r.precision,r.rounding):(B=!1,r.modulo==9?(e=C(n,t.abs(),0,3,1),e.s*=t.s):e=C(n,t,0,r.modulo,1),e=e.times(t),B=!0,n.minus(e))};d.naturalExponential=d.exp=function(){return ot(this)};d.naturalLogarithm=d.ln=function(){return ne(this)};d.negated=d.neg=function(){var t=new this.constructor(this);return t.s=-t.s,T(t)};d.plus=d.add=function(t){var e,n,r,i,o,s,u,c,a,f,l=this,p=l.constructor;if(t=new p(t),!l.d||!t.d)return!l.s||!t.s?t=new p(NaN):l.d||(t=new p(t.d||l.s===t.s?l:NaN)),t;if(l.s!=t.s)return t.s=-t.s,l.minus(t);if(a=l.d,f=t.d,u=p.precision,c=p.rounding,!a[0]||!f[0])return f[0]||(t=new p(l)),B?T(t,u,c):t;if(o=G(l.e/A),r=G(t.e/A),a=a.slice(),i=o-r,i){for(i<0?(n=a,i=-i,s=f.length):(n=f,r=o,s=a.length),o=Math.ceil(u/A),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=a.length,i=f.length,s-i<0&&(i=s,n=f,f=a,a=n),e=0;i;)e=(a[--i]=a[i]+f[i]+e)/Z|0,a[i]%=Z;for(e&&(a.unshift(e),++r),s=a.length;a[--s]==0;)a.pop();return t.d=a,t.e=Fe(a,r),B?T(t,u,c):t};d.precision=d.sd=function(t){var e,n=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(re+t);return n.d?(e=Qt(n.d),t&&n.e+1>e&&(e=n.e+1)):e=NaN,e};d.round=function(){var t=this,e=t.constructor;return T(new e(t),t.e+1,e.rounding)};d.sine=d.sin=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+A,r.rounding=1,n=Vn(r,Jt(r,n)),r.precision=t,r.rounding=e,T(ee>2?n.neg():n,t,e,!0)):new r(NaN)};d.squareRoot=d.sqrt=function(){var t,e,n,r,i,o,s=this,u=s.d,c=s.e,a=s.s,f=s.constructor;if(a!==1||!u||!u[0])return new f(!a||a<0&&(!u||u[0])?NaN:u?s:1/0);for(B=!1,a=Math.sqrt(+s),a==0||a==1/0?(e=q(u),(e.length+c)%2==0&&(e+="0"),a=Math.sqrt(e),c=G((c+1)/2)-(c<0||c%2),a==1/0?e="5e"+c:(e=a.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),r=new f(e)):r=new f(a.toString()),n=(c=f.precision)+3;;)if(o=r,r=o.plus(C(s,o,n+2,1)).times(.5),q(o.d).slice(0,n)===(e=q(r.d)).slice(0,n))if(e=e.slice(n-3,n+1),e=="9999"||!i&&e=="4999"){if(!i&&(T(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(T(r,c+1,1),t=!r.times(r).eq(s));break}return B=!0,T(r,c,f.rounding,t)};d.tangent=d.tan=function(){var t,e,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(t=r.precision,e=r.rounding,r.precision=t+10,r.rounding=1,n=n.sin(),n.s=1,n=C(n,new r(1).minus(n.times(n)).sqrt(),t+10,0),r.precision=t,r.rounding=e,T(ee==2||ee==4?n.neg():n,t,e,!0)):new r(NaN)};d.times=d.mul=function(t){var e,n,r,i,o,s,u,c,a,f=this,l=f.constructor,p=f.d,m=(t=new l(t)).d;if(t.s*=f.s,!p||!p[0]||!m||!m[0])return new l(!t.s||p&&!p[0]&&!m||m&&!m[0]&&!p?NaN:!p||!m?t.s/0:t.s*0);for(n=G(f.e/A)+G(t.e/A),c=p.length,a=m.length,c<a&&(o=p,p=m,m=o,s=c,c=a,a=s),o=[],s=c+a,r=s;r--;)o.push(0);for(r=a;--r>=0;){for(e=0,i=c+r;i>r;)u=o[i]+m[r]*p[i-r-1]+e,o[i--]=u%Z|0,e=u/Z|0;o[i]=(o[i]+e)%Z|0}for(;!o[--s];)o.pop();return e?++n:o.shift(),t.d=o,t.e=Fe(o,n),B?T(t,l.precision,l.rounding):t};d.toBinary=function(t,e){return ut(this,2,t,e)};d.toDecimalPlaces=d.toDP=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(j(t,0,ie),e===void 0?e=r.rounding:j(e,0,8),T(n,t+n.e+1,e))};d.toExponential=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=J(r,!0):(j(t,0,ie),e===void 0?e=i.rounding:j(e,0,8),r=T(new i(r),t+1,e),n=J(r,!0,t+1)),r.isNeg()&&!r.isZero()?"-"+n:n};d.toFixed=function(t,e){var n,r,i=this,o=i.constructor;return t===void 0?n=J(i):(j(t,0,ie),e===void 0?e=o.rounding:j(e,0,8),r=T(new o(i),t+i.e+1,e),n=J(r,!1,t+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};d.toFraction=function(t){var e,n,r,i,o,s,u,c,a,f,l,p,m=this,y=m.d,g=m.constructor;if(!y)return new g(m);if(a=n=new g(1),r=c=new g(0),e=new g(r),o=e.e=Qt(y)-m.e-1,s=o%A,e.d[0]=O(10,s<0?A+s:s),t==null)t=o>0?e:a;else{if(u=new g(t),!u.isInt()||u.lt(a))throw Error(re+u);t=u.gt(e)?o>0?e:a:u}for(B=!1,u=new g(q(y)),f=g.precision,g.precision=o=y.length*A*2;l=C(u,e,0,1,1),i=n.plus(l.times(r)),i.cmp(t)!=1;)n=r,r=i,i=a,a=c.plus(l.times(i)),c=i,i=e,e=u.minus(l.times(i)),u=i;return i=C(t.minus(n),r,0,1,1),c=c.plus(i.times(a)),n=n.plus(i.times(r)),c.s=a.s=m.s,p=C(a,r,o,1).minus(m).abs().cmp(C(c,n,o,1).minus(m).abs())<1?[a,r]:[c,n],g.precision=f,B=!0,p};d.toHexadecimal=d.toHex=function(t,e){return ut(this,16,t,e)};d.toNearest=function(t,e){var n=this,r=n.constructor;if(n=new r(n),t==null){if(!n.d)return n;t=new r(1),e=r.rounding}else{if(t=new r(t),e===void 0?e=r.rounding:j(e,0,8),!n.d)return t.s?n:t;if(!t.d)return t.s&&(t.s=n.s),t}return t.d[0]?(B=!1,n=C(n,t,0,e,1).times(t),B=!0,T(n)):(t.s=n.s,n=t),n};d.toNumber=function(){return+this};d.toOctal=function(t,e){return ut(this,8,t,e)};d.toPower=d.pow=function(t){var e,n,r,i,o,s,u=this,c=u.constructor,a=+(t=new c(t));if(!u.d||!t.d||!u.d[0]||!t.d[0])return new c(O(+u,a));if(u=new c(u),u.eq(1))return u;if(r=c.precision,o=c.rounding,t.eq(1))return T(u,r,o);if(e=G(t.e/A),e>=t.d.length-1&&(n=a<0?-a:a)<=vn)return i=Yt(c,u,n,r),t.s<0?new c(1).div(i):T(i,r,o);if(s=u.s,s<0){if(e<t.d.length-1)return new c(NaN);if((t.d[e]&1)==0&&(s=1),u.e==0&&u.d[0]==1&&u.d.length==1)return u.s=s,u}return n=O(+u,a),e=n==0||!isFinite(n)?G(a*(Math.log("0."+q(u.d))/Math.LN10+u.e+1)):new c(n+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(B=!1,c.rounding=u.s=1,n=Math.min(12,(e+"").length),i=ot(t.times(ne(u,r+n)),r),i.d&&(i=T(i,r+5,1),Pe(i.d,r,o)&&(e=r+10,i=T(ot(t.times(ne(u,e+n)),e),e+5,1),+q(i.d).slice(r+1,r+15)+1==1e14&&(i=T(i,r+1,0)))),i.s=s,B=!0,c.rounding=o,T(i,r,o))};d.toPrecision=function(t,e){var n,r=this,i=r.constructor;return t===void 0?n=J(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(j(t,1,ie),e===void 0?e=i.rounding:j(e,0,8),r=T(new i(r),t,e),n=J(r,t<=r.e||r.e<=i.toExpNeg,t)),r.isNeg()&&!r.isZero()?"-"+n:n};d.toSignificantDigits=d.toSD=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(j(t,1,ie),e===void 0?e=r.rounding:j(e,0,8)),T(new r(n),t,e)};d.toString=function(){var t=this,e=t.constructor,n=J(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+n:n};d.truncated=d.trunc=function(){return T(new this.constructor(this),this.e+1,1)};d.valueOf=d.toJSON=function(){var t=this,e=t.constructor,n=J(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+n:n};function q(t){var e,n,r,i=t.length-1,o="",s=t[0];if(i>0){for(o+=s,e=1;e<i;e++)r=t[e]+"",n=A-r.length,n&&(o+=te(n)),o+=r;s=t[e],r=s+"",n=A-r.length,n&&(o+=te(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function j(t,e,n){if(t!==~~t||t<e||t>n)throw Error(re+t)}function Pe(t,e,n,r){var i,o,s,u;for(o=t[0];o>=10;o/=10)--e;return--e<0?(e+=A,i=0):(i=Math.ceil((e+1)/A),e%=A),o=O(10,A-e),u=t[i]%o|0,r==null?e<3?(e==0?u=u/100|0:e==1&&(u=u/10|0),s=n<4&&u==99999||n>3&&u==49999||u==5e4||u==0):s=(n<4&&u+1==o||n>3&&u+1==o/2)&&(t[i+1]/o/100|0)==O(10,e-2)-1||(u==o/2||u==0)&&(t[i+1]/o/100|0)==0:e<4?(e==0?u=u/1e3|0:e==1?u=u/100|0:e==2&&(u=u/10|0),s=(r||n<4)&&u==9999||!r&&n>3&&u==4999):s=((r||n<4)&&u+1==o||!r&&n>3&&u+1==o/2)&&(t[i+1]/o/1e3|0)==O(10,e-3)-1,s}function De(t,e,n){for(var r,i=[0],o,s=0,u=t.length;s<u;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=nt.indexOf(t.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Fn(t,e){var n,r,i;if(e.isZero())return e;r=e.d.length,r<32?(n=Math.ceil(r/3),i=(1/Oe(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),t.precision+=n,e=ge(t,1,e.times(i),new t(1));for(var o=n;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=n,e}var C=function(){function t(r,i,o){var s,u=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+u,r[c]=s%o|0,u=s/o|0;return u&&r.unshift(u),r}function e(r,i,o,s){var u,c;if(o!=s)c=o>s?1:-1;else for(u=c=0;u<o;u++)if(r[u]!=i[u]){c=r[u]>i[u]?1:-1;break}return c}function n(r,i,o,s){for(var u=0;o--;)r[o]-=u,u=r[o]<i[o]?1:0,r[o]=u*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,u,c){var a,f,l,p,m,y,g,w,h,b,x,P,N,k,E,D,V,F,I,$,pe=r.constructor,et=r.s==i.s?1:-1,W=r.d,M=i.d;if(!W||!W[0]||!M||!M[0])return new pe(!r.s||!i.s||(W?M&&W[0]==M[0]:!M)?NaN:W&&W[0]==0||!M?et*0:et/0);for(c?(m=1,f=r.e-i.e):(c=Z,m=A,f=G(r.e/m)-G(i.e/m)),I=M.length,V=W.length,h=new pe(et),b=h.d=[],l=0;M[l]==(W[l]||0);l++);if(M[l]>(W[l]||0)&&f--,o==null?(k=o=pe.precision,s=pe.rounding):u?k=o+(r.e-i.e)+1:k=o,k<0)b.push(1),y=!0;else{if(k=k/m+2|0,l=0,I==1){for(p=0,M=M[0],k++;(l<V||p)&&k--;l++)E=p*c+(W[l]||0),b[l]=E/M|0,p=E%M|0;y=p||l<V}else{for(p=c/(M[0]+1)|0,p>1&&(M=t(M,p,c),W=t(W,p,c),I=M.length,V=W.length),D=I,x=W.slice(0,I),P=x.length;P<I;)x[P++]=0;$=M.slice(),$.unshift(0),F=M[0],M[1]>=c/2&&++F;do p=0,a=e(M,x,I,P),a<0?(N=x[0],I!=P&&(N=N*c+(x[1]||0)),p=N/F|0,p>1?(p>=c&&(p=c-1),g=t(M,p,c),w=g.length,P=x.length,a=e(g,x,w,P),a==1&&(p--,n(g,I<w?$:M,w,c))):(p==0&&(a=p=1),g=M.slice()),w=g.length,w<P&&g.unshift(0),n(x,g,P,c),a==-1&&(P=x.length,a=e(M,x,I,P),a<1&&(p++,n(x,I<P?$:M,P,c))),P=x.length):a===0&&(p++,x=[0]),b[l++]=p,a&&x[0]?x[P++]=W[D]||0:(x=[W[D]],P=1);while((D++<V||x[0]!==void 0)&&k--);y=x[0]!==void 0}b[0]||b.shift()}if(m==1)h.e=f,Ut=y;else{for(l=1,p=b[0];p>=10;p/=10)l++;h.e=l+f*m-1,T(h,u?o+h.e+1:o,s,y)}return h}}();function T(t,e,n,r){var i,o,s,u,c,a,f,l,p,m=t.constructor;e:if(e!=null){if(l=t.d,!l)return t;for(i=1,u=l[0];u>=10;u/=10)i++;if(o=e-i,o<0)o+=A,s=e,f=l[p=0],c=f/O(10,i-s-1)%10|0;else if(p=Math.ceil((o+1)/A),u=l.length,p>=u)if(r){for(;u++<=p;)l.push(0);f=c=0,i=1,o%=A,s=o-A+1}else break e;else{for(f=u=l[p],i=1;u>=10;u/=10)i++;o%=A,s=o-A+i,c=s<0?0:f/O(10,i-s-1)%10|0}if(r=r||e<0||l[p+1]!==void 0||(s<0?f:f%O(10,i-s-1)),a=n<4?(c||r)&&(n==0||n==(t.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?f/O(10,i-s):0:l[p-1])%10&1||n==(t.s<0?8:7)),e<1||!l[0])return l.length=0,a?(e-=t.e+1,l[0]=O(10,(A-e%A)%A),t.e=-e||0):l[0]=t.e=0,t;if(o==0?(l.length=p,u=1,p--):(l.length=p+1,u=O(10,A-o),l[p]=s>0?(f/O(10,i-s)%O(10,s)|0)*u:0),a)for(;;)if(p==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=u,u=1;s>=10;s/=10)u++;o!=u&&(t.e++,l[0]==Z&&(l[0]=1));break}else{if(l[p]+=u,l[p]!=Z)break;l[p--]=0,u=1}for(o=l.length;l[--o]===0;)l.pop()}return B&&(t.e>m.maxE?(t.d=null,t.e=NaN):t.e<m.minE&&(t.e=0,t.d=[0])),t}function J(t,e,n){if(!t.isFinite())return Xt(t);var r,i=t.e,o=q(t.d),s=o.length;return e?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+te(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(t.e<0?"e":"e+")+t.e):i<0?(o="0."+te(-i-1)+o,n&&(r=n-s)>0&&(o+=te(r))):i>=s?(o+=te(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+te(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=te(r))),o}function Fe(t,e){var n=t[0];for(e*=A;n>=10;n/=10)e++;return e}function ve(t,e,n){if(e>_n)throw B=!0,n&&(t.precision=n),Error(Gt);return T(new t(Ke),e,1,!0)}function Y(t,e,n){if(e>it)throw Error(Gt);return T(new t(Ie),e,n,!0)}function Qt(t){var e=t.length-1,n=e*A+1;if(e=t[e],e){for(;e%10==0;e/=10)n--;for(e=t[0];e>=10;e/=10)n++}return n}function te(t){for(var e="";t--;)e+="0";return e}function Yt(t,e,n,r){var i,o=new t(1),s=Math.ceil(r/A+4);for(B=!1;;){if(n%2&&(o=o.times(e),qt(o.d,s)&&(i=!0)),n=G(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}e=e.times(e),qt(e.d,s)}return B=!0,o}function Vt(t){return t.d[t.d.length-1]&1}function Zt(t,e,n){for(var r,i=new t(e[0]),o=0;++o<e.length;)if(r=new t(e[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function ot(t,e){var n,r,i,o,s,u,c,a=0,f=0,l=0,p=t.constructor,m=p.rounding,y=p.precision;if(!t.d||!t.d[0]||t.e>17)return new p(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(B=!1,c=y):c=e,u=new p(.03125);t.e>-2;)t=t.times(u),l+=5;for(r=Math.log(O(2,l))/Math.LN10*2+5|0,c+=r,n=o=s=new p(1),p.precision=c;;){if(o=T(o.times(t),c,1),n=n.times(++f),u=s.plus(C(o,n,c,1)),q(u.d).slice(0,c)===q(s.d).slice(0,c)){for(i=l;i--;)s=T(s.times(s),c,1);if(e==null)if(a<3&&Pe(s.d,c-r,m,a))p.precision=c+=10,n=o=u=new p(1),f=0,a++;else return T(s,p.precision=y,m,B=!0);else return p.precision=y,s}s=u}}function ne(t,e){var n,r,i,o,s,u,c,a,f,l,p,m=1,y=10,g=t,w=g.d,h=g.constructor,b=h.rounding,x=h.precision;if(g.s<0||!w||!w[0]||!g.e&&w[0]==1&&w.length==1)return new h(w&&!w[0]?-1/0:g.s!=1?NaN:w?0:g);if(e==null?(B=!1,f=x):f=e,h.precision=f+=y,n=q(w),r=n.charAt(0),Math.abs(o=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(t),n=q(g.d),r=n.charAt(0),m++;o=g.e,r>1?(g=new h("0."+n),o++):g=new h(r+"."+n.slice(1))}else return a=ve(h,f+2,x).times(o+""),g=ne(new h(r+"."+n.slice(1)),f-y).plus(a),h.precision=x,e==null?T(g,x,b,B=!0):g;for(l=g,c=s=g=C(g.minus(1),g.plus(1),f,1),p=T(g.times(g),f,1),i=3;;){if(s=T(s.times(p),f,1),a=c.plus(C(s,new h(i),f,1)),q(a.d).slice(0,f)===q(c.d).slice(0,f))if(c=c.times(2),o!==0&&(c=c.plus(ve(h,f+2,x).times(o+""))),c=C(c,new h(m),f,1),e==null)if(Pe(c.d,f-y,b,u))h.precision=f+=y,a=s=g=C(l.minus(1),l.plus(1),f,1),p=T(g.times(g),f,1),i=u=1;else return T(c,h.precision=x,b,B=!0);else return h.precision=x,c;c=a,i+=2}}function Xt(t){return String(t.s*t.s/0)}function st(t,e){var n,r,i;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;r++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(r,i),e){if(i-=r,t.e=n=n-r-1,t.d=[],r=(n+1)%A,n<0&&(r+=A),r<i){for(r&&t.d.push(+e.slice(0,r)),i-=A;r<i;)t.d.push(+e.slice(r,r+=A));e=e.slice(r),r=A-e.length}else r-=i;for(;r--;)e+="0";t.d.push(+e),B&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function On(t,e){var n,r,i,o,s,u,c,a,f;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),jt.test(e))return st(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(Kn.test(e))n=16,e=e.toLowerCase();else if(Dn.test(e))n=2;else if(In.test(e))n=8;else throw Error(re+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,r=t.constructor,s&&(e=e.replace(".",""),u=e.length,o=u-o,i=Yt(r,new r(n),o,o*2)),a=De(e,n,Z),f=a.length-1,o=f;a[o]===0;--o)a.pop();return o<0?new r(t.s*0):(t.e=Fe(a,f),t.d=a,B=!1,s&&(t=C(t,i,u*4)),c&&(t=t.times(Math.abs(c)<54?O(2,c):Ve.pow(2,c))),B=!0,t)}function Vn(t,e){var n,r=e.d.length;if(r<3)return e.isZero()?e:ge(t,2,e,e);n=1.4*Math.sqrt(r),n=n>16?16:n|0,e=e.times(1/Oe(5,n)),e=ge(t,2,e,e);for(var i,o=new t(5),s=new t(16),u=new t(20);n--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(u))));return e}function ge(t,e,n,r,i){var o,s,u,c,a=1,f=t.precision,l=Math.ceil(f/A);for(B=!1,c=n.times(n),u=new t(r);;){if(s=C(u.times(c),new t(e++*e++),f,1),u=i?r.plus(s):r.minus(s),r=C(s.times(c),new t(e++*e++),f,1),s=u.plus(r),s.d[l]!==void 0){for(o=l;s.d[o]===u.d[o]&&o--;);if(o==-1)break}o=u,u=r,r=s,s=o,a++}return B=!0,s.d.length=l+1,s}function Oe(t,e){for(var n=t;--e;)n*=t;return n}function Jt(t,e){var n,r=e.s<0,i=Y(t,t.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return ee=r?4:1,e;if(n=e.divToInt(i),n.isZero())ee=r?3:2;else{if(e=e.minus(n.times(i)),e.lte(o))return ee=Vt(n)?r?2:3:r?4:1,e;ee=Vt(n)?r?1:4:r?3:2}return e.minus(i).abs()}function ut(t,e,n,r){var i,o,s,u,c,a,f,l,p,m=t.constructor,y=n!==void 0;if(y?(j(n,1,ie),r===void 0?r=m.rounding:j(r,0,8)):(n=m.precision,r=m.rounding),!t.isFinite())f=Xt(t);else{for(f=J(t),s=f.indexOf("."),y?(i=2,e==16?n=n*4-3:e==8&&(n=n*3-2)):i=e,s>=0&&(f=f.replace(".",""),p=new m(1),p.e=f.length-s,p.d=De(J(p),10,i),p.e=p.d.length),l=De(f,10,i),o=c=l.length;l[--c]==0;)l.pop();if(!l[0])f=y?"0p+0":"0";else{if(s<0?o--:(t=new m(t),t.d=l,t.e=o,t=C(t,p,n,r,0,i),l=t.d,o=t.e,a=Ut),s=l[n],u=i/2,a=a||l[n+1]!==void 0,a=r<4?(s!==void 0||a)&&(r===0||r===(t.s<0?3:2)):s>u||s===u&&(r===4||a||r===6&&l[n-1]&1||r===(t.s<0?8:7)),l.length=n,a)for(;++l[--n]>i-1;)l[n]=0,n||(++o,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,f="";s<c;s++)f+=nt.charAt(l[s]);if(y){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)f+="0";for(l=De(f,i,e),c=l.length;!l[c-1];--c);for(s=1,f="1.";s<c;s++)f+=nt.charAt(l[s])}else f=f.charAt(0)+"."+f.slice(1);f=f+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)f="0"+f;f="0."+f}else if(++o>c)for(o-=c;o--;)f+="0";else o<c&&(f=f.slice(0,o)+"."+f.slice(o))}f=(e==16?"0x":e==2?"0b":e==8?"0o":"")+f}return t.s<0?"-"+f:f}function qt(t,e){if(t.length>e)return t.length=e,!0}function qn(t){return new this(t).abs()}function Wn(t){return new this(t).acos()}function Un(t){return new this(t).acosh()}function Gn(t,e){return new this(t).plus(e)}function Hn(t){return new this(t).asin()}function zn(t){return new this(t).asinh()}function jn(t){return new this(t).atan()}function Qn(t){return new this(t).atanh()}function Yn(t,e){t=new this(t),e=new this(e);var n,r=this.precision,i=this.rounding,o=r+4;return!t.s||!e.s?n=new this(NaN):!t.d&&!e.d?(n=Y(this,o,1).times(e.s>0?.25:.75),n.s=t.s):!e.d||t.isZero()?(n=e.s<0?Y(this,r,i):new this(0),n.s=t.s):!t.d||e.isZero()?(n=Y(this,o,1).times(.5),n.s=t.s):e.s<0?(this.precision=o,this.rounding=1,n=this.atan(C(t,e,o,1)),e=Y(this,o,1),this.precision=r,this.rounding=i,n=t.s<0?n.minus(e):n.plus(e)):n=this.atan(C(t,e,o,1)),n}function Zn(t){return new this(t).cbrt()}function Xn(t){return T(t=new this(t),t.e+1,2)}function Jn(t,e,n){return new this(t).clamp(e,n)}function $n(t){if(!t||typeof t!="object")throw Error(_e+"Object expected");var e,n,r,i=t.defaults===!0,o=["precision",1,ie,"rounding",0,8,"toExpNeg",-me,0,"toExpPos",0,me,"maxE",0,me,"minE",-me,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(n=o[e],i&&(this[n]=rt[n]),(r=t[n])!==void 0)if(G(r)===r&&r>=o[e+1]&&r<=o[e+2])this[n]=r;else throw Error(re+n+": "+r);if(n="crypto",i&&(this[n]=rt[n]),(r=t[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Ht);else this[n]=!1;else throw Error(re+n+": "+r);return this}function er(t){return new this(t).cos()}function tr(t){return new this(t).cosh()}function $t(t){var e,n,r;function i(o){var s,u,c,a=this;if(!(a instanceof i))return new i(o);if(a.constructor=i,Wt(o)){a.s=o.s,B?!o.d||o.e>i.maxE?(a.e=NaN,a.d=null):o.e<i.minE?(a.e=0,a.d=[0]):(a.e=o.e,a.d=o.d.slice()):(a.e=o.e,a.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){a.s=1/o<0?-1:1,a.e=0,a.d=[0];return}if(o<0?(o=-o,a.s=-1):a.s=1,o===~~o&&o<1e7){for(s=0,u=o;u>=10;u/=10)s++;B?s>i.maxE?(a.e=NaN,a.d=null):s<i.minE?(a.e=0,a.d=[0]):(a.e=s,a.d=[o]):(a.e=s,a.d=[o]);return}else if(o*0!==0){o||(a.s=NaN),a.e=NaN,a.d=null;return}return st(a,o.toString())}else if(c!=="string")throw Error(re+o);return(u=o.charCodeAt(0))===45?(o=o.slice(1),a.s=-1):(u===43&&(o=o.slice(1)),a.s=1),jt.test(o)?st(a,o):On(a,o)}if(i.prototype=d,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=$n,i.clone=$t,i.isDecimal=Wt,i.abs=qn,i.acos=Wn,i.acosh=Un,i.add=Gn,i.asin=Hn,i.asinh=zn,i.atan=jn,i.atanh=Qn,i.atan2=Yn,i.cbrt=Zn,i.ceil=Xn,i.clamp=Jn,i.cos=er,i.cosh=tr,i.div=nr,i.exp=rr,i.floor=ir,i.hypot=or,i.ln=sr,i.log=ur,i.log10=cr,i.log2=ar,i.max=lr,i.min=fr,i.mod=pr,i.mul=dr,i.pow=mr,i.random=gr,i.round=hr,i.sign=br,i.sin=yr,i.sinh=wr,i.sqrt=xr,i.sub=Tr,i.sum=Pr,i.tan=Ar,i.tanh=Br,i.trunc=Sr,t===void 0&&(t={}),t&&t.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return i.config(t),i}function nr(t,e){return new this(t).div(e)}function rr(t){return new this(t).exp()}function ir(t){return T(t=new this(t),t.e+1,3)}function or(){var t,e,n=new this(0);for(B=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)n.d&&(n=n.plus(e.times(e)));else{if(e.s)return B=!0,new this(1/0);n=e}return B=!0,n.sqrt()}function Wt(t){return t instanceof Ve||t&&t.toStringTag===zt||!1}function sr(t){return new this(t).ln()}function ur(t,e){return new this(t).log(e)}function ar(t){return new this(t).log(2)}function cr(t){return new this(t).log(10)}function lr(){return Zt(this,arguments,"lt")}function fr(){return Zt(this,arguments,"gt")}function pr(t,e){return new this(t).mod(e)}function dr(t,e){return new this(t).mul(e)}function mr(t,e){return new this(t).pow(e)}function gr(t){var e,n,r,i,o=0,s=new this(1),u=[];if(t===void 0?t=this.precision:j(t,1,ie),r=Math.ceil(t/A),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));o<r;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:u[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);o<r;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(u.push(i%1e7),o+=4);o=r/4}else throw Error(Ht);else for(;o<r;)u[o++]=Math.random()*1e7|0;for(r=u[--o],t%=A,r&&t&&(i=O(10,A-t),u[o]=(r/i|0)*i);u[o]===0;o--)u.pop();if(o<0)n=0,u=[0];else{for(n=-1;u[0]===0;n-=A)u.shift();for(r=1,i=u[0];i>=10;i/=10)r++;r<A&&(n-=A-r)}return s.e=n,s.d=u,s}function hr(t){return T(t=new this(t),t.e+1,this.rounding)}function br(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function yr(t){return new this(t).sin()}function wr(t){return new this(t).sinh()}function xr(t){return new this(t).sqrt()}function Tr(t,e){return new this(t).sub(e)}function Pr(){var t=0,e=arguments,n=new this(e[t]);for(B=!1;n.s&&++t<e.length;)n=n.plus(e[t]);return B=!0,T(n,this.precision,this.rounding)}function Ar(t){return new this(t).tan()}function Br(t){return new this(t).tanh()}function Sr(t){return T(t=new this(t),t.e+1,1)}d[Symbol.for("nodejs.util.inspect.custom")]=d.toString;d[Symbol.toStringTag]="Decimal";var Ve=d.constructor=$t(rt);Ke=new Ve(Ke);Ie=new Ve(Ie);import{PublicKey as ct}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Lr}from"@solana/spl-token";import{PublicKey as K,SystemProgram as tn,SYSVAR_RENT_PUBKEY as kr}from"@solana/web3.js";function at({pubkey:t,isSigner:e=!1,isWritable:n=!0}){return{pubkey:t,isWritable:n,isSigner:e}}var ki=[at({pubkey:Lr,isWritable:!1}),at({pubkey:tn.programId,isWritable:!1}),at({pubkey:kr,isWritable:!1})];function nn({publicKey:t,transformSol:e}){let n=rn(t.toString());if(n instanceof K)return e&&n.equals(Ae)?en:n;if(e&&n.toString()===Ae.toBase58())return en;if(typeof n=="string"){if(n===K.default.toBase58())return K.default;try{return new K(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function rn(t){try{return new K(t)}catch{return t}}var Ni=new K("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ci=new K("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ei=new K("SysvarRent111111111111111111111111111111111"),Mi=new K("SysvarC1ock11111111111111111111111111111111"),Ri=new K("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Di=new K("Sysvar1nstructions1111111111111111111111111"),Ki=tn.programId,Ii=new K("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),vi=new K("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),_i=new K("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Fi=new K("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Oi=new K("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Vi=new K("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),qi=new K("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Wi=new K("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ui=new K("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Gi=new K("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Hi=new K("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),en=new K("So11111111111111111111111111111111111111112"),Ae=K.default;import{PublicKey as Nr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as on}from"@solana/spl-token";var sn={chainId:101,address:Nr.default.toBase58(),programId:on.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:on.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var lt=class{constructor({mint:e,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Ae.toBase58()||e instanceof ct&&Ae.equals(e)){this.decimals=le.decimals,this.symbol=le.symbol,this.name=le.name,this.mint=new ct(le.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?ct.default:nn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},he=lt;he.WSOL=new lt({...le,mint:le.address});import We from"big.js";import Mr from"bn.js";import Rr from"decimal.js-light";import Cr from"toformat";var Er=Cr,Be=Er;var qe=U("module/fraction"),ft=Be(We),Se=Be(Rr),Dr={[0]:Se.ROUND_DOWN,[1]:Se.ROUND_HALF_UP,[2]:Se.ROUND_UP},Kr={[0]:We.roundDown,[1]:We.roundHalfUp,[2]:We.roundUp},R=class{constructor(e,n=new Mr(1)){this.numerator=oe(e),this.denominator=oe(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new R(this.denominator,this.numerator)}add(e){let n=e instanceof R?e:new R(oe(e));return this.denominator.eq(n.denominator)?new R(this.numerator.add(n.numerator),this.denominator):new R(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(e){let n=e instanceof R?e:new R(oe(e));return this.denominator.eq(n.denominator)?new R(this.numerator.sub(n.numerator),this.denominator):new R(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(e){let n=e instanceof R?e:new R(oe(e));return new R(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(e){let n=e instanceof R?e:new R(oe(e));return new R(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(e,n={groupSeparator:""},r=1){Number.isInteger(e)||qe.logWithError(`${e} is not an integer.`),e<=0&&qe.logWithError(`${e} is not positive.`),Se.set({precision:e+1,rounding:Dr[r]});let i=new Se(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),n)}toFixed(e,n={groupSeparator:""},r=1){return Number.isInteger(e)||qe.logWithError(`${e} is not an integer.`),e<0&&qe.logWithError(`${e} is negative.`),ft.DP=e,ft.RM=Kr[r]||1,new ft(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,n)}isZero(){return this.numerator.isZero()}};var yo=U("Raydium_price");var pt=class{constructor({decimals:e,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=e,this.symbol=n,this.name=r}equals(e){return this===e}},Ue=pt;Ue.SOL=new pt(sn);import vr from"bn.js";var Lo=new R(new vr(100));var Ge=new Q(0),zo=new Q(1),jo=new Q(2),Qo=new Q(3),Yo=new Q(5),_r=new Q(10),Zo=new Q(100),Xo=new Q(1e3),Jo=new Q(1e4),ln=9007199254740991;function oe(t){let e=U("Raydium_parseBigNumberish");if(t instanceof Q)return t;if(typeof t=="string"){if(t.match(/^-?[0-9]+$/))return new Q(t);e.logWithError(`invalid BigNumberish string: ${t}`)}return typeof t=="number"?(t%1&&e.logWithError(`BigNumberish number underflow: ${t}`),(t>=ln||t<=-ln)&&e.logWithError(`BigNumberish number overflow: ${t}`),new Q(String(t))):typeof t=="bigint"?new Q(t.toString()):(e.error(`invalid BigNumberish value: ${t}`),new Q(0))}var ps=U("Raydium_amount"),ds=Be(Fr);function dt(t,e=1,n=[]){let r=[...t];if(e<=0)return n;for(;r.length;)n.push(r.splice(0,e));return n}import{PublicKey as v}from"@solana/web3.js";var Ks=new v("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Is=new v("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),vs=new v("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),_s=new v("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Fs=new v("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Os=new v("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Vs=new v("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),qs=new v("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ws=new v("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Us=new v("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Gs=new v("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Hs=new v("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),zs=new v("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),js=new v("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Qs=new v("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ys=new v("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Zs=new v("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Xs=new v("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Js=new v("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),$s=new v("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as ru}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as su}from"@solana/spl-token";import cu from"bn.js";var mt=U("Raydium_accountInfo_util");async function fn(t,e,n){let{batchRequest:r,commitment:i="confirmed"}={batchRequest:!1,...n},o=dt(e,100),s=new Array(o.length).fill([]);if(r){let u=o.map(f=>{let l=t._buildArgs([f.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:l}}),c=dt(u,10);s=(await(await Promise.all(c.map(async f=>await t._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(l=>{if(l){let{data:p,executable:m,lamports:y,owner:g,rentEpoch:w}=l;return p.length!==2&&p[1]!=="base64"&&mt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:m,lamports:y,owner:new Or(g),rentEpoch:w}}return null})))}else try{s=await Promise.all(o.map(u=>t.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return s.flat()}async function gt({connection:t,address:e}){let n=await fn(t,[...new Set(e.map(i=>i.toString()))].map(i=>new pn(i))),r={};for(let i=0;i<e.length;i++){let o=n[i],s=e[i];if(!o)continue;let u=new He({key:s,state:He.deserialize(o.data)});r[s.toString()]=u,ze[s.toString()]=u}return r}var ze={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new He({key:new pn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:He.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var je=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let e=(await Vr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=e==null?void 0:e[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:n,instructionTypes:r}=Re(e);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:e,defaultIns:n}){try{let r=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:e=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(u=>u!==Le.default.toString())),this}async versionBuild({txVersion:e,extInfo:n}){return e===0?await this.buildV0({...n||{}}):this.build(n)}build(e){let n=new ke;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:i,skipPreflight:o=!0}=r||{},s=i!=null?i:await de(this.connection);if(n.recentBlockhash=s,this.signers.length&&n.sign(...this.signers),ce([n]),(u=this.owner)!=null&&u.isKeyPair)return{txId:await ht(this.connection,n,this.signers.find(c=>c.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:o}),signedTx:n};if(this.signAllTransactions){let c=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:o}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){let{extraPreBuildData:n=[],extInfo:r}=e,{transaction:i}=this.build(r),o=n.filter(a=>a.transaction.instructions.length>0),s=[i,...o.map(a=>a.transaction)],u=[this.signers,...o.map(a=>a.signers)],c=[...this.instructionTypes,...o.map(a=>a.instructionTypes).flat()];return{builder:this,transactions:s,signers:u,instructionTypes:c,execute:async a=>{var g;let{sequentially:f,onTxUpdate:l,recentBlockHash:p,skipPreflight:m=!0}=a||{},y=p!=null?p:await de(this.connection);if((g=this.owner)!=null&&g.isKeyPair)return{txIds:await await Promise.all(s.map(async(w,h)=>(w.recentBlockhash=y,await ht(this.connection,w,u[h].find(b=>b.publicKey.equals(this.owner.publicKey))?u[h]:[...u[h],this.owner.signer],{skipPreflight:m})))),signedTxs:s};if(this.signAllTransactions){let w=s.map((b,x)=>(b.recentBlockhash=y,u[x].length&&b.sign(...u[x]),b));ce(w);let h=await this.signAllTransactions(w);if(f){let b=0,x=[],P=async()=>{if(!h[b])return;let N=await this.connection.sendRawTransaction(h[b].serialize(),{skipPreflight:m});x.push({txId:N,status:"sent",signedTx:h[b]}),l==null||l([...x]),b++,this.connection.onSignature(N,k=>{let E=x.findIndex(D=>D.txId===N);E>-1&&(x[E].status=k.err?"error":"success"),l==null||l([...x]),k.err||P()},"processed"),this.connection.getSignatureStatus(N)};return await P(),{txIds:x.map(N=>N.txId),signedTxs:h}}else{let b=[];for(let x=0;x<h.length;x+=1){let P=await this.connection.sendRawTransaction(h[x].serialize(),{skipPreflight:m});b.push(P)}return{txIds:b,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:r})}async buildV0(e){let{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i,...o}=e||{},s={...this.cluster==="devnet"?{}:ze,...n},u=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let p of u)s[p]===void 0&&c.push(new Le(p));let a=await gt({connection:this.connection,address:c});for(let[p,m]of Object.entries(a))s[p]=m;let f=new Ne({payerKey:this.feePayer,recentBlockhash:i?Le.default.toBase58():await de(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),l=new Ce(f);return l.sign(this.signers),{builder:this,transaction:l,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async p=>{var g;let{recentBlockHash:m,skipPreflight:y=!0}=p||{};if(m&&(l.message.recentBlockhash=m),ce([l]),(g=this.owner)!=null&&g.isKeyPair){this.signers.find(x=>x.publicKey.equals(this.owner.publicKey))||l.sign([this.owner.signer]);let w=await this.connection.sendTransaction(l,{skipPreflight:y}),{lastValidBlockHeight:h,blockhash:b}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:b,lastValidBlockHeight:h,signature:w},"confirmed"),{txId:w,signedTx:l}}if(this.signAllTransactions){let w=await this.signAllTransactions([l]);return{txId:await this.connection.sendTransaction(w[0],{skipPreflight:y}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async buildV0MultiTx(e){let{extraPreBuildData:n=[],buildProps:r}=e,{transaction:i}=await this.buildV0(r),o=n.filter(a=>a.builder.instructions.length>0),s=[i,...o.map(a=>a.transaction)],u=[this.signers,...o.map(a=>a.signers)],c=[...this.instructionTypes,...o.map(a=>a.instructionTypes).flat()];return s.forEach(async(a,f)=>{a.sign(u[f])}),{builder:this,transactions:s,signers:u,instructionTypes:c,buildProps:r,execute:async a=>{var y;let{sequentially:f,onTxUpdate:l,recentBlockHash:p,skipPreflight:m=!0}=a||{};if(p&&s.forEach(g=>g.message.recentBlockhash=p),ce(s),(y=this.owner)!=null&&y.isKeyPair){let{lastValidBlockHeight:g,blockhash:w}=await this.connection.getLatestBlockhash();return s.forEach((h,b)=>{u[b].find(x=>x.publicKey.equals(this.owner.publicKey))||h.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async h=>{let b=await this.connection.sendTransaction(h,{skipPreflight:m});return await this.connection.confirmTransaction({blockhash:w,lastValidBlockHeight:g,signature:b},"confirmed"),b})),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(f){let w=0,h=[],b=async()=>{if(!g[w])return;let x=await this.connection.sendTransaction(g[w],{skipPreflight:m});h.push({txId:x,status:"sent",signedTx:g[w]}),l==null||l([...h]),w++,this.connection.onSignature(x,P=>{let N=h.findIndex(k=>k.txId===x);N>-1&&(h[N].status=P.err?"error":"success"),l==null||l([...h]),P.err||b()},"processed"),this.connection.getSignatureStatus(x)};return b(),{txIds:[],signedTxs:g}}else{let w=[];for(let h=0;h<g.length;h+=1){let b=await this.connection.sendTransaction(g[h],{skipPreflight:m});w.push(b)}return{txIds:w,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(e){let{computeBudgetConfig:n,...r}=e||{},i=n?Re(n):{instructions:[],instructionTypes:[]},o=this.signers.reduce((a,f)=>({...a,[f.publicKey.toBase58()]:f}),{}),s=[],u=[],c=[];if(this.allInstructions.forEach(a=>{let f=[...c,a],l=n?[...i.instructions,...f]:f,m=[...new Set(f.map(y=>y.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(y=>new Le(y));if(c.length<12&&xe({instructions:l,payer:this.feePayer,signers:m})||xe({instructions:f,payer:this.feePayer,signers:m}))c.push(a);else{if(c.length===0)throw Error("item ins too big");xe({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:m})?s.push(new ke().add(...i.instructions,...c)):s.push(new ke().add(...c)),u.push(Array.from(new Set(c.map(y=>y.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),c=[a]}}),c.length>0){let f=[...new Set(c.map(l=>l.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(l=>o[l]).filter(l=>l!==void 0);xe({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:f.map(l=>l.publicKey)})?s.push(new ke().add(...i.instructions,...c)):s.push(new ke().add(...c)),u.push(f)}return s.forEach(a=>a.feePayer=this.feePayer),{builder:this,transactions:s,signers:u,instructionTypes:this.instructionTypes,execute:async a=>{var g;let{sequentially:f,onTxUpdate:l,recentBlockHash:p,skipPreflight:m=!0}=a||{},y=p!=null?p:await de(this.connection);if(s.forEach(async(w,h)=>{w.recentBlockhash=y,u[h].length&&w.sign(...u[h])}),ce(s),(g=this.owner)!=null&&g.isKeyPair)return{txIds:await Promise.all(s.map(async(w,h)=>await ht(this.connection,w,u[h].find(b=>b.publicKey.equals(this.owner.publicKey))?u[h]:[...u[h],this.owner.signer],{skipPreflight:m}))),signedTxs:s};if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(f){let h=0,b=[],x=async()=>{if(!w[h])return;let P=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:m});b.push({txId:P,status:"sent",signedTx:w[h]}),l==null||l([...b]),h++,this.connection.onSignature(P,N=>{let k=b.findIndex(E=>E.txId===P);k>-1&&(b[k].status=N.err?"error":"success"),l==null||l([...b]),N.err||x()},"processed"),this.connection.getSignatureStatus(P)};return await x(),{txIds:b.map(P=>P.txId),signedTxs:w}}else{let h=[];for(let b=0;b<w.length;b+=1){let x=await this.connection.sendRawTransaction(w[b].serialize(),{skipPreflight:m});h.push(x)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){let{computeBudgetConfig:n,lookupTableCache:r={},lookupTableAddress:i=[],...o}=e||{},s={...this.cluster==="devnet"?{}:ze,...r},u=Array.from(new Set([...this.lookupTableAddress,...i])),c=[];for(let w of u)s[w]===void 0&&c.push(new Le(w));let a=await gt({connection:this.connection,address:c});for(let[w,h]of Object.entries(a))s[w]=h;let f=n?Re(n):{instructions:[],instructionTypes:[]},l=await de(this.connection),p=this.signers.reduce((w,h)=>({...w,[h.publicKey.toBase58()]:h}),{}),m=[],y=[],g=[];if(this.allInstructions.forEach(w=>{let h=[...g,w],b=n?[...f.instructions,...h]:h;if(g.length<12&&Te({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s})||Te({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(w);else{if(g.length===0)throw Error("item ins too big");let x={};for(let P of[...new Set(u)])s[P]!==void 0&&(x[P]=s[P]);if(n&&Te({instructions:[...f.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let P=new Ne({payerKey:this.feePayer,recentBlockhash:l,instructions:[...f.instructions,...g]}).compileToV0Message(Object.values(s));m.push(new Ce(P))}else{let P=new Ne({payerKey:this.feePayer,recentBlockhash:l,instructions:[...g]}).compileToV0Message(Object.values(s));m.push(new Ce(P))}y.push(Array.from(new Set(g.map(P=>P.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat())).map(P=>p[P]).filter(P=>P!==void 0)),g=[w]}}),g.length>0){let h=[...new Set(g.map(b=>b.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(b=>p[b]).filter(b=>b!==void 0);if(n&&Te({instructions:[...f.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let b=new Ne({payerKey:this.feePayer,recentBlockhash:l,instructions:[...f.instructions,...g]}).compileToV0Message(Object.values(s));m.push(new Ce(b))}else{let b=new Ne({payerKey:this.feePayer,recentBlockhash:l,instructions:[...g]}).compileToV0Message(Object.values(s));m.push(new Ce(b))}y.push(h)}return{builder:this,transactions:m,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var N;let{sequentially:h,onTxUpdate:b,recentBlockHash:x,skipPreflight:P=!0}=w||{};if(m.map(async(k,E)=>{y[E].length&&k.sign(y[E]),x&&(k.message.recentBlockhash=x)}),ce(m),(N=this.owner)!=null&&N.isKeyPair){let{lastValidBlockHeight:k,blockhash:E}=await this.connection.getLatestBlockhash();return m.forEach((D,V)=>{y[V].find(F=>F.publicKey.equals(this.owner.publicKey))||D.sign([this.owner.signer])}),{txIds:await Promise.all(m.map(async D=>{let V=await this.connection.sendTransaction(D,{skipPreflight:P});return await this.connection.confirmTransaction({blockhash:E,lastValidBlockHeight:k,signature:V},"confirmed"),V})),signedTxs:m}}if(this.signAllTransactions){let k=await this.signAllTransactions(m);if(h){let E=0,D=[],V=async()=>{if(!k[E])return;let F=await this.connection.sendTransaction(k[E],{skipPreflight:P});D.push({txId:F,status:"sent",signedTx:k[E]}),b==null||b([...D]),E++,this.connection.onSignature(F,I=>{let $=D.findIndex(pe=>pe.txId===F);$>-1&&(D[$].status=I.err?"error":"success"),b==null||b([...D]),I.err||V()},"processed"),this.connection.getSignatureStatus(F)};return V(),{txIds:[],signedTxs:k}}else{let E=[];for(let D=0;D<k.length;D+=1){let V=await this.connection.sendTransaction(k[D],{skipPreflight:P});E.push(V)}return{txIds:E,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};var bt=(...t)=>t.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ee=class{constructor({scope:e,moduleName:n}){this.disabled=!1;this.scope=e,this.logger=U(n)}createTxBuilder(e){return this.scope.checkOwner(),new je({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(bt(e))}logInfo(...e){this.logger.info(bt(e))}logAndCreateError(...e){let n=bt(e);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as ei,Keypair as ti}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ni}from"@solana/spl-token";import Pc from"bn.js";import{PublicKey as Qr}from"@solana/web3.js";import gn,{isBN as Ja}from"bn.js";import{bits as qr,BitStructure as ia,blob as Wr,Blob as oa,cstr as sa,f32 as ua,f32be as aa,f64 as ca,f64be as la,greedy as fa,Layout as Ur,ns64 as pa,ns64be as da,nu64 as ma,nu64be as ga,offset as ha,s16 as ba,s16be as ya,s24 as wa,s24be as xa,s32 as Ta,s32be as Pa,s40 as Aa,s40be as Ba,s48 as Sa,s48be as La,s8 as ka,seq as Na,struct as Ca,Structure as Gr,u16 as Hr,u16be as Ea,u24 as Ma,u24be as Ra,u32 as zr,u32be as Da,u40 as Ka,u40be as Ia,u48 as va,u48be as _a,u8 as Fa,UInt as jr,union as Oa,Union as Va,unionLayoutDiscriminator as qa,utf8 as Wa}from"@solana/buffer-layout";var Qe=Ur,dn=Gr;var yt=jr;var mn=Hr;var wt=zr;var be=Wr;var xt=qr;var Tt=class extends Qe{constructor(n,r,i){super(n,i);this.blob=be(n),this.signed=r}decode(n,r=0){let i=new gn(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new gn(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}},Ye=class extends Qe{constructor(n){super(8,n);this._lower=xt(wt(),!1),this._upper=xt(wt(),!1)}addBoolean(n){this._lower.fields.length<32?this._lower.addBoolean(n):this._upper.addBoolean(n)}decode(n,r=0){let i=this._lower.decode(n,r),o=this._upper.decode(n,r+this._lower.span);return{...i,...o}}encode(n,r,i=0){return this._lower.encode(n,r,i)+this._upper.encode(n,r,i+this._lower.span)}};function Ze(t){return new yt(1,t)}function ye(t){return new yt(4,t)}function _(t){return new Tt(8,!1,t)}var Pt=class extends Qe{constructor(n,r,i,o){super(n.span,o);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function H(t){return new Pt(be(32),e=>new Qr(e),e=>e.toBuffer(),t)}var At=class extends dn{decode(e,n){return super.decode(e,n)}};function we(t,e,n){return new At(t,e,n)}var Yr=we([H("mint"),H("owner"),_("amount"),ye("delegateOption"),H("delegate"),Ze("state"),ye("isNativeOption"),_("isNative"),_("delegatedAmount"),ye("closeAuthorityOption"),H("closeAuthority")]);function Zr(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Bt(t,...e){if(!Zr(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function St(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function hn(t,e){Bt(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Je=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),X=(t,e)=>t<<32-e|t>>>e;var sc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Xr(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Lt(t){return typeof t=="string"&&(t=Xr(t)),Bt(t),t}var Xe=class{clone(){return this._cloneInto()}},uc={}.toString;function bn(t){let e=r=>t().update(Lt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Jr(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),u=Number(n&o),c=r?4:0,a=r?0:4;t.setUint32(e+c,s,r),t.setUint32(e+a,u,r)}var yn=(t,e,n)=>t&e^~t&n,wn=(t,e,n)=>t&e^t&n^e&n,$e=class extends Xe{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Je(this.buffer)}update(e){St(this);let{view:n,buffer:r,blockLen:i}=this;e=Lt(e);let o=e.length;for(let s=0;s<o;){let u=Math.min(i-this.pos,o-s);if(u===i){let c=Je(e);for(;i<=o-s;s+=i)this.process(c,s);continue}r.set(e.subarray(s,s+u),this.pos),this.pos+=u,s+=u,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){St(this),hn(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:i,isLE:o}=this,{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let l=s;l<i;l++)n[l]=0;Jr(r,i-8,BigInt(this.length*8),o),this.process(r,0);let u=Je(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let a=c/4,f=this.get();if(a>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<a;l++)u.setUint32(4*l,f[l],o)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:i,finished:o,destroyed:s,pos:u}=this;return e.length=i,e.pos=u,e.finished=o,e.destroyed=s,i%n&&e.buffer.set(r),e}};var $r=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),se=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ue=new Uint32Array(64),kt=class extends $e{constructor(){super(64,32,8,!1),this.A=se[0]|0,this.B=se[1]|0,this.C=se[2]|0,this.D=se[3]|0,this.E=se[4]|0,this.F=se[5]|0,this.G=se[6]|0,this.H=se[7]|0}get(){let{A:e,B:n,C:r,D:i,E:o,F:s,G:u,H:c}=this;return[e,n,r,i,o,s,u,c]}set(e,n,r,i,o,s,u,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=u|0,this.H=c|0}process(e,n){for(let l=0;l<16;l++,n+=4)ue[l]=e.getUint32(n,!1);for(let l=16;l<64;l++){let p=ue[l-15],m=ue[l-2],y=X(p,7)^X(p,18)^p>>>3,g=X(m,17)^X(m,19)^m>>>10;ue[l]=g+ue[l-7]+y+ue[l-16]|0}let{A:r,B:i,C:o,D:s,E:u,F:c,G:a,H:f}=this;for(let l=0;l<64;l++){let p=X(u,6)^X(u,11)^X(u,25),m=f+p+yn(u,c,a)+$r[l]+ue[l]|0,g=(X(r,2)^X(r,13)^X(r,22))+wn(r,i,o)|0;f=a,a=c,c=u,u=s+m|0,s=o,o=i,i=r,r=m+g|0}r=r+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,u=u+this.E|0,c=c+this.F|0,a=a+this.G|0,f=f+this.H|0,this.set(r,i,o,s,u,c,a,f)}roundClean(){ue.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var xn=bn(()=>new kt);var Lc=U("Raydium_Util");function ae({fromPublicKey:t,programId:e=ni}){let n=ti.generate().publicKey.toBase58().slice(0,32);return{publicKey:ri(t,n,e),seed:n}}function ri(t,e,n){let r=Buffer.concat([t.toBuffer(),Buffer.from(e),n.toBuffer()]),i=xn(r);return new ei(i)}import{TransactionInstruction as oi,SYSVAR_RENT_PUBKEY as si}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Tn}from"@solana/spl-token";import{createInitializeAccountInstruction as Pn}from"@solana/spl-token";import{SystemProgram as fe,Transaction as An}from"@solana/web3.js";function ii(t="accountFlags"){let e=new Ye(t);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var Nt=we([be(5),ii("accountFlags"),H("ownAddress"),_("vaultSignerNonce"),H("baseMint"),H("quoteMint"),H("baseVault"),_("baseDepositsTotal"),_("baseFeesAccrued"),H("quoteVault"),_("quoteDepositsTotal"),_("quoteFeesAccrued"),_("quoteDustThreshold"),H("requestQueue"),H("eventQueue"),H("bids"),H("asks"),_("baseLotSize"),_("quoteLotSize"),_("feeRateBps"),_("referrerRebatesAccrued"),be(7)]);function ui({programId:t,marketInfo:e}){let n=we([Ze("version"),ye("instruction"),_("baseLotSize"),_("quoteLotSize"),mn("feeRateBps"),_("vaultSignerNonce"),_("quoteDustThreshold")]),r=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:si,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),i=Buffer.alloc(n.span);return n.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},i),new oi({keys:r,programId:t,data:i})}async function Bn({connection:t,wallet:e,marketInfo:n}){let r=new An,i=await t.getMinimumBalanceForRentExemption(165);r.add(fe.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:n.baseVault.seed,newAccountPubkey:n.baseVault.publicKey,lamports:i,space:165,programId:Tn}),fe.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:n.quoteVault.seed,newAccountPubkey:n.quoteVault.publicKey,lamports:i,space:165,programId:Tn}),Pn(n.baseVault.publicKey,n.baseMint,n.vaultOwner),Pn(n.quoteVault.publicKey,n.quoteMint,n.vaultOwner));let o=new An;return o.add(fe.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:n.id.seed,newAccountPubkey:n.id.publicKey,lamports:await t.getMinimumBalanceForRentExemption(Nt.span),space:Nt.span,programId:n.programId}),fe.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:n.requestQueue.seed,newAccountPubkey:n.requestQueue.publicKey,lamports:await t.getMinimumBalanceForRentExemption(5120+12),space:5120+12,programId:n.programId}),fe.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:n.eventQueue.seed,newAccountPubkey:n.eventQueue.publicKey,lamports:await t.getMinimumBalanceForRentExemption(262144+12),space:262144+12,programId:n.programId}),fe.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:n.bids.seed,newAccountPubkey:n.bids.publicKey,lamports:await t.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:n.programId}),fe.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:n.asks.seed,newAccountPubkey:n.asks.publicKey,lamports:await t.getMinimumBalanceForRentExemption(65536+12),space:65536+12,programId:n.programId}),ui({programId:n.programId,marketInfo:{id:n.id.publicKey,requestQueue:n.requestQueue.publicKey,eventQueue:n.eventQueue.publicKey,bids:n.bids.publicKey,asks:n.asks.publicKey,baseVault:n.baseVault.publicKey,quoteVault:n.quoteVault.publicKey,baseMint:n.baseMint,quoteMint:n.quoteMint,baseLotSize:n.baseLotSize,quoteLotSize:n.quoteLotSize,feeRateBps:n.feeRateBps,vaultSignerNonce:n.vaultSignerNonce,quoteDustThreshold:n.quoteDustThreshold}})),[{transaction:r,signer:[],instructionTypes:[z.CreateAccount,z.CreateAccount,z.InitAccount,z.InitAccount]},{transaction:o,signer:[],instructionTypes:[z.CreateAccount,z.CreateAccount,z.CreateAccount,z.CreateAccount,z.CreateAccount,z.InitMarket]}]}var Et=class extends Ee{async create({baseInfo:e,quoteInfo:n,lotSize:r,tickSize:i,dexProgramId:o,txVersion:s,computeBudgetConfig:u}){let c=this.scope.ownerPubKey,a=ae({fromPublicKey:c,programId:o}),f=ae({fromPublicKey:c,programId:o}),l=ae({fromPublicKey:c,programId:o}),p=ae({fromPublicKey:c,programId:o}),m=ae({fromPublicKey:c,programId:o}),y=ae({fromPublicKey:c,programId:Sn}),g=ae({fromPublicKey:c,programId:Sn}),w=0,h=new Me(100);function b(){let F=new Me(0);for(;;)try{return{vaultOwner:Ct.createProgramAddressSync([a.publicKey.toBuffer(),F.toArrayLike(Buffer,"le",8)],o),vaultSignerNonce:F}}catch{if(F.iaddn(1),F.gt(new Me(25555)))throw Error("find vault owner error")}}let{vaultOwner:x,vaultSignerNonce:P}=b(),N=new Me(Math.round(10**e.decimals*r)),k=new Me(Math.round(r*10**n.decimals*i));if(N.eq(Ge))throw Error("lot size is too small");if(k.eq(Ge))throw Error("tick size or lot size is too small");let E=await Bn({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:o,id:a,baseMint:e.mint,quoteMint:n.mint,baseVault:y,quoteVault:g,vaultOwner:x,requestQueue:f,eventQueue:l,bids:p,asks:m,feeRateBps:w,quoteDustThreshold:h,vaultSignerNonce:P,baseLotSize:N,quoteLotSize:k}}),D=this.createTxBuilder();D.addCustomComputeBudget(u),D.addInstruction({instructions:E[0].transaction.instructions,signers:E[0].signer});let V=[];for await(let F of E.slice(1,E.length)){let I=this.createTxBuilder();I.addCustomComputeBudget(u),I.addInstruction({instructions:F.transaction.instructions,signers:F.signer,instructionTypes:F.instructionTypes});let $=await I.versionBuild({txVersion:s});V.push($)}return D.versionMultiBuild({extraPreBuildData:V,extInfo:{address:{marketId:a.publicKey,requestQueue:f.publicKey,eventQueue:l.publicKey,bids:p.publicKey,asks:m.publicKey,baseVault:y.publicKey,quoteVault:g.publicKey,baseMint:new Ct(e.mint),quoteMin:new Ct(n.mint)}},txVersion:s})}};export{Et as default};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=createMarket.mjs.map