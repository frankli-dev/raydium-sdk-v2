import{get as Yn,set as ji}from"lodash";import Zn from"dayjs";import Ji from"dayjs/plugin/utc";Zn.extend(Ji);var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Zn().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Qn={},$i={};function re(i){let e=Yn(Qn,i);if(!e){let t=Yn($i,i);e=new en({name:i,logLevel:t}),ji(Qn,i,e)}return e}import{PublicKey as co}from"@solana/web3.js";import lo from"bn.js";import so from"big.js";import Ut from"bn.js";import Te from"bn.js";var pt=9e15,et=1e9,tn="0123456789abcdef",Ot="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Et="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",nn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-pt,maxE:pt,crypto:!1},ei,Xe,M=!0,Wt="[DecimalError] ",$e=Wt+"Invalid argument: ",ti=Wt+"Precision limit exceeded",ni=Wt+"crypto unavailable",ii="[object Decimal]",ye=Math.floor,ae=Math.pow,er=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,tr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,nr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ri=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Me=1e7,C=7,ir=9007199254740991,rr=Ot.length-1,rn=Et.length-1,w={toStringTag:ii};w.absoluteValue=w.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),K(i)};w.ceil=function(){return K(new this.constructor(this),this.e+1,2)};w.clampedTo=w.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error($e+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};w.comparedTo=w.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};w.cosine=w.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=or(n,ci(n,t)),n.precision=i,n.rounding=e,K(Xe==2||Xe==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};w.cubeRoot=w.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(M=!1,o=l.s*ae(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=de(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ae(t,1/3),i=ye((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=Z(c.plus(l).times(a),c.plus(u),s+2,1),de(a.d).slice(0,s)===(t=de(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(K(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(K(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return M=!0,K(n,i,m.rounding,e)};w.decimalPlaces=w.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ye(this.e/C))*C,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};w.dividedBy=w.div=function(i){return Z(this,new this.constructor(i))};w.dividedToIntegerBy=w.divToInt=function(i){var e=this,t=e.constructor;return K(Z(e,new t(i),0,1,1),t.precision,t.rounding)};w.equals=w.eq=function(i){return this.cmp(i)===0};w.floor=function(){return K(new this.constructor(this),this.e+1,3)};w.greaterThan=w.gt=function(i){return this.cmp(i)>0};w.greaterThanOrEqualTo=w.gte=function(i){var e=this.cmp(i);return e==1||e===0};w.hyperbolicCosine=w.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Dt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=ft(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return K(o,s.precision=t,s.rounding=n,!0)};w.hyperbolicSine=w.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=ft(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Dt(5,i)),r=ft(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,K(r,e,t,!0)};w.hyperbolicTangent=w.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,Z(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};w.inverseCosine=w.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Re(t,r,o):new t(0):new t(NaN):e.isZero()?Re(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Re(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};w.inverseHyperbolicCosine=w.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,M=!1,t=t.times(t).minus(1).sqrt().plus(t),M=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};w.inverseHyperbolicSine=w.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,M=!1,t=t.times(t).plus(1).sqrt().plus(t),M=!0,n.precision=i,n.rounding=e,t.ln())};w.inverseHyperbolicTangent=w.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?K(new o(r),i,e,!0):(o.precision=t=n-r.e,r=Z(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};w.inverseSine=w.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Re(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};w.inverseTangent=w.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=rn)return s=Re(l,m+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=rn)return s=Re(l,m+4,p).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/C+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(M=!1,e=Math.ceil(a/C),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),M=!0,K(s,l.precision=m,l.rounding=p,!0)};w.isFinite=function(){return!!this.d};w.isInteger=w.isInt=function(){return!!this.d&&ye(this.e/C)>this.d.length-2};w.isNaN=function(){return!this.s};w.isNegative=w.isNeg=function(){return this.s<0};w.isPositive=w.isPos=function(){return this.s>0};w.isZero=function(){return!!this.d&&this.d[0]===0};w.lessThan=w.lt=function(i){return this.cmp(i)<0};w.lessThanOrEqualTo=w.lte=function(i){return this.cmp(i)<1};w.logarithm=w.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(M=!1,a=m+d,s=Je(c,a),n=e?Ft(l,a+10):Je(i,a),u=Z(s,n,a,1),At(u.d,r=m,p))do if(a+=10,s=Je(c,a),n=e?Ft(l,a+10):Je(i,a),u=Z(s,n,a,1),!o){+de(u.d).slice(r+1,r+15)+1==1e14&&(u=K(u,m+1,0));break}while(At(u.d,r+=10,p));return M=!0,K(u,m,p)};w.minus=w.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,b=d.constructor;if(i=new b(i),!d.d||!i.d)return!d.s||!i.s?i=new b(NaN):d.d?i.s=-i.s:i=new b(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,p=i.d,a=b.precision,u=b.rounding,!c[0]||!p[0]){if(p[0])i.s=-i.s;else if(c[0])i=new b(d);else return new b(u===3?-0:0);return M?K(i,a,u):i}if(t=ye(i.e/C),l=ye(d.e/C),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=p.length):(e=p,t=l,s=c.length),n=Math.max(Math.ceil(a/C),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=p.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=p[n]){m=c[n]<p[n];break}o=0}for(m&&(e=c,c=p,p=e,i.s=-i.s),s=c.length,n=p.length-s;n>0;--n)c[s++]=0;for(n=p.length;n>o;){if(c[--n]<p[n]){for(r=n;r&&c[--r]===0;)c[r]=Me-1;--c[r],c[n]+=Me}c[n]-=p[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=vt(c,t),M?K(i,a,u):i):new b(u===3?-0:0)};w.modulo=w.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?K(new n(t),n.precision,n.rounding):(M=!1,n.modulo==9?(e=Z(t,i.abs(),0,3,1),e.s*=i.s):e=Z(t,i,0,n.modulo,1),e=e.times(i),M=!0,t.minus(e))};w.naturalExponential=w.exp=function(){return on(this)};w.naturalLogarithm=w.ln=function(){return Je(this)};w.negated=w.neg=function(){var i=new this.constructor(this);return i.s=-i.s,K(i)};w.plus=w.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,p=m.constructor;if(i=new p(i),!m.d||!i.d)return!m.s||!i.s?i=new p(NaN):m.d||(i=new p(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=p.precision,u=p.rounding,!c[0]||!l[0])return l[0]||(i=new p(m)),M?K(i,a,u):i;if(o=ye(m.e/C),n=ye(i.e/C),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/C),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Me|0,c[r]%=Me;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=vt(c,n),M?K(i,a,u):i};w.precision=w.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error($e+i);return t.d?(e=oi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};w.round=function(){var i=this,e=i.constructor;return K(new e(i),i.e+1,e.rounding)};w.sine=w.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=ar(n,ci(n,t)),n.precision=i,n.rounding=e,K(Xe>2?t.neg():t,i,e,!0)):new n(NaN)};w.squareRoot=w.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(M=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=de(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=ye((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(Z(s,o,t+2,1)).times(.5),de(o.d).slice(0,t)===(e=de(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(K(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(K(n,u+1,1),i=!n.times(n).eq(s));break}return M=!0,K(n,u,l.rounding,i)};w.tangent=w.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=Z(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,K(Xe==2||Xe==4?t.neg():t,i,e,!0)):new n(NaN)};w.times=w.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,p=l.d,d=(i=new m(i)).d;if(i.s*=l.s,!p||!p[0]||!d||!d[0])return new m(!i.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?i.s/0:i.s*0);for(t=ye(l.e/C)+ye(i.e/C),u=p.length,c=d.length,u<c&&(o=p,p=d,d=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+d[n]*p[r-n-1]+e,o[r--]=a%Me|0,e=a/Me|0;o[r]=(o[r]+e)%Me|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=vt(o,t),M?K(i,m.precision,m.rounding):i};w.toBinary=function(i,e){return an(this,2,i,e)};w.toDecimalPlaces=w.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Pe(i,0,et),e===void 0?e=n.rounding:Pe(e,0,8),K(t,i+t.e+1,e))};w.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=De(n,!0):(Pe(i,0,et),e===void 0?e=r.rounding:Pe(e,0,8),n=K(new r(n),i+1,e),t=De(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=De(r):(Pe(i,0,et),e===void 0?e=o.rounding:Pe(e,0,8),n=K(new o(r),i+r.e+1,e),t=De(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};w.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,b=d.d,f=d.constructor;if(!b)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=oi(b)-d.e-1,s=o%C,e.d[0]=ae(10,s<0?C+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error($e+a);i=a.gt(e)?o>0?e:c:a}for(M=!1,a=new f(de(b)),l=f.precision,f.precision=o=b.length*C*2;m=Z(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=Z(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=d.s,p=Z(c,n,o,1).minus(d).abs().cmp(Z(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,M=!0,p};w.toHexadecimal=w.toHex=function(i,e){return an(this,16,i,e)};w.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Pe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(M=!1,t=Z(t,i,0,e,1).times(i),M=!0,K(t)):(i.s=t.s,t=i),t};w.toNumber=function(){return+this};w.toOctal=function(i,e){return an(this,8,i,e)};w.toPower=w.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(ae(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return K(a,n,o);if(e=ye(i.e/C),e>=i.d.length-1&&(t=c<0?-c:c)<=ir)return r=si(u,a,t,n),i.s<0?new u(1).div(r):K(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ae(+a,c),e=t==0||!isFinite(t)?ye(c*(Math.log("0."+de(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(M=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=on(i.times(Je(a,n+t)),n),r.d&&(r=K(r,n+5,1),At(r.d,n,o)&&(e=n+10,r=K(on(i.times(Je(a,e+t)),e),e+5,1),+de(r.d).slice(n+1,n+15)+1==1e14&&(r=K(r,n+1,0)))),r.s=s,M=!0,u.rounding=o,K(r,n,o))};w.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=De(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Pe(i,1,et),e===void 0?e=r.rounding:Pe(e,0,8),n=K(new r(n),i,e),t=De(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toSignificantDigits=w.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Pe(i,1,et),e===void 0?e=n.rounding:Pe(e,0,8)),K(new n(t),i,e)};w.toString=function(){var i=this,e=i.constructor,t=De(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};w.truncated=w.trunc=function(){return K(new this.constructor(this),this.e+1,1)};w.valueOf=w.toJSON=function(){var i=this,e=i.constructor,t=De(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function de(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=C-n.length,t&&(o+=je(t)),o+=n;s=i[e],n=s+"",t=C-n.length,t&&(o+=je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Pe(i,e,t){if(i!==~~i||i<e||i>t)throw Error($e+i)}function At(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=C,r=0):(r=Math.ceil((e+1)/C),e%=C),o=ae(10,C-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ae(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ae(10,e-3)-1,s}function Mt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=tn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function or(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Dt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=ft(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var Z=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,p,d,b,f,g,k,h,A,x,P,L,E,q,J,X,Q,Le,me=n.constructor,he=n.s==r.s?1:-1,te=n.d,z=r.d;if(!te||!te[0]||!z||!z[0])return new me(!n.s||!r.s||(te?z&&te[0]==z[0]:!z)?NaN:te&&te[0]==0||!z?he*0:he/0);for(u?(d=1,l=n.e-r.e):(u=Me,d=C,l=ye(n.e/d)-ye(r.e/d)),Q=z.length,J=te.length,k=new me(he),h=k.d=[],m=0;z[m]==(te[m]||0);m++);if(z[m]>(te[m]||0)&&l--,o==null?(L=o=me.precision,s=me.rounding):a?L=o+(n.e-r.e)+1:L=o,L<0)h.push(1),b=!0;else{if(L=L/d+2|0,m=0,Q==1){for(p=0,z=z[0],L++;(m<J||p)&&L--;m++)E=p*u+(te[m]||0),h[m]=E/z|0,p=E%z|0;b=p||m<J}else{for(p=u/(z[0]+1)|0,p>1&&(z=i(z,p,u),te=i(te,p,u),Q=z.length,J=te.length),q=Q,A=te.slice(0,Q),x=A.length;x<Q;)A[x++]=0;Le=z.slice(),Le.unshift(0),X=z[0],z[1]>=u/2&&++X;do p=0,c=e(z,A,Q,x),c<0?(P=A[0],Q!=x&&(P=P*u+(A[1]||0)),p=P/X|0,p>1?(p>=u&&(p=u-1),f=i(z,p,u),g=f.length,x=A.length,c=e(f,A,g,x),c==1&&(p--,t(f,Q<g?Le:z,g,u))):(p==0&&(c=p=1),f=z.slice()),g=f.length,g<x&&f.unshift(0),t(A,f,x,u),c==-1&&(x=A.length,c=e(z,A,Q,x),c<1&&(p++,t(A,Q<x?Le:z,x,u))),x=A.length):c===0&&(p++,A=[0]),h[m++]=p,c&&A[0]?A[x++]=te[q]||0:(A=[te[q]],x=1);while((q++<J||A[0]!==void 0)&&L--);b=A[0]!==void 0}h[0]||h.shift()}if(d==1)k.e=l,ei=b;else{for(m=1,p=h[0];p>=10;p/=10)m++;k.e=m+l*d-1,K(k,a?o+k.e+1:o,s,b)}return k}}();function K(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=C,s=e,l=m[p=0],u=l/ae(10,r-s-1)%10|0;else if(p=Math.ceil((o+1)/C),a=m.length,p>=a)if(n){for(;a++<=p;)m.push(0);l=u=0,r=1,o%=C,s=o-C+1}else break e;else{for(l=a=m[p],r=1;a>=10;a/=10)r++;o%=C,s=o-C+r,u=s<0?0:l/ae(10,r-s-1)%10|0}if(n=n||e<0||m[p+1]!==void 0||(s<0?l:l%ae(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ae(10,r-s):0:m[p-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=ae(10,(C-e%C)%C),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=p,a=1,p--):(m.length=p+1,a=ae(10,C-o),m[p]=s>0?(l/ae(10,r-s)%ae(10,s)|0)*a:0),c)for(;;)if(p==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Me&&(m[0]=1));break}else{if(m[p]+=a,m[p]!=Me)break;m[p--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return M&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function De(i,e,t){if(!i.isFinite())return ui(i);var n,r=i.e,o=de(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+je(-r-1)+o,t&&(n=t-s)>0&&(o+=je(n))):r>=s?(o+=je(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+je(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=je(n))),o}function vt(i,e){var t=i[0];for(e*=C;t>=10;t/=10)e++;return e}function Ft(i,e,t){if(e>rr)throw M=!0,t&&(i.precision=t),Error(ti);return K(new i(Ot),e,1,!0)}function Re(i,e,t){if(e>rn)throw Error(ti);return K(new i(Et),e,t,!0)}function oi(i){var e=i.length-1,t=e*C+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function je(i){for(var e="";i--;)e+="0";return e}function si(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/C+4);for(M=!1;;){if(t%2&&(o=o.times(e),Jn(o.d,s)&&(r=!0)),t=ye(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Jn(e.d,s)}return M=!0,o}function jn(i){return i.d[i.d.length-1]&1}function ai(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function on(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,p=i.constructor,d=p.rounding,b=p.precision;if(!i.d||!i.d[0]||i.e>17)return new p(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(M=!1,u=b):u=e,a=new p(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ae(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new p(1),p.precision=u;;){if(o=K(o.times(i),u,1),t=t.times(++l),a=s.plus(Z(o,t,u,1)),de(a.d).slice(0,u)===de(s.d).slice(0,u)){for(r=m;r--;)s=K(s.times(s),u,1);if(e==null)if(c<3&&At(s.d,u-n,d,c))p.precision=u+=10,t=o=a=new p(1),l=0,c++;else return K(s,p.precision=b,d,M=!0);else return p.precision=b,s}s=a}}function Je(i,e){var t,n,r,o,s,a,u,c,l,m,p,d=1,b=10,f=i,g=f.d,k=f.constructor,h=k.rounding,A=k.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new k(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(M=!1,l=A):l=e,k.precision=l+=b,t=de(g),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=de(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new k("0."+t),o++):f=new k(n+"."+t.slice(1))}else return c=Ft(k,l+2,A).times(o+""),f=Je(new k(n+"."+t.slice(1)),l-b).plus(c),k.precision=A,e==null?K(f,A,h,M=!0):f;for(m=f,u=s=f=Z(f.minus(1),f.plus(1),l,1),p=K(f.times(f),l,1),r=3;;){if(s=K(s.times(p),l,1),c=u.plus(Z(s,new k(r),l,1)),de(c.d).slice(0,l)===de(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Ft(k,l+2,A).times(o+""))),u=Z(u,new k(d),l,1),e==null)if(At(u.d,l-b,h,a))k.precision=l+=b,c=s=f=Z(m.minus(1),m.plus(1),l,1),p=K(f.times(f),l,1),r=a=1;else return K(u,k.precision=A,h,M=!0);else return k.precision=A,u;u=c,r+=2}}function ui(i){return String(i.s*i.s/0)}function sn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%C,t<0&&(n+=C),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=C;n<r;)i.d.push(+e.slice(n,n+=C));e=e.slice(n),n=C-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),M&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function sr(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ri.test(e))return sn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(tr.test(e))t=16,e=e.toLowerCase();else if(er.test(e))t=2;else if(nr.test(e))t=8;else throw Error($e+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=si(n,new n(t),o,o*2)),c=Mt(e,t,Me),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=vt(c,l),i.d=c,M=!1,s&&(i=Z(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?ae(2,u):ht.pow(2,u))),M=!0,i)}function ar(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:ft(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Dt(5,t)),e=ft(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function ft(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/C);for(M=!1,u=t.times(t),a=new i(n);;){if(s=Z(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=Z(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return M=!0,s.d.length=m+1,s}function Dt(i,e){for(var t=i;--e;)t*=i;return t}function ci(i,e){var t,n=e.s<0,r=Re(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Xe=n?4:1,e;if(t=e.divToInt(r),t.isZero())Xe=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Xe=jn(t)?n?2:3:n?4:1,e;Xe=jn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function an(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor,b=t!==void 0;if(b?(Pe(t,1,et),n===void 0?n=d.rounding:Pe(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=ui(i);else{for(l=De(i),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),p=new d(1),p.e=l.length-s,p.d=Mt(De(p),10,r),p.e=p.d.length),m=Mt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(i=new d(i),i.d=m,i.e=o,i=Z(i,p,t,n,0,r),m=i.d,o=i.e,c=ei),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=tn.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Mt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=tn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Jn(i,e){if(i.length>e)return i.length=e,!0}function ur(i){return new this(i).abs()}function cr(i){return new this(i).acos()}function lr(i){return new this(i).acosh()}function mr(i,e){return new this(i).plus(e)}function dr(i){return new this(i).asin()}function pr(i){return new this(i).asinh()}function fr(i){return new this(i).atan()}function br(i){return new this(i).atanh()}function yr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Re(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Re(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Re(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Z(i,e,o,1)),e=Re(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(Z(i,e,o,1)),t}function gr(i){return new this(i).cbrt()}function wr(i){return K(i=new this(i),i.e+1,2)}function kr(i,e,t){return new this(i).clamp(e,t)}function Ar(i){if(!i||typeof i!="object")throw Error(Wt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,et,"rounding",0,8,"toExpNeg",-pt,0,"toExpPos",0,pt,"maxE",0,pt,"minE",-pt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=nn[t]),(n=i[t])!==void 0)if(ye(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error($e+t+": "+n);if(t="crypto",r&&(this[t]=nn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ni);else this[t]=!1;else throw Error($e+t+": "+n);return this}function hr(i){return new this(i).cos()}function Pr(i){return new this(i).cosh()}function li(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,$n(o)){c.s=o.s,M?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;M?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return sn(c,o.toString())}else if(u!=="string")throw Error($e+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ri.test(o)?sn(c,o):sr(c,o)}if(r.prototype=w,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Ar,r.clone=li,r.isDecimal=$n,r.abs=ur,r.acos=cr,r.acosh=lr,r.add=mr,r.asin=dr,r.asinh=pr,r.atan=fr,r.atanh=br,r.atan2=yr,r.cbrt=gr,r.ceil=wr,r.clamp=kr,r.cos=hr,r.cosh=Pr,r.div=Tr,r.exp=xr,r.floor=Br,r.hypot=Ir,r.ln=Sr,r.log=Kr,r.log10=Nr,r.log2=Cr,r.max=Lr,r.min=Rr,r.mod=Mr,r.mul=Or,r.pow=Er,r.random=Fr,r.round=Wr,r.sign=vr,r.sin=Dr,r.sinh=_r,r.sqrt=qr,r.sub=Vr,r.sum=Gr,r.tan=Ur,r.tanh=Xr,r.trunc=Hr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Tr(i,e){return new this(i).div(e)}function xr(i){return new this(i).exp()}function Br(i){return K(i=new this(i),i.e+1,3)}function Ir(){var i,e,t=new this(0);for(M=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return M=!0,new this(1/0);t=e}return M=!0,t.sqrt()}function $n(i){return i instanceof ht||i&&i.toStringTag===ii||!1}function Sr(i){return new this(i).ln()}function Kr(i,e){return new this(i).log(e)}function Cr(i){return new this(i).log(2)}function Nr(i){return new this(i).log(10)}function Lr(){return ai(this,arguments,"lt")}function Rr(){return ai(this,arguments,"gt")}function Mr(i,e){return new this(i).mod(e)}function Or(i,e){return new this(i).mul(e)}function Er(i,e){return new this(i).pow(e)}function Fr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Pe(i,1,et),n=Math.ceil(i/C),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(ni);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=C,n&&i&&(r=ae(10,C-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=C)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<C&&(t-=C-n)}return s.e=t,s.d=a,s}function Wr(i){return K(i=new this(i),i.e+1,this.rounding)}function vr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Dr(i){return new this(i).sin()}function _r(i){return new this(i).sinh()}function qr(i){return new this(i).sqrt()}function Vr(i,e){return new this(i).sub(e)}function Gr(){var i=0,e=arguments,t=new this(e[i]);for(M=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return M=!0,K(t,this.precision,this.rounding)}function Ur(i){return new this(i).tan()}function Xr(i){return new this(i).tanh()}function Hr(i){return K(i=new this(i),i.e+1,1)}w[Symbol.for("nodejs.util.inspect.custom")]=w.toString;w[Symbol.toStringTag]="Decimal";var ht=w.constructor=li(nn);Ot=new ht(Ot);Et=new ht(Et);var N=ht;import{PublicKey as mn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zr}from"@solana/spl-token";import{PublicKey as $,SystemProgram as mi,SYSVAR_RENT_PUBKEY as Yr}from"@solana/web3.js";function D({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ws=[D({pubkey:zr,isWritable:!1}),D({pubkey:mi.programId,isWritable:!1}),D({pubkey:Yr,isWritable:!1})];function un({publicKey:i,transformSol:e}){let t=cn(i.toString());if(t instanceof $)return e&&t.equals(Pt)?_t:t;if(e&&t.toString()===Pt.toBase58())return _t;if(typeof t=="string"){if(t===$.default.toBase58())return $.default;try{return new $(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function cn(i){try{return new $(i)}catch{return i}}var bt=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ks=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),yt=new $("SysvarRent111111111111111111111111111111111"),As=new $("SysvarC1ock11111111111111111111111111111111"),gt=new $("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),hs=new $("Sysvar1nstructions1111111111111111111111111"),Ps=mi.programId,Ts=new $("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),xs=new $("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Bs=new $("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Is=new $("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ss=new $("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ks=new $("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Cs=new $("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ns=new $("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ls=new $("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Rs=new $("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ms=new $("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),_t=new $("So11111111111111111111111111111111111111112"),Pt=$.default;function ln(i){return un({publicKey:i,transformSol:!0})}import{PublicKey as Qr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as di}from"@solana/spl-token";var pi={chainId:101,address:Qr.default.toBase58(),programId:di.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},tt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:di.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var dn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Pt.toBase58()||e instanceof mn&&Pt.equals(e)){this.decimals=tt.decimals,this.symbol=tt.symbol,this.name=tt.name,this.mint=new mn(tt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?mn.default:un({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},_e=dn;_e.WSOL=new dn({...tt,mint:tt.address});import Vt from"big.js";import Jr from"bn.js";import $r from"decimal.js-light";import Zr from"toformat";var jr=Zr,Tt=jr;var qt=re("module/fraction"),pn=Tt(Vt),xt=Tt($r),eo={[0]:xt.ROUND_DOWN,[1]:xt.ROUND_HALF_UP,[2]:xt.ROUND_UP},to={[0]:Vt.roundDown,[1]:Vt.roundHalfUp,[2]:Vt.roundUp},H=class{constructor(e,t=new Jr(1)){this.numerator=ee(e),this.denominator=ee(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(ee(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(ee(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(ee(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(ee(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||qt.logWithError(`${e} is not an integer.`),e<=0&&qt.logWithError(`${e} is not positive.`),xt.set({precision:e+1,rounding:eo[n]});let r=new xt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||qt.logWithError(`${e} is not an integer.`),e<0&&qt.logWithError(`${e} is negative.`),pn.DP=e,pn.RM=to[n]||1,new pn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var io=re("Raydium_price"),Ie=class extends H{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new H(fn(n.decimals),fn(r.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ie({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&io.logWithError("mul token not equals");let n=super.mul(t);return new Ie({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var bn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Gt=bn;Gt.SOL=new bn(pi);import ro from"bn.js";var fi=new H(new ro(100)),nt=class extends H{toSignificant(e=5,t,n){return this.mul(fi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(fi).toFixed(e,t,n)}};var yn=new Te(0),oo=new Te(1),Ca=new Te(2),Na=new Te(3),La=new Te(5),gn=new Te(10),Ra=new Te(100),Ma=new Te(1e3),Oa=new Te(1e4),bi=9007199254740991;function ee(i){let e=re("Raydium_parseBigNumberish");if(i instanceof Te)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Te(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=bi||i<=-bi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Te(String(i))):typeof i=="bigint"?new Te(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Te(0))}function fn(i){return gn.pow(ee(i))}var ao=re("Raydium_amount"),gi=Tt(so);function uo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):ao.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var pe=class extends H{constructor(t,n,r=!0,o){let s=new Ut(0),a=gn.pow(new Ut(t.decimals));if(r)s=ee(n);else{let u=new Ut(0),c=new Ut(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=uo(n.toString(),t.decimals);u=ee(l),c=ee(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=re(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return gi.DP=this.token.decimals,new gi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function yi(i){return typeof i=="object"&&i!==null&&![_e,pe,co,H,lo,Ie,nt].some(e=>typeof e=="object"&&i instanceof e)}function ge(i){return typeof i=="string"?cn(i):Array.isArray(i)?i.map(e=>ge(e)):yi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,ge(t)])):i}import{PublicKey as Xu,sendAndConfirmTransaction as Hu,Transaction as Yu,TransactionMessage as Zu,VersionedTransaction as ju}from"@solana/web3.js";import $u from"axios";var ne={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as mo,ComputeBudgetProgram as cu,Transaction as mu,TransactionMessage as pu,Keypair as fu,VersionedTransaction as yu}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wu}from"@solana/spl-token";var hu=re("Raydium_txUtil");function Se(i,e){let[t,n]=mo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as fo,AddressLookupTableAccount as wi}from"@solana/web3.js";import{PublicKey as po}from"@solana/web3.js";import{getTransferFeeConfig as Ku,unpackMint as Cu}from"@solana/spl-token";var wn=re("Raydium_accountInfo_util");async function at(i,e,t){let{batchRequest:n,commitment:r="confirmed"}={batchRequest:!1,...t},o=kn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=i._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=kn(a,10);s=(await(await Promise.all(u.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&wn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:p,executable:d,lamports:b,owner:f,rentEpoch:g}=m;return p.length!==2&&p[1]!=="base64"&&wn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:d,lamports:b,owner:new po(f),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&wn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function An(i,e,t){let n=await at(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}var bo={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new wi({key:new fo("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:wi.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function kn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as oe}from"@solana/web3.js";var cc=new oe("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),lc=new oe("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),mc=new oe("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),dc=new oe("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pc=new oe("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fc=new oe("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),bc=new oe("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),yc=new oe("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),gc=new oe("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),wc=new oe("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),kc=new oe("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ac=new oe("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),hc=new oe("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Pc=new oe("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Tc=new oe("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),xc=new oe("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Bc=new oe("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ic=new oe("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Sc=new oe("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Kc=new oe("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as go}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wo}from"@solana/spl-token";function qe(i,e,t){return Se([i.toBuffer(),(t!=null?t:wo).toBuffer(),e.toBuffer()],new go("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Oe from"bn.js";var Bt=1e4;function ue(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Oe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Bt){let u=new Oe(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=hn(i.mul(new Oe(Bt)),new Oe(Bt-o.transferFeeBasisPoints)),c=new Oe(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=hn(l.mul(new Oe(o.transferFeeBasisPoints)),new Oe(Bt)),p=m.gt(s)?s:m;return{amount:l,fee:p,expirationTime:a}}else{let u=hn(i.mul(new Oe(o.transferFeeBasisPoints)),new Oe(Bt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function ut(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function hn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Oe(0))?t.add(new Oe(1)):t}import{createInitializeAccountInstruction as Sm,createCloseAccountInstruction as Km,createTransferInstruction as Cm,TOKEN_PROGRAM_ID as Nm}from"@solana/spl-token";import{PublicKey as Om,SystemProgram as Fm}from"@solana/web3.js";import Dm from"bn.js";import{PublicKey as Oo,Keypair as Eo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Fo}from"@solana/spl-token";import Am from"bn.js";import{PublicKey as So}from"@solana/web3.js";import Pi,{isBN as Ti}from"bn.js";import{bits as ol,BitStructure as sl,blob as ko,Blob as al,cstr as ul,f32 as cl,f32be as ll,f64 as ml,f64be as dl,greedy as pl,Layout as Ao,ns64 as fl,ns64be as bl,nu64 as yl,nu64be as gl,offset as wl,s16 as kl,s16be as Al,s24 as hl,s24be as Pl,s32 as ho,s32be as Tl,s40 as xl,s40be as Bl,s48 as Il,s48be as Sl,s8 as Kl,seq as Po,struct as Cl,Structure as To,u16 as xo,u16be as Nl,u24 as Ll,u24be as Rl,u32 as Ml,u32be as Ol,u40 as El,u40be as Fl,u48 as Wl,u48be as vl,u8 as Bo,UInt as Io,union as Dl,Union as _l,unionLayoutDiscriminator as ql,utf8 as Vl}from"@solana/buffer-layout";var Pn=Ao,ki=To;var Tn=Io;var Ai=Bo,wt=xo;var fe=ho;var hi=Po;var Ke=ko;var It=class extends Pn{constructor(t,n,r){super(t,r);this.blob=Ke(t),this.signed=n}decode(t,n=0){let r=new Pi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Pi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function V(i){return new Tn(1,i)}function He(i){return new Tn(4,i)}function y(i){return new It(8,!1,i)}function O(i){return new It(16,!1,i)}function xi(i){return new It(16,!0,i)}var Xt=class extends Pn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function R(i){return new Xt(Ke(32),e=>new So(e),e=>e.toBuffer(),i)}function Ve(i){return new Xt(Ai(),Ko,Co,i)}function Ko(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Co(i){return i?1:0}var xn=class extends ki{decode(e,t){return super.decode(e,t)}};function F(i,e,t){return new xn(i,e,t)}function j(i,e,t){let n,r=typeof e=="number"?e:Ti(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Ti(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return hi(i,r,t)}var Bi=F([R("mint"),R("owner"),y("amount"),He("delegateOption"),R("delegate"),V("state"),He("isNativeOption"),y("isNative"),y("delegatedAmount"),He("closeAuthorityOption"),R("closeAuthority")]);function No(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Bn(i,...e){if(!No(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function In(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Ii(i,e){Bn(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var zt=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Ee=(i,e)=>i<<32-e|i>>>e;var om=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Lo(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Sn(i){return typeof i=="string"&&(i=Lo(i)),Bn(i),i}var Ht=class{clone(){return this._cloneInto()}},sm={}.toString;function Si(i){let e=n=>i().update(Sn(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Ro(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var Ki=(i,e,t)=>i&e^~i&t,Ci=(i,e,t)=>i&e^i&t^e&t,Yt=class extends Ht{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zt(this.buffer)}update(e){In(this);let{view:t,buffer:n,blockLen:r}=this;e=Sn(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=zt(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){In(this),Ii(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;Ro(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=zt(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var Mo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),it=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),rt=new Uint32Array(64),Kn=class extends Yt{constructor(){super(64,32,8,!1),this.A=it[0]|0,this.B=it[1]|0,this.C=it[2]|0,this.D=it[3]|0,this.E=it[4]|0,this.F=it[5]|0,this.G=it[6]|0,this.H=it[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)rt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let p=rt[m-15],d=rt[m-2],b=Ee(p,7)^Ee(p,18)^p>>>3,f=Ee(d,17)^Ee(d,19)^d>>>10;rt[m]=f+rt[m-7]+b+rt[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let p=Ee(a,6)^Ee(a,11)^Ee(a,25),d=l+p+Ki(a,u,c)+Mo[m]+rt[m]|0,f=(Ee(n,2)^Ee(n,13)^Ee(n,22))+Ci(n,r,o)|0;l=c,c=u,u=a,a=s+d|0,s=o,o=r,r=n,n=d+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,u,c,l)}roundClean(){rt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ni=Si(()=>new Kn);var xm=re("Raydium_Util");function Cn({fromPublicKey:i,programId:e=Fo}){let t=Eo.generate().publicKey.toBase58().slice(0,32);return{publicKey:Wo(i,t,e),seed:t}}function Wo(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Ni(n);return new Oo(r)}import{TOKEN_PROGRAM_ID as Xn,TOKEN_2022_PROGRAM_ID as Gn}from"@solana/spl-token";import{PublicKey as Ne,TransactionInstruction as Hn,SystemProgram as Zi}from"@solana/web3.js";import Un from"bn.js";import{PublicKey as Gp}from"@solana/web3.js";import Ge from"bn.js";var se=new Ge(0),xe=new Ge(1),ze=new Ge(-1),Be=new Ge(1).shln(64),Qt=new Ge(1).shln(128),Nn=Be.sub(xe),St=64,Li=Qt.subn(1),we=-443636,Ae=-we,Ye=new Ge("4295048016"),Qe=new Ge("79226673521066979257578248091"),Ri=16,Mi="59543866431248",Oi="184467440737095516",Ei="15793534762490258745",Zt=new Ge(10).pow(new Ge(6));var cd=new Ge("18446744073700000000");import _ from"bn.js";function jt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Ln(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Rn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Kt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Fi(i,e){return Kt(i,e)?null:Ln(i,e)}function Wi(i,e){return Kt(i,e)?null:Rn(i,e)}var bd=Buffer.from("amm_config","utf8"),Do=Buffer.from("pool","utf8"),_o=Buffer.from("pool_vault","utf8"),qo=Buffer.from("pool_reward_vault","utf8"),vi=Buffer.from("position","utf8"),Vo=Buffer.from("tick_array","utf8"),Go=Buffer.from("operation","utf8"),Uo=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Di(i,e,t,n){return Se([Do,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Mn(i,e,t){return Se([_o,e.toBuffer(),t.toBuffer()],i)}function _i(i,e,t){return Se([qo,e.toBuffer(),t.toBuffer()],i)}function Y(i,e,t){return Se([Vo,e.toBuffer(),jt(t)],i)}function ct(i,e,t,n){return Se([vi,e.toBuffer(),jt(t),jt(n)],i)}function Fe(i,e){return Se([vi,e.toBuffer()],i)}function Jt(i){return Se([Buffer.from("metadata","utf8"),gt.toBuffer(),i.toBuffer()],gt)}function $t(i){return Se([Go],i)}function Ce(i,e){return Se([Uo,e.toBuffer()],i)}import{PublicKey as ot}from"@solana/web3.js";import ie from"bn.js";import jo from"bn.js";var On=14,Ze=class{static maxTickInTickarrayBitmap(e){return e*ce*lt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!G.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-G.tickCount(n):t+G.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ce,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Fi(1024,l);if(m!==null){let p=(c-m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Wi(1024,l);if(m!==null){let p=(c+m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-G.tickCount(n)}}}},Ct=class{static getBitmapOffset(e,t){if(!G.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Ze.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;if(Ae<=t)throw Error(`extensionTickBoundary check error: ${Ae}, ${t}`);if(n<=we)throw Error(`extensionTickBoundary check error: ${n}, ${we}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:S.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=G.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=Ze.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=S.mergeTickArrayBitmap(e).shln(lt-1-a),c=Kt(512,u)?null:Ln(512,u);if(c!==null){let l=t-c*G.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=S.mergeTickArrayBitmap(e).shrn(a),c=Kt(512,u)?null:Rn(512,u);if(c!==null){let l=t+c*G.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-G.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Ze.maxTickInTickarrayBitmap(t),r=Math.floor(n/G.tickCount(t));return e<0&&n!=0&&(r=lt-r),r}};var Bd=F([Ke(8),V("bump"),wt("index"),R(""),He("protocolFeeRate"),He("tradeFeeRate"),wt("tickSpacing"),j(y(),8,"")]),Xo=F([He("blockTimestamp"),O("sqrtPriceX64"),O("cumulativeTimePriceX64"),j(O(),1,"")]),En=F([Ke(8),Ve("initialized"),R("poolId"),j(Xo,1e3,"observations"),j(O(),5,"")]),Ho=F([V("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),O("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),R("tokenMint"),R("tokenVault"),R("creator"),O("rewardGrowthGlobalX64")]),Fn=F([Ke(8),V("bump"),R("ammConfig"),R("creator"),R("mintA"),R("mintB"),R("vaultA"),R("vaultB"),R("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),wt("tickSpacing"),O("liquidity"),O("sqrtPriceX64"),fe("tickCurrent"),wt("observationIndex"),wt("observationUpdateDuration"),O("feeGrowthGlobalX64A"),O("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),O("swapInAmountTokenA"),O("swapOutAmountTokenB"),O("swapInAmountTokenB"),O("swapOutAmountTokenA"),V("status"),j(V(),7,""),j(Ho,3,"rewardInfos"),j(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),j(y(),15*4-3,"padding")]),zo=F([O("growthInsideLastX64"),y("rewardAmountOwed")]),Wn=F([Ke(8),V("bump"),R("nftMint"),R("poolId"),fe("tickLower"),fe("tickUpper"),O("liquidity"),O("feeGrowthInsideLastX64A"),O("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),j(zo,3,"rewardInfos"),j(y(),8,"")]),Id=F([Ke(8),V("bump"),R("poolId"),fe("tickLowerIndex"),fe("tickUpperIndex"),O("liquidity"),O("feeGrowthInsideLastX64A"),O("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),j(O(),3,"rewardGrowthInside"),j(y(),8,"")]),Yo=F([fe("tick"),xi("liquidityNet"),O("liquidityGross"),O("feeGrowthOutsideX64A"),O("feeGrowthOutsideX64B"),j(O(),3,"rewardGrowthsOutsideX64"),j(He(),13,"")]),Nt=F([Ke(8),R("poolId"),fe("startTickIndex"),j(Yo,ce,"ticks"),V("initializedTickCount"),j(V(),115,"")]),Qo=F([Ke(329),j(R(),100,"whitelistMints")]),qi=F([Ke(8),R("poolId"),j(j(y(),8),On,"positiveTickArrayBitmap"),j(j(y(),8),On,"negativeTickArrayBitmap")]);var Zo=15,G=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=S.getTickArrayStartIndexByTick(r,o),l=S.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Zo/2));for(let d=0;d<l.length;d++){let{publicKey:b}=Y(t,n,l[d]);u.push(b)}let m=(await at(e,u)).map(d=>d!==null?Nt.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let b=m[d];b!==null&&(p[b.startTickIndex]={...b,address:u[d]})}return p}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=S.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,p,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/G.tickCount(t)),a=n?S.searchLowBitFromStart(r,o,s-1,1,t):S.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ce-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ce;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=Y(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=S.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u-1}else for(u=u+1;u<ce;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u+1}let{publicKey:m}=Y(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(S.checkIsOutOfBoundary(e)){if(e>Ae)return!1;let n=S.getTickArrayStartIndexByTick(we,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ce*e}};var ce=60,lt=512,S=class{static getTickArrayAddressByTick(e,t,n,r){let o=S.getTickArrayStartIndexByTick(n,r),{publicKey:s}=Y(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=S.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ce)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=G.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*G.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ce,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ce,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ce:e+t*ce}static mergeTickArrayBitmap(e){let t=new jo(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ce));return[...S.searchLowBitFromStart(e,t,s-1,o,n),...S.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return S.searchHightBitFromStart(e,t,0,lt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=S.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=Y(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=G.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>S.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=G.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<we||e>Ae}static nextInitTick(e,t,n,r,o){if(G.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ce;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ce-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ce;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=W.getSqrtPriceX64FromTick(t),o=W.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=mt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=W.getSqrtPriceX64FromTick(o),a=W.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=W.getSqrtPriceX64FromTick(t),o=W.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=mt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=W.getSqrtPriceX64FromTick(o),a=W.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};import Ue from"bn.js";var Lt=class{static getfeeGrowthInside(e,t,n){let r=new Ue(0),o=new Ue(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ue(0),a=new Ue(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Be),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Be),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ue(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ue(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ue(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ue(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var g,k,h,A;let a=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),u=W.getSqrtPriceX64FromTick(t.tickLower),c=W.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=U.getAmountsFromLiquidity(a,u,c,n,o),[p,d]=[ue(m.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),ue(m.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)],[b,f]=[ue(new Ue(new N(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),ue(new Ue(new N(m.amountB.toString()).mul(l).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:f,expirationTime:ut(p.expirationTime,d.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as Vi}from"@solana/spl-token";var ke=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintA.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:b}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,o);return a.push(...p),{expectedAmountOut:m.mul(ze),remainingAccounts:a,executionPrice:d,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:g}=Y(e.programId,e.id,f.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:b}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(ze),c,o);return a.push(...p),{expectedAmountIn:m,remainingAccounts:a,executionPrice:d,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ke.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Ct.checkTickArrayIsInit(G.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):S.checkTickArrayIsInitialized(S.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Y(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,G.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Y(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/G.tickCount(e.tickSpacing)),r=t?S.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):S.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=G.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=Ze.nextInitializedTickArrayStartIndex(S.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Ct.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<we||t>Ae)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],p=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d={...m,perSecond:v.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new ot(p)};if(d.tokenMint.equals(ot.default))continue;if(n<=d.openTime.toNumber()||r.eq(se)){s.push(d);continue}let b=new ie(Math.min(d.endTime.toNumber(),n)),f=b.sub(d.lastUpdateTime),g=v.mulDivFloor(f,d.emissionsPerSecondX64,r),k=d.rewardGrowthGlobalX64.add(g),h=v.mulDivFloor(f,d.emissionsPerSecondX64,Be),A=d.rewardTotalEmissioned.add(h);s.push({...d,rewardGrowthGlobalX64:k,rewardTotalEmissioned:A,lastUpdateTime:b})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=S.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;return t>Ae&&(t=G.getArrayStartIndex(Ae,e)+G.tickCount(e)),n<we&&(n=G.getArrayStartIndex(we,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!G.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/G.tickCount(t)*lt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await An(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=qi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=S.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=S.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:p}=Y(u.programId,u.id,m);o.push({pubkey:p}),r[p.toString()]=u.id}}let s=await An(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Nt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of u)for(let d of s)c.push(Fe(d,p).publicKey);let l=await at(t,c,{batchRequest:r}),m={};for(let p of l){if(p===null)continue;let d=Wn.decode(p.data),b=d.poolId.toString(),f=e.find(q=>q.state.id.toBase58()===b);if(f===void 0)continue;let g=f.state,k=S._getTickPriceLegacy({poolInfo:g,tick:d.tickLower,baseIn:!0}),h=S._getTickPriceLegacy({poolInfo:g,tick:d.tickUpper,baseIn:!0}),{amountA:A,amountB:x}=U.getAmountsFromLiquidity(g.sqrtPriceX64,k.tickSqrtPriceX64,h.tickSqrtPriceX64,d.liquidity,!1),P=1/(1-Math.sqrt(Math.sqrt(k.price.div(h.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:k.price,priceUpper:h.price,amountA:A,amountB:x,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(q=>({...q,pendingReward:new ie(0)})),leverage:P,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let L=await S.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),E=await S.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=L,m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=E}if(o){let p=Object.values(m),d=await at(t,p,{batchRequest:r}),b={};for(let f=0;f<p.length;f++){let g=d[f];if(g===null)continue;let k=p[f].toString();b[k]=Nt.decode(g.data)}for(let{state:f,positionAccount:g}of e)if(!!g)for(let k of g){let h=`${f.programId.toString()}-${f.id.toString()}-${k.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${k.tickUpper}`,x=b[m[h].toString()],P=b[m[A].toString()],L=x.ticks[S.getTickOffsetInArray(k.tickLower,f.tickSpacing)],E=P.ticks[S.getTickOffsetInArray(k.tickUpper,f.tickSpacing)],{tokenFeeAmountA:q,tokenFeeAmountB:J}=await Lt.GetPositionFees(f,k,L,E),X=await Lt.GetPositionRewards(f,k,L,E);k.tokenFeeAmountA=q.gte(new ie(0))?q:new ie(0),k.tokenFeeAmountB=J.gte(new ie(0))?J:new ie(0);for(let Q=0;Q<X.length;Q++)k.rewardInfos[Q].pendingReward=X[Q].gte(new ie(0))?X[Q]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new N(0)}){var X;let u,c=n.toBase58()===e.mintA.address,[l,m]=c?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new N(0))?u=c?Ye.add(new ie(1)):Qe.sub(new ie(1)):u=W.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ue(o,l,r,!1),{expectedAmountOut:d,remainingAccounts:b,executionPrice:f,feeAmount:g}=ke.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((X=p.fee)!=null?X:se),u),k=ue(d,m,r,!1),h=W.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),A=c?h:new N(1).div(h),x=d.mul(new ie(Math.floor((1-s)*1e10))).div(new ie(1e10)),P=ue(x,m,r,!1),L=c?e.currentPrice:new N(1).div(e.currentPrice),E=new N(A).sub(L).abs(),q=L,J=new nt(new N(E).mul(10**15).toFixed(0),new N(q).mul(10**15).toFixed(0));return{realAmountIn:p,amountOut:k,minAmountOut:P,expirationTime:ut(p.expirationTime,k.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:J,fee:g,remainingAccounts:b}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s}){let a=r.address===e.mintB.address,[u,c]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,m]=[new _e({...u,mint:u.address,isToken2022:u.programId===Vi.toBase58()}),new _e({...c,mint:c.address,isToken2022:c.programId===Vi.toBase58()})],{realAmountIn:p,amountOut:d,minAmountOut:b,expirationTime:f,currentPrice:g,executionPrice:k,priceImpact:h,fee:A,remainingAccounts:x}=await ke.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new ot(u.address),amountIn:n,slippage:o,epochInfo:s}),P={...p,amount:new pe(l,p.amount),fee:p.fee===void 0?void 0:new pe(l,p.fee)},L={...d,amount:new pe(m,d.amount),fee:d.fee===void 0?void 0:new pe(m,d.fee)},E={...b,amount:new pe(m,b.amount),fee:b.fee===void 0?void 0:new pe(m,b.fee)},q=new Ie({baseToken:l,denominator:new ie(10).pow(new ie(20+l.decimals)),quoteToken:m,numerator:g.mul(new N(10**(20+m.decimals))).toFixed(0)}),J=new Ie({baseToken:l,denominator:new ie(10).pow(new ie(20+l.decimals)),quoteToken:m,numerator:k.mul(new N(10**(20+m.decimals))).toFixed(0)}),X=new pe(l,A);return{realAmountIn:P,amountOut:L,minAmountOut:E,expirationTime:f,currentPrice:q,executionPrice:J,priceImpact:h,fee:X,remainingAccounts:x}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var b,f,g;let o=e[t],s=S.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=S.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,p=o.priceMax-o.priceMin,d;return l<=0?d=0:m===l?d=p/l:p===l?d=l/m:d=l/p*(l/m),{feeApr:o.feeApr*d,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*d,(f=o.rewardApr[1])!=null?f:0*d,(g=o.rewardApr[2])!=null?g:0*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[ln(e.mintA.address).toString()],p=r[ln(e.mintB.address).toString()],d=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),g=W.getSqrtPriceX64FromTick(s),k=W.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:A}=U.getAmountsFromLiquidityWithSlippage(f,g,k,t,!1,!1,0),{amountSlippageA:x,amountSlippageB:P}=U.getAmountsFromLiquidityWithSlippage(f,g,k,o,!1,!1,0),L=new N(h.toString()).div(new N(10).pow(d)).mul(m.value).add(new N(A.toString()).div(new N(10).pow(b)).mul(p.value)),E=new N(x.toString()).div(new N(10).pow(d)).mul(m.value).add(new N(P.toString()).div(new N(10).pow(b)).mul(p.value)),q=E.div(L.add(E)).div(E),X=new N(l.volumeFee).mul(365).div(c).mul(q).mul(100).toNumber(),Q=3600*24*365,Le=e.rewardDefaultInfos.map(me=>{var z,zn;let he=me.mint.decimals,te=r[me.mint.address];return u<((z=me.startTime)!=null?z:0)||u>((zn=me.endTime)!=null?zn:0)||!me.perSecond||!te||he===void 0?0:new N(te.value).mul(new N(me.perSecond).mul(Q)).div(new N(10).pow(he)).mul(q).mul(100).toNumber()});return{feeApr:X,rewardsApr:Le,apr:X+Le.reduce((me,he)=>me+he,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var k,h;let l=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=W.getSqrtPriceX64FromTick(n),p=W.getSqrtPriceX64FromTick(r),d=a?1-s:1+s,b=ue(o,(k=e[t?"mintA":"mintB"].extensions)==null?void 0:k.feeConfig,u,!c),f=new ie(new N(b.amount.sub((h=b.fee)!=null?h:se).toString()).mul(d).toFixed(0)),g;if(l.lte(m))g=t?U.getLiquidityFromTokenAmountA(m,p,f,!a):new ie(0);else if(l.lte(p)){let A=U.getLiquidityFromTokenAmountA(l,p,f,!a),x=U.getLiquidityFromTokenAmountB(m,l,f);g=t?A:x}else g=t?new ie(0):U.getLiquidityFromTokenAmountB(m,p,f);return ke.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var g,k,h,A;let u=W.getSqrtPriceX64FromTick(n),c=W.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=U.getAmountsFromLiquidity(W.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[p,d]=[ue(m.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),ue(m.amountB,(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)],[b,f]=[ue(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ue(m.amountB.muln(l),(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)];return{liquidity:o,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:f,expirationTime:ut(p.expirationTime,d.expirationTime)}}static async fetchComputeClmmInfo({owner:e,connection:t,poolInfo:n}){let r=await t.getAccountInfo(new ot(n.id));if(!r)throw new Error(`pool not found ${n.id}`);let o=Fn.decode(r.data),s=Ce(e,new ot(n.id)).publicKey,a=await ke.fetchExBitmaps({connection:t,exBitmapAddress:[s],batchRequest:!1});return{...o,id:new ot(n.id),programId:new ot(n.programId),mintA:n.mintA,mintB:n.mintB,ammConfig:{...n.config,id:new ot(n.config.id),fundOwner:""},currentPrice:new N(n.price),exBitmapInfo:a[s.toBase58()],startTime:o.startTime.toNumber()}}};var v=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(se)||(o=o.add(xe)),o}static mulDivFloor(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).add(n.sub(xe)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new _(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Qt).sub(t).mod(Qt)}};function le(i,e){return vn(i.mul(e),64,256)}function Jo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function vn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var W=class{static sqrtPriceX64ToPrice(e,t,n){return v.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return v.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(se))return e;let o=t.shln(St);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?v.mulDivCeil(s,e,a):v.mulDivRoundingUp(s,xe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return v.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(St);if(r)return e.add(o.div(t));{let s=v.mulDivRoundingUp(o,xe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<we||e>Ae)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new _("18445821805675395072"):new _("18446744073709551616");return(t&2)!=0&&(n=le(n,new _("18444899583751176192"))),(t&4)!=0&&(n=le(n,new _("18443055278223355904"))),(t&8)!=0&&(n=le(n,new _("18439367220385607680"))),(t&16)!=0&&(n=le(n,new _("18431993317065453568"))),(t&32)!=0&&(n=le(n,new _("18417254355718170624"))),(t&64)!=0&&(n=le(n,new _("18387811781193609216"))),(t&128)!=0&&(n=le(n,new _("18329067761203558400"))),(t&256)!=0&&(n=le(n,new _("18212142134806163456"))),(t&512)!=0&&(n=le(n,new _("17980523815641700352"))),(t&1024)!=0&&(n=le(n,new _("17526086738831433728"))),(t&2048)!=0&&(n=le(n,new _("16651378430235570176"))),(t&4096)!=0&&(n=le(n,new _("15030750278694412288"))),(t&8192)!=0&&(n=le(n,new _("12247334978884435968"))),(t&16384)!=0&&(n=le(n,new _("8131365268886854656"))),(t&32768)!=0&&(n=le(n,new _("3584323654725218816"))),(t&65536)!=0&&(n=le(n,new _("696457651848324352"))),(t&131072)!=0&&(n=le(n,new _("26294789957507116"))),(t&262144)!=0&&(n=le(n,new _("37481735321082"))),e>0&&(n=Li.div(n)),n}static getTickFromPrice(e,t,n){return W.getTickFromSqrtPriceX64(W.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Qe)||e.lt(Ye))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new _(t-64),r=Jo(n,32,128),o=new _("8000000000000000","hex"),s=0,a=new _(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new _(0))&&s<Ri;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new _(Mi)),p=vn(m.sub(new _(Oi)),64,128).toNumber(),d=vn(m.add(new _(Ei)),64,128).toNumber();return p==d?p:W.getSqrtPriceX64FromTick(d).lte(e)?d:p}},mt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=W.getTickFromSqrtPriceX64(W.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=mt.getTickWithPriceAndTickspacing(e,t,n,r),s=W.getSqrtPriceX64FromTick(o);return W.sqrtPriceX64ToPrice(s,n,r)}},U=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(St),s=t.sub(e);return r?v.mulDivRoundingUp(v.mulDivCeil(o,s,t),xe,e):v.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");return r?v.mulDivCeil(n,t.sub(e),Be):v.mulDivFloor(n,t.sub(e),Be)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?v.mulDivRoundingUp(a,xe,Nn):a.shrn(St)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),v.mulDivFloor(n,Nn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return U.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=U.getLiquidityFromTokenAmountA(e,n,r,!1),a=U.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return U.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:U.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new _(0)};if(e.lt(n)){let s=U.getTokenAmountAFromLiquidity(e,n,r,o),a=U.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new _(0),amountB:U.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=U.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new _(new N(u.toString()).mul(l).toFixed(0)),p=new _(new N(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var h,A,x,P;let c=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=W.getSqrtPriceX64FromTick(t),m=W.getSqrtPriceX64FromTick(n),p=s?1+o:1-o,d=U.getAmountsFromLiquidity(c,l,m,r,s),[b,f]=[ue(d.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),ue(d.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,u)],[g,k]=[ue(new _(new N(d.amountA.toString()).mul(p).toFixed(0)),(x=e.mintA.extensions)==null?void 0:x.feeConfig,a,u),ue(new _(new N(d.amountB.toString()).mul(p).toFixed(0)),(P=e.mintB.extensions)==null?void 0:P.feeConfig,a,u)];return{liquidity:r,amountA:b,amountB:f,amountSlippageA:g,amountSlippageB:k,expirationTime:ut(b.expirationTime,f.expirationTime)}}},dt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,p,d,b){if(p.eq(se))throw new Error("amountSpecified must not be 0");if(b||(b=s?Ye.add(xe):Qe.sub(xe)),s){if(b.lt(Ye))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(Qe))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=p.gt(se),g={amountSpecifiedRemaining:p,amountCalculated:se,sqrtPriceX64:m,tick:c>d?Math.min(d+G.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new _(0)},k=d,h=n[d],A=0,x=!s&&h.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(se)&&!g.sqrtPriceX64.eq(b);){if(A>10)throw Error("liquidity limit");let P={};P.sqrtPriceStartX64=g.sqrtPriceX64;let L=S.nextInitTick(h,g.tick,l,s,x),E=L||null,q=null;if(!(E!=null&&E.liquidityGross.gtn(0))){let X=ke.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},k,s);if(!X.isExist)throw Error("swapCompute LiquidityInsufficient");k=X.nextStartIndex;let{publicKey:Q}=Y(e,t,k);q=Q,h=n[k],E=S.firstInitializedTick(h,s)}P.tickNext=E.tick,P.initialized=E.liquidityGross.gtn(0),d!==k&&q&&(g.accounts.push(q),d=k),P.tickNext<we?P.tickNext=we:P.tickNext>Ae&&(P.tickNext=Ae),P.sqrtPriceNextX64=W.getSqrtPriceX64FromTick(P.tickNext);let J;if(s&&P.sqrtPriceNextX64.lt(b)||!s&&P.sqrtPriceNextX64.gt(b)?J=b:J=P.sqrtPriceNextX64,[g.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=dt.swapStepCompute(g.sqrtPriceX64,J,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(P.feeAmount),f?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),g.amountCalculated=g.amountCalculated.sub(P.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(P.amountOut),g.amountCalculated=g.amountCalculated.add(P.amountIn.add(P.feeAmount))),g.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let X=E.liquidityNet;s&&(X=X.mul(ze)),g.liquidity=U.addDelta(g.liquidity,X)}x=P.tickNext!=g.tick&&!s&&h.startTickIndex===P.tickNext,g.tick=s?P.tickNext-1:P.tickNext}else if(g.sqrtPriceX64!=P.sqrtPriceStartX64){let X=W.getTickFromSqrtPriceX64(g.sqrtPriceX64);x=X!=g.tick&&!s&&h.startTickIndex===X,g.tick=X}++A}try{let{nextStartIndex:P,isExist:L}=G.nextInitializedTickArray(g.tick,l,s,r,o);L&&d!==P&&(g.accounts.push(Y(e,t,P).publicKey),d=P)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new _(0),amountIn:new _(0),amountOut:new _(0),feeAmount:new _(0)},a=e.gte(t),u=r.gte(se);if(u){let l=v.mulDivFloor(r,Zt.sub(new _(o.toString())),Zt);s.amountIn=a?U.getTokenAmountAFromLiquidity(t,e,n,!0):U.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=W.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?U.getTokenAmountBFromLiquidity(t,e,n,!1):U.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=W.getNextSqrtPriceX64FromOutput(e,n,r.mul(ze),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=U.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=U.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:U.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:U.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(ze))&&(s.amountOut=r.mul(ze)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=v.mulDivCeil(s.amountIn,new _(o),Zt.sub(new _(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as be,TOKEN_2022_PROGRAM_ID as st,ASSOCIATED_TOKEN_PROGRAM_ID as Gi}from"@solana/spl-token";import{PublicKey as T,TransactionInstruction as We,SystemProgram as kt,Keypair as Dn}from"@solana/web3.js";import Ui from"bn.js";var Xi=re("Raydium_Clmm"),ve={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Rt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b){let f=F([O("sqrtPriceX64"),y("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1}],k=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,startTime:b},k);let h=Buffer.from([...ve.createPool,...k]);return new We({keys:g,programId:e,data:h})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=Cn({fromPublicKey:r,programId:n}),[p,d]=[new T(o.address),new T(s.address)],b=[kt.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(En.span),space:En.span,programId:n})],{publicKey:f}=Di(n,a,p,d),{publicKey:g}=Mn(n,f,p),{publicKey:k}=Mn(n,f,d);return b.push(this.createPoolInstruction(n,f,r,a,m.publicKey,p,g,new T(o.programId||be),d,k,new T(s.programId||be),Ce(n,f).publicKey,u,c)),{signers:[],instructions:b,instructionTypes:[ne.CreateAccount,ne.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:g,mintBVault:k},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,h,A,x,P,L,E,q,J,X){let Q=F([fe("tickLowerIndex"),fe("tickUpperIndex"),fe("tickArrayLowerStartIndex"),fe("tickArrayUpperStartIndex"),O("liquidity"),y("amountMaxA"),y("amountMaxB"),Ve("withMetadata"),V("optionBaseFlag"),Ve("baseFlag")]),Le=[...X?[{pubkey:X,isSigner:!1,isWritable:!0}]:[]],me=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:Gi,isSigner:!1,isWritable:!1},{pubkey:gt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...Le],he=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:P,liquidity:L,amountMaxA:E,amountMaxB:q,withMetadata:J==="create",baseFlag:!1,optionBaseFlag:0},he);let te=Buffer.from([...ve.openPosition,...he]);return new We({keys:me,programId:e,data:te})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let q=Dn.generate();m.push(q),b=q.publicKey}let f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=Y(p,d,f),{publicKey:h}=Y(p,d,g),{publicKey:A}=qe(n.wallet,b,be),{publicKey:x}=Jt(b),{publicKey:P}=Fe(p,b),{publicKey:L}=ct(p,d,r,o),E=this.openPositionFromLiquidityInstruction(p,n.feePayer,d,n.wallet,b,A,x,L,k,h,P,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,f,g,s,a,u,c);return{signers:m,instructions:[E],instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:k,tickArrayUpper:h,positionNftAccount:A,metadataAccount:x,personalPosition:P,protocolPosition:L}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let q=Dn.generate();m.push(q),b=q.publicKey}let f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=Y(p,d,f),{publicKey:h}=Y(p,d,g),{publicKey:A}=qe(n.wallet,b,be),{publicKey:x}=Jt(b),{publicKey:P}=Fe(p,b),{publicKey:L}=ct(p,d,r,o),E=this.openPositionFromBaseInstruction(p,n.feePayer,d,n.wallet,b,A,x,L,k,h,P,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,f,g,c,s,a,u,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?Ce(p,d).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:k,tickArrayUpper:h,positionNftAccount:A,metadataAccount:x,personalPosition:P,protocolPosition:L},instructions:[E],signers:m,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,h,A,x,P,L,E,q,J,X){let Q=F([fe("tickLowerIndex"),fe("tickUpperIndex"),fe("tickArrayLowerStartIndex"),fe("tickArrayUpperStartIndex"),O("liquidity"),y("amountMaxA"),y("amountMaxB"),Ve("withMetadata"),V("optionBaseFlag"),Ve("baseFlag")]),Le=[...X?[{pubkey:X,isSigner:!1,isWritable:!0}]:[]],me=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:Gi,isSigner:!1,isWritable:!1},{pubkey:gt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...Le],he=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:P,liquidity:new Ui(0),amountMaxA:E==="MintA"?q:J,amountMaxB:E==="MintA"?J:q,withMetadata:L==="create",baseFlag:E==="MintA",optionBaseFlag:1},he);let te=Buffer.from([...ve.openPosition,...he]);return new We({keys:me,programId:e,data:te})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,p=[];if(l)m=new T((await l(1))[0]);else{let q=Dn.generate();p.push(q),m=q.publicKey}let[d,b]=[new T(e.programId),new T(e.id)],f=S.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=S.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=Y(d,b,f),{publicKey:h}=Y(d,b,g),{publicKey:A}=qe(n.wallet,m,be),{publicKey:x}=Jt(m),{publicKey:P}=Fe(d,m),{publicKey:L}=ct(d,b,r,o),E=this.openPositionFromLiquidityInstruction(d,n.wallet,b,n.wallet,m,A,x,L,k,h,P,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),r,o,f,g,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?Ce(d,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:k,tickArrayUpper:h,positionNftAccount:A,metadataAccount:x,personalPosition:P,protocolPosition:L},instructions:[E],signers:p,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=F([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...ve.closePosition,...u]);return new We({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new T(e.programId),{publicKey:s}=qe(n.wallet,r.nftMint,be),{publicKey:a}=Fe(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[ne.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,h){let A=F([O("liquidity"),y("amountMaxA"),y("amountMaxB"),V("optionBaseFlag"),Ve("baseFlag")]),x=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],L=Buffer.alloc(A.span);A.encode({liquidity:f,amountMaxA:g,amountMaxB:k,optionBaseFlag:0,baseFlag:!1},L);let E=Buffer.from([...ve.increaseLiquidity,...L]);return new We({keys:P,programId:e,data:E})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(u,c,l),{publicKey:d}=Y(u,c,m),{publicKey:b}=qe(r.wallet,n.nftMint,be),{publicKey:f}=Fe(u,n.nftMint),{publicKey:g}=ct(u,c,n.tickLower,n.tickUpper),k=this.increasePositionFromLiquidityInstruction(u,r.wallet,b,f,c,g,p,d,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ce(u,c).publicKey:void 0);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:b,personalPosition:f,protocolPosition:g},signers:[],instructions:[k],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(u,c,l),{publicKey:d}=Y(u,c,m),{publicKey:b}=qe(r.wallet,n.nftMint,be),{publicKey:f}=Fe(u,n.nftMint),{publicKey:g}=ct(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:b,personalPosition:f,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,b,f,c,g,p,d,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ce(u,c).publicKey:void 0)],signers:[],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,h){let A=F([O("liquidity"),y("amountMaxA"),y("amountMaxB"),V("optionBaseFlag"),Ve("baseFlag")]),x=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],L=Buffer.alloc(A.span);A.encode({liquidity:new Ui(0),amountMaxA:f==="MintA"?g:k,amountMaxB:f==="MintA"?k:g,baseFlag:f==="MintA",optionBaseFlag:1},L);let E=Buffer.from([...ve.increaseLiquidity,...L]);return new We({keys:P,programId:e,data:E})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,h,A){let x=F([O("liquidity"),y("amountMinA"),y("amountMinB")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...f.map(J=>[{pubkey:J.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:J.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:J.rewardMint,isSigner:!1,isWritable:!1}]).flat()],L=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],E=Buffer.alloc(x.span);x.encode({liquidity:g,amountMinA:k,amountMinB:h},E);let q=Buffer.from([...ve.decreaseLiquidity,...E]);return new We({keys:L,programId:e,data:q})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new T(e.programId),new T(e.id)],m=S.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=S.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Y(c,l,m),{publicKey:b}=Y(c,l,p),{publicKey:f}=qe(r.wallet,n.nftMint,u),{publicKey:g}=Fe(c,n.nftMint),{publicKey:k}=ct(c,l,n.tickLower,n.tickUpper),h=[];for(let x=0;x<e.rewardDefaultInfos.length;x++)h.push({poolRewardVault:new T(t.rewardInfos[x].vault),ownerRewardVault:r.rewardAccounts[x],rewardMint:new T(e.rewardDefaultInfos[x].mint.address)});let A=[];return A.push(this.decreaseLiquidityInstruction(c,r.wallet,f,g,l,k,d,b,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),h,o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Ce(c,l).publicKey:void 0)),{address:{tickArrayLower:d,tickArrayUpper:b,positionNftAccount:f,personalPosition:g,protocolPosition:k},signers:[],instructions:A,instructionTypes:[ne.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k){let h=F([y("amount"),y("otherAmountThreshold"),O("sqrtPriceLimitX64"),Ve("isBaseInput")]),A=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...m.map(E=>({pubkey:E,isSigner:!1,isWritable:!0}))],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...A],P=Buffer.alloc(h.span);h.encode({amount:d,otherAmountThreshold:b,sqrtPriceLimitX64:f,isBaseInput:g},P);let L=Buffer.from([...ve.swap,...P]);return new We({keys:x,programId:e,data:L})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,p]=[new T(t.vault.A),new T(t.vault.B)],[d,b]=[new T(e.mintA.address),new T(e.mintB.address)],f=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:p,f?p:m,f?d:b,f?b:d,u,m,o,s,a,!0,Ce(c,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[ne.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=F([y("openTime"),y("endTime"),O("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:ee(l),endTime:ee(m),emissionsPerSecondX64:p},f);let g=Buffer.from([...ve.initReward,...f]);return new We({keys:b,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a=_i(o,s,r.mint).publicKey,u=$t(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new T(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[ne.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=F([V("rewardIndex"),O("emissionsPerSecondX64"),y("openTime"),y("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:p,openTime:ee(l),endTime:ee(m)},f);let g=Buffer.from([...ve.setRewardEmissions,...f]);return new We({keys:b,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u,c;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===r.mint.toString()&&(a=p,u=new T(t.rewardInfos[p].vault),c=new T(t.rewardInfos[p].mint.address));(a===void 0||u===void 0)&&Xi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=$t(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new T(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ne.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=F([V("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...ve.collectReward,...l]);return new We({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new T(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Xi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ne.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,p]=[new T(t.vault.A),new T(t.vault.B)],[d,b]=[new T(e.mintA.address),new T(e.mintB.address)],f=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?p:m,f?m:p,f?d:b,f?b:d,u,m,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[ne.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import of from"bn.js";import{TOKEN_PROGRAM_ID as os,ASSOCIATED_TOKEN_PROGRAM_ID as vf}from"@solana/spl-token";import{PublicKey as _f,TransactionInstruction as zi,SystemProgram as ss,SYSVAR_RENT_PUBKEY as qf}from"@solana/web3.js";var _n=F([V("instruction"),y("amountIn"),y("minAmountOut")]),qn=F([V("instruction"),y("maxAmountIn"),y("amountOut")]),Sf=F([V("instruction"),V("nonce")]),$o=F([V("instruction"),V("nonce"),y("startTime")]),Kf=F([y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalValue"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),O("swapBaseInAmount"),O("swapQuoteOutAmount"),y("swapBase2QuoteFee"),O("swapQuoteInAmount"),O("swapBaseOutAmount"),y("swapQuote2BaseFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("withdrawQueue"),R("lpVault"),R("owner"),y("lpReserve"),j(y(),3,"padding")]),Cf=F([y("accountType"),y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalsValue"),y("abortTradeFactor"),y("priceTickMultiplier"),y("priceTick"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),O("swapBaseInAmount"),O("swapQuoteOutAmount"),O("swapQuoteInAmount"),O("swapBaseOutAmount"),y("swapQuote2BaseFee"),y("swapBase2QuoteFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("modelDataAccount"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("owner"),j(y(),64,"padding")]),es=F([V("instruction"),y("baseAmountIn"),y("quoteAmountIn"),y("fixedSide")]),ts=F([V("instruction"),y("amountIn")]);var Nf=F([y("fee")]);import{PublicKey as ns}from"@solana/web3.js";var Vn=new ns("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),is=5e4,rs=F([y("x"),y("y"),y("price")]),Ef=F([y("accountType"),y("status"),y("multiplier"),y("validDataCount"),j(rs,is,"DataElement")]);var Hi=re("Raydium_liquidity_instruction");function as({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=ge(i),s=Buffer.alloc(_n.span);_n.encode({instruction:9,amountIn:ee(t),minAmountOut:ee(n)},s);let a=[D({pubkey:os,isWritable:!1}),D({pubkey:o.id}),D({pubkey:o.authority,isWritable:!1}),D({pubkey:o.openOrders})];return r===4&&a.push(D({pubkey:o.targetOrders})),a.push(D({pubkey:o.vault.A}),D({pubkey:o.vault.B})),r===5&&a.push(D({pubkey:Vn})),a.push(D({pubkey:o.marketProgramId,isWritable:!1}),D({pubkey:o.marketId}),D({pubkey:o.marketBids}),D({pubkey:o.marketAsks}),D({pubkey:o.marketEventQueue}),D({pubkey:o.marketBaseVault}),D({pubkey:o.marketQuoteVault}),D({pubkey:o.marketAuthority,isWritable:!1}),D({pubkey:e.tokenAccountIn}),D({pubkey:e.tokenAccountOut}),D({pubkey:e.owner,isWritable:!1})),new zi({programId:o.programId,keys:a,data:s})}function us({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=ge(i),s=Buffer.alloc(qn.span);qn.encode({instruction:11,maxAmountIn:ee(t),amountOut:ee(n)},s);let a=[D({pubkey:ss.programId,isWritable:!1}),D({pubkey:o.id}),D({pubkey:o.authority,isWritable:!1}),D({pubkey:o.openOrders}),D({pubkey:o.targetOrders}),D({pubkey:o.vault.A}),D({pubkey:o.vault.B})];return r===5&&a.push(D({pubkey:Vn})),a.push(D({pubkey:o.marketProgramId,isWritable:!1}),D({pubkey:o.marketId}),D({pubkey:o.marketBids}),D({pubkey:o.marketAsks}),D({pubkey:o.marketEventQueue}),D({pubkey:o.marketBaseVault}),D({pubkey:o.marketQuoteVault}),D({pubkey:o.marketAuthority,isWritable:!1}),D({pubkey:e.tokenAccountIn}),D({pubkey:e.tokenAccountOut}),D({pubkey:e.owner,isWritable:!1,isSigner:!0})),new zi({programId:o.programId,keys:a,data:s})}function Yi(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return as({...a,amountIn:r,minAmountOut:o},t);if(s==="out")return us({...a,maxAmountIn:r,amountOut:o},t);Hi.logWithError("invalid params","params",i)}throw Hi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}function ob(i,e,t,n,r,o,s,a,u,c,l,m){let p=F([V("instruction"),y("amountIn"),y("amountOut")]),d=[{pubkey:Zi.programId,isSigner:!1,isWritable:!1},{pubkey:Xn,isSigner:!1,isWritable:!1},{pubkey:new Ne(t.programId),isSigner:!1,isWritable:!1},{pubkey:new Ne(t.id),isSigner:!1,isWritable:!0},{pubkey:new Ne(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=ge(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=ge(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new Ne("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=ge(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let b=Buffer.alloc(p.span);return p.encode({instruction:4,amountIn:c,amountOut:l},b),new Hn({keys:d,programId:i,data:b})}function sb(i,e,t,n,r,o,s,a,u,c){let l=F([V("instruction")]),m=[{pubkey:Zi.programId,isSigner:!1,isWritable:!1},{pubkey:Xn,isSigner:!1,isWritable:!1},{pubkey:new Ne(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new Ne(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new Ne(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=ge(n);m.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=ge(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new Ne("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=ge(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let p=Buffer.alloc(l.span);return l.encode({instruction:5},p),new Hn({keys:m,programId:i,data:p})}function Qi(i,e,t,n,r,o){if(i.pooltype.includes("StablePool")){let s=ge(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:new Ne("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]}else if(i.type==="Concentrated"){let s=i,a=ge(e),u=s.mintA.address===t;return[{pubkey:new Ne(String(i.programId)),isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a.config.id,isSigner:!1,isWritable:!1},{pubkey:a.id,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.A:a.vault.B,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.B:a.vault.A,isSigner:!1,isWritable:!0},{pubkey:a.id,isSigner:!1,isWritable:!0},...a.mintA.programId.equals(Gn)||a.mintB.programId.equals(Gn)?[{pubkey:Gn,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:u?a.mintA.address:a.mintB.address,isSigner:!1,isWritable:!1},{pubkey:u?a.mintB.address:a.mintA.address,isSigner:!1,isWritable:!1}]:[],...(o!=null?o:[]).map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Ce(new Ne(String(i.programId)),new Ne(i.id)).publicKey,isSigner:!1,isWritable:!0}]}else{let s=ge(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},...s.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:s.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:s.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]]}}function cs(i,e,t,n,r,o,s,a,u,c,l,m,p,d){let b=F([V("instruction"),y("amountIn"),y("amountOut")]),f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:Xn,isSigner:!1,isWritable:!1}];f.push(...Qi(a,c,o,t,n,d[0])),f.push(...Qi(u,l,s,n,r,d[1]));let g=Buffer.alloc(b.span);return b.encode({instruction:8,amountIn:m,amountOut:p},g),new Hn({keys:f,programId:i,data:g})}async function ab({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c;if(n.routeType==="amm")if(n.poolInfo[0].type==="Concentrated"){let l=ge(n.poolKey[0]),m=t.equals(l.mintA.address)?Ye.add(xe):Qe.sub(xe);return await Rt.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,ownerInfo:{wallet:e.wallet,tokenAccountA:l.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:l.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Un(0)),sqrtPriceLimitX64:m,remainingAccounts:n.remainingAccounts[0]})}else{let l=n.poolKey[0];return{signers:[],instructions:[Yi({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((a=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?a:new Un(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ne.AmmV5SwapBaseIn:ne.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],m=n.poolInfo[1],p=n.poolKey[0],d=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[cs(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.minMiddleAmountFee.token.mint.toString(),l,m,p,d,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((c=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?c:new Un(0)),n.remainingAccounts)],instructionTypes:[ne.RouteSwap],lookupTableAddress:[p.lookupTableAccount,d.lookupTableAccount].filter(b=>b!==void 0),address:{}}}else throw Error("route type error")}export{ab as makeSwapInstruction,ob as route1Instruction,sb as route2Instruction,cs as routeInstruction};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map