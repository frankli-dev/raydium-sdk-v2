import{TOKEN_PROGRAM_ID as Gn,TOKEN_2022_PROGRAM_ID as qn}from"@solana/spl-token";import{PublicKey as Ne,TransactionInstruction as Un,SystemProgram as Qi}from"@solana/web3.js";import Vn from"bn.js";import{PublicKey as ap}from"@solana/web3.js";var pt=9e15,et=1e9,$t="0123456789abcdef",Mt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ot="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",en={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-pt,maxE:pt,crypto:!1},Qn,Xe,E=!0,Wt="[DecimalError] ",$e=Wt+"Invalid argument: ",Zn=Wt+"Precision limit exceeded",jn=Wt+"crypto unavailable",Jn="[object Decimal]",ye=Math.floor,ae=Math.pow,Zi=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ji=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ji=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,$n=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ee=1e7,K=7,$i=9007199254740991,er=Mt.length-1,tn=Ot.length-1,w={toStringTag:Jn};w.absoluteValue=w.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),I(i)};w.ceil=function(){return I(new this.constructor(this),this.e+1,2)};w.clampedTo=w.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error($e+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};w.comparedTo=w.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};w.cosine=w.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+K,n.rounding=1,t=tr(n,ri(n,t)),n.precision=i,n.rounding=e,I(Xe==2||Xe==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};w.cubeRoot=w.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(E=!1,o=l.s*ae(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=de(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ae(t,1/3),i=ye((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=Z(c.plus(l).times(a),c.plus(u),s+2,1),de(a.d).slice(0,s)===(t=de(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(I(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return E=!0,I(n,i,m.rounding,e)};w.decimalPlaces=w.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ye(this.e/K))*K,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};w.dividedBy=w.div=function(i){return Z(this,new this.constructor(i))};w.dividedToIntegerBy=w.divToInt=function(i){var e=this,t=e.constructor;return I(Z(e,new t(i),0,1,1),t.precision,t.rounding)};w.equals=w.eq=function(i){return this.cmp(i)===0};w.floor=function(){return I(new this.constructor(this),this.e+1,3)};w.greaterThan=w.gt=function(i){return this.cmp(i)>0};w.greaterThanOrEqualTo=w.gte=function(i){var e=this.cmp(i);return e==1||e===0};w.hyperbolicCosine=w.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Dt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=ft(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return I(o,s.precision=t,s.rounding=n,!0)};w.hyperbolicSine=w.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=ft(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Dt(5,i)),r=ft(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,I(r,e,t,!0)};w.hyperbolicTangent=w.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,Z(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};w.inverseCosine=w.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Re(t,r,o):new t(0):new t(NaN):e.isZero()?Re(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Re(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};w.inverseHyperbolicCosine=w.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,E=!1,t=t.times(t).minus(1).sqrt().plus(t),E=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};w.inverseHyperbolicSine=w.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,E=!1,t=t.times(t).plus(1).sqrt().plus(t),E=!0,n.precision=i,n.rounding=e,t.ln())};w.inverseHyperbolicTangent=w.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?I(new o(r),i,e,!0):(o.precision=t=n-r.e,r=Z(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};w.inverseSine=w.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Re(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};w.inverseTangent=w.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=tn)return s=Re(l,m+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=tn)return s=Re(l,m+4,p).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/K+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(E=!1,e=Math.ceil(a/K),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),E=!0,I(s,l.precision=m,l.rounding=p,!0)};w.isFinite=function(){return!!this.d};w.isInteger=w.isInt=function(){return!!this.d&&ye(this.e/K)>this.d.length-2};w.isNaN=function(){return!this.s};w.isNegative=w.isNeg=function(){return this.s<0};w.isPositive=w.isPos=function(){return this.s>0};w.isZero=function(){return!!this.d&&this.d[0]===0};w.lessThan=w.lt=function(i){return this.cmp(i)<0};w.lessThanOrEqualTo=w.lte=function(i){return this.cmp(i)<1};w.logarithm=w.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(E=!1,a=m+d,s=Je(c,a),n=e?Ft(l,a+10):Je(i,a),u=Z(s,n,a,1),ht(u.d,r=m,p))do if(a+=10,s=Je(c,a),n=e?Ft(l,a+10):Je(i,a),u=Z(s,n,a,1),!o){+de(u.d).slice(r+1,r+15)+1==1e14&&(u=I(u,m+1,0));break}while(ht(u.d,r+=10,p));return E=!0,I(u,m,p)};w.minus=w.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,b=d.constructor;if(i=new b(i),!d.d||!i.d)return!d.s||!i.s?i=new b(NaN):d.d?i.s=-i.s:i=new b(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,p=i.d,a=b.precision,u=b.rounding,!c[0]||!p[0]){if(p[0])i.s=-i.s;else if(c[0])i=new b(d);else return new b(u===3?-0:0);return E?I(i,a,u):i}if(t=ye(i.e/K),l=ye(d.e/K),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=p.length):(e=p,t=l,s=c.length),n=Math.max(Math.ceil(a/K),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=p.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=p[n]){m=c[n]<p[n];break}o=0}for(m&&(e=c,c=p,p=e,i.s=-i.s),s=c.length,n=p.length-s;n>0;--n)c[s++]=0;for(n=p.length;n>o;){if(c[--n]<p[n]){for(r=n;r&&c[--r]===0;)c[r]=Ee-1;--c[r],c[n]+=Ee}c[n]-=p[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=vt(c,t),E?I(i,a,u):i):new b(u===3?-0:0)};w.modulo=w.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?I(new n(t),n.precision,n.rounding):(E=!1,n.modulo==9?(e=Z(t,i.abs(),0,3,1),e.s*=i.s):e=Z(t,i,0,n.modulo,1),e=e.times(i),E=!0,t.minus(e))};w.naturalExponential=w.exp=function(){return nn(this)};w.naturalLogarithm=w.ln=function(){return Je(this)};w.negated=w.neg=function(){var i=new this.constructor(this);return i.s=-i.s,I(i)};w.plus=w.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,p=m.constructor;if(i=new p(i),!m.d||!i.d)return!m.s||!i.s?i=new p(NaN):m.d||(i=new p(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=p.precision,u=p.rounding,!c[0]||!l[0])return l[0]||(i=new p(m)),E?I(i,a,u):i;if(o=ye(m.e/K),n=ye(i.e/K),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/K),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Ee|0,c[r]%=Ee;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=vt(c,n),E?I(i,a,u):i};w.precision=w.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error($e+i);return t.d?(e=ei(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};w.round=function(){var i=this,e=i.constructor;return I(new e(i),i.e+1,e.rounding)};w.sine=w.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+K,n.rounding=1,t=ir(n,ri(n,t)),n.precision=i,n.rounding=e,I(Xe>2?t.neg():t,i,e,!0)):new n(NaN)};w.squareRoot=w.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(E=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=de(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=ye((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(Z(s,o,t+2,1)).times(.5),de(o.d).slice(0,t)===(e=de(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(I(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(I(n,u+1,1),i=!n.times(n).eq(s));break}return E=!0,I(n,u,l.rounding,i)};w.tangent=w.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=Z(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,I(Xe==2||Xe==4?t.neg():t,i,e,!0)):new n(NaN)};w.times=w.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,p=l.d,d=(i=new m(i)).d;if(i.s*=l.s,!p||!p[0]||!d||!d[0])return new m(!i.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?i.s/0:i.s*0);for(t=ye(l.e/K)+ye(i.e/K),u=p.length,c=d.length,u<c&&(o=p,p=d,d=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+d[n]*p[r-n-1]+e,o[r--]=a%Ee|0,e=a/Ee|0;o[r]=(o[r]+e)%Ee|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=vt(o,t),E?I(i,m.precision,m.rounding):i};w.toBinary=function(i,e){return on(this,2,i,e)};w.toDecimalPlaces=w.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Pe(i,0,et),e===void 0?e=n.rounding:Pe(e,0,8),I(t,i+t.e+1,e))};w.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=De(n,!0):(Pe(i,0,et),e===void 0?e=r.rounding:Pe(e,0,8),n=I(new r(n),i+1,e),t=De(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=De(r):(Pe(i,0,et),e===void 0?e=o.rounding:Pe(e,0,8),n=I(new o(r),i+r.e+1,e),t=De(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};w.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,b=d.d,f=d.constructor;if(!b)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ei(b)-d.e-1,s=o%K,e.d[0]=ae(10,s<0?K+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error($e+a);i=a.gt(e)?o>0?e:c:a}for(E=!1,a=new f(de(b)),l=f.precision,f.precision=o=b.length*K*2;m=Z(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=Z(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=d.s,p=Z(c,n,o,1).minus(d).abs().cmp(Z(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,E=!0,p};w.toHexadecimal=w.toHex=function(i,e){return on(this,16,i,e)};w.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Pe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(E=!1,t=Z(t,i,0,e,1).times(i),E=!0,I(t)):(i.s=t.s,t=i),t};w.toNumber=function(){return+this};w.toOctal=function(i,e){return on(this,8,i,e)};w.toPower=w.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(ae(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return I(a,n,o);if(e=ye(i.e/K),e>=i.d.length-1&&(t=c<0?-c:c)<=$i)return r=ti(u,a,t,n),i.s<0?new u(1).div(r):I(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ae(+a,c),e=t==0||!isFinite(t)?ye(c*(Math.log("0."+de(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(E=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=nn(i.times(Je(a,n+t)),n),r.d&&(r=I(r,n+5,1),ht(r.d,n,o)&&(e=n+10,r=I(nn(i.times(Je(a,e+t)),e),e+5,1),+de(r.d).slice(n+1,n+15)+1==1e14&&(r=I(r,n+1,0)))),r.s=s,E=!0,u.rounding=o,I(r,n,o))};w.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=De(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Pe(i,1,et),e===void 0?e=r.rounding:Pe(e,0,8),n=I(new r(n),i,e),t=De(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toSignificantDigits=w.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Pe(i,1,et),e===void 0?e=n.rounding:Pe(e,0,8)),I(new n(t),i,e)};w.toString=function(){var i=this,e=i.constructor,t=De(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};w.truncated=w.trunc=function(){return I(new this.constructor(this),this.e+1,1)};w.valueOf=w.toJSON=function(){var i=this,e=i.constructor,t=De(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function de(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=K-n.length,t&&(o+=je(t)),o+=n;s=i[e],n=s+"",t=K-n.length,t&&(o+=je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Pe(i,e,t){if(i!==~~i||i<e||i>t)throw Error($e+i)}function ht(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=K,r=0):(r=Math.ceil((e+1)/K),e%=K),o=ae(10,K-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ae(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ae(10,e-3)-1,s}function Et(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=$t.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function tr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Dt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=ft(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var Z=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,p,d,b,f,g,k,A,h,x,P,L,O,q,J,X,Q,Le,me=n.constructor,Ae=n.s==r.s?1:-1,ee=n.d,z=r.d;if(!ee||!ee[0]||!z||!z[0])return new me(!n.s||!r.s||(ee?z&&ee[0]==z[0]:!z)?NaN:ee&&ee[0]==0||!z?Ae*0:Ae/0);for(u?(d=1,l=n.e-r.e):(u=Ee,d=K,l=ye(n.e/d)-ye(r.e/d)),Q=z.length,J=ee.length,k=new me(Ae),A=k.d=[],m=0;z[m]==(ee[m]||0);m++);if(z[m]>(ee[m]||0)&&l--,o==null?(L=o=me.precision,s=me.rounding):a?L=o+(n.e-r.e)+1:L=o,L<0)A.push(1),b=!0;else{if(L=L/d+2|0,m=0,Q==1){for(p=0,z=z[0],L++;(m<J||p)&&L--;m++)O=p*u+(ee[m]||0),A[m]=O/z|0,p=O%z|0;b=p||m<J}else{for(p=u/(z[0]+1)|0,p>1&&(z=i(z,p,u),ee=i(ee,p,u),Q=z.length,J=ee.length),q=Q,h=ee.slice(0,Q),x=h.length;x<Q;)h[x++]=0;Le=z.slice(),Le.unshift(0),X=z[0],z[1]>=u/2&&++X;do p=0,c=e(z,h,Q,x),c<0?(P=h[0],Q!=x&&(P=P*u+(h[1]||0)),p=P/X|0,p>1?(p>=u&&(p=u-1),f=i(z,p,u),g=f.length,x=h.length,c=e(f,h,g,x),c==1&&(p--,t(f,Q<g?Le:z,g,u))):(p==0&&(c=p=1),f=z.slice()),g=f.length,g<x&&f.unshift(0),t(h,f,x,u),c==-1&&(x=h.length,c=e(z,h,Q,x),c<1&&(p++,t(h,Q<x?Le:z,x,u))),x=h.length):c===0&&(p++,h=[0]),A[m++]=p,c&&h[0]?h[x++]=ee[q]||0:(h=[ee[q]],x=1);while((q++<J||h[0]!==void 0)&&L--);b=h[0]!==void 0}A[0]||A.shift()}if(d==1)k.e=l,Qn=b;else{for(m=1,p=A[0];p>=10;p/=10)m++;k.e=m+l*d-1,I(k,a?o+k.e+1:o,s,b)}return k}}();function I(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=K,s=e,l=m[p=0],u=l/ae(10,r-s-1)%10|0;else if(p=Math.ceil((o+1)/K),a=m.length,p>=a)if(n){for(;a++<=p;)m.push(0);l=u=0,r=1,o%=K,s=o-K+1}else break e;else{for(l=a=m[p],r=1;a>=10;a/=10)r++;o%=K,s=o-K+r,u=s<0?0:l/ae(10,r-s-1)%10|0}if(n=n||e<0||m[p+1]!==void 0||(s<0?l:l%ae(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ae(10,r-s):0:m[p-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=ae(10,(K-e%K)%K),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=p,a=1,p--):(m.length=p+1,a=ae(10,K-o),m[p]=s>0?(l/ae(10,r-s)%ae(10,s)|0)*a:0),c)for(;;)if(p==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Ee&&(m[0]=1));break}else{if(m[p]+=a,m[p]!=Ee)break;m[p--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return E&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function De(i,e,t){if(!i.isFinite())return ii(i);var n,r=i.e,o=de(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+je(-r-1)+o,t&&(n=t-s)>0&&(o+=je(n))):r>=s?(o+=je(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+je(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=je(n))),o}function vt(i,e){var t=i[0];for(e*=K;t>=10;t/=10)e++;return e}function Ft(i,e,t){if(e>er)throw E=!0,t&&(i.precision=t),Error(Zn);return I(new i(Mt),e,1,!0)}function Re(i,e,t){if(e>tn)throw Error(Zn);return I(new i(Ot),e,t,!0)}function ei(i){var e=i.length-1,t=e*K+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function je(i){for(var e="";i--;)e+="0";return e}function ti(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/K+4);for(E=!1;;){if(t%2&&(o=o.times(e),zn(o.d,s)&&(r=!0)),t=ye(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),zn(e.d,s)}return E=!0,o}function Hn(i){return i.d[i.d.length-1]&1}function ni(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function nn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,p=i.constructor,d=p.rounding,b=p.precision;if(!i.d||!i.d[0]||i.e>17)return new p(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(E=!1,u=b):u=e,a=new p(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ae(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new p(1),p.precision=u;;){if(o=I(o.times(i),u,1),t=t.times(++l),a=s.plus(Z(o,t,u,1)),de(a.d).slice(0,u)===de(s.d).slice(0,u)){for(r=m;r--;)s=I(s.times(s),u,1);if(e==null)if(c<3&&ht(s.d,u-n,d,c))p.precision=u+=10,t=o=a=new p(1),l=0,c++;else return I(s,p.precision=b,d,E=!0);else return p.precision=b,s}s=a}}function Je(i,e){var t,n,r,o,s,a,u,c,l,m,p,d=1,b=10,f=i,g=f.d,k=f.constructor,A=k.rounding,h=k.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new k(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(E=!1,l=h):l=e,k.precision=l+=b,t=de(g),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=de(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new k("0."+t),o++):f=new k(n+"."+t.slice(1))}else return c=Ft(k,l+2,h).times(o+""),f=Je(new k(n+"."+t.slice(1)),l-b).plus(c),k.precision=h,e==null?I(f,h,A,E=!0):f;for(m=f,u=s=f=Z(f.minus(1),f.plus(1),l,1),p=I(f.times(f),l,1),r=3;;){if(s=I(s.times(p),l,1),c=u.plus(Z(s,new k(r),l,1)),de(c.d).slice(0,l)===de(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Ft(k,l+2,h).times(o+""))),u=Z(u,new k(d),l,1),e==null)if(ht(u.d,l-b,A,a))k.precision=l+=b,c=s=f=Z(m.minus(1),m.plus(1),l,1),p=I(f.times(f),l,1),r=a=1;else return I(u,k.precision=h,A,E=!0);else return k.precision=h,u;u=c,r+=2}}function ii(i){return String(i.s*i.s/0)}function rn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%K,t<0&&(n+=K),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=K;n<r;)i.d.push(+e.slice(n,n+=K));e=e.slice(n),n=K-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),E&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function nr(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),$n.test(e))return rn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(ji.test(e))t=16,e=e.toLowerCase();else if(Zi.test(e))t=2;else if(Ji.test(e))t=8;else throw Error($e+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ti(n,new n(t),o,o*2)),c=Et(e,t,Ee),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=vt(c,l),i.d=c,E=!1,s&&(i=Z(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?ae(2,u):At.pow(2,u))),E=!0,i)}function ir(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:ft(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Dt(5,t)),e=ft(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function ft(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/K);for(E=!1,u=t.times(t),a=new i(n);;){if(s=Z(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=Z(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return E=!0,s.d.length=m+1,s}function Dt(i,e){for(var t=i;--e;)t*=i;return t}function ri(i,e){var t,n=e.s<0,r=Re(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Xe=n?4:1,e;if(t=e.divToInt(r),t.isZero())Xe=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Xe=Hn(t)?n?2:3:n?4:1,e;Xe=Hn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function on(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor,b=t!==void 0;if(b?(Pe(t,1,et),n===void 0?n=d.rounding:Pe(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=ii(i);else{for(l=De(i),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),p=new d(1),p.e=l.length-s,p.d=Et(De(p),10,r),p.e=p.d.length),m=Et(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(i=new d(i),i.d=m,i.e=o,i=Z(i,p,t,n,0,r),m=i.d,o=i.e,c=Qn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=$t.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Et(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=$t.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function zn(i,e){if(i.length>e)return i.length=e,!0}function rr(i){return new this(i).abs()}function or(i){return new this(i).acos()}function sr(i){return new this(i).acosh()}function ar(i,e){return new this(i).plus(e)}function ur(i){return new this(i).asin()}function cr(i){return new this(i).asinh()}function lr(i){return new this(i).atan()}function mr(i){return new this(i).atanh()}function dr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Re(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Re(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Re(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Z(i,e,o,1)),e=Re(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(Z(i,e,o,1)),t}function pr(i){return new this(i).cbrt()}function fr(i){return I(i=new this(i),i.e+1,2)}function br(i,e,t){return new this(i).clamp(e,t)}function yr(i){if(!i||typeof i!="object")throw Error(Wt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,et,"rounding",0,8,"toExpNeg",-pt,0,"toExpPos",0,pt,"maxE",0,pt,"minE",-pt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=en[t]),(n=i[t])!==void 0)if(ye(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error($e+t+": "+n);if(t="crypto",r&&(this[t]=en[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(jn);else this[t]=!1;else throw Error($e+t+": "+n);return this}function gr(i){return new this(i).cos()}function wr(i){return new this(i).cosh()}function oi(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Yn(o)){c.s=o.s,E?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;E?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return rn(c,o.toString())}else if(u!=="string")throw Error($e+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),$n.test(o)?rn(c,o):nr(c,o)}if(r.prototype=w,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=yr,r.clone=oi,r.isDecimal=Yn,r.abs=rr,r.acos=or,r.acosh=sr,r.add=ar,r.asin=ur,r.asinh=cr,r.atan=lr,r.atanh=mr,r.atan2=dr,r.cbrt=pr,r.ceil=fr,r.clamp=br,r.cos=gr,r.cosh=wr,r.div=kr,r.exp=hr,r.floor=Ar,r.hypot=Pr,r.ln=Tr,r.log=xr,r.log10=Ir,r.log2=Br,r.max=Sr,r.min=Cr,r.mod=Kr,r.mul=Nr,r.pow=Lr,r.random=Rr,r.round=Er,r.sign=Mr,r.sin=Or,r.sinh=Fr,r.sqrt=Wr,r.sub=vr,r.sum=Dr,r.tan=_r,r.tanh=qr,r.trunc=Vr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function kr(i,e){return new this(i).div(e)}function hr(i){return new this(i).exp()}function Ar(i){return I(i=new this(i),i.e+1,3)}function Pr(){var i,e,t=new this(0);for(E=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return E=!0,new this(1/0);t=e}return E=!0,t.sqrt()}function Yn(i){return i instanceof At||i&&i.toStringTag===Jn||!1}function Tr(i){return new this(i).ln()}function xr(i,e){return new this(i).log(e)}function Br(i){return new this(i).log(2)}function Ir(i){return new this(i).log(10)}function Sr(){return ni(this,arguments,"lt")}function Cr(){return ni(this,arguments,"gt")}function Kr(i,e){return new this(i).mod(e)}function Nr(i,e){return new this(i).mul(e)}function Lr(i,e){return new this(i).pow(e)}function Rr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Pe(i,1,et),n=Math.ceil(i/K),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(jn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=K,n&&i&&(r=ae(10,K-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=K)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<K&&(t-=K-n)}return s.e=t,s.d=a,s}function Er(i){return I(i=new this(i),i.e+1,this.rounding)}function Mr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Or(i){return new this(i).sin()}function Fr(i){return new this(i).sinh()}function Wr(i){return new this(i).sqrt()}function vr(i,e){return new this(i).sub(e)}function Dr(){var i=0,e=arguments,t=new this(e[i]);for(E=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return E=!0,I(t,this.precision,this.rounding)}function _r(i){return new this(i).tan()}function qr(i){return new this(i).tanh()}function Vr(i){return I(i=new this(i),i.e+1,1)}w[Symbol.for("nodejs.util.inspect.custom")]=w.toString;w[Symbol.toStringTag]="Decimal";var At=w.constructor=oi(en);Mt=new At(Mt);Ot=new At(Ot);var N=At;import{get as si,set as Gr}from"lodash";import ui from"dayjs";import Ur from"dayjs/plugin/utc";ui.extend(Ur);var sn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return ui().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ai={},Xr={};function re(i){let e=si(ai,i);if(!e){let t=si(Xr,i);e=new sn({name:i,logLevel:t}),Gr(ai,i,e)}return e}import{PublicKey as uo}from"@solana/web3.js";import co from"bn.js";import oo from"big.js";import Gt from"bn.js";import Te from"bn.js";import{PublicKey as mn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Hr}from"@solana/spl-token";import{PublicKey as $,SystemProgram as ci,SYSVAR_RENT_PUBKEY as zr}from"@solana/web3.js";function D({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var gs=[D({pubkey:Hr,isWritable:!1}),D({pubkey:ci.programId,isWritable:!1}),D({pubkey:zr,isWritable:!1})];function un({publicKey:i,transformSol:e}){let t=cn(i.toString());if(t instanceof $)return e&&t.equals(Pt)?an:t;if(e&&t.toString()===Pt.toBase58())return an;if(typeof t=="string"){if(t===$.default.toBase58())return $.default;try{return new $(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function cn(i){try{return new $(i)}catch{return i}}var bt=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ws=new $("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),yt=new $("SysvarRent111111111111111111111111111111111"),ks=new $("SysvarC1ock11111111111111111111111111111111"),gt=new $("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),hs=new $("Sysvar1nstructions1111111111111111111111111"),As=ci.programId,Ps=new $("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ts=new $("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xs=new $("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Bs=new $("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Is=new $("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ss=new $("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Cs=new $("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ks=new $("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ns=new $("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ls=new $("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Rs=new $("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),an=new $("So11111111111111111111111111111111111111112"),Pt=$.default;function ln(i){return un({publicKey:i,transformSol:!0})}import{PublicKey as Yr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as li}from"@solana/spl-token";var mi={chainId:101,address:Yr.default.toBase58(),programId:li.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},st={chainId:101,address:"So11111111111111111111111111111111111111112",programId:li.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var dn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Pt.toBase58()||e instanceof mn&&Pt.equals(e)){this.decimals=st.decimals,this.symbol=st.symbol,this.name=st.name,this.mint=new mn(st.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?mn.default:un({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},_e=dn;_e.WSOL=new dn({...st,mint:st.address});import qt from"big.js";import jr from"bn.js";import Jr from"decimal.js-light";import Qr from"toformat";var Zr=Qr,Tt=Zr;var _t=re("module/fraction"),pn=Tt(qt),xt=Tt(Jr),$r={[0]:xt.ROUND_DOWN,[1]:xt.ROUND_HALF_UP,[2]:xt.ROUND_UP},eo={[0]:qt.roundDown,[1]:qt.roundHalfUp,[2]:qt.roundUp},H=class{constructor(e,t=new jr(1)){this.numerator=te(e),this.denominator=te(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(te(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(te(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(te(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(te(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||_t.logWithError(`${e} is not an integer.`),e<=0&&_t.logWithError(`${e} is not positive.`),xt.set({precision:e+1,rounding:$r[n]});let r=new xt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||_t.logWithError(`${e} is not an integer.`),e<0&&_t.logWithError(`${e} is negative.`),pn.DP=e,pn.RM=eo[n]||1,new pn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var no=re("Raydium_price"),Ie=class extends H{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new H(fn(n.decimals),fn(r.decimals))}get raw(){return new H(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ie({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&no.logWithError("mul token not equals");let n=super.mul(t);return new Ie({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var bn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Vt=bn;Vt.SOL=new bn(mi);import io from"bn.js";var di=new H(new io(100)),tt=class extends H{toSignificant(e=5,t,n){return this.mul(di).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(di).toFixed(e,t,n)}};var pi=new Te(0),ro=new Te(1),Ca=new Te(2),Ka=new Te(3),Na=new Te(5),yn=new Te(10),La=new Te(100),Ra=new Te(1e3),Ea=new Te(1e4),fi=9007199254740991;function te(i){let e=re("Raydium_parseBigNumberish");if(i instanceof Te)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Te(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=fi||i<=-fi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Te(String(i))):typeof i=="bigint"?new Te(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Te(0))}function fn(i){return yn.pow(te(i))}var so=re("Raydium_amount"),yi=Tt(oo);function ao(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):so.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var pe=class extends H{constructor(t,n,r=!0,o){let s=new Gt(0),a=yn.pow(new Gt(t.decimals));if(r)s=te(n);else{let u=new Gt(0),c=new Gt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=ao(n.toString(),t.decimals);u=te(l),c=te(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=re(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return yi.DP=this.token.decimals,new yi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function bi(i){return typeof i=="object"&&i!==null&&![_e,pe,uo,H,co,Ie,tt].some(e=>typeof e=="object"&&i instanceof e)}function ge(i){return typeof i=="string"?cn(i):Array.isArray(i)?i.map(e=>ge(e)):bi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,ge(t)])):i}import{PublicKey as Uu,sendAndConfirmTransaction as Xu,Transaction as zu,TransactionMessage as Qu,VersionedTransaction as Zu}from"@solana/web3.js";import Ju from"axios";var ne={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as lo,ComputeBudgetProgram as uu,Transaction as lu,TransactionMessage as du,Keypair as pu,VersionedTransaction as bu}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as gu}from"@solana/spl-token";var hu=re("Raydium_txUtil");function Se(i,e){let[t,n]=lo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as po,AddressLookupTableAccount as gi}from"@solana/web3.js";import{PublicKey as mo}from"@solana/web3.js";import{getTransferFeeConfig as Su,unpackMint as Cu}from"@solana/spl-token";var gn=re("Raydium_accountInfo_util");async function at(i,e,t){let{batchRequest:n,commitment:r="confirmed"}={batchRequest:!1,...t},o=wn(e,100),s=new Array(o.length).fill([]);if(n){let a=o.map(l=>{let m=i._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=wn(a,10);s=(await(await Promise.all(u.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&gn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(m=>{if(m){let{data:p,executable:d,lamports:b,owner:f,rentEpoch:g}=m;return p.length!==2&&p[1]!=="base64"&&gn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:d,lamports:b,owner:new mo(f),rentEpoch:g}}return null})))}else try{s=await Promise.all(o.map(a=>i.getMultipleAccountsInfo(a,r)))}catch(a){a instanceof Error&&gn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function kn(i,e,t){let n=await at(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>({...r,accountInfo:n[o]}))}var fo={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new gi({key:new po("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:gi.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function wn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as oe}from"@solana/web3.js";var uc=new oe("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),cc=new oe("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),lc=new oe("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),mc=new oe("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),dc=new oe("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),pc=new oe("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),fc=new oe("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),bc=new oe("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),yc=new oe("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),gc=new oe("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),wc=new oe("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),kc=new oe("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),hc=new oe("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ac=new oe("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Pc=new oe("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Tc=new oe("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),xc=new oe("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Bc=new oe("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ic=new oe("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Sc=new oe("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import{PublicKey as yo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as go}from"@solana/spl-token";function qe(i,e,t){return Se([i.toBuffer(),(t!=null?t:go).toBuffer(),e.toBuffer()],new yo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Me from"bn.js";var Bt=1e4;function ue(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r={...e,olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}},o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Me(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Bt){let u=new Me(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=hn(i.mul(new Me(Bt)),new Me(Bt-o.transferFeeBasisPoints)),c=new Me(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=hn(l.mul(new Me(o.transferFeeBasisPoints)),new Me(Bt)),p=m.gt(s)?s:m;return{amount:l,fee:p,expirationTime:a}}else{let u=hn(i.mul(new Me(o.transferFeeBasisPoints)),new Me(Bt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function ut(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function hn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Me(0))?t.add(new Me(1)):t}import Ve from"bn.js";var se=new Ve(0),xe=new Ve(1),He=new Ve(-1),Be=new Ve(1).shln(64),Ut=new Ve(1).shln(128),An=Be.sub(xe),It=64,wi=Ut.subn(1),we=-443636,he=-we,ze=new Ve("4295048016"),Ye=new Ve("79226673521066979257578248091"),ki=16,hi="59543866431248",Ai="184467440737095516",Pi="15793534762490258745",Xt=new Ve(10).pow(new Ve(6));var rl=new Ve("18446744073700000000");import _ from"bn.js";function Ht(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Pn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Tn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function St(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ti(i,e){return St(i,e)?null:Pn(i,e)}function xi(i,e){return St(i,e)?null:Tn(i,e)}var ll=Buffer.from("amm_config","utf8"),wo=Buffer.from("pool","utf8"),ko=Buffer.from("pool_vault","utf8"),ho=Buffer.from("pool_reward_vault","utf8"),Bi=Buffer.from("position","utf8"),Ao=Buffer.from("tick_array","utf8"),Po=Buffer.from("operation","utf8"),To=Buffer.from("pool_tick_array_bitmap_extension","utf8");function Ii(i,e,t,n){return Se([wo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function xn(i,e,t){return Se([ko,e.toBuffer(),t.toBuffer()],i)}function Si(i,e,t){return Se([ho,e.toBuffer(),t.toBuffer()],i)}function Y(i,e,t){return Se([Ao,e.toBuffer(),Ht(t)],i)}function ct(i,e,t,n){return Se([Bi,e.toBuffer(),Ht(t),Ht(n)],i)}function Oe(i,e){return Se([Bi,e.toBuffer()],i)}function zt(i){return Se([Buffer.from("metadata","utf8"),gt.toBuffer(),i.toBuffer()],gt)}function Yt(i){return Se([Po],i)}function Ce(i,e){return Se([To,e.toBuffer()],i)}import{PublicKey as nt}from"@solana/web3.js";import ie from"bn.js";import qo from"bn.js";import{PublicKey as Ro}from"@solana/web3.js";import Li,{isBN as Ri}from"bn.js";import{bits as pl,BitStructure as fl,blob as xo,Blob as bl,cstr as yl,f32 as gl,f32be as wl,f64 as kl,f64be as hl,greedy as Al,Layout as Bo,ns64 as Pl,ns64be as Tl,nu64 as xl,nu64be as Bl,offset as Il,s16 as Sl,s16be as Cl,s24 as Kl,s24be as Nl,s32 as Io,s32be as Ll,s40 as Rl,s40be as El,s48 as Ml,s48be as Ol,s8 as Fl,seq as So,struct as Wl,Structure as Co,u16 as Ko,u16be as vl,u24 as Dl,u24be as _l,u32 as ql,u32be as Vl,u40 as Gl,u40be as Ul,u48 as Xl,u48be as Hl,u8 as No,UInt as Lo,union as zl,Union as Yl,unionLayoutDiscriminator as Ql,utf8 as Zl}from"@solana/buffer-layout";var Bn=Bo,Ci=Co;var In=Lo;var Ki=No,wt=Ko;var fe=Io;var Ni=So;var Ke=xo;var Ct=class extends Bn{constructor(t,n,r){super(t,r);this.blob=Ke(t),this.signed=n}decode(t,n=0){let r=new Li(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Li(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function V(i){return new In(1,i)}function Qe(i){return new In(4,i)}function y(i){return new Ct(8,!1,i)}function M(i){return new Ct(16,!1,i)}function Ei(i){return new Ct(16,!0,i)}var Qt=class extends Bn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function R(i){return new Qt(Ke(32),e=>new Ro(e),e=>e.toBuffer(),i)}function Ge(i){return new Qt(Ki(),Eo,Mo,i)}function Eo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Mo(i){return i?1:0}var Sn=class extends Ci{decode(e,t){return super.decode(e,t)}};function F(i,e,t){return new Sn(i,e,t)}function j(i,e,t){let n,r=typeof e=="number"?e:Ri(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Ri(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Ni(i,r,t)}var Cn=14,Ze=class{static maxTickInTickarrayBitmap(e){return e*ce*lt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!G.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-G.tickCount(n):t+G.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ce,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Ti(1024,l);if(m!==null){let p=(c-m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=xi(1024,l);if(m!==null){let p=(c+m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-G.tickCount(n)}}}},Kt=class{static getBitmapOffset(e,t){if(!G.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Ze.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;if(he<=t)throw Error(`extensionTickBoundary check error: ${he}, ${t}`);if(n<=we)throw Error(`extensionTickBoundary check error: ${n}, ${we}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:B.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=G.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=Ze.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=B.mergeTickArrayBitmap(e).shln(lt-1-a),c=St(512,u)?null:Pn(512,u);if(c!==null){let l=t-c*G.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=B.mergeTickArrayBitmap(e).shrn(a),c=St(512,u)?null:Tn(512,u);if(c!==null){let l=t+c*G.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-G.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Ze.maxTickInTickarrayBitmap(t),r=Math.floor(n/G.tickCount(t));return e<0&&n!=0&&(r=lt-r),r}};var gm=F([Ke(8),V("bump"),wt("index"),R(""),Qe("protocolFeeRate"),Qe("tradeFeeRate"),wt("tickSpacing"),j(y(),8,"")]),Oo=F([Qe("blockTimestamp"),M("sqrtPriceX64"),M("cumulativeTimePriceX64"),j(M(),1,"")]),Kn=F([Ke(8),Ge("initialized"),R("poolId"),j(Oo,1e3,"observations"),j(M(),5,"")]),Fo=F([V("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),M("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),R("tokenMint"),R("tokenVault"),R("creator"),M("rewardGrowthGlobalX64")]),Nn=F([Ke(8),V("bump"),R("ammConfig"),R("creator"),R("mintA"),R("mintB"),R("vaultA"),R("vaultB"),R("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),wt("tickSpacing"),M("liquidity"),M("sqrtPriceX64"),fe("tickCurrent"),wt("observationIndex"),wt("observationUpdateDuration"),M("feeGrowthGlobalX64A"),M("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),M("swapInAmountTokenA"),M("swapOutAmountTokenB"),M("swapInAmountTokenB"),M("swapOutAmountTokenA"),V("status"),j(V(),7,""),j(Fo,3,"rewardInfos"),j(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),j(y(),15*4-3,"padding")]),Wo=F([M("growthInsideLastX64"),y("rewardAmountOwed")]),Ln=F([Ke(8),V("bump"),R("nftMint"),R("poolId"),fe("tickLower"),fe("tickUpper"),M("liquidity"),M("feeGrowthInsideLastX64A"),M("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),j(Wo,3,"rewardInfos"),j(y(),8,"")]),wm=F([Ke(8),V("bump"),R("poolId"),fe("tickLowerIndex"),fe("tickUpperIndex"),M("liquidity"),M("feeGrowthInsideLastX64A"),M("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),j(M(),3,"rewardGrowthInside"),j(y(),8,"")]),vo=F([fe("tick"),Ei("liquidityNet"),M("liquidityGross"),M("feeGrowthOutsideX64A"),M("feeGrowthOutsideX64B"),j(M(),3,"rewardGrowthsOutsideX64"),j(Qe(),13,"")]),Nt=F([Ke(8),R("poolId"),fe("startTickIndex"),j(vo,ce,"ticks"),V("initializedTickCount"),j(V(),115,"")]),Do=F([Ke(329),j(R(),100,"whitelistMints")]),Mi=F([Ke(8),R("poolId"),j(j(y(),8),Cn,"positiveTickArrayBitmap"),j(j(y(),8),Cn,"negativeTickArrayBitmap")]);var _o=15,G=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=B.getTickArrayStartIndexByTick(r,o),l=B.getInitializedTickArrayInRange(s,a,o,c,Math.floor(_o/2));for(let d=0;d<l.length;d++){let{publicKey:b}=Y(t,n,l[d]);u.push(b)}let m=(await at(e,u)).map(d=>d!==null?Nt.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let b=m[d];b!==null&&(p[b.startTickIndex]={...b,address:u[d]})}return p}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=B.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,p,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/G.tickCount(t)),a=n?B.searchLowBitFromStart(r,o,s-1,1,t):B.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ce-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ce;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=Y(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=B.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u-1}else for(u=u+1;u<ce;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u+1}let{publicKey:m}=Y(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(B.checkIsOutOfBoundary(e)){if(e>he)return!1;let n=B.getTickArrayStartIndexByTick(we,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ce*e}};var ce=60,lt=512,B=class{static getTickArrayAddressByTick(e,t,n,r){let o=B.getTickArrayStartIndexByTick(n,r),{publicKey:s}=Y(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=B.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ce)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=G.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*G.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ce,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ce,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ce:e+t*ce}static mergeTickArrayBitmap(e){let t=new qo(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ce));return[...B.searchLowBitFromStart(e,t,s-1,o,n),...B.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return B.searchHightBitFromStart(e,t,0,lt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=B.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=Y(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>B.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=G.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>B.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=G.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<we||e>he}static nextInitTick(e,t,n,r,o){if(G.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ce;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ce-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ce;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=W.getSqrtPriceX64FromTick(t),o=W.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=mt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=W.getSqrtPriceX64FromTick(o),a=W.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=W.getSqrtPriceX64FromTick(t),o=W.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=mt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=W.getSqrtPriceX64FromTick(o),a=W.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};import Ue from"bn.js";var Lt=class{static getfeeGrowthInside(e,t,n){let r=new Ue(0),o=new Ue(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ue(0),a=new Ue(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Be),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=v.wrappingSubU128(u,c.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Be),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ue(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ue(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ue(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ue(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var g,k,A,h;let a=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),u=W.getSqrtPriceX64FromTick(t.tickLower),c=W.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=U.getAmountsFromLiquidity(a,u,c,n,o),[p,d]=[ue(m.amountA,(g=e.mintA.extensions)==null?void 0:g.feeConfig,s,!0),ue(m.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)],[b,f]=[ue(new Ue(new N(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ue(new Ue(new N(m.amountB.toString()).mul(l).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:f,expirationTime:ut(p.expirationTime,d.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as Oi}from"@solana/spl-token";var ke=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintA.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:b}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,c,o);return a.push(...p),{expectedAmountOut:m.mul(He),remainingAccounts:a,executionPrice:d,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:g}=Y(e.programId,e.id,f.nextStartIndex);a.push(g)}}catch{}a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:b}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(He),c,o);return a.push(...p),{expectedAmountIn:m,remainingAccounts:a,executionPrice:d,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ke.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Kt.checkTickArrayIsInit(G.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):B.checkTickArrayIsInitialized(B.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Y(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,G.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Y(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/G.tickCount(e.tickSpacing)),r=t?B.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):B.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=G.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=Ze.nextInitializedTickArrayStartIndex(B.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Kt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<we||t>he)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],p=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d={...m,perSecond:v.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new nt(p)};if(d.tokenMint.equals(nt.default))continue;if(n<=d.openTime.toNumber()||r.eq(se)){s.push(d);continue}let b=new ie(Math.min(d.endTime.toNumber(),n)),f=b.sub(d.lastUpdateTime),g=v.mulDivFloor(f,d.emissionsPerSecondX64,r),k=d.rewardGrowthGlobalX64.add(g),A=v.mulDivFloor(f,d.emissionsPerSecondX64,Be),h=d.rewardTotalEmissioned.add(A);s.push({...d,rewardGrowthGlobalX64:k,rewardTotalEmissioned:h,lastUpdateTime:b})}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=B.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=Ze.maxTickInTickarrayBitmap(e),n=-t;return t>he&&(t=G.getArrayStartIndex(he,e)+G.tickCount(e)),n<we&&(n=G.getArrayStartIndex(we,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!G.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/G.tickCount(t)*lt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await kn(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Mi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=B.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=B.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:p}=Y(u.programId,u.id,m);o.push({pubkey:p}),r[p.toString()]=u.id}}let s=await kn(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Nt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of u)for(let d of s)c.push(Oe(d,p).publicKey);let l=await at(t,c,{batchRequest:r}),m={};for(let p of l){if(p===null)continue;let d=Ln.decode(p.data),b=d.poolId.toString(),f=e.find(q=>q.state.id.toBase58()===b);if(f===void 0)continue;let g=f.state,k=B._getTickPriceLegacy({poolInfo:g,tick:d.tickLower,baseIn:!0}),A=B._getTickPriceLegacy({poolInfo:g,tick:d.tickUpper,baseIn:!0}),{amountA:h,amountB:x}=U.getAmountsFromLiquidity(g.sqrtPriceX64,k.tickSqrtPriceX64,A.tickSqrtPriceX64,d.liquidity,!1),P=1/(1-Math.sqrt(Math.sqrt(k.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:k.price,priceUpper:A.price,amountA:h,amountB:x,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(q=>({...q,pendingReward:new ie(0)})),leverage:P,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let L=await B.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),O=await B.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=L,m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=O}if(o){let p=Object.values(m),d=await at(t,p,{batchRequest:r}),b={};for(let f=0;f<p.length;f++){let g=d[f];if(g===null)continue;let k=p[f].toString();b[k]=Nt.decode(g.data)}for(let{state:f,positionAccount:g}of e)if(!!g)for(let k of g){let A=`${f.programId.toString()}-${f.id.toString()}-${k.tickLower}`,h=`${f.programId.toString()}-${f.id.toString()}-${k.tickUpper}`,x=b[m[A].toString()],P=b[m[h].toString()],L=x.ticks[B.getTickOffsetInArray(k.tickLower,f.tickSpacing)],O=P.ticks[B.getTickOffsetInArray(k.tickUpper,f.tickSpacing)],{tokenFeeAmountA:q,tokenFeeAmountB:J}=await Lt.GetPositionFees(f,k,L,O),X=await Lt.GetPositionRewards(f,k,L,O);k.tokenFeeAmountA=q.gte(new ie(0))?q:new ie(0),k.tokenFeeAmountB=J.gte(new ie(0))?J:new ie(0);for(let Q=0;Q<X.length;Q++)k.rewardInfos[Q].pendingReward=X[Q].gte(new ie(0))?X[Q]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new N(0)}){var X;let u,c=n.toBase58()===e.mintA.address,[l,m]=c?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new N(0))?u=c?ze.add(new ie(1)):Ye.sub(new ie(1)):u=W.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ue(o,l,r,!1),{expectedAmountOut:d,remainingAccounts:b,executionPrice:f,feeAmount:g}=ke.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((X=p.fee)!=null?X:se),u),k=ue(d,m,r,!1),A=W.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),h=c?A:new N(1).div(A),x=d.mul(new ie(Math.floor((1-s)*1e10))).div(new ie(1e10)),P=ue(x,m,r,!1),L=c?e.currentPrice:new N(1).div(e.currentPrice),O=new N(h).sub(L).abs(),q=L,J=new tt(new N(O).mul(10**15).toFixed(0),new N(q).mul(10**15).toFixed(0));return{realAmountIn:p,amountOut:k,minAmountOut:P,expirationTime:ut(p.expirationTime,k.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:J,fee:g,remainingAccounts:b}}static async computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s}){let a=r.address===e.mintB.address,[u,c]=a?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,m]=[new _e({...u,mint:u.address,isToken2022:u.programId===Oi.toBase58()}),new _e({...c,mint:c.address,isToken2022:c.programId===Oi.toBase58()})],{realAmountIn:p,amountOut:d,minAmountOut:b,expirationTime:f,currentPrice:g,executionPrice:k,priceImpact:A,fee:h,remainingAccounts:x}=await ke.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new nt(u.address),amountIn:n,slippage:o,epochInfo:s}),P={...p,amount:new pe(l,p.amount),fee:p.fee===void 0?void 0:new pe(l,p.fee)},L={...d,amount:new pe(m,d.amount),fee:d.fee===void 0?void 0:new pe(m,d.fee)},O={...b,amount:new pe(m,b.amount),fee:b.fee===void 0?void 0:new pe(m,b.fee)},q=new Ie({baseToken:l,denominator:new ie(10).pow(new ie(20+l.decimals)),quoteToken:m,numerator:g.mul(new N(10**(20+m.decimals))).toFixed(0)}),J=new Ie({baseToken:l,denominator:new ie(10).pow(new ie(20+l.decimals)),quoteToken:m,numerator:k.mul(new N(10**(20+m.decimals))).toFixed(0)}),X=new pe(l,h);return{realAmountIn:P,amountOut:L,minAmountOut:O,expirationTime:f,currentPrice:q,executionPrice:J,priceImpact:A,fee:X,remainingAccounts:x}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var b,f,g;let o=e[t],s=B.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=B.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,p=o.priceMax-o.priceMin,d;return l<=0?d=0:m===l?d=p/l:p===l?d=l/m:d=l/p*(l/m),{feeApr:o.feeApr*d,rewardsApr:[(b=o.rewardApr[0])!=null?b:0*d,(f=o.rewardApr[1])!=null?f:0*d,(g=o.rewardApr[2])!=null?g:0*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[ln(e.mintA.address).toString()],p=r[ln(e.mintB.address).toString()],d=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),g=W.getSqrtPriceX64FromTick(s),k=W.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:h}=U.getAmountsFromLiquidityWithSlippage(f,g,k,t,!1,!1,0),{amountSlippageA:x,amountSlippageB:P}=U.getAmountsFromLiquidityWithSlippage(f,g,k,o,!1,!1,0),L=new N(A.toString()).div(new N(10).pow(d)).mul(m.value).add(new N(h.toString()).div(new N(10).pow(b)).mul(p.value)),O=new N(x.toString()).div(new N(10).pow(d)).mul(m.value).add(new N(P.toString()).div(new N(10).pow(b)).mul(p.value)),q=O.div(L.add(O)).div(O),X=new N(l.volumeFee).mul(365).div(c).mul(q).mul(100).toNumber(),Q=3600*24*365,Le=e.rewardDefaultInfos.map(me=>{var z,Xn;let Ae=me.mint.decimals,ee=r[me.mint.address];return u<((z=me.startTime)!=null?z:0)||u>((Xn=me.endTime)!=null?Xn:0)||!me.perSecond||!ee||Ae===void 0?0:new N(ee.value).mul(new N(me.perSecond).mul(Q)).div(new N(10).pow(Ae)).mul(q).mul(100).toNumber()});return{feeApr:X,rewardsApr:Le,apr:X+Le.reduce((me,Ae)=>me+Ae,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var k,A;let l=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=W.getSqrtPriceX64FromTick(n),p=W.getSqrtPriceX64FromTick(r),d=a?1-s:1+s,b=ue(o,(k=e[t?"mintA":"mintB"].extensions)==null?void 0:k.feeConfig,u,!c),f=new ie(new N(b.amount.sub((A=b.fee)!=null?A:se).toString()).mul(d).toFixed(0)),g;if(l.lte(m))g=t?U.getLiquidityFromTokenAmountA(m,p,f,!a):new ie(0);else if(l.lte(p)){let h=U.getLiquidityFromTokenAmountA(l,p,f,!a),x=U.getLiquidityFromTokenAmountB(m,l,f);g=t?h:x}else g=t?new ie(0):U.getLiquidityFromTokenAmountB(m,p,f);return ke.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:g,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var g,k,A,h;let u=W.getSqrtPriceX64FromTick(n),c=W.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=U.getAmountsFromLiquidity(W.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[p,d]=[ue(m.amountA,(g=t.mintA.extensions)==null?void 0:g.feeConfig,e,!0),ue(m.amountB,(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)],[b,f]=[ue(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ue(m.amountB.muln(l),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:p,amountB:d,amountSlippageA:b,amountSlippageB:f,expirationTime:ut(p.expirationTime,d.expirationTime)}}static async fetchComputeClmmInfo({owner:e,connection:t,poolInfo:n}){let r=await t.getAccountInfo(new nt(n.id));if(!r)throw new Error(`pool not found ${n.id}`);let o=Nn.decode(r.data),s=Ce(e,new nt(n.id)).publicKey,a=await ke.fetchExBitmaps({connection:t,exBitmapAddress:[s],batchRequest:!1});return{...o,id:new nt(n.id),programId:new nt(n.programId),mintA:n.mintA,mintB:n.mintB,ammConfig:{...n.config,id:new nt(n.config.id),fundOwner:""},currentPrice:new N(n.price),exBitmapInfo:a[s.toBase58()],startTime:o.startTime.toNumber()}}};var v=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(se)||(o=o.add(xe)),o}static mulDivFloor(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).add(n.sub(xe)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new _(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Ut).sub(t).mod(Ut)}};function le(i,e){return Rn(i.mul(e),64,256)}function Vo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Rn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var W=class{static sqrtPriceX64ToPrice(e,t,n){return v.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return v.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(se))return e;let o=t.shln(It);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?v.mulDivCeil(s,e,a):v.mulDivRoundingUp(s,xe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return v.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(It);if(r)return e.add(o.div(t));{let s=v.mulDivRoundingUp(o,xe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<we||e>he)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new _("18445821805675395072"):new _("18446744073709551616");return(t&2)!=0&&(n=le(n,new _("18444899583751176192"))),(t&4)!=0&&(n=le(n,new _("18443055278223355904"))),(t&8)!=0&&(n=le(n,new _("18439367220385607680"))),(t&16)!=0&&(n=le(n,new _("18431993317065453568"))),(t&32)!=0&&(n=le(n,new _("18417254355718170624"))),(t&64)!=0&&(n=le(n,new _("18387811781193609216"))),(t&128)!=0&&(n=le(n,new _("18329067761203558400"))),(t&256)!=0&&(n=le(n,new _("18212142134806163456"))),(t&512)!=0&&(n=le(n,new _("17980523815641700352"))),(t&1024)!=0&&(n=le(n,new _("17526086738831433728"))),(t&2048)!=0&&(n=le(n,new _("16651378430235570176"))),(t&4096)!=0&&(n=le(n,new _("15030750278694412288"))),(t&8192)!=0&&(n=le(n,new _("12247334978884435968"))),(t&16384)!=0&&(n=le(n,new _("8131365268886854656"))),(t&32768)!=0&&(n=le(n,new _("3584323654725218816"))),(t&65536)!=0&&(n=le(n,new _("696457651848324352"))),(t&131072)!=0&&(n=le(n,new _("26294789957507116"))),(t&262144)!=0&&(n=le(n,new _("37481735321082"))),e>0&&(n=wi.div(n)),n}static getTickFromPrice(e,t,n){return W.getTickFromSqrtPriceX64(W.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ye)||e.lt(ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new _(t-64),r=Vo(n,32,128),o=new _("8000000000000000","hex"),s=0,a=new _(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new _(0))&&s<ki;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new _(hi)),p=Rn(m.sub(new _(Ai)),64,128).toNumber(),d=Rn(m.add(new _(Pi)),64,128).toNumber();return p==d?p:W.getSqrtPriceX64FromTick(d).lte(e)?d:p}},mt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=W.getTickFromSqrtPriceX64(W.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=mt.getTickWithPriceAndTickspacing(e,t,n,r),s=W.getSqrtPriceX64FromTick(o);return W.sqrtPriceX64ToPrice(s,n,r)}},U=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(It),s=t.sub(e);return r?v.mulDivRoundingUp(v.mulDivCeil(o,s,t),xe,e):v.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");return r?v.mulDivCeil(n,t.sub(e),Be):v.mulDivFloor(n,t.sub(e),Be)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?v.mulDivRoundingUp(a,xe,An):a.shrn(It)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),v.mulDivFloor(n,An,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return U.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=U.getLiquidityFromTokenAmountA(e,n,r,!1),a=U.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return U.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:U.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new _(0)};if(e.lt(n)){let s=U.getTokenAmountAFromLiquidity(e,n,r,o),a=U.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new _(0),amountB:U.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=U.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new _(new N(u.toString()).mul(l).toFixed(0)),p=new _(new N(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,h,x,P;let c=W.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=W.getSqrtPriceX64FromTick(t),m=W.getSqrtPriceX64FromTick(n),p=s?1+o:1-o,d=U.getAmountsFromLiquidity(c,l,m,r,s),[b,f]=[ue(d.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),ue(d.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)],[g,k]=[ue(new _(new N(d.amountA.toString()).mul(p).toFixed(0)),(x=e.mintA.extensions)==null?void 0:x.feeConfig,a,u),ue(new _(new N(d.amountB.toString()).mul(p).toFixed(0)),(P=e.mintB.extensions)==null?void 0:P.feeConfig,a,u)];return{liquidity:r,amountA:b,amountB:f,amountSlippageA:g,amountSlippageB:k,expirationTime:ut(b.expirationTime,f.expirationTime)}}},dt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,p,d,b){if(p.eq(se))throw new Error("amountSpecified must not be 0");if(b||(b=s?ze.add(xe):Ye.sub(xe)),s){if(b.lt(ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(Ye))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let f=p.gt(se),g={amountSpecifiedRemaining:p,amountCalculated:se,sqrtPriceX64:m,tick:c>d?Math.min(d+G.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new _(0)},k=d,A=n[d],h=0,x=!s&&A.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(se)&&!g.sqrtPriceX64.eq(b);){if(h>10)throw Error("liquidity limit");let P={};P.sqrtPriceStartX64=g.sqrtPriceX64;let L=B.nextInitTick(A,g.tick,l,s,x),O=L||null,q=null;if(!(O!=null&&O.liquidityGross.gtn(0))){let X=ke.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},k,s);if(!X.isExist)throw Error("swapCompute LiquidityInsufficient");k=X.nextStartIndex;let{publicKey:Q}=Y(e,t,k);q=Q,A=n[k],O=B.firstInitializedTick(A,s)}P.tickNext=O.tick,P.initialized=O.liquidityGross.gtn(0),d!==k&&q&&(g.accounts.push(q),d=k),P.tickNext<we?P.tickNext=we:P.tickNext>he&&(P.tickNext=he),P.sqrtPriceNextX64=W.getSqrtPriceX64FromTick(P.tickNext);let J;if(s&&P.sqrtPriceNextX64.lt(b)||!s&&P.sqrtPriceNextX64.gt(b)?J=b:J=P.sqrtPriceNextX64,[g.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=dt.swapStepCompute(g.sqrtPriceX64,J,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(P.feeAmount),f?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),g.amountCalculated=g.amountCalculated.sub(P.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(P.amountOut),g.amountCalculated=g.amountCalculated.add(P.amountIn.add(P.feeAmount))),g.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let X=O.liquidityNet;s&&(X=X.mul(He)),g.liquidity=U.addDelta(g.liquidity,X)}x=P.tickNext!=g.tick&&!s&&A.startTickIndex===P.tickNext,g.tick=s?P.tickNext-1:P.tickNext}else if(g.sqrtPriceX64!=P.sqrtPriceStartX64){let X=W.getTickFromSqrtPriceX64(g.sqrtPriceX64);x=X!=g.tick&&!s&&A.startTickIndex===X,g.tick=X}++h}try{let{nextStartIndex:P,isExist:L}=G.nextInitializedTickArray(g.tick,l,s,r,o);L&&d!==P&&(g.accounts.push(Y(e,t,P).publicKey),d=P)}catch{}return{amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new _(0),amountIn:new _(0),amountOut:new _(0),feeAmount:new _(0)},a=e.gte(t),u=r.gte(se);if(u){let l=v.mulDivFloor(r,Xt.sub(new _(o.toString())),Xt);s.amountIn=a?U.getTokenAmountAFromLiquidity(t,e,n,!0):U.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=W.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?U.getTokenAmountBFromLiquidity(t,e,n,!1):U.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(He).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=W.getNextSqrtPriceX64FromOutput(e,n,r.mul(He),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=U.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=U.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:U.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:U.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(He))&&(s.amountOut=r.mul(He)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=v.mulDivCeil(s.amountIn,new _(o),Xt.sub(new _(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{TOKEN_PROGRAM_ID as be,TOKEN_2022_PROGRAM_ID as ot,ASSOCIATED_TOKEN_PROGRAM_ID as Vi}from"@solana/spl-token";import{PublicKey as T,TransactionInstruction as We,SystemProgram as kt,Keypair as Wn}from"@solana/web3.js";import Gi from"bn.js";import{PublicKey as Yo,Keypair as Qo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zo}from"@solana/spl-token";import Wd from"bn.js";var Go=F([R("mint"),R("owner"),y("amount"),Qe("delegateOption"),R("delegate"),V("state"),Qe("isNativeOption"),y("isNative"),y("delegatedAmount"),Qe("closeAuthorityOption"),R("closeAuthority")]);function Uo(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function En(i,...e){if(!Uo(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Mn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Fi(i,e){En(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var jt=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Fe=(i,e)=>i<<32-e|i>>>e;var Pd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Xo(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function On(i){return typeof i=="string"&&(i=Xo(i)),En(i),i}var Zt=class{clone(){return this._cloneInto()}},Td={}.toString;function Wi(i){let e=n=>i().update(On(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Ho(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),u=n?4:0,c=n?0:4;i.setUint32(e+u,s,n),i.setUint32(e+c,a,n)}var vi=(i,e,t)=>i&e^~i&t,Di=(i,e,t)=>i&e^i&t^e&t,Jt=class extends Zt{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=jt(this.buffer)}update(e){Mn(this);let{view:t,buffer:n,blockLen:r}=this;e=On(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let u=jt(e);for(;r<=o-s;s+=r)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Mn(this),Fi(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;Ho(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=jt(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var zo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),it=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),rt=new Uint32Array(64),Fn=class extends Jt{constructor(){super(64,32,8,!1),this.A=it[0]|0,this.B=it[1]|0,this.C=it[2]|0,this.D=it[3]|0,this.E=it[4]|0,this.F=it[5]|0,this.G=it[6]|0,this.H=it[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:u}=this;return[e,t,n,r,o,s,a,u]}set(e,t,n,r,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)rt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let p=rt[m-15],d=rt[m-2],b=Fe(p,7)^Fe(p,18)^p>>>3,f=Fe(d,17)^Fe(d,19)^d>>>10;rt[m]=f+rt[m-7]+b+rt[m-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let p=Fe(a,6)^Fe(a,11)^Fe(a,25),d=l+p+vi(a,u,c)+zo[m]+rt[m]|0,f=(Fe(n,2)^Fe(n,13)^Fe(n,22))+Di(n,r,o)|0;l=c,c=u,u=a,a=s+d|0,s=o,o=r,r=n,n=d+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,u,c,l)}roundClean(){rt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var _i=Wi(()=>new Fn);var qd=re("Raydium_Util");function qi({fromPublicKey:i,programId:e=Zo}){let t=Qo.generate().publicKey.toBase58().slice(0,32);return{publicKey:jo(i,t,e),seed:t}}function jo(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=_i(n);return new Yo(r)}var Ui=re("Raydium_Clmm"),ve={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Rt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b){let f=F([M("sqrtPriceX64"),y("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1}],k=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,startTime:b},k);let A=Buffer.from([...ve.createPool,...k]);return new We({keys:g,programId:e,data:A})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:r,mintA:o,mintB:s,ammConfigId:a,initialPriceX64:u,startTime:c,forerunCreate:l}=e,m=qi({fromPublicKey:r,programId:n}),[p,d]=[new T(o.address),new T(s.address)],b=[kt.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:m.seed,newAccountPubkey:m.publicKey,lamports:l?0:await t.getMinimumBalanceForRentExemption(Kn.span),space:Kn.span,programId:n})],{publicKey:f}=Ii(n,a,p,d),{publicKey:g}=xn(n,f,p),{publicKey:k}=xn(n,f,d);return b.push(this.createPoolInstruction(n,f,r,a,m.publicKey,p,g,new T(o.programId||be),d,k,new T(s.programId||be),Ce(n,f).publicKey,u,c)),{signers:[],instructions:b,instructionTypes:[ne.CreateAccount,ne.ClmmCreatePool],address:{poolId:f,observationId:m.publicKey,mintAVault:g,mintBVault:k},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,A,h,x,P,L,O,q,J,X){let Q=F([fe("tickLowerIndex"),fe("tickUpperIndex"),fe("tickArrayLowerStartIndex"),fe("tickArrayUpperStartIndex"),M("liquidity"),y("amountMaxA"),y("amountMaxB"),Ge("withMetadata"),V("optionBaseFlag"),Ge("baseFlag")]),Le=[...X?[{pubkey:X,isSigner:!1,isWritable:!0}]:[]],me=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:Vi,isSigner:!1,isWritable:!1},{pubkey:gt,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...Le],Ae=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:A,tickUpperIndex:h,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:P,liquidity:L,amountMaxA:O,amountMaxB:q,withMetadata:J==="create",baseFlag:!1,optionBaseFlag:0},Ae);let ee=Buffer.from([...ve.openPosition,...Ae]);return new We({keys:me,programId:e,data:ee})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let q=Wn.generate();m.push(q),b=q.publicKey}let f=B.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=B.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=Y(p,d,f),{publicKey:A}=Y(p,d,g),{publicKey:h}=qe(n.wallet,b,be),{publicKey:x}=zt(b),{publicKey:P}=Oe(p,b),{publicKey:L}=ct(p,d,r,o),O=this.openPositionFromLiquidityInstruction(p,n.feePayer,d,n.wallet,b,h,x,L,k,A,P,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,f,g,s,a,u,c);return{signers:m,instructions:[O],instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:k,tickArrayUpper:A,positionNftAccount:h,metadataAccount:x,personalPosition:P,protocolPosition:L}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[p,d]=[new T(e.programId),new T(e.id)],b;if(l)b=new T((await l(1))[0]);else{let q=Wn.generate();m.push(q),b=q.publicKey}let f=B.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=B.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=Y(p,d,f),{publicKey:A}=Y(p,d,g),{publicKey:h}=qe(n.wallet,b,be),{publicKey:x}=zt(b),{publicKey:P}=Oe(p,b),{publicKey:L}=ct(p,d,r,o),O=this.openPositionFromBaseInstruction(p,n.feePayer,d,n.wallet,b,h,x,L,k,A,P,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,f,g,c,s,a,u,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?Ce(p,d).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:k,tickArrayUpper:A,positionNftAccount:h,metadataAccount:x,personalPosition:P,protocolPosition:L},instructions:[O],signers:m,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,A,h,x,P,L,O,q,J,X){let Q=F([fe("tickLowerIndex"),fe("tickUpperIndex"),fe("tickArrayLowerStartIndex"),fe("tickArrayUpperStartIndex"),M("liquidity"),y("amountMaxA"),y("amountMaxB"),Ge("withMetadata"),V("optionBaseFlag"),Ge("baseFlag")]),Le=[...X?[{pubkey:X,isSigner:!1,isWritable:!0}]:[]],me=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:Vi,isSigner:!1,isWritable:!1},{pubkey:gt,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...Le],Ae=Buffer.alloc(Q.span);Q.encode({tickLowerIndex:A,tickUpperIndex:h,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:P,liquidity:new Gi(0),amountMaxA:O==="MintA"?q:J,amountMaxB:O==="MintA"?J:q,withMetadata:L==="create",baseFlag:O==="MintA",optionBaseFlag:1},Ae);let ee=Buffer.from([...ve.openPosition,...Ae]);return new We({keys:me,programId:e,data:ee})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,p=[];if(l)m=new T((await l(1))[0]);else{let q=Wn.generate();p.push(q),m=q.publicKey}let[d,b]=[new T(e.programId),new T(e.id)],f=B.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=B.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=Y(d,b,f),{publicKey:A}=Y(d,b,g),{publicKey:h}=qe(n.wallet,m,be),{publicKey:x}=zt(m),{publicKey:P}=Oe(d,m),{publicKey:L}=ct(d,b,r,o),O=this.openPositionFromLiquidityInstruction(d,n.wallet,b,n.wallet,m,h,x,L,k,A,P,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),r,o,f,g,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,g])?Ce(d,b).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:k,tickArrayUpper:A,positionNftAccount:h,metadataAccount:x,personalPosition:P,protocolPosition:L},instructions:[O],signers:p,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=F([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...ve.closePosition,...u]);return new We({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new T(e.programId),{publicKey:s}=qe(n.wallet,r.nftMint,be),{publicKey:a}=Oe(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[ne.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,A){let h=F([M("liquidity"),y("amountMaxA"),y("amountMaxB"),V("optionBaseFlag"),Ge("baseFlag")]),x=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],L=Buffer.alloc(h.span);h.encode({liquidity:f,amountMaxA:g,amountMaxB:k,optionBaseFlag:0,baseFlag:!1},L);let O=Buffer.from([...ve.increaseLiquidity,...L]);return new We({keys:P,programId:e,data:O})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=B.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=B.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(u,c,l),{publicKey:d}=Y(u,c,m),{publicKey:b}=qe(r.wallet,n.nftMint,be),{publicKey:f}=Oe(u,n.nftMint),{publicKey:g}=ct(u,c,n.tickLower,n.tickUpper),k=this.increasePositionFromLiquidityInstruction(u,r.wallet,b,f,c,g,p,d,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ce(u,c).publicKey:void 0);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:b,personalPosition:f,protocolPosition:g},signers:[],instructions:[k],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=B.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=B.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(u,c,l),{publicKey:d}=Y(u,c,m),{publicKey:b}=qe(r.wallet,n.nftMint,be),{publicKey:f}=Oe(u,n.nftMint),{publicKey:g}=ct(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:p,tickArrayUpper:d,positionNftAccount:b,personalPosition:f,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,b,f,c,g,p,d,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ce(u,c).publicKey:void 0)],signers:[],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,A){let h=F([M("liquidity"),y("amountMaxA"),y("amountMaxB"),V("optionBaseFlag"),Ge("baseFlag")]),x=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],L=Buffer.alloc(h.span);h.encode({liquidity:new Gi(0),amountMaxA:f==="MintA"?g:k,amountMaxB:f==="MintA"?k:g,baseFlag:f==="MintA",optionBaseFlag:1},L);let O=Buffer.from([...ve.increaseLiquidity,...L]);return new We({keys:P,programId:e,data:O})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k,A,h){let x=F([M("liquidity"),y("amountMinA"),y("amountMinB")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...f.map(J=>[{pubkey:J.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:J.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:J.rewardMint,isSigner:!1,isWritable:!1}]).flat()],L=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],O=Buffer.alloc(x.span);x.encode({liquidity:g,amountMinA:k,amountMinB:A},O);let q=Buffer.from([...ve.decreaseLiquidity,...O]);return new We({keys:L,programId:e,data:q})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new T(e.programId),new T(e.id)],m=B.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=B.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Y(c,l,m),{publicKey:b}=Y(c,l,p),{publicKey:f}=qe(r.wallet,n.nftMint,u),{publicKey:g}=Oe(c,n.nftMint),{publicKey:k}=ct(c,l,n.tickLower,n.tickUpper),A=[];for(let x=0;x<e.rewardDefaultInfos.length;x++)A.push({poolRewardVault:new T(t.rewardInfos[x].vault),ownerRewardVault:r.rewardAccounts[x],rewardMint:new T(e.rewardDefaultInfos[x].mint.address)});let h=[];return h.push(this.decreaseLiquidityInstruction(c,r.wallet,f,g,l,k,d,b,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),A,o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Ce(c,l).publicKey:void 0)),{address:{tickArrayLower:d,tickArrayUpper:b,positionNftAccount:f,personalPosition:g,protocolPosition:k},signers:[],instructions:h,instructionTypes:[ne.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,b,f,g,k){let A=F([y("amount"),y("otherAmountThreshold"),M("sqrtPriceLimitX64"),Ge("isBaseInput")]),h=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...m.map(O=>({pubkey:O,isSigner:!1,isWritable:!0}))],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...h],P=Buffer.alloc(A.span);A.encode({amount:d,otherAmountThreshold:b,sqrtPriceLimitX64:f,isBaseInput:g},P);let L=Buffer.from([...ve.swap,...P]);return new We({keys:x,programId:e,data:L})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,p]=[new T(t.vault.A),new T(t.vault.B)],[d,b]=[new T(e.mintA.address),new T(e.mintB.address)],f=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),f?n.tokenAccountA:n.tokenAccountB,f?n.tokenAccountB:n.tokenAccountA,f?m:p,f?p:m,f?d:b,f?b:d,u,m,o,s,a,!0,Ce(c,l).publicKey)];return{signers:[],instructions:g,instructionTypes:[ne.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=F([y("openTime"),y("endTime"),M("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:te(l),endTime:te(m),emissionsPerSecondX64:p},f);let g=Buffer.from([...ve.initReward,...f]);return new We({keys:b,programId:e,data:g})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a=Si(o,s,r.mint).publicKey,u=Yt(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new T(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[ne.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=F([V("rewardIndex"),M("emissionsPerSecondX64"),y("openTime"),y("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:p,openTime:te(l),endTime:te(m)},f);let g=Buffer.from([...ve.setRewardEmissions,...f]);return new We({keys:b,programId:e,data:g})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u,c;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===r.mint.toString()&&(a=p,u=new T(t.rewardInfos[p].vault),c=new T(t.rewardInfos[p].mint.address));(a===void 0||u===void 0)&&Ui.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Yt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new T(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ne.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=F([V("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:ot,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...ve.collectReward,...l]);return new We({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new T(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Ui.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ne.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new T(e.programId),new T(e.id)],[m,p]=[new T(t.vault.A),new T(t.vault.B)],[d,b]=[new T(e.mintA.address),new T(e.mintB.address)],f=e.mintA.address===r.toString(),g=[this.swapInstruction(c,n.wallet,l,new T(e.config.id),f?n.tokenAccountB:n.tokenAccountA,f?n.tokenAccountA:n.tokenAccountB,f?p:m,f?m:p,f?d:b,f?b:d,u,m,o,s,a,!1)];return{signers:[],instructions:g,instructionTypes:[ne.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}};import Pp from"bn.js";import{TOKEN_PROGRAM_ID as rs,ASSOCIATED_TOKEN_PROGRAM_ID as tf}from"@solana/spl-token";import{PublicKey as rf,TransactionInstruction as Hi,SystemProgram as os,SYSVAR_RENT_PUBKEY as of}from"@solana/web3.js";var vn=F([V("instruction"),y("amountIn"),y("minAmountOut")]),Dn=F([V("instruction"),y("maxAmountIn"),y("amountOut")]),Up=F([V("instruction"),V("nonce")]),Jo=F([V("instruction"),V("nonce"),y("startTime")]),Xp=F([y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalValue"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),M("swapBaseInAmount"),M("swapQuoteOutAmount"),y("swapBase2QuoteFee"),M("swapQuoteInAmount"),M("swapBaseOutAmount"),y("swapQuote2BaseFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("withdrawQueue"),R("lpVault"),R("owner"),y("lpReserve"),j(y(),3,"padding")]),Hp=F([y("accountType"),y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalsValue"),y("abortTradeFactor"),y("priceTickMultiplier"),y("priceTick"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),M("swapBaseInAmount"),M("swapQuoteOutAmount"),M("swapQuoteInAmount"),M("swapBaseOutAmount"),y("swapQuote2BaseFee"),y("swapBase2QuoteFee"),R("baseVault"),R("quoteVault"),R("baseMint"),R("quoteMint"),R("lpMint"),R("modelDataAccount"),R("openOrders"),R("marketId"),R("marketProgramId"),R("targetOrders"),R("owner"),j(y(),64,"padding")]),$o=F([V("instruction"),y("baseAmountIn"),y("quoteAmountIn"),y("fixedSide")]),es=F([V("instruction"),y("amountIn")]);var zp=F([y("fee")]);import{PublicKey as ts}from"@solana/web3.js";var _n=new ts("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ns=5e4,is=F([y("x"),y("y"),y("price")]),Jp=F([y("accountType"),y("status"),y("multiplier"),y("validDataCount"),j(is,ns,"DataElement")]);var Xi=re("Raydium_liquidity_instruction");function ss({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=ge(i),s=Buffer.alloc(vn.span);vn.encode({instruction:9,amountIn:te(t),minAmountOut:te(n)},s);let a=[D({pubkey:rs,isWritable:!1}),D({pubkey:o.id}),D({pubkey:o.authority,isWritable:!1}),D({pubkey:o.openOrders})];return r===4&&a.push(D({pubkey:o.targetOrders})),a.push(D({pubkey:o.vault.A}),D({pubkey:o.vault.B})),r===5&&a.push(D({pubkey:_n})),a.push(D({pubkey:o.marketProgramId,isWritable:!1}),D({pubkey:o.marketId}),D({pubkey:o.marketBids}),D({pubkey:o.marketAsks}),D({pubkey:o.marketEventQueue}),D({pubkey:o.marketBaseVault}),D({pubkey:o.marketQuoteVault}),D({pubkey:o.marketAuthority,isWritable:!1}),D({pubkey:e.tokenAccountIn}),D({pubkey:e.tokenAccountOut}),D({pubkey:e.owner,isWritable:!1})),new Hi({programId:o.programId,keys:a,data:s})}function as({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=ge(i),s=Buffer.alloc(Dn.span);Dn.encode({instruction:11,maxAmountIn:te(t),amountOut:te(n)},s);let a=[D({pubkey:os.programId,isWritable:!1}),D({pubkey:o.id}),D({pubkey:o.authority,isWritable:!1}),D({pubkey:o.openOrders}),D({pubkey:o.targetOrders}),D({pubkey:o.vault.A}),D({pubkey:o.vault.B})];return r===5&&a.push(D({pubkey:_n})),a.push(D({pubkey:o.marketProgramId,isWritable:!1}),D({pubkey:o.marketId}),D({pubkey:o.marketBids}),D({pubkey:o.marketAsks}),D({pubkey:o.marketEventQueue}),D({pubkey:o.marketBaseVault}),D({pubkey:o.marketQuoteVault}),D({pubkey:o.marketAuthority,isWritable:!1}),D({pubkey:e.tokenAccountIn}),D({pubkey:e.tokenAccountOut}),D({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Hi({programId:o.programId,keys:a,data:s})}function zi(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return ss({...a,amountIn:r,minAmountOut:o},t);if(s==="out")return as({...a,maxAmountIn:r,amountOut:o},t);Xi.logWithError("invalid params","params",i)}throw Xi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}function Tf(i,e,t,n,r,o,s,a,u,c,l,m){let p=F([V("instruction"),y("amountIn"),y("amountOut")]),d=[{pubkey:Qi.programId,isSigner:!1,isWritable:!1},{pubkey:Gn,isSigner:!1,isWritable:!1},{pubkey:new Ne(t.programId),isSigner:!1,isWritable:!1},{pubkey:new Ne(t.id),isSigner:!1,isWritable:!0},{pubkey:new Ne(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=ge(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=ge(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new Ne("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=ge(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let b=Buffer.alloc(p.span);return p.encode({instruction:4,amountIn:c,amountOut:l},b),new Un({keys:d,programId:i,data:b})}function xf(i,e,t,n,r,o,s,a,u,c){let l=F([V("instruction")]),m=[{pubkey:Qi.programId,isSigner:!1,isWritable:!1},{pubkey:Gn,isSigner:!1,isWritable:!1},{pubkey:new Ne(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new Ne(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new Ne(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=ge(n);m.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=ge(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new Ne("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=ge(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let p=Buffer.alloc(l.span);return l.encode({instruction:5},p),new Un({keys:m,programId:i,data:p})}function Yi(i,e,t,n,r,o){if(i.pooltype.includes("StablePool")){let s=ge(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:new Ne("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]}else if(i.type==="Concentrated"){let s=i,a=ge(e),u=s.mintA.address===t;return[{pubkey:new Ne(String(i.programId)),isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a.config.id,isSigner:!1,isWritable:!1},{pubkey:a.id,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.A:a.vault.B,isSigner:!1,isWritable:!0},{pubkey:u?a.vault.B:a.vault.A,isSigner:!1,isWritable:!0},{pubkey:a.id,isSigner:!1,isWritable:!0},...a.mintA.programId.equals(qn)||a.mintB.programId.equals(qn)?[{pubkey:qn,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:u?a.mintA.address:a.mintB.address,isSigner:!1,isWritable:!1},{pubkey:u?a.mintB.address:a.mintA.address,isSigner:!1,isWritable:!1}]:[],...(o!=null?o:[]).map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Ce(new Ne(String(i.programId)),new Ne(i.id)).publicKey,isSigner:!1,isWritable:!0}]}else{let s=ge(e);return[{pubkey:s.programId,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.authority,isSigner:!1,isWritable:!1},{pubkey:s.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:s.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:s.openOrders,isSigner:!1,isWritable:!0},{pubkey:s.vault.A,isSigner:!1,isWritable:!0},{pubkey:s.vault.B,isSigner:!1,isWritable:!0},{pubkey:s.marketId,isSigner:!1,isWritable:!0},{pubkey:s.marketBids,isSigner:!1,isWritable:!0},{pubkey:s.marketAsks,isSigner:!1,isWritable:!0},{pubkey:s.marketEventQueue,isSigner:!1,isWritable:!0},...s.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:s.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:s.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:s.id,isSigner:!1,isWritable:!0},{pubkey:s.id,isSigner:!1,isWritable:!0}]]}}function us(i,e,t,n,r,o,s,a,u,c,l,m,p,d){let b=F([V("instruction"),y("amountIn"),y("amountOut")]),f=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:Gn,isSigner:!1,isWritable:!1}];f.push(...Yi(a,c,o,t,n,d[0])),f.push(...Yi(u,l,s,n,r,d[1]));let g=Buffer.alloc(b.span);return b.encode({instruction:8,amountIn:m,amountOut:p},g),new Un({keys:f,programId:i,data:g})}async function Bf({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c;if(n.routeType==="amm")if(n.poolInfo[0].type==="Concentrated"){let l=ge(n.poolKey[0]),m=t.equals(l.mintA.address)?ze.add(xe):Ye.sub(xe);return await Rt.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,ownerInfo:{wallet:e.wallet,tokenAccountA:l.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:l.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Vn(0)),sqrtPriceLimitX64:m,remainingAccounts:n.remainingAccounts[0]})}else{let l=n.poolKey[0];return{signers:[],instructions:[zi({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((a=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?a:new Vn(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ne.AmmV5SwapBaseIn:ne.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],m=n.poolInfo[1],p=n.poolKey[0],d=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[us(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.minMiddleAmountFee.token.mint.toString(),l,m,p,d,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((c=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?c:new Vn(0)),n.remainingAccounts)],instructionTypes:[ne.RouteSwap],lookupTableAddress:[p.lookupTableAccount,d.lookupTableAccount].filter(b=>b!==void 0),address:{}}}else throw Error("route type error")}export{Bf as makeSwapInstruction,Tf as route1Instruction,xf as route2Instruction,us as routeInstruction};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=instrument.mjs.map