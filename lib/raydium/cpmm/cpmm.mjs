import{PublicKey as x}from"@solana/web3.js";import{NATIVE_MINT as nt,TOKEN_PROGRAM_ID as re,AccountLayout as Mn}from"@solana/spl-token";import Wr from"big.js";import as from"bn.js";import Y from"bn.js";var ye=9e15,me=1e9,rt="0123456789abcdef",Ve="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",qe="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",it={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ye,maxE:ye,crypto:!1},Mt,oe,k=!0,Ge="[DecimalError] ",fe=Ge+"Invalid argument: ",Kt=Ge+"Precision limit exceeded",Et=Ge+"crypto unavailable",Dt="[object Decimal]",G=Math.floor,V=Math.pow,Kn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,En=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Dn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Rt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,$=1e7,B=7,Rn=9007199254740991,vn=Ve.length-1,ot=qe.length-1,h={toStringTag:Dt};h.absoluteValue=h.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),A(e)};h.ceil=function(){return A(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(fe+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};h.comparedTo=h.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,c=o.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==e.e)return o.e>e.e^c<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};h.cosine=h.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+B,r.rounding=1,n=_n(r,Wt(r,n)),r.precision=e,r.rounding=t,A(oe==2||oe==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};h.cubeRoot=h.cbrt=function(){var e,t,n,r,i,o,s,a,c,u,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(k=!1,o=l.s*V(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=q(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=V(n,1/3),e=G((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=D(u.plus(l).times(a),u.plus(c),s+2,1),q(a.d).slice(0,s)===(n=q(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(A(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(A(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return k=!0,A(r,e,f.rounding,t)};h.decimalPlaces=h.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-G(this.e/B))*B,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};h.dividedBy=h.div=function(e){return D(this,new this.constructor(e))};h.dividedToIntegerBy=h.divToInt=function(e){var t=this,n=t.constructor;return A(D(t,new n(e),0,1,1),n.precision,n.rounding)};h.equals=h.eq=function(e){return this.cmp(e)===0};h.floor=function(){return A(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(e){return this.cmp(e)>0};h.greaterThanOrEqualTo=h.gte=function(e){var t=this.cmp(e);return t==1||t===0};h.hyperbolicCosine=h.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/je(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=we(s,1,o.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return A(o,s.precision=n,s.rounding=r,!0)};h.hyperbolicSine=h.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=we(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/je(5,e)),i=we(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=t,o.rounding=n,A(i,t,n,!0)};h.hyperbolicTangent=h.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,D(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};h.inverseCosine=h.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?Q(n,i,o):new n(0):new n(NaN):t.isZero()?Q(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=Q(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};h.inverseHyperbolicCosine=h.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,k=!1,n=n.times(n).minus(1).sqrt().plus(n),k=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};h.inverseHyperbolicSine=h.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,k=!1,n=n.times(n).plus(1).sqrt().plus(n),k=!0,r.precision=e,r.rounding=t,n.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?A(new o(i),e,t,!0):(o.precision=n=r-i.e,i=D(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=Q(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};h.inverseTangent=h.atan=function(){var e,t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&f+4<=ot)return s=Q(l,f+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(f+4<=ot)return s=Q(l,f+4,m).times(.5),s.s=u.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/B+2|0),e=n;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(k=!1,t=Math.ceil(a/B),r=1,c=u.times(u),s=new l(u),i=u;e!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),k=!0,A(s,l.precision=f,l.rounding=m,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&G(this.e/B)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(e){return this.cmp(e)<0};h.lessThanOrEqualTo=h.lte=function(e){return this.cmp(e)<1};h.logarithm=h.log=function(e){var t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding,d=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(k=!1,a=f+d,s=le(u,a),r=t?Ue(l,a+10):le(e,a),c=D(s,r,a,1),Be(c.d,i=f,m))do if(a+=10,s=le(u,a),r=t?Ue(l,a+10):le(e,a),c=D(s,r,a,1),!o){+q(c.d).slice(i+1,i+15)+1==1e14&&(c=A(c,f+1,0));break}while(Be(c.d,i+=10,m));return k=!0,A(c,f,m)};h.minus=h.sub=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,d=this,P=d.constructor;if(e=new P(e),!d.d||!e.d)return!d.s||!e.s?e=new P(NaN):d.d?e.s=-e.s:e=new P(e.d||d.s!==e.s?d:NaN),e;if(d.s!=e.s)return e.s=-e.s,d.plus(e);if(u=d.d,m=e.d,a=P.precision,c=P.rounding,!u[0]||!m[0]){if(m[0])e.s=-e.s;else if(u[0])e=new P(d);else return new P(c===3?-0:0);return k?A(e,a,c):e}if(n=G(e.e/B),l=G(d.e/B),u=u.slice(),o=l-n,o){for(f=o<0,f?(t=u,o=-o,s=m.length):(t=m,n=l,s=u.length),r=Math.max(Math.ceil(a/B),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=u.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(u[r]!=m[r]){f=u[r]<m[r];break}o=0}for(f&&(t=u,u=m,m=t,e.s=-e.s),s=u.length,r=m.length-s;r>0;--r)u[s++]=0;for(r=m.length;r>o;){if(u[--r]<m[r]){for(i=r;i&&u[--i]===0;)u[i]=$-1;--u[i],u[r]+=$}u[r]-=m[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(e.d=u,e.e=He(u,n),k?A(e,a,c):e):new P(c===3?-0:0)};h.modulo=h.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?A(new r(n),r.precision,r.rounding):(k=!1,r.modulo==9?(t=D(n,e.abs(),0,3,1),t.s*=e.s):t=D(n,e,0,r.modulo,1),t=t.times(e),k=!0,n.minus(t))};h.naturalExponential=h.exp=function(){return st(this)};h.naturalLogarithm=h.ln=function(){return le(this)};h.negated=h.neg=function(){var e=new this.constructor(this);return e.s=-e.s,A(e)};h.plus=h.add=function(e){var t,n,r,i,o,s,a,c,u,l,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(u=f.d,l=e.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(e=new m(f)),k?A(e,a,c):e;if(o=G(f.e/B),r=G(e.e/B),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/B),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),t=0;i;)t=(u[--i]=u[i]+l[i]+t)/$|0,u[i]%=$;for(t&&(u.unshift(t),++r),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=He(u,r),k?A(e,a,c):e};h.precision=h.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(fe+e);return n.d?(t=vt(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};h.round=function(){var e=this,t=e.constructor;return A(new t(e),e.e+1,t.rounding)};h.sine=h.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+B,r.rounding=1,n=Fn(r,Wt(r,n)),r.precision=e,r.rounding=t,A(oe>2?n.neg():n,e,t,!0)):new r(NaN)};h.squareRoot=h.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(k=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=q(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=G((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),r=new l(t)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(D(s,o,n+2,1)).times(.5),q(o.d).slice(0,n)===(t=q(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(A(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(A(r,c+1,1),e=!r.times(r).eq(s));break}return k=!0,A(r,c,l.rounding,e)};h.tangent=h.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=D(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,A(oe==2||oe==4?n.neg():n,e,t,!0)):new r(NaN)};h.times=h.mul=function(e){var t,n,r,i,o,s,a,c,u,l=this,f=l.constructor,m=l.d,d=(e=new f(e)).d;if(e.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!e.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?e.s/0:e.s*0);for(n=G(l.e/B)+G(e.e/B),c=m.length,u=d.length,c<u&&(o=m,m=d,d=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,i=c+r;i>r;)a=o[i]+d[r]*m[i-r-1]+t,o[i--]=a%$|0,t=a/$|0;o[i]=(o[i]+t)%$|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=He(o,n),k?A(e,f.precision,f.rounding):e};h.toBinary=function(e,t){return ut(this,2,e,t)};h.toDecimalPlaces=h.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(z(e,0,me),t===void 0?t=r.rounding:z(t,0,8),A(n,e+n.e+1,t))};h.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=ne(r,!0):(z(e,0,me),t===void 0?t=i.rounding:z(t,0,8),r=A(new i(r),e+1,t),n=ne(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};h.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=ne(i):(z(e,0,me),t===void 0?t=o.rounding:z(t,0,8),r=A(new o(i),e+i.e+1,t),n=ne(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};h.toFraction=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,d=this,P=d.d,p=d.constructor;if(!P)return new p(d);if(u=n=new p(1),r=c=new p(0),t=new p(r),o=t.e=vt(P)-d.e-1,s=o%B,t.d[0]=V(10,s<0?B+s:s),e==null)e=o>0?t:u;else{if(a=new p(e),!a.isInt()||a.lt(u))throw Error(fe+a);e=a.gt(t)?o>0?t:u:a}for(k=!1,a=new p(q(P)),l=p.precision,p.precision=o=P.length*B*2;f=D(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=u,u=c.plus(f.times(i)),c=i,i=t,t=a.minus(f.times(i)),a=i;return i=D(e.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=d.s,m=D(u,r,o,1).minus(d).abs().cmp(D(c,n,o,1).minus(d).abs())<1?[u,r]:[c,n],p.precision=l,k=!0,m};h.toHexadecimal=h.toHex=function(e,t){return ut(this,16,e,t)};h.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:z(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(k=!1,n=D(n,e,0,t,1).times(e),k=!0,A(n)):(e.s=n.s,n=e),n};h.toNumber=function(){return+this};h.toOctal=function(e,t){return ut(this,8,e,t)};h.toPower=h.pow=function(e){var t,n,r,i,o,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(V(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,e.eq(1))return A(a,r,o);if(t=G(e.e/B),t>=e.d.length-1&&(n=u<0?-u:u)<=Rn)return i=_t(c,a,n,r),e.s<0?new c(1).div(i):A(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=V(+a,u),t=n==0||!isFinite(n)?G(u*(Math.log("0."+q(a.d))/Math.LN10+a.e+1)):new c(n+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(k=!1,c.rounding=a.s=1,n=Math.min(12,(t+"").length),i=st(e.times(le(a,r+n)),r),i.d&&(i=A(i,r+5,1),Be(i.d,r,o)&&(t=r+10,i=A(st(e.times(le(a,t+n)),t),t+5,1),+q(i.d).slice(r+1,r+15)+1==1e14&&(i=A(i,r+1,0)))),i.s=s,k=!0,c.rounding=o,A(i,r,o))};h.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=ne(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(z(e,1,me),t===void 0?t=i.rounding:z(t,0,8),r=A(new i(r),e,t),n=ne(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};h.toSignificantDigits=h.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(z(e,1,me),t===void 0?t=r.rounding:z(t,0,8)),A(new r(n),e,t)};h.toString=function(){var e=this,t=e.constructor,n=ne(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};h.truncated=h.trunc=function(){return A(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var e=this,t=e.constructor,n=ne(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function q(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=B-r.length,n&&(o+=ce(n)),o+=r;s=e[t],r=s+"",n=B-r.length,n&&(o+=ce(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function z(e,t,n){if(e!==~~e||e<t||e>n)throw Error(fe+e)}function Be(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=B,i=0):(i=Math.ceil((t+1)/B),t%=B),o=V(10,B-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==V(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==V(10,t-3)-1,s}function We(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=rt.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function _n(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/je(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=we(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var D=function(){function e(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,f,m,d,P,p,y,g,b,w,T,C,S,L,K,I,F,E,Z,J=r.constructor,ie=r.s==i.s?1:-1,U=r.d,v=i.d;if(!U||!U[0]||!v||!v[0])return new J(!r.s||!i.s||(U?v&&U[0]==v[0]:!v)?NaN:U&&U[0]==0||!v?ie*0:ie/0);for(c?(d=1,l=r.e-i.e):(c=$,d=B,l=G(r.e/d)-G(i.e/d)),E=v.length,I=U.length,g=new J(ie),b=g.d=[],f=0;v[f]==(U[f]||0);f++);if(v[f]>(U[f]||0)&&l--,o==null?(S=o=J.precision,s=J.rounding):a?S=o+(r.e-i.e)+1:S=o,S<0)b.push(1),P=!0;else{if(S=S/d+2|0,f=0,E==1){for(m=0,v=v[0],S++;(f<I||m)&&S--;f++)L=m*c+(U[f]||0),b[f]=L/v|0,m=L%v|0;P=m||f<I}else{for(m=c/(v[0]+1)|0,m>1&&(v=e(v,m,c),U=e(U,m,c),E=v.length,I=U.length),K=E,w=U.slice(0,E),T=w.length;T<E;)w[T++]=0;Z=v.slice(),Z.unshift(0),F=v[0],v[1]>=c/2&&++F;do m=0,u=t(v,w,E,T),u<0?(C=w[0],E!=T&&(C=C*c+(w[1]||0)),m=C/F|0,m>1?(m>=c&&(m=c-1),p=e(v,m,c),y=p.length,T=w.length,u=t(p,w,y,T),u==1&&(m--,n(p,E<y?Z:v,y,c))):(m==0&&(u=m=1),p=v.slice()),y=p.length,y<T&&p.unshift(0),n(w,p,T,c),u==-1&&(T=w.length,u=t(v,w,E,T),u<1&&(m++,n(w,E<T?Z:v,T,c))),T=w.length):u===0&&(m++,w=[0]),b[f++]=m,u&&w[0]?w[T++]=U[K]||0:(w=[U[K]],T=1);while((K++<I||w[0]!==void 0)&&S--);P=w[0]!==void 0}b[0]||b.shift()}if(d==1)g.e=l,Mt=P;else{for(f=1,m=b[0];m>=10;m/=10)f++;g.e=f+l*d-1,A(g,a?o+g.e+1:o,s,P)}return g}}();function A(e,t,n,r){var i,o,s,a,c,u,l,f,m,d=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=B,s=t,l=f[m=0],c=l/V(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/B),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=c=0,i=1,o%=B,s=o-B+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=B,s=o-B+i,c=s<0?0:l/V(10,i-s-1)%10|0}if(r=r||t<0||f[m+1]!==void 0||(s<0?l:l%V(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(e.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/V(10,i-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,u?(t-=e.e+1,f[0]=V(10,(B-t%B)%B),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=V(10,B-o),f[m]=s>0?(l/V(10,i-s)%V(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==$&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=$)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return k&&(e.e>d.maxE?(e.d=null,e.e=NaN):e.e<d.minE&&(e.e=0,e.d=[0])),e}function ne(e,t,n){if(!e.isFinite())return Ft(e);var r,i=e.e,o=q(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+ce(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+ce(-i-1)+o,n&&(r=n-s)>0&&(o+=ce(r))):i>=s?(o+=ce(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+ce(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=ce(r))),o}function He(e,t){var n=e[0];for(t*=B;n>=10;n/=10)t++;return t}function Ue(e,t,n){if(t>vn)throw k=!0,n&&(e.precision=n),Error(Kt);return A(new e(Ve),t,1,!0)}function Q(e,t,n){if(t>ot)throw Error(Kt);return A(new e(qe),t,n,!0)}function vt(e){var t=e.length-1,n=t*B+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function ce(e){for(var t="";e--;)t+="0";return t}function _t(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/B+4);for(k=!1;;){if(n%2&&(o=o.times(t),Lt(o.d,s)&&(i=!0)),n=G(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),Lt(t.d,s)}return k=!0,o}function It(e){return e.d[e.d.length-1]&1}function Ot(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function st(e,t){var n,r,i,o,s,a,c,u=0,l=0,f=0,m=e.constructor,d=m.rounding,P=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(k=!1,c=P):c=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(V(2,f))/Math.LN10*2+5|0,c+=r,n=o=s=new m(1),m.precision=c;;){if(o=A(o.times(e),c,1),n=n.times(++l),a=s.plus(D(o,n,c,1)),q(a.d).slice(0,c)===q(s.d).slice(0,c)){for(i=f;i--;)s=A(s.times(s),c,1);if(t==null)if(u<3&&Be(s.d,c-r,d,u))m.precision=c+=10,n=o=a=new m(1),l=0,u++;else return A(s,m.precision=P,d,k=!0);else return m.precision=P,s}s=a}}function le(e,t){var n,r,i,o,s,a,c,u,l,f,m,d=1,P=10,p=e,y=p.d,g=p.constructor,b=g.rounding,w=g.precision;if(p.s<0||!y||!y[0]||!p.e&&y[0]==1&&y.length==1)return new g(y&&!y[0]?-1/0:p.s!=1?NaN:y?0:p);if(t==null?(k=!1,l=w):l=t,g.precision=l+=P,n=q(y),r=n.charAt(0),Math.abs(o=p.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)p=p.times(e),n=q(p.d),r=n.charAt(0),d++;o=p.e,r>1?(p=new g("0."+n),o++):p=new g(r+"."+n.slice(1))}else return u=Ue(g,l+2,w).times(o+""),p=le(new g(r+"."+n.slice(1)),l-P).plus(u),g.precision=w,t==null?A(p,w,b,k=!0):p;for(f=p,c=s=p=D(p.minus(1),p.plus(1),l,1),m=A(p.times(p),l,1),i=3;;){if(s=A(s.times(m),l,1),u=c.plus(D(s,new g(i),l,1)),q(u.d).slice(0,l)===q(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Ue(g,l+2,w).times(o+""))),c=D(c,new g(d),l,1),t==null)if(Be(c.d,l-P,b,a))g.precision=l+=P,u=s=p=D(f.minus(1),f.plus(1),l,1),m=A(p.times(p),l,1),i=a=1;else return A(c,g.precision=w,b,k=!0);else return g.precision=w,c;c=u,i+=2}}function Ft(e){return String(e.s*e.s/0)}function at(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%B,n<0&&(r+=B),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=B;r<i;)e.d.push(+t.slice(r,r+=B));t=t.slice(r),r=B-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),k&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function On(e,t){var n,r,i,o,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Rt.test(t))return at(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(En.test(t))n=16,t=t.toLowerCase();else if(Kn.test(t))n=2;else if(Dn.test(t))n=8;else throw Error(fe+t);for(o=t.search(/p/i),o>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=_t(r,new r(n),o,o*2)),u=We(t,n,$),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(e.s*0):(e.e=He(u,l),e.d=u,k=!1,s&&(e=D(e,i,a*4)),c&&(e=e.times(Math.abs(c)<54?V(2,c):ke.pow(2,c))),k=!0,e)}function Fn(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:we(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/je(5,n)),t=we(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function we(e,t,n,r,i){var o,s,a,c,u=1,l=e.precision,f=Math.ceil(l/B);for(k=!1,c=n.times(n),a=new e(r);;){if(s=D(a.times(c),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=D(s.times(c),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return k=!0,s.d.length=f+1,s}function je(e,t){for(var n=e;--t;)n*=e;return n}function Wt(e,t){var n,r=t.s<0,i=Q(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return oe=r?4:1,t;if(n=t.divToInt(i),n.isZero())oe=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return oe=It(n)?r?2:3:r?4:1,t;oe=It(n)?r?1:4:r?3:2}return t.minus(i).abs()}function ut(e,t,n,r){var i,o,s,a,c,u,l,f,m,d=e.constructor,P=n!==void 0;if(P?(z(n,1,me),r===void 0?r=d.rounding:z(r,0,8)):(n=d.precision,r=d.rounding),!e.isFinite())l=Ft(e);else{for(l=ne(e),s=l.indexOf("."),P?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=We(ne(m),10,i),m.e=m.d.length),f=We(l,10,i),o=c=f.length;f[--c]==0;)f.pop();if(!f[0])l=P?"0p+0":"0";else{if(s<0?o--:(e=new d(e),e.d=f,e.e=o,e=D(e,m,n,r,0,i),f=e.d,o=e.e,u=Mt),s=f[n],a=i/2,u=u||f[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,u)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(c=f.length;!f[c-1];--c);for(s=0,l="";s<c;s++)l+=rt.charAt(f[s]);if(P){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(f=We(l,i,t),c=f.length;!f[c-1];--c);for(s=1,l="1.";s<c;s++)l+=rt.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Lt(e,t){if(e.length>t)return e.length=t,!0}function Wn(e){return new this(e).abs()}function Vn(e){return new this(e).acos()}function qn(e){return new this(e).acosh()}function Un(e,t){return new this(e).plus(t)}function Gn(e){return new this(e).asin()}function Hn(e){return new this(e).asinh()}function jn(e){return new this(e).atan()}function Zn(e){return new this(e).atanh()}function zn(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Q(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Q(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Q(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(D(e,t,o,1)),t=Q(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(D(e,t,o,1)),n}function Yn(e){return new this(e).cbrt()}function Xn(e){return A(e=new this(e),e.e+1,2)}function Jn(e,t,n){return new this(e).clamp(t,n)}function Qn(e){if(!e||typeof e!="object")throw Error(Ge+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,me,"rounding",0,8,"toExpNeg",-ye,0,"toExpPos",0,ye,"maxE",0,ye,"minE",-ye,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=it[n]),(r=e[n])!==void 0)if(G(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(fe+n+": "+r);if(n="crypto",i&&(this[n]=it[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Et);else this[n]=!1;else throw Error(fe+n+": "+r);return this}function $n(e){return new this(e).cos()}function er(e){return new this(e).cosh()}function Vt(e){var t,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Nt(o)){u.s=o.s,k?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;k?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return at(u,o.toString())}else if(c!=="string")throw Error(fe+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Rt.test(o)?at(u,o):On(u,o)}if(i.prototype=h,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Qn,i.clone=Vt,i.isDecimal=Nt,i.abs=Wn,i.acos=Vn,i.acosh=qn,i.add=Un,i.asin=Gn,i.asinh=Hn,i.atan=jn,i.atanh=Zn,i.atan2=zn,i.cbrt=Yn,i.ceil=Xn,i.clamp=Jn,i.cos=$n,i.cosh=er,i.div=tr,i.exp=nr,i.floor=rr,i.hypot=ir,i.ln=or,i.log=sr,i.log10=ur,i.log2=ar,i.max=cr,i.min=lr,i.mod=fr,i.mul=mr,i.pow=pr,i.random=dr,i.round=gr,i.sign=hr,i.sin=br,i.sinh=yr,i.sqrt=wr,i.sub=Pr,i.sum=Tr,i.tan=xr,i.tanh=Ar,i.trunc=Br,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function tr(e,t){return new this(e).div(t)}function nr(e){return new this(e).exp()}function rr(e){return A(e=new this(e),e.e+1,3)}function ir(){var e,t,n=new this(0);for(k=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return k=!0,new this(1/0);n=t}return k=!0,n.sqrt()}function Nt(e){return e instanceof ke||e&&e.toStringTag===Dt||!1}function or(e){return new this(e).ln()}function sr(e,t){return new this(e).log(t)}function ar(e){return new this(e).log(2)}function ur(e){return new this(e).log(10)}function cr(){return Ot(this,arguments,"lt")}function lr(){return Ot(this,arguments,"gt")}function fr(e,t){return new this(e).mod(t)}function mr(e,t){return new this(e).mul(t)}function pr(e,t){return new this(e).pow(t)}function dr(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:z(e,1,me),r=Math.ceil(e/B),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(Et);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=B,r&&e&&(i=V(10,B-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=B)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<B&&(n-=B-r)}return s.e=n,s.d=a,s}function gr(e){return A(e=new this(e),e.e+1,this.rounding)}function hr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function br(e){return new this(e).sin()}function yr(e){return new this(e).sinh()}function wr(e){return new this(e).sqrt()}function Pr(e,t){return new this(e).sub(t)}function Tr(){var e=0,t=arguments,n=new this(t[e]);for(k=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return k=!0,A(n,this.precision,this.rounding)}function xr(e){return new this(e).tan()}function Ar(e){return new this(e).tanh()}function Br(e){return A(e=new this(e),e.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var ke=h.constructor=Vt(it);Ve=new ke(Ve);qe=new ke(qe);var ee=ke;import{PublicKey as lt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as kr}from"@solana/spl-token";import{PublicKey as O,SystemProgram as qt,SYSVAR_RENT_PUBKEY as Sr}from"@solana/web3.js";function ct({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var Bi=[ct({pubkey:kr,isWritable:!1}),ct({pubkey:qt.programId,isWritable:!1}),ct({pubkey:Sr,isWritable:!1})];function Ut({publicKey:e,transformSol:t}){let n=Gt(e.toString());if(n instanceof O)return t&&n.equals(Ce)?Se:n;if(t&&n.toString()===Ce.toBase58())return Se;if(typeof n=="string"){if(n===O.default.toBase58())return O.default;try{return new O(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Gt(e){try{return new O(e)}catch{return e}}var ki=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ht=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),jt=new O("SysvarRent111111111111111111111111111111111"),Si=new O("SysvarC1ock11111111111111111111111111111111"),Ci=new O("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ii=new O("Sysvar1nstructions1111111111111111111111111"),Zt=qt.programId,Li=new O("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ni=new O("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Mi=new O("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ki=new O("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ei=new O("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Di=new O("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ri=new O("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),vi=new O("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),_i=new O("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Oi=new O("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Fi=new O("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Se=new O("So11111111111111111111111111111111111111112"),Ce=O.default;import{PublicKey as Cr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zt}from"@solana/spl-token";var Yt={chainId:101,address:Cr.default.toBase58(),programId:zt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ge={chainId:101,address:"So11111111111111111111111111111111111111112",programId:zt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var ft=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===Ce.toBase58()||t instanceof lt&&Ce.equals(t)){this.decimals=ge.decimals,this.symbol=ge.symbol,this.name=ge.name,this.mint=new lt(ge.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?lt.default:Ut({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Pe=ft;Pe.WSOL=new ft({...ge,mint:ge.address});import{get as Xt,set as Ir}from"lodash";import Qt from"dayjs";import Lr from"dayjs/plugin/utc";Qt.extend(Lr);var mt=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Qt().utc().format("YYYY/MM/DD HH:mm:ss UTC")}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Jt={},Nr={};function H(e){let t=Xt(Jt,e);if(!t){let n=Xt(Nr,e);t=new mt({name:e,logLevel:n}),Ir(Jt,e,t)}return t}import ze from"big.js";import Er from"bn.js";import Dr from"decimal.js-light";import Mr from"toformat";var Kr=Mr,Ie=Kr;var Ze=H("module/fraction"),pt=Ie(ze),Le=Ie(Dr),Rr={[0]:Le.ROUND_DOWN,[1]:Le.ROUND_HALF_UP,[2]:Le.ROUND_UP},vr={[0]:ze.roundDown,[1]:ze.roundHalfUp,[2]:ze.roundUp},_=class{constructor(t,n=new Er(1)){this.numerator=pe(t),this.denominator=pe(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new _(this.denominator,this.numerator)}add(t){let n=t instanceof _?t:new _(pe(t));return this.denominator.eq(n.denominator)?new _(this.numerator.add(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof _?t:new _(pe(t));return this.denominator.eq(n.denominator)?new _(this.numerator.sub(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof _?t:new _(pe(t));return new _(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof _?t:new _(pe(t));return new _(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Ze.logWithError(`${t} is not an integer.`),t<=0&&Ze.logWithError(`${t} is not positive.`),Le.set({precision:t+1,rounding:Rr[r]});let i=new Le(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Ze.logWithError(`${t} is not an integer.`),t<0&&Ze.logWithError(`${t} is negative.`),pt.DP=t,pt.RM=vr[r]||1,new pt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var ho=H("Raydium_price");var dt=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},Ye=dt;Ye.SOL=new dt(Yt);import Or from"bn.js";var $t=new _(new Or(100)),de=class extends _{toSignificant(t=5,n,r){return this.mul($t).toSignificant(t,n,r)}toFixed(t=2,n,r){return this.mul($t).toFixed(t,n,r)}};import{PublicKey as Mo}from"@solana/web3.js";import Eo from"bn.js";var gt=new Y(0),Xo=new Y(1),Jo=new Y(2),Qo=new Y(3),$o=new Y(5),Fr=new Y(10),es=new Y(100),ts=new Y(1e3),ns=new Y(1e4),nn=9007199254740991;function pe(e){let t=H("Raydium_parseBigNumberish");if(e instanceof Y)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Y(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=nn||e<=-nn)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Y(String(e))):typeof e=="bigint"?new Y(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Y(0))}var gs=H("Raydium_amount"),hs=Ie(Wr);import{PublicKey as jr}from"@solana/web3.js";import{PublicKey as Vr,ComputeBudgetProgram as rn,Transaction as sn,TransactionMessage as qr,Keypair as an,VersionedTransaction as un}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ur}from"@solana/spl-token";var se={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};var on=H("Raydium_txUtil"),cn=1644;function Xe(e){let t=[],n=[];return e.microLamports&&(t.push(rn.setComputeUnitPrice({microLamports:e.microLamports})),n.push(se.SetComputeUnitPrice)),e.units&&(t.push(rn.setComputeUnitLimit({units:e.units})),n.push(se.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function Te(e){var t,n;try{return((n=await((t=e.getLatestBlockhash)==null?void 0:t.call(e)))==null?void 0:n.blockhash)||(await e.getRecentBlockhash()).blockhash}catch{return(await e.getRecentBlockhash()).blockhash}}function Gr(e,t){e.length<1&&on.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&on.logWithError(`no signers provided:, ${t.toString()}`);let n=new sn;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<cn}catch{return!1}}function ae(e,t){let[n,r]=Vr.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}function Ne({instructions:e,payer:t,signers:n}){return Gr(e,[t,...n])}function Me({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=an.generate().publicKey.toString()}){let o=new qr({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new un(o).serialize()).toString("base64").length<cn}catch{return!1}}var Hr=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e);function he(e){let t=[];return e.forEach(n=>{n instanceof sn&&(n.recentBlockhash||(n.recentBlockhash=Ur.toBase58()),n.feePayer||(n.feePayer=an.generate().publicKey));let r=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof un&&(r=Hr(r));let i=r.toString("base64");t.push(i)}),console.log("simulate tx string:",t),t}import{TOKEN_PROGRAM_ID as Zr}from"@solana/spl-token";function ln(e,t,n){return ae([e.toBuffer(),(n!=null?n:Zr).toBuffer(),t.toBuffer()],new jr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as Ee,sendAndConfirmTransaction as Pt,Transaction as De,TransactionMessage as Re,VersionedTransaction as ve}from"@solana/web3.js";import Yr from"axios";import{PublicKey as mn,AddressLookupTableAccount as Je}from"@solana/web3.js";import{PublicKey as zr}from"@solana/web3.js";import{getTransferFeeConfig as Ra,unpackMint as va}from"@solana/spl-token";function ht(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as W}from"@solana/web3.js";var Gs=new W("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Hs=new W("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),js=new W("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Zs=new W("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),zs=new W("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ys=new W("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Xs=new W("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Js=new W("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Qs=new W("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),$s=new W("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ea=new W("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ta=new W("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),na=new W("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ra=new W("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ia=new W("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),oa=new W("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),sa=new W("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),aa=new W("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ua=new W("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),ca=new W("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");import te from"bn.js";var Ke=1e4;function xe(e,t,n,r){if(t===void 0)return{amount:e,fee:void 0,expirationTime:void 0};let i={...t,olderTransferFee:{epoch:BigInt(t.olderTransferFee.epoch),maximumFee:BigInt(t.olderTransferFee.maximumFee),transferFeeBasisPoints:t.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(t.newerTransferFee.epoch),maximumFee:BigInt(t.newerTransferFee.maximumFee),transferFeeBasisPoints:t.newerTransferFee.transferFeeBasisPoints}},o=n.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new te(o.maximumFee.toString()),a=n.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*n.slotsInEpoch-n.absoluteSlot)*400/1e3:void 0;if(r)if(o.transferFeeBasisPoints===Ke){let c=new te(o.maximumFee.toString());return{amount:e.add(c),fee:c,expirationTime:a}}else{let c=bt(e.mul(new te(Ke)),new te(Ke-o.transferFeeBasisPoints)),u=new te(o.maximumFee.toString()),l=c.sub(e).gt(u)?e.add(u):c,f=bt(l.mul(new te(o.transferFeeBasisPoints)),new te(Ke)),m=f.gt(s)?s:f;return{amount:l,fee:m,expirationTime:a}}else{let c=bt(e.mul(new te(o.transferFeeBasisPoints)),new te(Ke)),u=c.gt(s)?s:c;return{amount:e,fee:u,expirationTime:a}}}function bt(e,t){let{div:n,mod:r}=e.divmod(t);return r.gt(new te(0))?n.add(new te(1)):n}var yt=H("Raydium_accountInfo_util");async function fn(e,t,n){let{batchRequest:r,commitment:i="confirmed"}={batchRequest:!1,...n},o=ht(t,100),s=new Array(o.length).fill([]);if(r){let a=o.map(l=>{let f=e._buildArgs([l.map(m=>m.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:f}}),c=ht(a,10);s=(await(await Promise.all(c.map(async l=>await e._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&yt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(f=>{if(f){let{data:m,executable:d,lamports:P,owner:p,rentEpoch:y}=f;return m.length!==2&&m[1]!=="base64"&&yt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:d,lamports:P,owner:new zr(p),rentEpoch:y}}return null})))}else try{s=await Promise.all(o.map(a=>e.getMultipleAccountsInfo(a,i)))}catch(a){a instanceof Error&&yt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${a.message}`)}return s.flat()}async function wt({connection:e,address:t}){let n=await fn(e,[...new Set(t.map(i=>i.toString()))].map(i=>new mn(i))),r={};for(let i=0;i<t.length;i++){let o=n[i],s=t[i];if(!o)continue;let a=new Je({key:s,state:Je.deserialize(o.data)});r[s.toString()]=a,Qe[s.toString()]=a}return r}var Qe={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Je({key:new mn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Je.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var $e=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Yr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=Xe(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ee.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0({...n||{}}):this.build(n)}build(t){let n=new De;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var a;let{recentBlockHash:i,skipPreflight:o=!0}=r||{},s=i!=null?i:await Te(this.connection);if(n.recentBlockhash=s,this.signers.length&&n.sign(...this.signers),he([n]),(a=this.owner)!=null&&a.isKeyPair)return{txId:await Pt(this.connection,n,this.signers.find(c=>c.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:o}),signedTx:n};if(this.signAllTransactions){let c=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(c[0].serialize(),{skipPreflight:o}),signedTx:c[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(u=>u.transaction.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async u=>{var p;let{sequentially:l,onTxUpdate:f,recentBlockHash:m,skipPreflight:d=!0}=u||{},P=m!=null?m:await Te(this.connection);if((p=this.owner)!=null&&p.isKeyPair)return{txIds:await await Promise.all(s.map(async(y,g)=>(y.recentBlockhash=P,await Pt(this.connection,y,a[g].find(b=>b.publicKey.equals(this.owner.publicKey))?a[g]:[...a[g],this.owner.signer],{skipPreflight:d})))),signedTxs:s};if(this.signAllTransactions){let y=s.map((b,w)=>(b.recentBlockhash=P,a[w].length&&b.sign(...a[w]),b));he(y);let g=await this.signAllTransactions(y);if(l){let b=0,w=[],T=async()=>{if(!g[b])return;let C=await this.connection.sendRawTransaction(g[b].serialize(),{skipPreflight:d});w.push({txId:C,status:"sent",signedTx:g[b]}),f==null||f([...w]),b++,this.connection.onSignature(C,S=>{let L=w.findIndex(K=>K.txId===C);L>-1&&(w[L].status=S.err?"error":"success"),f==null||f([...w]),S.err||T()},"processed"),this.connection.getSignatureStatus(C)};return await T(),{txIds:w.map(C=>C.txId),signedTxs:g}}else{let b=[];for(let w=0;w<g.length;w+=1){let T=await this.connection.sendRawTransaction(g[w].serialize(),{skipPreflight:d});b.push(T)}return{txIds:b,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){let{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i,...o}=t||{},s={...this.cluster==="devnet"?{}:Qe,...n},a=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let m of a)s[m]===void 0&&c.push(new Ee(m));let u=await wt({connection:this.connection,address:c});for(let[m,d]of Object.entries(u))s[m]=d;let l=new Re({payerKey:this.feePayer,recentBlockhash:i?Ee.default.toBase58():await Te(this.connection),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(s)),f=new ve(l);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async m=>{var p;let{recentBlockHash:d,skipPreflight:P=!0}=m||{};if(d&&(f.message.recentBlockhash=d),he([f]),(p=this.owner)!=null&&p.isKeyPair){this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))||f.sign([this.owner.signer]);let y=await this.connection.sendTransaction(f,{skipPreflight:P}),{lastValidBlockHeight:g,blockhash:b}=await this.connection.getLatestBlockhash();return await this.connection.confirmTransaction({blockhash:b,lastValidBlockHeight:g,signature:y},"confirmed"),{txId:y,signedTx:f}}if(this.signAllTransactions){let y=await this.signAllTransactions([f]);return{txId:await this.connection.sendTransaction(y[0],{skipPreflight:P}),signedTx:y[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async buildV0MultiTx(t){let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(u=>u.builder.instructions.length>0),s=[i,...o.map(u=>u.transaction)],a=[this.signers,...o.map(u=>u.signers)],c=[...this.instructionTypes,...o.map(u=>u.instructionTypes).flat()];return s.forEach(async(u,l)=>{u.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:r,execute:async u=>{var P;let{sequentially:l,onTxUpdate:f,recentBlockHash:m,skipPreflight:d=!0}=u||{};if(m&&s.forEach(p=>p.message.recentBlockhash=m),he(s),(P=this.owner)!=null&&P.isKeyPair){let{lastValidBlockHeight:p,blockhash:y}=await this.connection.getLatestBlockhash();return s.forEach((g,b)=>{a[b].find(w=>w.publicKey.equals(this.owner.publicKey))||g.sign([this.owner.signer])}),{txIds:await Promise.all(s.map(async g=>{let b=await this.connection.sendTransaction(g,{skipPreflight:d});return await this.connection.confirmTransaction({blockhash:y,lastValidBlockHeight:p,signature:b},"confirmed"),b})),signedTxs:s}}if(this.signAllTransactions){let p=await this.signAllTransactions(s);if(l){let y=0,g=[],b=async()=>{if(!p[y])return;let w=await this.connection.sendTransaction(p[y],{skipPreflight:d});g.push({txId:w,status:"sent",signedTx:p[y]}),f==null||f([...g]),y++,this.connection.onSignature(w,T=>{let C=g.findIndex(S=>S.txId===w);C>-1&&(g[C].status=T.err?"error":"success"),f==null||f([...g]),T.err||b()},"processed"),this.connection.getSignatureStatus(w)};return b(),{txIds:[],signedTxs:p}}else{let y=[];for(let g=0;g<p.length;g+=1){let b=await this.connection.sendTransaction(p[g],{skipPreflight:d});y.push(b)}return{txIds:y,signedTxs:p}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){let{computeBudgetConfig:n,...r}=t||{},i=n?Xe(n):{instructions:[],instructionTypes:[]},o=this.signers.reduce((u,l)=>({...u,[l.publicKey.toBase58()]:l}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(u=>{let l=[...c,u],f=n?[...i.instructions,...l]:l,d=[...new Set(l.map(P=>P.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(P=>new Ee(P));if(c.length<12&&Ne({instructions:f,payer:this.feePayer,signers:d})||Ne({instructions:l,payer:this.feePayer,signers:d}))c.push(u);else{if(c.length===0)throw Error("item ins too big");Ne({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:d})?s.push(new De().add(...i.instructions,...c)):s.push(new De().add(...c)),a.push(Array.from(new Set(c.map(P=>P.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat())).map(P=>o[P]).filter(P=>P!==void 0)),c=[u]}}),c.length>0){let l=[...new Set(c.map(f=>f.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()).values()].map(f=>o[f]).filter(f=>f!==void 0);Ne({instructions:n?[...i.instructions,...c]:[...c],payer:this.feePayer,signers:l.map(f=>f.publicKey)})?s.push(new De().add(...i.instructions,...c)):s.push(new De().add(...c)),a.push(l)}return s.forEach(u=>u.feePayer=this.feePayer),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async u=>{var p;let{sequentially:l,onTxUpdate:f,recentBlockHash:m,skipPreflight:d=!0}=u||{},P=m!=null?m:await Te(this.connection);if(s.forEach(async(y,g)=>{y.recentBlockhash=P,a[g].length&&y.sign(...a[g])}),he(s),(p=this.owner)!=null&&p.isKeyPair)return{txIds:await Promise.all(s.map(async(y,g)=>await Pt(this.connection,y,a[g].find(b=>b.publicKey.equals(this.owner.publicKey))?a[g]:[...a[g],this.owner.signer],{skipPreflight:d}))),signedTxs:s};if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(l){let g=0,b=[],w=async()=>{if(!y[g])return;let T=await this.connection.sendRawTransaction(y[g].serialize(),{skipPreflight:d});b.push({txId:T,status:"sent",signedTx:y[g]}),f==null||f([...b]),g++,this.connection.onSignature(T,C=>{let S=b.findIndex(L=>L.txId===T);S>-1&&(b[S].status=C.err?"error":"success"),f==null||f([...b]),C.err||w()},"processed"),this.connection.getSignatureStatus(T)};return await w(),{txIds:b.map(T=>T.txId),signedTxs:y}}else{let g=[];for(let b=0;b<y.length;b+=1){let w=await this.connection.sendRawTransaction(y[b].serialize(),{skipPreflight:d});g.push(w)}return{txIds:g,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){let{computeBudgetConfig:n,lookupTableCache:r={},lookupTableAddress:i=[],...o}=t||{},s={...this.cluster==="devnet"?{}:Qe,...r},a=Array.from(new Set([...this.lookupTableAddress,...i])),c=[];for(let y of a)s[y]===void 0&&c.push(new Ee(y));let u=await wt({connection:this.connection,address:c});for(let[y,g]of Object.entries(u))s[y]=g;let l=n?Xe(n):{instructions:[],instructionTypes:[]},f=await Te(this.connection),m=this.signers.reduce((y,g)=>({...y,[g.publicKey.toBase58()]:g}),{}),d=[],P=[],p=[];if(this.allInstructions.forEach(y=>{let g=[...p,y],b=n?[...l.instructions,...g]:g;if(p.length<12&&Me({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s})||Me({instructions:g,payer:this.feePayer,lookupTableAddressAccount:s}))p.push(y);else{if(p.length===0)throw Error("item ins too big");let w={};for(let T of[...new Set(a)])s[T]!==void 0&&(w[T]=s[T]);if(n&&Me({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let T=new Re({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));d.push(new ve(T))}else{let T=new Re({payerKey:this.feePayer,recentBlockhash:f,instructions:[...p]}).compileToV0Message(Object.values(s));d.push(new ve(T))}P.push(Array.from(new Set(p.map(T=>T.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(T=>m[T]).filter(T=>T!==void 0)),p=[y]}}),p.length>0){let g=[...new Set(p.map(b=>b.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(b=>m[b]).filter(b=>b!==void 0);if(n&&Me({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let b=new Re({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));d.push(new ve(b))}else{let b=new Re({payerKey:this.feePayer,recentBlockhash:f,instructions:[...p]}).compileToV0Message(Object.values(s));d.push(new ve(b))}P.push(g)}return{builder:this,transactions:d,buildProps:t,signers:P,instructionTypes:this.instructionTypes,execute:async y=>{var C;let{sequentially:g,onTxUpdate:b,recentBlockHash:w,skipPreflight:T=!0}=y||{};if(d.map(async(S,L)=>{P[L].length&&S.sign(P[L]),w&&(S.message.recentBlockhash=w)}),he(d),(C=this.owner)!=null&&C.isKeyPair){let{lastValidBlockHeight:S,blockhash:L}=await this.connection.getLatestBlockhash();return d.forEach((K,I)=>{P[I].find(F=>F.publicKey.equals(this.owner.publicKey))||K.sign([this.owner.signer])}),{txIds:await Promise.all(d.map(async K=>{let I=await this.connection.sendTransaction(K,{skipPreflight:T});return await this.connection.confirmTransaction({blockhash:L,lastValidBlockHeight:S,signature:I},"confirmed"),I})),signedTxs:d}}if(this.signAllTransactions){let S=await this.signAllTransactions(d);if(g){let L=0,K=[],I=async()=>{if(!S[L])return;let F=await this.connection.sendTransaction(S[L],{skipPreflight:T});K.push({txId:F,status:"sent",signedTx:S[L]}),b==null||b([...K]),L++,this.connection.onSignature(F,E=>{let Z=K.findIndex(J=>J.txId===F);Z>-1&&(K[Z].status=E.err?"error":"success"),b==null||b([...K]),E.err||I()},"processed"),this.connection.getSignatureStatus(F)};return I(),{txIds:[],signedTxs:S}}else{let L=[];for(let K=0;K<S.length;K+=1){let I=await this.connection.sendTransaction(S[K],{skipPreflight:T});L.push(I)}return{txIds:L,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};var Tt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),_e=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=H(n)}createTxBuilder(t){return this.scope.checkOwner(),new $e({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Tt(t))}logInfo(...t){this.logger.info(Tt(t))}logAndCreateError(...t){let n=Tt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Xr=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Jr=Buffer.from("amm_config","utf8"),Qr=Buffer.from("pool","utf8"),$r=Buffer.from("pool_lp_mint","utf8"),ei=Buffer.from("pool_vault","utf8"),ti=Buffer.from("observation","utf8");function ni(e){return ae([Xr],e)}function ri(e,t){return ae([Jr,si(t)],e)}function ii(e,t,n,r){return ae([Qr,t.toBuffer(),n.toBuffer(),r.toBuffer()],e)}function oi(e,t){return ae([$r,t.toBuffer()],e)}function pn(e,t,n){return ae([ei,t.toBuffer(),n.toBuffer()],e)}function et(e,t){return ae([ti,t.toBuffer()],e)}function si(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e,!1),new Uint8Array(t)}function dn({programId:e,mintA:t,mintB:n}){let r=ri(e,0).publicKey,i=ni(e).publicKey,o=ii(e,r,t,n).publicKey,s=oi(e,o).publicKey,a=pn(e,o,t).publicKey,c=pn(e,o,n).publicKey,u=et(e,o).publicKey;return{poolId:o,configId:r,authority:i,lpMint:s,vaultA:a,vaultB:c,observationId:u}}import{TransactionInstruction as Oe}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as St,TOKEN_2022_PROGRAM_ID as An,ASSOCIATED_TOKEN_PROGRAM_ID as bi}from"@solana/spl-token";import{PublicKey as di}from"@solana/web3.js";import Pn,{isBN as Tn}from"bn.js";import{bits as uu,BitStructure as cu,blob as ai,Blob as lu,cstr as fu,f32 as mu,f32be as pu,f64 as du,f64be as gu,greedy as hu,Layout as ui,ns64 as bu,ns64be as yu,nu64 as wu,nu64be as Pu,offset as Tu,s16 as xu,s16be as Au,s24 as Bu,s24be as ku,s32 as Su,s32be as Cu,s40 as Iu,s40be as Lu,s48 as Nu,s48be as Mu,s8 as Ku,seq as ci,struct as Eu,Structure as li,u16 as fi,u16be as Du,u24 as Ru,u24be as vu,u32 as _u,u32be as Ou,u40 as Fu,u40be as Wu,u48 as Vu,u48be as qu,u8 as mi,UInt as pi,union as Uu,Union as Gu,unionLayoutDiscriminator as Hu,utf8 as ju}from"@solana/buffer-layout";var xt=ui,gn=li;var hn=pi;var bn=mi,yn=fi;var wn=ci;var Ae=ai;var At=class extends xt{constructor(n,r,i){super(n,i);this.blob=Ae(n),this.signed=r}decode(n,r=0){let i=new Pn(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new Pn(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}};function be(e){return new hn(1,e)}function R(e){return new At(8,!1,e)}var tt=class extends xt{constructor(n,r,i,o){super(n.span,o);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function X(e){return new tt(Ae(32),t=>new di(t),t=>t.toBuffer(),e)}function xn(e){return new tt(bn(),gi,hi,e)}function gi(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function hi(e){return e?1:0}var Bt=class extends gn{decode(t,n){return super.decode(t,n)}};function ue(e,t,n){return new Bt(e,t,n)}function kt(e,t,n){let r,i=typeof t=="number"?t:Tn(t)?t.toNumber():new Proxy(t,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=Tn(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return wn(e,i,n)}var yi=H("Raydium_cpmm"),Fe={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function Bn(e,t,n,r,i,o,s,a,c,u,l,f,m,d,P,p,y,g,b,w){let T=ue([R("amountMaxA"),R("amountMaxB"),R("openTime")]),C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:St,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:bi,isSigner:!1,isWritable:!1},{pubkey:Zt,isSigner:!1,isWritable:!1},{pubkey:jt,isSigner:!1,isWritable:!1}],S=Buffer.alloc(T.span);return T.encode({amountMaxA:g,amountMaxB:b,openTime:w},S),new Oe({keys:C,programId:e,data:Buffer.from([...Fe.initialize,...S])})}function kn(e,t,n,r,i,o,s,a,c,u,l,f,m,d,P){let p=ue([R("lpAmount"),R("amountMaxA"),R("amountMaxB")]),y=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:St,isSigner:!1,isWritable:!1},{pubkey:An,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!0}],g=Buffer.alloc(p.span);return yi.debug("cpmm deposit data",{lpAmount:m.toString(),amountMaxA:d.toString(),amountMaxB:P.toString()}),p.encode({lpAmount:m,amountMaxA:d,amountMaxB:P},g),new Oe({keys:y,programId:e,data:Buffer.from([...Fe.deposit,...g])})}function Sn(e,t,n,r,i,o,s,a,c,u,l,f,m,d,P){let p=ue([R("lpAmount"),R("amountMinA"),R("amountMinB")]),y=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:St,isSigner:!1,isWritable:!1},{pubkey:An,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Ht,isSigner:!1,isWritable:!1}],g=Buffer.alloc(p.span);return p.encode({lpAmount:m,amountMinA:d,amountMinB:P},g),new Oe({keys:y,programId:e,data:Buffer.from([...Fe.withdraw,...g])})}function Cn(e,t,n,r,i,o,s,a,c,u,l,f,m,d,P,p){let y=ue([R("amountIn"),R("amounOutMin")]),g=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],b=Buffer.alloc(y.span);return y.encode({amountIn:P,amounOutMin:p},b),new Oe({keys:g,programId:e,data:Buffer.from([...Fe.swapBaseInput,...b])})}function In(e,t,n,r,i,o,s,a,c,u,l,f,m,d,P,p){let y=ue([R("amountInMax"),R("amountOut")]),g=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],b=Buffer.alloc(y.span);return y.encode({amountInMax:P,amountOut:p},b),new Oe({keys:g,programId:e,data:Buffer.from([...Fe.swapBaseOutput,...b])})}import j from"bn.js";var Ln=ue([Ae(8),be("bump"),xn("disableCreatePool"),yn("index"),R("tradeFeeRate"),R("protocolFeeRate"),R("fundFeeRate"),R("createPoolFee"),X("protocolOwner"),X("fundOwner"),kt(R(),16)]),Nn=ue([Ae(8),X("configId"),X("poolCreator"),X("vaultA"),X("vaultB"),X("mintLp"),X("mintA"),X("mintB"),X("mintProgramA"),X("mintProgramB"),X("observationId"),be("bump"),be("status"),be("lpDecimals"),be("mintDecimalA"),be("mintDecimalB"),R("lpAmount"),R("protocolFeesMintA"),R("protocolFeesMintB"),R("fundFeesMintA"),R("fundFeesMintB"),R("openTime"),kt(R(),32)]);var Ct=class extends _e{constructor(t){super(t)}async load(){this.checkDisabled()}async getCpmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async getRpcPoolInfo(t,n){let r=await this.scope.connection.getAccountInfo(new x(t));if(!r)throw new Error(`pool not found: ${t}`);let i=Nn.decode(r.data),[o,s]=await this.scope.connection.getMultipleAccountsInfo([i.vaultA,i.vaultB]);if(!o)throw new Error(`pool vaultA info not found: ${i.vaultA.toBase58()}`);if(!s)throw new Error(`pool vaultB info not found: ${i.vaultB.toBase58()}`);let a;if(n){let c=await this.scope.connection.getAccountInfo(i.configId);c&&(a=Ln.decode(c.data))}return{...i,baseReserve:new j(Mn.decode(o.data).amount.toString()).sub(i.protocolFeesMintA).sub(i.fundFeesMintA),quoteReserve:new j(Mn.decode(s.data).amount.toString()).sub(i.protocolFeesMintB).sub(i.fundFeesMintB),configInfo:a}}async createPool({programId:t,poolFeeAccount:n,startTime:r,ownerInfo:i,associatedOnly:o=!1,checkCreateATAOwner:s=!1,txVersion:a,computeBudgetConfig:c,...u}){var F,E,Z;let l=i.feePayer||((F=this.scope.owner)==null?void 0:F.publicKey),f=new j(new x(u.mintA.address).toBuffer()).lte(new j(new x(u.mintB.address).toBuffer())),[m,d]=f?[u.mintA,u.mintB]:[u.mintB,u.mintA],[P,p]=f?[u.mintAAmount,u.mintBAmount]:[u.mintBAmount,u.mintAAmount],y=i.useSOLBalance&&m.address===nt.toBase58(),g=i.useSOLBalance&&d.address===nt.toBase58(),[b,w]=[new x(m.address),new x(d.address)],T=this.createTxBuilder(),{account:C,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({mint:b,tokenProgram:m.programId,owner:this.scope.ownerPubKey,createInfo:y?{payer:l,amount:P}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:o,checkCreateATAOwner:s});T.addInstruction(S||{});let{account:L,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({mint:new x(d.address),tokenProgram:d.programId,owner:this.scope.ownerPubKey,createInfo:g?{payer:l,amount:p}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:o,checkCreateATAOwner:s});if(T.addInstruction(K||{}),C===void 0||L===void 0)throw Error("you don't has some token account");let I=dn({programId:t,mintA:b,mintB:w});return T.addInstruction({instructions:[Bn(t,this.scope.ownerPubKey,I.configId,I.authority,I.poolId,b,w,I.lpMint,C,L,ln(this.scope.ownerPubKey,I.lpMint).publicKey,I.vaultA,I.vaultB,n,new x((E=m.programId)!=null?E:re),new x((Z=d.programId)!=null?Z:re),I.observationId,P,p,r)],instructionTypes:[se.CpmmCreatePool]}),T.addCustomComputeBudget(c),T.versionBuild({txVersion:a,extInfo:{address:{...I,mintA:m,mintB:d,programId:t,poolFeeAccount:n}}})}async addLiquidity(t){let{poolInfo:n,inputAmount:r,baseIn:i,slippage:o,computeResult:s,computeBudgetConfig:a,config:c,txVersion:u}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),r.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:r.toString()});let{account:l}=this.scope,{bypassAssociatedCheck:f,checkCreateATAOwner:m}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...c},d=await this.getRpcPoolInfo(n.id),{liquidity:P,inputAmountFee:p,anotherAmount:y}=s||this.computePairAmount({poolInfo:{...n,mintAmountA:new ee(d.baseReserve.toString()).div(10**n.mintA.decimals).toNumber(),mintAmountB:new ee(d.quoteReserve.toString()).div(10**n.mintB.decimals).toNumber(),lpAmount:new ee(d.lpAmount.toString()).div(10**n.lpMint.decimals).toNumber()},slippage:o,baseIn:i,epochInfo:await this.scope.fetchEpochInfo(),amount:new ee(r.toString()).div(10**(i?n.mintA.decimals:n.mintB.decimals))}),g=y.amount,b=n.mintA.address===nt.toString(),w=n.mintB.address===nt.toString(),T=this.createTxBuilder(),[C,S]=[new x(n.mintA.address),new x(n.mintB.address)],{account:L,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.mintA.programId,mint:new x(n.mintA.address),owner:this.scope.ownerPubKey,createInfo:b||(i?r:g).isZero()?{payer:this.scope.ownerPubKey,amount:i?r:g}:void 0,skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:!1,checkCreateATAOwner:m});T.addInstruction(K||{});let{account:I,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.mintB.programId,mint:new x(n.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||(i?g:r).isZero()?{payer:this.scope.ownerPubKey,amount:i?g:r}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:!1,checkCreateATAOwner:m});T.addInstruction(F||{}),!L&&!I&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let E=await l.getCreatedTokenAccount({mint:new x(n.lpMint.address)}),{tokenAccount:Z,...J}=await l.handleTokenAccount({side:"out",amount:0,mint:new x(n.lpMint.address),tokenAccount:E,bypassAssociatedCheck:f,checkCreateATAOwner:m});T.addInstruction(J);let ie=await this.getCpmmPoolKeys(n.id);return T.addInstruction({instructions:[kn(new x(n.programId),this.scope.ownerPubKey,new x(ie.authority),new x(n.id),Z,L,I,new x(ie.vault.A),new x(ie.vault.B),C,S,new x(n.lpMint.address),P,i?p.amount:g,i?g:p.amount)],instructionTypes:[se.CpmmAddLiquidity],lookupTableAddress:ie.lookupTableAccount?[ie.lookupTableAccount]:[]}),T.addCustomComputeBudget(a),T.versionBuild({txVersion:u})}async withdrawLiquidity(t){var Z,J;let{poolInfo:n,lpAmount:r,slippage:i,computeBudgetConfig:o,txVersion:s}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let a=new de(new j(1)).sub(i),c=await this.getRpcPoolInfo(n.id),[u,l]=[a.mul(r.mul(c.baseReserve).div(c.lpAmount)).quotient,a.mul(r.mul(c.quoteReserve).div(c.lpAmount)).quotient],f=await this.scope.fetchEpochInfo(),[m,d]=[xe(u,n.mintA.extensions.feeConfig,f,!0),xe(l,n.mintB.extensions.feeConfig,f,!0)],{account:P}=this.scope,p=this.createTxBuilder(),[y,g]=[new x(n.mintA.address),new x(n.mintB.address)],b=y.equals(Se),w=g.equals(Se),T,C,{account:S,instructionParams:L}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.mintA.programId,mint:new x(n.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:!b,checkCreateATAOwner:!1});T=S,L&&p.addInstruction(L);let{account:K,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.mintB.programId,mint:new x(n.mintB.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,associatedOnly:!w,checkCreateATAOwner:!1});C=K,I&&p.addInstruction(I),(!T||!C)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",P.tokenAccounts);let F=await P.getCreatedTokenAccount({mint:new x(n.lpMint.address)});F||this.logAndCreateError("cannot found lp token account","tokenAccounts",P.tokenAccounts);let E=await this.getCpmmPoolKeys(n.id);return p.addInstruction({instructions:[Sn(new x(n.programId),this.scope.ownerPubKey,new x(E.authority),new x(n.id),F,T,C,new x(E.vault.A),new x(E.vault.B),y,g,new x(n.lpMint.address),r,u.sub((Z=m.fee)!=null?Z:new j(0)),l.sub((J=d.fee)!=null?J:new j(0)))],instructionTypes:[se.CpmmWithdrawLiquidity],lookupTableAddress:E.lookupTableAccount?[E.lookupTableAccount]:[]}),p.addCustomComputeBudget(o),p.versionBuild({txVersion:s})}async swap(t){var T,C,S,L,K,I,F,E;let{poolInfo:n,baseIn:r,swapResult:i,config:o,computeBudgetConfig:s,txVersion:a}=t,{bypassAssociatedCheck:c,checkCreateATAOwner:u}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...o},l=this.createTxBuilder(),[f,m]=[new x(n.mintA.address),new x(n.mintB.address)],d=await this.scope.account.getCreatedTokenAccount({programId:new x((T=n.mintA.programId)!=null?T:re),mint:f,associatedOnly:!1}),P=await this.scope.account.getCreatedTokenAccount({programId:new x((C=n.mintB.programId)!=null?C:re),mint:m,associatedOnly:!1}),{tokenAccount:p,...y}=await this.scope.account.handleTokenAccount({side:r?"in":"out",amount:r?i.sourceAmountSwapped:i.destinationAmountSwapped,mint:f,tokenAccount:d,bypassAssociatedCheck:c,checkCreateATAOwner:u,programId:new x((S=n.mintA.programId)!=null?S:re)});l.addInstruction(y);let{tokenAccount:g,...b}=await this.scope.account.handleTokenAccount({side:r?"out":"in",amount:r?i.destinationAmountSwapped:i.sourceAmountSwapped,mint:m,tokenAccount:P,bypassAssociatedCheck:c,checkCreateATAOwner:u,programId:new x((L=n.mintB.programId)!=null?L:re)});l.addInstruction(b),!p&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let w=await this.getCpmmPoolKeys(n.id);return l.addInstruction({instructions:[r?Cn(new x(n.programId),this.scope.ownerPubKey,new x(w.authority),new x(w.config.id),new x(n.id),p,g,new x(w.vault.A),new x(w.vault.B),new x((K=n.mintA.programId)!=null?K:re),new x((I=n.mintB.programId)!=null?I:re),f,m,et(new x(n.programId),new x(n.id)).publicKey,i.sourceAmountSwapped,i.destinationAmountSwapped):In(new x(n.programId),this.scope.ownerPubKey,new x(w.authority),new x(w.config.id),new x(n.id),g,p,new x(w.vault.B),new x(w.vault.A),new x((F=n.mintB.programId)!=null?F:re),new x((E=n.mintA.programId)!=null?E:re),m,f,et(new x(n.programId),new x(n.id)).publicKey,i.sourceAmountSwapped,i.destinationAmountSwapped)],instructionTypes:[r?se.CpmmSwapBaseIn:se.CpmmSwapBaseOut]}),l.addCustomComputeBudget(s),l.versionBuild({txVersion:a})}computePairAmount({poolInfo:t,amount:n,slippage:r,epochInfo:i,baseIn:o}){var b,w,T,C,S,L,K,I;let s=1-Number(r.toSignificant())/100,a=new j(new ee(n).mul(10**t[o?"mintA":"mintB"].decimals).mul(s).toFixed(0)),c=xe(a,t[o?"mintA":"mintB"].extensions.feeConfig,i,!1),u=a.sub((b=c.fee)!=null?b:new j(0)),[l,f]=[new j(new ee(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new j(new ee(t.mintAmountB).mul(10**t.mintB.decimals).toString())],m=new j(new ee(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,ee.ROUND_DOWN));this.logDebug("baseReserve:",l.toString(),"quoteReserve:",f.toString()),this.logDebug("tokenIn:",o?t.mintA.symbol:t.mintB.symbol,"amountIn:",a.toString(),"amountInFee:",(T=(w=c.fee)==null?void 0:w.toString())!=null?T:0,"anotherToken:",o?t.mintB.symbol:t.mintA.symbol,"slippage:",`${r.toSignificant()}%`);let d=o?"base":"quote";this.logDebug("input side:",d);let P=u.mul(m).div(d==="base"?l:f),p={amount:gt,fee:void 0,expirationTime:void 0};u.isZero()||(p=xe(wi(P,l,f,m)[o?"amountB":"amountA"],t[o?"mintB":"mintA"].extensions.feeConfig,i,!0));let y=new de(new j(1)).add(r),g=xe(y.mul(p.amount.sub((C=p.fee)!=null?C:new j(0))).quotient,t[o?"mintB":"mintA"].extensions.feeConfig,i,!0);return this.logDebug("anotherAmount:",p.amount.toString(),"anotherAmountFee:",(L=(S=p.fee)==null?void 0:S.toString())!=null?L:0,"maxAnotherAmount:",g.amount.toString(),"maxAnotherAmountFee:",(I=(K=g.fee)==null?void 0:K.toString())!=null?I:0),{inputAmountFee:c,anotherAmount:p,maxAnotherAmount:g,liquidity:P}}};function wi(e,t,n,r){let i=e.mul(t).div(r);!i.isZero()&&!e.mul(t).mod(r).isZero()&&(i=i.add(new j(1)));let o=e.mul(n).div(r);return!o.isZero()&&!e.mul(n).mod(r).isZero()&&(o=o.add(new j(1))),{amountA:i,amountB:o}}export{Ct as default};
/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */
//# sourceMappingURL=cpmm.mjs.map